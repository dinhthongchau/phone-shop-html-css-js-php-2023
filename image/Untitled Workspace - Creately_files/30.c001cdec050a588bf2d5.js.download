(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{C7fj:function(t,e,n){"use strict";n.r(e),n.d(e,"EditorModule",(function(){return pl}));var i=n("5xGT"),a=n("CNgt"),o=n("EM62"),r=n("s2Ay"),s=function(){function t(t){this.state=t}return t.prototype.openFullScreen=function(){this.state.set("LeftSidebarVisibility",!0),this.state.set("FolderPanelScreen",a.a.FULL_SCREEN)},t.\u0275fac=function(e){return new(e||t)(o.gc(i.Nb))},t.\u0275cmp=o.ac({type:t,selectors:[["dashboard-canvas-message"]],decls:7,vars:0,consts:[[1,"fx-cover","dashboard-canvas-message-container"],[1,"dashboard-canvas-message-box"],["translate","",1,"dashboard-canvas-message-title"],[1,"dashboard-canvas-message-button"],["translate","",1,"btn-medium","btn-primary","fx-no-margin",3,"click"]],template:function(t,e){1&t&&(o.mc(0,"div",0),o.mc(1,"div",1),o.mc(2,"h2",2),o.gd(3,"MESSAGES.DASHBOARD_CANVAS_MESSAGE"),o.lc(),o.mc(4,"div",3),o.mc(5,"button",4),o.uc("click",(function(){return e.openFullScreen()})),o.gd(6," BUTTONS.VIEW_WORKSPACES "),o.lc(),o.lc(),o.lc(),o.lc())},directives:[r.a],styles:[".dashboard-canvas-message-container[_ngcontent-%COMP%]{z-index:2;background-color:#f0f0f0}.dashboard-canvas-message-box[_ngcontent-%COMP%]{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%)}.dashboard-canvas-message-box[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{text-align:center}.dashboard-canvas-message-title[_ngcontent-%COMP%]{margin-bottom:12px}"]}),t}(),c=n("pi4j"),l=n("+ETr"),u=n("PmVp"),d=n("oggG"),p=n("3AeD"),h=n("STWM"),g=n("Jzy8"),f=n("w1VY"),b=n("QoSw"),m=n("wx9+"),v=n("W9bu"),y=n("X0jn"),S=n("NNJu"),O=n("C05f"),x=n("g6G6"),C=n("6Oco"),P=n("KTx3"),T=n("TLy2"),w=n("3mST"),j=n("J+dc"),M=n("8j5Y"),I=n("YtkY"),E=n("xVbo"),D=n("c7W3"),_=n("r3/A"),k=n("2kYt"),A=n("Wrqg"),L=["textInput"],B=["container"];function R(t,e){if(1&t){var n=o.nc();o.mc(0,"div",13),o.mc(1,"a",14),o.uc("blur",(function(){return o.Rc(n),o.yc(2).onBlur()}))("click",(function(t){return o.Rc(n),o.yc(2).navigate(t)})),o.gd(2),o.lc(),o.lc()}if(2&t){var i=e.ngIf;o.Sb(2),o.hd(i)}}function N(t,e){if(1&t){var n=o.nc();o.mc(0,"div",6),o.ed(1,R,3,1,"div",7),o.mc(2,"button",8),o.uc("click",(function(){return o.Rc(n),o.yc().onEditBtnClick()})),o.xc(),o.mc(3,"svg",9),o.hc(4,"use",10),o.lc(),o.lc(),o.wc(),o.mc(5,"button",11),o.uc("click",(function(){return o.Rc(n),o.yc().removeLink()})),o.xc(),o.mc(6,"svg",9),o.hc(7,"use",12),o.lc(),o.lc(),o.lc()}if(2&t){var i=o.yc();o.Sb(1),o.Dc("ngIf",i.editorState.value.value)}}function H(t,e){if(1&t){var n=o.nc();o.mc(0,"div"),o.mc(1,"text-input",15,16),o.uc("updateText",(function(){return o.Rc(n),o.yc().handleInputChange()}))("keydown",(function(t){return o.Rc(n),o.yc().handleKeydown(t)}))("blur",(function(){return o.Rc(n),o.yc().onBlur()})),o.zc(3,"translate"),o.lc(),o.lc()}if(2&t){var i=o.yc();o.Sb(1),o.Ec("placeholder",o.Ac(3,2,"LABELS.ADD_LINK_AND_ENTER")),o.Dc("value",i.editorState.value.value)}}function F(t,e){1&t&&(o.mc(0,"div",17),o.gd(1,"LABELS.PRESS_ESCAPE_TO_CANCEL"),o.lc())}var G,q=function(){function t(t,e,n,i,a,o){this.ll=t,this.viewportService=e,this.linkService=n,this.commandService=i,this.dtov=a,this.state=o,this.toolbarGap=2,this.subs=[],this.editorState=new O.a({state:"view",value:""}),this.shapelinkViewValue=new O.a(""),this.shapelinkEditValue=new O.a("")}return Object.defineProperty(t.prototype,"containerElement",{get:function(){return this.container.nativeElement},enumerable:!1,configurable:!0}),t.prototype.ngAfterViewInit=function(){var t=this;this.containerElement.style.display="none",this.subs.push(this.state.changes("ShapelinkEditState").pipe(Object(T.a)((function(e){return e.open?(t.updateLinkValue(),t.containerElement.style.display="block",t.textInput&&t.textInput.focus(),t.position(),Object(x.a)(t.state.changes("Selected").pipe(Object(w.a)(1),Object(j.a)(1),Object(M.a)((function(){return t.closeEditor()}))),t.onEscape().pipe(Object(M.a)((function(){return t.closeEditor()}))),t.viewportService.getShapeModels().pipe(Object(M.a)((function(){return t.position()}))))):(t.containerElement.style.display="none",Object(C.b)())}))).subscribe())},t.prototype.onBlur=function(){this.closeEditor()},t.prototype.onEditBtnClick=function(){i.Pb.track("shapelinkEditor.edit.click");var t=this.linkData&&this.linkData.link&&this.linkData.link.link?this.linkData.link.link:"";this.editorState.next({state:"edit",value:t||""})},t.prototype.ngOnDestroy=function(){for(;this.subs.length;)this.subs.pop().unsubscribe()},t.prototype.handleKeydown=function(t){t.keyCode===y.m.Enter?(t.preventDefault(),this.applyLink()):t.keyCode===y.m.Escape&&this.closeEditor()},t.prototype.handleInputChange=function(){this.containerElement.classList.contains("invalid-url")&&this.containerElement.classList.remove("invalid-url")},t.prototype.navigate=function(t){t.preventDefault(),this.linkService.navigate(this.linkData.link)},t.prototype.updateLinkValue=function(){var t=this;this.getLinkAndSource().subscribe((function(e){e.link?t.editorState.next({state:"view",value:e.link.placeHolder||e.link.link}):(t.editorState.next({state:"edit",value:""}),t.textInput&&t.textInput.clear()),t.linkData=e}))},t.prototype.getLinkAndSource=function(){var t=this.state.get("Selected");return 1===t.length?this.ll.forCurrent(!1).getShapeOnce(t[0]).pipe(Object(I.a)((function(e){return{link:e.links?e.links[0]:void 0,source:{type:"s",id:t[0]}}}))):t.length>1?this.ll.forCurrent(!1).getDiagramOnce().pipe(Object(I.a)((function(e){var n,i;if(e.isShapeInGroup(t)){var a=e.getGroupId(t[0]);return{link:null===(i=null===(n=e.groups[a])||void 0===n?void 0:n.links)||void 0===i?void 0:i[0],source:{type:"g",id:t[0]}}}return null}))):void 0},t.prototype.position=function(){var t=this;this.getSelectionBounds().subscribe((function(e){var n=t.containerElement.getBoundingClientRect(),i=t.dtov.x(e.centerX)-n.width/2,a=t.dtov.y(e.bottom)+10;t.containerElement.style.top=a+"px",t.containerElement.style.left=i+"px"}))},t.prototype.onEscape=function(){return Object(P.a)(window,"keydown").pipe(Object(E.a)((function(t){return t.keyCode===y.m.Escape})))},t.prototype.closeEditor=function(){this.editorState.next({state:"edit",value:""}),this.commandService.dispatch(D.a.openShapelinkEditor,{open:!1})},t.prototype.removeLink=function(){i.Pb.track("shapelinkEditor.unlink.click"),this.commandService.dispatch(D.a.applyShapelink,{source:this.linkData.source,link:this.linkData.link,isDelete:!0}),this.closeEditor()},t.prototype.applyLink=function(){if(this.textInput&&this.textInput.value){var t=encodeURI(this.textInput.value);if(_(t)||(t="https://"+t),!_(t))return void this.containerElement.classList.add("invalid-url");var e=g.E.fromUrl(t);this.commandService.dispatch(D.a.applyShapelink,{source:this.linkData.source,link:e,curLink:this.linkData.link})}this.closeEditor()},t.prototype.getSelectionBounds=function(){var t=this.state.get("Selected");return this.ll.forCurrent(!0).getDiagramOnce().pipe(Object(I.a)((function(e){return e.getBounds(t)})))},t.\u0275fac=function(e){return new(e||t)(o.gc(b.a),o.gc(m.a),o.gc(v.a),o.gc(i.B),o.gc(f.a),o.gc(i.Nb))},t.\u0275cmp=o.ac({type:t,selectors:[["shapelink-editor"]],viewQuery:function(t,e){var n;(1&t&&(o.ld(L,!0),o.ld(B,!0)),2&t)&&(o.Mc(n=o.vc())&&(e.textInput=n.first),o.Mc(n=o.vc())&&(e.container=n.first))},decls:8,vars:7,consts:[[1,"shapelink-editor-container"],["container",""],[1,"shapelink-editor-inner-container"],["class","fx-height-inherit fx-center-vertical",4,"ngIf"],[4,"ngIf"],["class","fx-center caption","translate","",4,"ngIf"],[1,"fx-height-inherit","fx-center-vertical"],["class","fx-flex-expand fx-ellipsis",4,"ngIf"],[1,"shapelink-edit-btn","btn-small","btn-link","lib-browser-close-btn","fx-no-padding",3,"click"],[1,"nu-icon"],[0,"xlink","href","./assets/icons/symbol-defs.svg#nu-ic-edit"],[1,"shapelink-remove-btn","btn-small","btn-link","lib-browser-close-btn",3,"click"],[0,"xlink","href","./assets/icons/symbol-defs.svg#nu-ic-trash-thin"],[1,"fx-flex-expand","fx-ellipsis"],["target","_blank",1,"shapelink-label","fx-ellipsis","primary","body",3,"blur","click"],["autoFocus","true","emitForInputChange","true",1,"shapelink-input",3,"placeholder","value","updateText","keydown","blur"],["textInput",""],["translate","",1,"fx-center","caption"]],template:function(t,e){1&t&&(o.mc(0,"div",0,1),o.mc(2,"div",2),o.ed(3,N,8,1,"div",3),o.zc(4,"async"),o.ed(5,H,4,4,"div",4),o.zc(6,"async"),o.lc(),o.ed(7,F,2,0,"div",5),o.lc()),2&t&&(o.Sb(3),o.Dc("ngIf","view"===o.Ac(4,3,e.editorState).state),o.Sb(2),o.Dc("ngIf","edit"===o.Ac(6,5,e.editorState).state),o.Sb(2),o.Dc("ngIf","edit"===e.editorState.value))},directives:[k.t,A.a,r.a],pipes:[k.b,r.d],styles:[".shapelink-editor-inner-container[_ngcontent-%COMP%]{margin:.5rem;border:1px solid #caccce;position:relative;width:320px;height:50px;background:#fff;box-sizing:border-box;border-radius:6px;z-index:2}.shapelink-editor-container[_ngcontent-%COMP%]{position:absolute}.shapelink-label[_ngcontent-%COMP%]{padding:1rem 2.75rem 1rem 1rem}.shapelink-input[_ngcontent-%COMP%]{margin:.5rem;float:left;width:302px}.shapelink-input[_ngcontent-%COMP%]  input{margin:0!important}.shapelink-editor-container.invalid-url[_ngcontent-%COMP%]   .shapelink-input[_ngcontent-%COMP%]  input{border:1px solid #ffb5b5}.shapelink-remove-btn[_ngcontent-%COMP%]{padding-right:.625rem;padding-left:0;margin-bottom:.5rem}.shapelink-edit-btn[_ngcontent-%COMP%], .shapelink-remove-btn[_ngcontent-%COMP%]{background:transparent}.nu-icon[_ngcontent-%COMP%]:hover{color:#0c5e96}"],changeDetection:0}),t}(),V=n("XfZi"),U=n("iRGy"),z=n("Lk+x"),Y=n("BL7/"),X=n("IOVY"),K=n("xpZS"),W=n("D57K"),Z=n("rKAp"),Q=n("sXdR"),J=n("nsO7"),$=n("ROBh"),tt=n("4e/d"),et=n("Ohay"),nt=n("0Woy"),it=n("kuMc"),at=n("BwBJ"),ot=n("cJ9h"),rt=n("jIqt"),st=n("jOdJ"),ct=n("CsoK"),lt=n("TaSY"),ut=n("mWib"),dt=n("Wg7D"),pt=n("yn08"),ht=n("Wpmq"),gt=n("qMyy"),ft=n("/jjY"),bt=n("LLEj"),mt=n("7zx0"),vt=function(){function t(){this.collisionCanvas=document.createElement("canvas"),this.collisionCtx=this.collisionCanvas.getContext("2d"),this.collisionCtx.save()}return t.prototype.getColliding=function(t,e){var n=this;return t.filter((function(t){return n.doesCollide(t,e)}))},t.prototype.doesCollide=function(t,e){var n=this.intersection(t,e);if(!this.isValidRect(n))return!1;n.pad(1,1,1,1);var i=this.getHitPoints(t),a=this.getHitPoints(e);if(i||a){var o=void 0,r=void 0;return i&&a?i.length>a.length?(o=t,r=a):(o=e,r=i):i?(o=e,r=i):(o=t,r=a),this.isPointColliding(this.pointsToRectangle(n,r),this.getImageData(n,o))}return!1},t.prototype.doesBoxCollide=function(t,e){var n=this.intersection(t,e);return this.isValidRect(n)},t.prototype.intersection=function(t,e){var n=t.hitArea||t,i=e.hitArea||e,a=this.getGlobalBounds(n,t),o=this.getGlobalBounds(i,e);if(!a||!o)throw new Error("Collision Detection is not possible on shapes that dont have bounds set");return a.intersection(o)},t.prototype.isValidRect=function(t){return!!t&&t.width>0&&t.height>0},t.prototype.pointsToRectangle=function(t,e){return e.filter((function(e){return t.contains(e.x,e.y)})).map((function(e){return{x:e.x-t.x,y:e.y-t.y}}))},t.prototype.isPointColliding=function(t,e){var n=e.data;return!!t.find((function(t){var i=Math.round(t.x),a=Math.round(t.y)*e.width*4+4*i-1;return n[a]>0}))},t.prototype.getImageData=function(t,e){this.collisionCanvas.width=t.width,this.collisionCanvas.height=t.height,this.collisionCtx.restore(),this.collisionCtx.save();var n=e.getConcatenatedMatrix();return n.tx-=t.x,n.ty-=t.y,this.collisionCtx.setTransform(n.a,n.b,n.c,n.d,n.tx,n.ty),e.draw(this.collisionCtx),this.collisionCtx.getImageData(0,0,t.width,t.height)},t.prototype.getHitPoints=function(t){if(t.getHitPoints){var e=t;return t.getHitPoints().map((function(t){return e.localToGlobal(t.x,t.y)}))}},t.prototype.getGlobalBounds=function(t,e){var n=t.getBounds();if(n){var a=i.jb.fromMatrix(e.getConcatenatedMatrix()),o=a.transform(n.x,n.y),r=a.transform(n.x+n.width,n.y),s=a.transform(n.x,n.y+n.height),c=a.transform(n.x+n.width,n.y+n.height),l=o.min(r).min(s).min(c),u=o.max(r).max(s).max(c);return new Z.Rectangle(l.x,l.y,u.x-l.x,u.y-l.y)}},t}(),yt=n("j6ZJ"),St=n("PeB7"),Ot=n("kUiX"),xt=n("eS84");!function(t){t.over="endpoint-over",t.out="endpoint-out"}(G||(G={}));var Ct,Pt=function(t){function e(e,n,i){var a=t.call(this,e,!0,!0)||this;return a.type=e,a.handle=n,a.targetOver=i,a}return Object(W.e)(e,t),e}(Z.Event),Tt=n("wk5G"),wt=n("S83/"),jt=n("blAi"),Mt=n("7SLS"),It=function(t){function e(n,i,a){var o=t.call(this)||this;return o.gluePointId=n,o.shapeId=i,o.model=a,o.type="defined",o.visibilityAnimationTime=200,o.activationAnimationTime=300,o.expandedRadius=13,o.retractedRadius=6,o.radius=o.retractedRadius,o._active=!1,o.subs=[],o.name=i+e.idSplitter+n,o.prepare(),o}return Object(W.e)(e,t),e.getShapeId=function(t){return t.indexOf(this.idSplitter)>-1?t.split(this.idSplitter)[0]:""},e.getGluePointId=function(t){return t.indexOf(this.idSplitter)>-1?t.split(this.idSplitter)[1]:""},Object.defineProperty(e.prototype,"isActive",{get:function(){return this._active},enumerable:!1,configurable:!0}),e.prototype.getCursor=function(t){return{cursor:"pointer",tail:null,type:"css"}},e.prototype.show=function(){return this.getVisibilityAnimation(.7)},e.prototype.hide=function(){return this.getVisibilityAnimation(0)},e.prototype.expand=function(){return this._active?Object(C.b)():(this._active=!0,this.getActivationAnimation(this.expandedRadius))},e.prototype.retract=function(){return this._active?(this._active=!1,this.getActivationAnimation(this.retractedRadius)):Object(C.b)()},e.prototype.setPosition=function(t){this.x=t.x,this.y=t.y},e.prototype.addSubscription=function(t){this.subs.push(t)},e.prototype.destroy=function(){for(;this.subs.length>0;)this.subs.pop().unsubscribe()},e.prototype.prepare=function(){this.alpha=0,this.redraw(),this.drawHitArea()},e.prototype.createShape=function(){return new Z.Shape},e.prototype.drawHitArea=function(){if(!this.hitArea){var t=this.createShape();t.graphics.beginFill("white"),t.graphics.drawCircle(0,0,10),t.graphics.endFill(),t.setBounds(-5,-5,10,10),this.hitArea=t}},e.prototype.redraw=function(){this.graphics.clear(),this.graphics.beginFill("#787878"),this.graphics.drawCircle(0,0,this.radius),this.graphics.beginFill("white"),this.graphics.drawCircle(0,0,2),this.graphics.endFill()},e.prototype.getVisibilityAnimation=function(t){var e=this;this.visibilityAnimation&&(this.visibilityAnimation.cancel(),this.visibilityAnimation=void 0);var n=wt.a.get(this).to({alpha:t},this.visibilityAnimationTime,Z.Ease.sineOut);return this.visibilityAnimation=n,n.changes().pipe(Object(M.a)({complete:function(){e.visibilityAnimation===n&&(e.visibilityAnimation=void 0)}}),Object(Mt.a)(this))},e.prototype.getActivationAnimation=function(t){var e=this;this.activationAnimation&&(this.activationAnimation.cancel(),this.activationAnimation=void 0);var n=wt.a.get(this).to({radius:t},this.activationAnimationTime,Z.Ease.sineOut);return this.activationAnimation=n,this.activationAnimation.changes().pipe(Object(M.a)({next:function(){return e.redraw()},complete:function(){e.activationAnimation===n&&(e.activationAnimation=void 0)}}),Object(Mt.a)(this))},e.idSplitter="&",e}(Z.Shape),Et=function(t){function e(n,i){var a=t.call(this,e.id,n,i)||this;return a.expandedRadius=18,a}return Object(W.e)(e,t),Object.defineProperty(e,"id",{get:function(){return"SCijFyR8ijq"},enumerable:!1,configurable:!0}),e.createModel=function(){return Object.assign(new jt.a,{id:this.id,x:.5,y:.5})},e.prototype.getCursor=function(t){return{cursor:"pointer",tail:null,type:"css"}},e.prototype.drawHitArea=function(){this.hitArea||(this.hitArea=this.createShape(),this.hitArea.setBounds(0,0,0,0))},e}(It),Dt=function(){function t(t){this.target=t}return t.prototype.change=function(t,e){var n=this.target.getMatrix().transformPoint(t,e);this.target.regX=t,this.target.regY=e,this.target.x=n.x,this.target.y=n.y},t.prototype.reset=function(){var t=this.target.getMatrix();this.target.regX=0,this.target.regY=0,this.target.x=t.tx,this.target.y=t.ty},t.prototype.translateTo=function(t,e){var n=this.target.getMatrix();n.tx=0,n.ty=0;var i=n.transformPoint(this.target.regX,this.target.regY);this.target.x=t-this.target.regX+i.x,this.target.y=e-this.target.regY+i.y},t}(),_t=n("ZtqW"),kt=function(t){function e(e){var n=t.call(this)||this;return n.name=e.id,n}return Object(W.e)(e,t),e.prototype.getCurrentMatrix=function(){var t=this.getConcatenatedMatrix().clone(),e=this.parent.parent.getConcatenatedMatrix().clone().invert();return i.jb.fromMatrix(t.prependMatrix(e))},e}(Z.Shape),At=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(W.e)(e,t),e.prototype.setTranslation=function(t){var e=this.parent.getTranslation(),n=t.viewTransform;this.x=n.x-e.x,this.y=n.y-e.y},e.prototype.setDefaultBounds=function(t){this.setBounds(0,0,t.defaultBounds.width,t.defaultBounds.height)},e.prototype.setTransformation=function(t){var e=t.viewTransform;this.scaleX=e.scaleX,this.scaleY=e.scaleY,this.rotation=e.angle},e.prototype.resetTransformation=function(){this.scaleX=1,this.scaleY=1,this.rotation=0},e}(kt),Lt=n("5vYS"),Bt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(W.e)(e,t),e.prototype.getMatrixDiff=function(t){var e=t||this.modelMatrix.clone();return this.updateModelMatrix(),{prev:e,next:this.modelMatrix.clone()}},e.prototype.setDefaultBounds=function(t){var e=t.viewBounds;this.setBounds(0,0,e.width,e.height),this.updateModelMatrix()},e.prototype.setTranslation=function(t){var e=t.viewBounds,n=this.parent.getTranslation();this.x=e.x-n.x,this.y=e.y-n.y,this.updateModelMatrix()},e.prototype.setTransformation=function(t){},e.prototype.resetTransformation=function(){},e.prototype.updateModelMatrix=function(){this.modelMatrix=this.getCurrentMatrix()},e}(kt);!function(t){t[t.None=0]="None",t[t.SingleShape=1]="SingleShape",t[t.MultiShape=2]="MultiShape",t[t.Connector=3]="Connector"}(Ct||(Ct={}));var Rt,Nt=function(t){function e(e){var n=t.call(this)||this;return n.commandService=e,n.baseConnectorMatrices={},n.selectedShapes={},n.reg=new Dt(n),n}return Object(W.e)(e,t),Object.defineProperty(e.prototype,"selectedIds",{get:function(){return this.selectedShapes?Object.keys(this.selectedShapes):[]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selectedShapeList",{get:function(){return Object(J.values)(this.selectedShapes)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selectionCount",{get:function(){return this.selectedIds.length},enumerable:!1,configurable:!0}),e.prototype.cancelInteraction=function(){this.commandService.dispatch(D.a.resetDiagramPreview)},e.prototype.addChild=function(e){return t.prototype.addChild.call(this,e)},e.prototype.getChildByName=function(e){return t.prototype.getChildByName.call(this,e)},e.prototype.isSelected=function(t){return!!this.selectedShapes[t]},e.prototype.addShape=function(t){if(this.addModel(t),t instanceof _t.a){var e=new At(t);this.addChild(e)}if(t instanceof Lt.a){e=new Bt(t);this.addChild(e),this.cacheConnectorMatrix(t)}},e.prototype.removeShape=function(t){if(this.selectedShapes[t]){this.removeModel(this.selectedShapes[t]);var e=this.getChildByName(t);this.removeChild(e)}},e.prototype.changeShape=function(t){this.addModel(t)},e.prototype.getTranslation=function(){return this.getMatrix().transformPoint(0,0)},e.prototype.destroy=function(){this.removeAllChildren(),this.selectedShapes=void 0},e.prototype.addModel=function(t){this.selectedShapes[t.id]=t},e.prototype.removeModel=function(t){delete this.selectedShapes[t.id]},e.prototype.getShapeMatrices=function(){var t=this,e={};return this.selectedIds.forEach((function(n){if(t.selectedShapes[n]instanceof _t.a){var i=t.getChildByName(n);e[n]=i.getCurrentMatrix()}})),e},e.prototype.cacheConnectorMatrix=function(t){var e=t.viewBounds;this.baseConnectorMatrices[t.id]=new i.jb,this.baseConnectorMatrices[t.id].translate(e.x,e.y)},e.prototype.resetCachedConnectorMatrices=function(){var t=this;this.selectedIds.forEach((function(e){var n=t.selectedShapes[e];n instanceof Lt.a&&t.cacheConnectorMatrix(n)}))},e.prototype.getConnectorMatrices=function(t,e){var n=this;void 0===t&&(t=!0),void 0===e&&(e=!1);var i={};return this.selectedIds.forEach((function(a){if(n.selectedShapes[a]instanceof Lt.a){var o=n.getChildByName(a);if(t||e)i[a]=o.getMatrixDiff();else{var r=n.baseConnectorMatrices[a];i[a]=o.getMatrixDiff(r)}}})),i},e}(Z.Container),Ht=n("YJWy"),Ft=function(t){function e(e){var n=t.call(this,e)||this;return n.commandService=e,n.resetPreview(),n}return Object(W.e)(e,t),Object.defineProperty(e.prototype,"selectionType",{get:function(){return Ct.Connector},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selectedShape",{get:function(){var t=this.selectedShapeList;if(t.length>1)throw new Error("Single connector container should not have mode than 1 connector");var e=t[0];return e||null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"connectorPath",{get:function(){var t=this.selectedShape;return t?t.viewPoints:[]},enumerable:!1,configurable:!0}),e.prototype.getEndPoints=function(){var t=this.connectorPath;return t.length?[t[0],t[t.length-1]].map((function(t){return{id:t.id,position:t}})):[]},e.prototype.getPathPoints=function(){var t=this.connectorPath;return t.length?t.slice(1,t.length-1).map((function(t){return{id:t.id,position:t,movement:null}})):[]},e.prototype.getBreakPoints=function(){return[]},e.prototype.onMove=function(){this.previewData.hasMove=!0},e.prototype.onEndPointMove=function(t,e,n){this.previewData.endPoint=Object(W.a)({},t),e&&(this.previewData.endPoint.shapeId=e,n?(this.previewData.endPoint.gluepointId=n,this.previewData.endPoint.gluepointLocked=!0):(this.previewData.endPoint.gluepointId=null,this.previewData.endPoint.gluepointLocked=!1))},e.prototype.onEndPointDrop=function(t,e,n){this.previewData.endPoint=Object(W.a)({},t),e&&(this.previewData.endPoint.shapeId=e,n?(this.previewData.endPoint.gluepointId=n,this.previewData.endPoint.gluepointLocked=!0):(this.previewData.endPoint.gluepointId=null,this.previewData.endPoint.gluepointLocked=!1))},e.prototype.onPathPointMove=function(t,e){this.previewData.pathPoint=Object(W.a)(Object(W.a)({id:t},e),{pathAdjustedManually:!0})},e.prototype.onPathPointDrop=function(t,e){this.previewData.pathPoint=Object(W.a)(Object(W.a)({id:t},e),{pathAdjustedManually:!0})},e.prototype.onBreakPointMove=function(t,e){},e.prototype.position=function(){var t=this.selectedShape,e=this.getChildByName(t.id);e.setDefaultBounds(t),e.setTranslation(t)},e.prototype.previewInteraction=function(){return Object(x.a)(this.fireTransformConnector(!0),this.fireMoveConnectorEndPoint(!0),this.fireMoveConnectorPathPoint(!0))},e.prototype.completeInteraction=function(t){return Object(x.a)(this.fireTransformConnector(!1,t),this.fireMoveConnectorEndPoint(!1),this.fireMoveConnectorPathPoint(!1))},e.prototype.cancelInteraction=function(){t.prototype.cancelInteraction.call(this),this.resetPreview()},e.prototype.fireTransformConnector=function(t,e){var n=this;if(!this.previewData.hasMove)return Object(C.b)();delete this.previewData.hasMove;var i=Ht.a.transformShapesAndConnectors,a=this.getConnectorMatrices(t,e);t||Object.keys(a).forEach((function(t){n.baseConnectorMatrices[t]=a[t].next}));var o={connectors:a};return this.fireCommandEvent(i,o,t)},e.prototype.fireMoveConnectorEndPoint=function(t){if(!this.previewData.endPoint||!this.selectedShape.id)return Object(C.b)();var e=Ht.a.moveConnectorEndPointOnViewport,n={id:this.selectedShape.id,points:[this.previewData.endPoint],updateConnections:!t,updateDefinitions:!t};return t?n.points=Object(J.cloneDeep)(n.points):delete this.previewData.endPoint,this.fireCommandEvent(e,n,t)},e.prototype.fireMoveConnectorPathPoint=function(t){if(!this.previewData.pathPoint||!this.selectedShape)return Object(C.b)();var e=Ht.a.moveConnectorPathPointOnViewport,n={id:this.selectedShape.id,points:[this.previewData.pathPoint]};return t?n.points=Object(J.cloneDeep)(n.points):delete this.previewData.pathPoint,this.fireCommandEvent(e,n,t)},e.prototype.fireCommandEvent=function(t,e,n){var i=n?"preview":"dispatch";return this.commandService[i](t,e)},e.prototype.resetPreview=function(){this.previewData={}},e}(Nt),Gt=n("qZtG"),qt=n("IeS+"),Vt=n("2m+3"),Ut=function(){function t(t,e,n){this.container=t,this.state=e,this.restriction=n,this.subs=new Map}return Object.defineProperty(t.prototype,"inProgress",{get:function(){return this._inProgress},enumerable:!1,configurable:!0}),t.prototype.register=function(t){var e=this,n=t.getInteractionStart().subscribe((function(t){return e.startHandler(t)})),i=t.getImmediateInteraction().subscribe((function(t){return e.immediateHandler(t)})),a=t.getInteraction().pipe(Object(qt.b)((function(t){return e.onHandler(t).pipe(Object(E.a)((function(){return!1})))}))).subscribe(),o=t.getInteractionEnd().subscribe((function(t){return e.endHandler(t)}));this.subs.set(t,[n,i,a,o])},t.prototype.unregister=function(t){var e,n;if(this.subs.has(t)){var i=this.subs.get(t);this.subs.delete(t);try{for(var a=Object(W.k)(i),o=a.next();!o.done;o=a.next()){o.value.unsubscribe()}}catch(r){e={error:r}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}}},t.prototype.destroy=function(){var t,e,n,i;try{for(var a=Object(W.k)(this.subs.values()),o=a.next();!o.done;o=a.next()){var r=o.value;try{for(var s=(n=void 0,Object(W.k)(r)),c=s.next();!c.done;c=s.next()){c.value.unsubscribe()}}catch(l){n={error:l}}finally{try{c&&!c.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}}}catch(u){t={error:u}}finally{try{o&&!o.done&&(e=a.return)&&e.call(a)}finally{if(t)throw t.error}}this.subs=new Map},t.prototype.restrictMovement=function(t,e,n,a){if(!e||"free"===e)return a;var o=this.container.selectedShapeList.find((function(e){return e.id===t})).viewTransform,r=i.jb.fromTransform(o).invert().transformPoint(n.x,n.y);switch(e){case"horizontal":r={x:r.x+5,y:r.y};break;case"vertical":r={x:r.x,y:r.y+5};break;case"diagonal-nesw":r={x:r.x-5,y:r.y+5};break;case"diagonal-nwse":r={x:r.x+5,y:r.y+5}}var s=i.jb.fromTransform(o).transformPoint(r.x,r.y),c=new i.fb(n,s).perpendicularTo(a);return{x:c.x,y:c.y}},t.prototype.getCancelInteraction=function(){return Object(P.a)(window,"keydown").pipe(Object(E.a)((function(t){return t.keyCode===y.m.Escape})))},t.prototype.startHandler=function(t){var e=this;this._inProgress=!0,this.cancelInteractionSubscription=this.getCancelInteraction().subscribe((function(){return e.cancelHandler(t)}));var n=t.target;this.interactionStart(t),this.dispatchInteractionEvent(n,Tt.b.interactionStart,t)},t.prototype.immediateHandler=function(t){this.dispatchInteractionEvent(t.handle,Tt.b.interactionStart,t),this.dispatchInteractionEvent(t.handle,Tt.b.interactionImmediate,t),this.interactionImmediate(t),this.dispatchInteractionEvent(t.handle,Tt.b.interactionEnd,t),this.container.completeInteraction(!0,t.handle)},t.prototype.getDirectionByKeycode=function(t){var e=0,n=0;return t===y.m.ArrowUp&&(n=-1),t===y.m.ArrowDown&&(n=1),t===y.m.ArrowLeft&&(e=-1),t===y.m.ArrowRight&&(e=1),{xDirection:e,yDirection:n}},t.prototype.onHandler=function(t){if(!this._inProgress)return Object(C.b)();var e=t.target;return this.interaction(t),this.dispatchInteractionEvent(e,Tt.b.interaction,t),Object(Gt.a)(this.container.previewInteraction(e),Object(P.a)(Z.Ticker,"tick").pipe(Object(j.a)(1)))},t.prototype.endHandler=function(t){if(this._inProgress){var e=t.target;this.interactionEnd(t),this.dispatchInteractionEvent(e,Tt.b.interactionEnd,t),this.container.completeInteraction(void 0,e),this._inProgress=!1,this.cancelInteractionSubscription.unsubscribe()}},t.prototype.cancelHandler=function(t){if(this._inProgress){var e=t.target;this.interactionCancel(t),this.dispatchInteractionEvent(e,Tt.b.interactionCancel,t),this.container.cancelInteraction(),this._inProgress=!1,this.cancelInteractionSubscription.unsubscribe()}},t.prototype.dispatchInteractionEvent=function(t,e,n){t.dispatchEvent(new Tt.a(e,this.name,t,null,n))},t}(),zt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(W.e)(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"MoveInteraction"},enumerable:!1,configurable:!0}),e.prototype.interactionStart=function(t){var e=void 0!==t.startX?t.startX:t.stageX,n=void 0!==t.startY?t.startY:t.stageY,i=this.restriction.pointOnViewport({x:e,y:n},["GridService"]),a=this.restriction.pointOnViewport({x:this.container.x,y:this.container.y},["GridService"]),o=i.x-a.x,r=i.y-a.y;this.container.reg.change(o,r)},e.prototype.interaction=function(t){var e=this.restriction.pointOnViewport({x:t.stageX,y:t.stageY},["GridService"]),n=e.x,a=e.y;if(this.container instanceof Ft){this.container.reg.translateTo(n,a);var o=(p=this.container.getTransformedBounds()).x-this.container.x,r=p.y-this.container.y,s=this.restriction.pointOnViewport({x:p.x,y:p.y},["SelectionMoveSnap"]);return this.container.reg.translateTo(s.x-o,s.y-r),void this.container.onMove()}this.container.reg.translateTo(n,a);var c=i.jb.fromMatrix(this.container.getMatrix()).decompose(),l=this.container.getTransformedBounds();if(l&&(0===c.angle||0===Math.abs(c.angle%90))){s=this.restriction.pointOnViewport({x:l.x,y:l.y},["SelectionMoveSnap"]);this.container.reg.translateTo(this.container.regX+s.x,this.container.regY+s.y);var u=s.x,d=s.y;if(c.scaleX>0&&-180===c.angle||c.scaleX>0&&180===c.angle||c.scaleX>0&&90===c.angle){var p=this.container.getTransformedBounds();u=s.x+p.width}if(c.scaleY<0&&0===c.angle||c.scaleY>0&&180===c.angle||c.scaleY>0&&-90===c.angle){p=this.container.getTransformedBounds();d=s.y+p.height}u===s.x&&d===s.y||this.container.reg.translateTo(this.container.regX+u,this.container.regY+d)}this.state.set("SelectionInteraction",{bounds:this.container.getTransformedBounds(),rotation:this.container.rotation,type:"move"})},e.prototype.interactionImmediate=function(t){var e=Vt.a.gridSize*this.state.get("DiagramZoomLevel"),n=this.getDirectionByKeycode(t.keyCode),i=n.xDirection,a=n.yDirection,o=this.container.x+i*e,r=this.container.y+a*e,s=this.restriction.pointOnViewport({x:o,y:r},["GridService"]),c=s.x,l=s.y;this.container.reg.translateTo(c,l),this.interactionEnd(null)},e.prototype.interactionEnd=function(t){this.container.reg.reset(),this.container instanceof Ft&&this.container.onMove()},e.prototype.interactionCancel=function(t){this.container.reg.reset()},e}(Ut),Yt=function(t){function e(e,n,i){var a=t.call(this,e,n,i)||this;return a.container=e,a.state=n,a.restriction=i,a}return Object(W.e)(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"ConnectorPointInteraction"},enumerable:!1,configurable:!0}),e.prototype.interactionStart=function(t){var e=this.getHandlePosition(t),n=e.x,i=e.y;this.container.reg.change(n,i)},e.prototype.interactionImmediate=function(t){},e.prototype.interactionEnd=function(t){this.container.reg.reset()},e.prototype.interactionCancel=function(t){this.container.reg.reset()},e.prototype.getHandlePosition=function(t){var e=t.target;return{x:e.x,y:e.y}},e.prototype.getPointerPosition=function(t){return{x:t.stageX,y:t.stageY}},e}(Ut),Xt=n("cs9O"),Kt=n("9KTM"),Wt=function(t){function e(e,n,i){var a=t.call(this,e,n,i)||this;return a.container=e,a.restriction=i,a.hoveredOver=[],a.vToDcoordinate=new ht.a(a.state),a.state=n,a}return Object(W.e)(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"EndPointMoveInteraction"},enumerable:!1,configurable:!0}),e.prototype.register=function(e){var n=this;t.prototype.register.call(this,e);var i=e.getEndpointOver().subscribe((function(t){return n.onEndpointOver(t)})),a=e.getEndpointOut().subscribe((function(t){return n.onEndpointOut(t)}));this.subs.set(e,[i,a])},e.prototype.onEndpointOver=function(t){this.hoveredOver.unshift(t.targetOver)},e.prototype.onEndpointOut=function(t){var e=t.targetOver,n=this.hoveredOver.findIndex((function(t){return t.name===e.name}));n>=0&&this.hoveredOver.splice(n,1)},e.prototype.getHoveredTarget=function(t){return this.hoveredOver[0]},e.prototype.interactionStart=function(e){t.prototype.interactionStart.call(this,e)},e.prototype.interaction=function(t){var e=t.target,n=this.getHoveredTarget(e),i=this.getPointerPosition(t),a=i.x,o=i.y,r=this.restriction.pointOnViewport({x:t.stageX,y:t.stageY},["GridService"]).x,s=this.restriction.pointOnViewport({x:t.stageX,y:t.stageY},["GridService"]).y,c=this.restriction.pointOnViewport({x:r,y:s},["SelectionMoveSnap"]),l={};if(l.point={id:e.pointId,x:a,y:o,shapeId:null,gluepointId:null},n instanceof Xt.a){var u=n.getBounds();this.shouldSnap(u,c)&&(l.point=Object(W.a)(Object(W.a)({},l.point),{x:c.x,y:c.y}))}n instanceof It&&(l.shapeId=n.shapeId,l.gluepointId=n.gluePointId),this.container.onEndPointMove(l.point,l.shapeId,l.gluepointId)},e.prototype.interactionEnd=function(e){t.prototype.interactionEnd.call(this,e);var n=e.target,i=this.getHoveredTarget(n),a=this.getPointerPosition(e),o=a.x,r=a.y,s=this.restriction.pointOnViewport({x:e.stageX,y:e.stageY},["GridService"]).x,c=this.restriction.pointOnViewport({x:e.stageX,y:e.stageY},["GridService"]).y,l=this.restriction.pointOnViewport({x:s,y:c},["SelectionMoveSnap"]),u={};if(u.point={id:n.pointId,x:o,y:r,shapeId:null,gluepointId:null,onShape:!1},i instanceof Xt.a){var d=i.getBounds();u.shapeId=i.name,u.point.shapeId=i.name,u.point.onShape=!0,u.point.position=this.shouldSnap(d,l)?this.positionOnShape(i.children[0],{x:l.x,y:l.y}):this.positionOnShape(i.children[0],{x:o,y:r}),u.point.gluepointId=null}i instanceof It&&(u.shapeId=i.shapeId,u.gluepointId=i.gluePointId),this.container.onEndPointDrop(u.point,u.shapeId,u.gluepointId)},e.prototype.shouldSnap=function(t,e){var n=this.vToDcoordinate.x(e.x),i=this.vToDcoordinate.y(e.y);return n>=t.x&&n<=t.x+t.width&&(i===t.y||i===t.y+t.height)||i>=t.y&&i<=t.y+t.height&&(n===t.x||n===t.x+t.width)},e.prototype.positionOnShape=function(t,e){var n=e;return n.x=this.vToDcoordinate.x(n.x),n.y=this.vToDcoordinate.y(n.y),{x:(n.x-t.x)/t._bounds.width,y:(n.y-t.y)/t._bounds.height}},e.\u0275fac=function(t){return new(t||e)(o.qc(Ft),o.qc(i.Nb),o.qc(Kt.a))},e.\u0275prov=o.cc({token:e,factory:e.\u0275fac}),e}(Yt),Zt=n("ljsB"),Qt=n("deqJ"),Jt=n("wOpJ"),$t=n("8a+/");!function(t){t.start="multiselection-start",t.end="multiselection-end",t.drag="multiselection-drag"}(Rt||(Rt={}));var te=function(t){function e(e,n){var i=t.call(this,e,!1,!1)||this;return i.relatedEvent=n,i}return Object(W.e)(e,t),e}(Z.Event),ee=n("BQpn"),ne=n("MvFr"),ie=function(t){function e(e,n,i,a){return void 0===i&&(i=!0),void 0===a&&(a=!0),t.call(this,e,n,i,a)||this}return Object(W.e)(e,t),e}(ne.a),ae=function(t){function e(e,n,i,a){void 0===i&&(i=!0),void 0===a&&(a=!0);var o=t.call(this,e,n,i,a)||this;return o.setRelatedShape(n),o}return Object(W.e)(e,t),e}(ie),oe=function(t){function e(e,n,i,a){return void 0===i&&(i=!0),void 0===a&&(a=!0),t.call(this,e,n,i,a)||this}return Object(W.e)(e,t),e}(ie),re=n("I4UX"),se=function(t){function e(e,n,i,a,o,r,s,c,l,u,d,p,h){var g=t.call(this,e,o,i)||this;return g.commandService=e,g.ll=n,g.state=i,g.contextMenuController=a,g.vToDcoordinate=o,g.dToVcoordinate=r,g.fileReceiver=s,g.postmsg=c,g.shapeBoundsLocator=l,g.realtimeStates=u,g.translate=d,g.shapeManage=p,g.eDataManageSvc=h,g.pointerInactiveTime=6e4,g.containerHitTestdebounceTime=50,g.pointerThrottle=120,g.endPointMoveThrottleTime=10,g}return Object(W.e)(e,t),Object.defineProperty(e.prototype,"defaultCursor",{get:function(){return{cursor:"default",tail:null,type:"css",viewingArea:"app"}},enumerable:!1,configurable:!0}),e.prototype.initialize=function(e,n,a){var o=this,r=t.prototype.initialize.call(this,e,n,a),s=this.getShapePressMoveStart().pipe(Object(M.a)((function(t){o.hideComments(),t.nativeEvent.ctrlKey&&0!==o.state.get("Selected").length||o.selectShape(t),o.cloneAndDragShapes(t)}))),c=this.getShapeDrag().pipe(Object(M.a)((function(t){return o.interactionCanvas.dispatchEvent(t)}))),l=this.getMultiselectionDrag().pipe(Object(M.a)((function(t){return o.interactionCanvas.dispatchEvent(t)}))),u=this.getStageMouseDown(this.gridCanvas).pipe(Object(E.a)((function(){return!o.state.get("EditingText").open})),Object(M.a)((function(t){o.hideComments(),o.selectShapes([])}))),d=this.getSingleClickOnShape().pipe(Object(M.a)((function(t){o.postmsg.sendToParent("shape:touch",{shapeId:t.currentTarget.name}),o.clickOnShape(t),o.handleTextEditor(t),o.selectShape(t,!0)}))),p=this.interactionCanvas.canvas,h=this.getCanvasDrop(p).pipe(Object(M.a)((function(t){return o.onDrop(t)}))),g=Object(P.a)(p,"mousemove").pipe(Object(Q.lodashThrottle)(this.pointerThrottle,{leading:!0,trailing:!0}),Object(M.a)((function(t){if(i.T.get("DEBUG_PHOTON_POINTER_MOVE")){var e=o.vToDcoordinate.x(t.x),n=o.vToDcoordinate.y(t.y),a=JSON.stringify([e,n]);o.realtimeStates.set("pointer",a)}})),Object(Q.lodashThrottle)(this.pointerInactiveTime,{leading:!0,trailing:!1}),Object(M.a)((function(t){o.realtimeStates.set("selected",JSON.stringify(o.state.get("Selected")))})),Object(tt.a)((function(t){return C.a})));return this.contextMenuController.registerEventSource("shape",this.getShapeRightClick()),this.contextMenuController.registerEventSource("stage",this.getStageRightClick(this.gridCanvas)),this.contextMenuController.registerEventSource("interaction",this.getInteractionRightClick(this.interactionCanvas)),Object(x.a)(r,s,c,l,u,d,h,g,this.keepSelectionInViewport(),this.multiselectPanInteraction(),this.detectEndPointCollision(),this.shapeSelectionChange(),this.updateSelectionInteractionState(),this.handleAddConnector())},e.prototype.getCursor=function(){var t=this;return Object(x.a)(this.getSelectionInteractionStartEnd(),this.state.changes("Selected")).pipe(Object(T.a)((function(e){return e&&e.type===Rt.start||e&&e.type===Tt.b.interactionStart?Object($.a)({cursor:"default",tail:null,type:"css",viewingArea:"app"}):t.getCursorByPosition()})),Object(et.a)((function(t,e){return t.cursor===e.cursor&&t.tail===e.tail})))},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.contextMenuController.unregisterEventSource("shape"),this.contextMenuController.unregisterEventSource("stage"),this.contextMenuController.unregisterEventSource("interaction")},e.prototype.updateSelectionInteractionState=function(){var t=this,e=Object(P.a)(this.interactionCanvas,Tt.b.interactionStart),n=Object(P.a)(this.interactionCanvas,Tt.b.interactionEnd);return Object(x.a)(e.pipe(Object(M.a)((function(){return t.state.set("SelectionInteractionState",pt.d.Started)}))),n.pipe(Object(M.a)((function(){return t.state.set("SelectionInteractionState",pt.d.Stopped)}))))},e.prototype.cloneAndDragShapes=function(t){t.nativeEvent&&t.nativeEvent.altKey&&this.commandService.dispatch(D.a.duplicateShapesAndMove,{onSameLocation:!0})},e.prototype.clickOnShape=function(t){var e=this,n=t.currentTarget.name;return this.ll.forCurrentObserver(!0).pipe(Object(T.a)((function(t){return t.getShapeOnce(n)})),Object(I.a)((function(i){var a;if(i&&"clickOnShape"in i){var o={x:e.vToDcoordinate.x(t.nativeEvent.clientX),y:e.vToDcoordinate.y(t.nativeEvent.clientY)},r=void 0;if(t.target instanceof Jt.a||t.target instanceof yt.a)r=t.target.name;var s={methodName:"clickOnShape",methodParams:[o,t.nativeEvent.shiftKey||t.nativeEvent.ctrlKey||t.nativeEvent.metaKey,r]},c={shapeInfo:(a={},a[n]=s,a)};return e.state.get("EditingText").open?c:(e.commandService.dispatch(D.a.executeShapeLogicMethod,c),{})}})),Object(T.a)((function(t){return e.state.changes("EditingText").pipe(Object(E.a)((function(t){return!1===t.open})),Object(j.a)(1),Object(M.a)((function(){return e.commandService.dispatch(D.a.executeShapeLogicMethod,t)})))}))).subscribe()},e.prototype.shapeSelectionChange=function(){var t=this;return this.state.changes("Selected").pipe(Object(nt.a)(),Object(I.a)((function(e){var n=e[0],i=e[1],a=t.state.get("SelectionHistory")||[];t.commandService.dispatch(D.a.toggleConnectorVisibilitySystem,t.state.get("CurrentDiagram"),{hideConnector:!1,selection:!1}),n.length<2&&!Object(J.isEqual)(n,i)&&(a.push.apply(a,Object(W.j)(i)),a.length>10&&a.shift(),t.state.set("SelectionHistory",a));var o=n.filter((function(t){return!i.includes(t)}));if(t.state.set("Deselected",o),0!==o.length){var r={};o.forEach((function(t){r[t]={methodName:"deselectShape",methodParams:[i]}}));var s={shapeInfo:r};t.commandService.dispatch(D.a.executeShapeLogicMethod,s);var c=t.state.get("originalEDataLinks");(o.some((function(t){return c[t]}))||Object.keys(c).some((function(t){return!i.includes(t)})))&&t.state.set("originalEDataLinks",{})}})))},e.prototype.hideComments=function(){var t=this.state.get("CommentThreadData");t&&t.visible&&this.state.set("CommentThreadData",{visible:!1})},e.prototype.getOnAndSelectedSubContexts=function(t){var e=[],n=t.filter((function(t){return t.parent instanceof Qt.a})).map((function(t){return t.parent}));return n.forEach((function(t){!e.includes("onConnector")&&t.isConnectorView&&e.push("onConnector"),!e.includes("onShape")&&t.isShapeView&&e.push("onShape")})),n[0]&&this.isSelected(n[0].name)&&(e.push("selected"),this.state.get("Selected").length>1&&e.push("multiSelected")),e},e.prototype.keepSelectionInViewport=function(){var t=this,e=Object(P.a)(this.interactionCanvas,Tt.b.interactionStart),n=Object(P.a)(this.interactionCanvas,Tt.b.interactionEnd);return e.pipe(Object(T.a)((function(){return t.selectionHitsViewport().pipe(Object(it.a)(n))})),Object(M.a)((function(e){var n=e.dx,i=e.dy;e.name,e.id,e.nativeEvent,e.bounds,e.type;t.dispatchPanCommand(n,i,"auto")})),Object(at.a)(20),Object(M.a)((function(e){e.dx,e.dy;var n=e.name,i=e.id,a=e.nativeEvent;e.bounds;e.type!==Tt.b.interactionImmediate&&t.dispatchSimulatedInteraction(n,i,a)})))},e.prototype.keepCaretInsideViewport=function(){var t=this;return this.state.changes("TextEditorState-shapeText").pipe(Object(E.a)((function(e){return t.state.get("EditingText").open&&e.selection})),Object(et.a)((function(t,e){return Object(J.isEqual)(null==t?void 0:t.selection,null==e?void 0:e.selection)})),Object(M.a)((function(e){var n=t.dToVcoordinate.y(e.selection.y)+t.dToVcoordinate.height(e.selection.height),i=t.state.get("DiagramViewPort"),a=0,o=0;n+150>i.bottom&&(a=n+150-i.bottom);var r=t.dToVcoordinate.x(e.selection.x)+t.dToVcoordinate.width(e.selection.width);r+50>i.right&&(o=r+50-i.right),(o||a)&&t.dispatchPanCommand(-o,-a,"auto")})))},e.prototype.multiselectPanInteraction=function(){var t=this,e=Object(P.a)(this.interactionCanvas,Rt.start),n=Object(P.a)(this.interactionCanvas,Rt.end);return e.pipe(Object(T.a)((function(){return t.multiSelectionHitsViewport().pipe(Object(it.a)(n))})),Object(M.a)((function(e){var n=e.dx,i=e.dy;e.name,e.id,e.nativeEvent,e.bounds,e.type;t.dispatchPanCommand(n,i)})),Object(at.a)(20),Object(M.a)((function(e){e.dx,e.dy;var n=e.name,i=e.id,a=e.nativeEvent;e.bounds,e.type;t.dispatchSimulatedMultiSelectInt(n,i,a)})))},e.prototype.dispatchPanCommand=function(t,e,n){var a=this;Object(i.Ub)((function(){return a.commandService.dispatch(Zt.a.panDiagram,{dy:e,dx:t,animate:!1,type:n})}))},e.prototype.dispatchSimulatedMultiSelectInt=function(t,e,n){var i=this.gridCanvas.getMouseX(),a=this.gridCanvas.getMouseY(),o=new Z.MouseEvent("stagemousemove",!1,!1,i,a,n,null,!0,i,a);o.data={isSimulated:!0};var r=new te(Rt.drag,o);this.interactionCanvas.dispatchEvent(r)},e.prototype.dispatchSimulatedInteraction=function(t,e,n){if("MoveInteraction"===t){var i=this.interactionCanvas.getMouseX(),a=this.interactionCanvas.getMouseY();(r=new Z.MouseEvent("stagemousemove",!1,!1,i,a,n,null,!0,i,a)).data={isSimulated:!0};var o=new ae("shapeDragMove",r);o.relatedShape={name:e},this.interactionCanvas.dispatchEvent(o)}else{var r;i=this.interactionCanvas.mouseX,a=this.interactionCanvas.mouseY;(r=new Z.MouseEvent("stagemousemove",!1,!1,i,a,n,null,!0,i,a)).data={isSimulated:!0},this.interactionCanvas.dispatchEvent(r)}},e.prototype.multiSelectionHitsViewport=function(){var t=this;return Object(P.a)(this.interactionCanvas,Rt.drag).pipe(Object(I.a)((function(e){var n=t.interactionCanvas.getMouseX(),a=t.interactionCanvas.getMouseY(),o=new i.Ab(n-5,a-5,10,10),r=e.relatedEvent.nativeEvent,s=t.getPanDeltaForMultiSelection(o,1,r),c=s.dx,l=s.dy;if(c||l)return{dx:c,dy:l,name:e.name,nativeEvent:r}})),Object(E.a)((function(t){return!!t})))},e.prototype.selectionHitsViewport=function(){var t=this,e=Object(P.a)(this.interactionCanvas,Tt.b.interaction).pipe(Object(I.a)((function(e){var n=t.getDataFromInteractionEvent(e),a=t.interactionCanvas.getMouseX(),o=t.interactionCanvas.getMouseY(),r=new i.Ab(a-5,o-5,10,10);return n.bounds=r,n})),Object(nt.a)(),Object(I.a)((function(e){var n=Object(W.h)(e,2),i=n[0],a=n[1];if(!a.isUserInteraction||JSON.stringify(i)!==JSON.stringify(a)){var o=t.getPanDelta(a.bounds,2),r=o.dx,s=o.dy;if(a.isUserInteraction){var c=t.isMovingOutside(i.bounds,a.bounds),l=c.x;s=c.y?s:0,r=l?r:0}return r||s?{dx:r,dy:s,name:a.name,id:a.id,nativeEvent:a.nativeEvent}:void 0}})),Object(E.a)((function(t){return!!t}))),n=Object(P.a)(this.interactionCanvas,Tt.b.interactionImmediate).pipe(Object(I.a)((function(e){var n=t.getDataFromInteractionEvent(e),a=n.id,o=n.nativeEvent,r=n.isUserInteraction,s=n.type,c=e.target.getTransformedBounds(),l=new i.Ab(c.x,c.y,c.width,c.height),u=t.getPanDelta(l,10),d=u.dx,p=u.dy;if(r){var h=t.isMovingOutsideForKeys(e.relatedEvent.keyCode,l),g=h.x;p=h.y?p:0,d=g?d:0}if(d||p)return{dx:d,dy:p,name:name,id:a,isUserInteraction:r,nativeEvent:o,bounds:l,type:s}})),Object(E.a)((function(t){return!!t})));return Object(x.a)(e,n)},e.prototype.getPanDelta=function(t,e){var n=this.state.get("DiagramViewPort"),i=t.y<n.top+10?e:0;i=t.bottom>n.bottom-10?-e:i;var a=t.x<n.left+10?e:0;return{dx:a=t.right>n.right-10?-e:a,dy:i}},e.prototype.getPanDeltaForMultiSelection=function(t,e,n){var i=0,a=0,o=this.state.get("DiagramViewPort");return n.movementY>0&&n.y>o.centerY&&(i=t.bottom>o.bottom-10?-e:0),n.movementY<0&&n.y<o.centerY&&(i=t.y<o.top+10?e:0),n.movementX>0&&n.x>o.centerX&&(a=t.right>o.right-10?-e:0),n.movementX<0&&n.x<o.centerX&&(a=t.x<o.left+10?e:0),{dx:a,dy:i}},e.prototype.isMovingOutside=function(t,e){var n=this.state.get("DiagramViewPort");return{x:Math.abs(n.centerX-t.centerX)<Math.abs(n.centerX-e.centerX),y:Math.abs(n.centerY-t.centerY)<Math.abs(n.centerY-e.centerY)}},e.prototype.isMovingOutsideForKeys=function(t,e){var n=this.state.get("DiagramViewPort");return t===y.m.ArrowUp?{x:!1,y:n.centerY>e.centerY}:t===y.m.ArrowDown?{x:!1,y:n.centerY<e.centerY}:t===y.m.ArrowLeft?{x:n.centerX>e.centerX,y:!1}:t===y.m.ArrowRight?{x:n.centerX<e.centerX,y:!1}:void 0},e.prototype.getDoubleClickOnShape=function(){var t=this;return this.getShapes().pipe(Object(ot.a)((function(e){return Object(P.a)(e,"dblclick").pipe(Object(it.a)(Object(P.a)(t.diagramCanvas,"childRemoved").pipe(Object(E.a)((function(t){return t.child===e})))))})),Object(I.a)((function(t){return t})))},e.prototype.getDoubleClickOnGrid=function(){return Object(P.a)(this.gridCanvas,"dblclick")},e.prototype.getSingleClickOnShape=function(){var t=this;return this.getShapes().pipe(Object(ot.a)((function(e){return Object(P.a)(e,"mousedown").pipe(Object(T.a)((function(){return Object(P.a)(e,"pressup").pipe(Object(it.a)(Object(P.a)(e,"pressmove")))})),Object(it.a)(Object(P.a)(t.diagramCanvas,"childRemoved").pipe(Object(E.a)((function(t){return t.child===e})))))})),Object(I.a)((function(t){return t})))},e.prototype.getShapePressMoveStart=function(){var t=this;return this.getShapes().pipe(Object(ot.a)((function(e){return Object(P.a)(e,"mousedown").pipe(Object(E.a)((function(t){return 0===t.nativeEvent.button})),Object(T.a)((function(){return Object(P.a)(e,"pressmove").pipe(Object(j.a)(1))})),Object(it.a)(Object(P.a)(t.diagramCanvas,"childRemoved").pipe(Object(E.a)((function(t){return t.child===e})))))})),Object(I.a)((function(t){return t})))},e.prototype.handleTextEditor=function(t){var e=this;if(2!==t.nativeEvent.button&&!this.state.get("PlusCreateState").inProgress){var n,i,a={x:t.localX,y:t.localY},o=t.target;if(t.target instanceof Xt.a&&(o=o.getObjectUnderPoint(a.x,a.y)||t.target),o instanceof Jt.a||o instanceof yt.a){var r=o;n=r.name,i=r.parent.name,this.state.get("Selected").includes(i)&&this.ll.forCurrent(!0).getShapeOnce(i).pipe(Object(M.a)((function(o){var r=e.state.get("InnerShapeSelection")[i],s=r&&r.includes(n),c=s&&(t.nativeEvent.shiftKey||t.nativeEvent.ctrlKey||t.nativeEvent.metaKey);o&&o.disableOpenTextOnShapeClick&&(!s||c)||(o.texts[n]&&o.texts[n].editableTextId&&(n=o.texts[n].editableTextId),e.openTextEditor(i,n,a))}))).subscribe()}else i=o.name,this.state.get("Selected").includes(i)&&this.ll.forCurrent(!0).getShapeOnce(i).pipe(Object(M.a)((function(t){t&&t.disableOpenTextOnShapeClick||e.openTextEditor(i,n,a)}))).subscribe()}},e.prototype.openTextEditor=function(t,e,n){var a=this.state.get("EditingText");!0===a.open&&(a.open=!1,this.commandService.dispatch(D.a.closeTextEditor,a)),i.Pb.track("canvas.text.doubleclick.change"),this.commandService.dispatch(D.a.openTextEditor,{open:!0,textId:e,point:n,shapeId:t})},e.prototype.getShapeDrag=function(){var t=this,e=Object(P.a)(this.interactionCanvas,"stagemouseup").pipe(Object(j.a)(1));return this.getShapes().pipe(Object(ot.a)((function(n){return Object(P.a)(n,"mousedown").pipe(Object(E.a)((function(t){return 0===t.nativeEvent.button})),Object(I.a)((function(t){return{startX:t.stageX,startY:t.stageY}})),Object(T.a)((function(t){return Object(P.a)(n,"pressmove").pipe(Object(j.a)(1),Object(M.a)((function(e){e.startX=t.startX,e.startY=t.startY})))})),Object(T.a)((function(n){return Object(x.a)(Object(P.a)(t.interactionCanvas,"stagemousemove").pipe(Object(E.a)((function(t){return!(t.nativeEvent&&t.nativeEvent.altKey)})),Object(it.a)(e)),e).pipe(Object(I.a)((function(t){var e="stagemousemove"===t.type?"shapeDragMove":"shapeDragEnd",i=new ae(e,n);return i.startX=n.startX,i.startY=n.startY,i.relatedMouseEvent=t,i})))})),Object(it.a)(Object(P.a)(t.diagramCanvas,"childRemoved").pipe(Object(E.a)((function(t){return t.child===n})))))})))},e.prototype.selectShape=function(t,e){var n=this;void 0===e&&(e=!1),this.ll.forCurrent(!0).getShapeOnce(t.currentTarget.name).pipe(Object(I.a)((function(i){if(!i.containerLocked||e){var a=t.nativeEvent.metaKey||t.nativeEvent.shiftKey||t.nativeEvent.ctrlKey;n.selectShapes([t.currentTarget.name],a,t.nativeEvent.button)}}))).subscribe()},e.prototype.selectShapes=function(t,e,n){void 0===n&&(n=0),2!==n&&this.commandService.dispatch(gt.a.selectShapes,this.state.get("CurrentDiagram"),{shapeIds:t,add:e})},e.prototype.getCanvasDrag=function(t){var e=Object(P.a)(t,"mousedown").pipe(Object(I.a)((function(t){return new oe("stageDragStart",t)}))),n=Object(P.a)(t,"pressup").pipe(Object(I.a)((function(t){return new oe("stageDragEnd",t)}))),i=Object(P.a)(t,"pressmove").pipe(Object(I.a)((function(t){return new oe("stageDragMove",t)})));return e.pipe(Object(T.a)((function(t){return Object(x.a)(i.pipe(Object(rt.a)(t),Object(it.a)(n)),i.pipe(Object(st.a)(),Object(ct.a)(n)))})))},e.prototype.getMultiselectionDrag=function(){var t=this,e=Object(P.a)(this.gridCanvas,"mousedown").pipe(Object(I.a)((function(t){return new te(Rt.start,t)}))),n=Object(P.a)(this.diagramCanvas,"mousedown").pipe(Object(T.a)((function(e){return t.ll.forCurrent(!0).getShapeOnce(e.target.name).pipe(Object(I.a)((function(n){if(!t.state.get("Selected").includes(e.target.name)&&n&&n.containerLocked)return new te(Rt.start,e)})),Object(E.a)((function(t){return!!t})))}))),i=Object(x.a)(n,e),a=Object(x.a)(Object(P.a)(this.diagramCanvas,"pressup").pipe(Object(I.a)((function(t){return new te(Rt.end,t)}))),Object(P.a)(this.gridCanvas,"pressup").pipe(Object(I.a)((function(t){return new te(Rt.end,t)})))),o=Object(x.a)(Object(P.a)(this.diagramCanvas,"pressmove").pipe(Object(I.a)((function(t){return new te(Rt.drag,t)}))),Object(P.a)(this.gridCanvas,"pressmove").pipe(Object(I.a)((function(t){return new te(Rt.drag,t)}))));return i.pipe(Object(T.a)((function(t){return Object(x.a)(o.pipe(Object(rt.a)(t),Object(it.a)(a)),o.pipe(Object(st.a)(),Object(ct.a)(a)))})))},e.prototype.getCanvasDrop=function(t){var e=Object(P.a)(t,"dragenter").pipe(Object(M.a)((function(t){return t.preventDefault()}))),n=Object(P.a)(t,"dragover").pipe(Object(M.a)((function(t){return t.preventDefault()}))),i=Object(P.a)(t,"drop").pipe(Object(M.a)((function(t){return t.preventDefault()})));return e.pipe(Object(ct.a)(Object(x.a)(n.pipe(Object(E.a)((function(){return!1}))),i.pipe(Object(j.a)(1)))))},e.prototype.onDrop=function(t){var e=t.dataTransfer;e.getData("Text")?this.onTextDrop(t):e.getData("PreDifQueries")?this.onQueryDrop(t):e.getData("URLData")?this.onUrlDrop(t):e.files&&e.files.length>0&&this.onFileDrop(t,!0)},e.prototype.onQueryDrop=function(t){var e=t.dataTransfer.getData("PreDifQueries"),n={};try{n=JSON.parse(e)}catch(i){return}this.addPreDefQueryShapes(n,t.offsetX,t.offsetY)},e.prototype.onTextDrop=function(t){var e,n=t.dataTransfer.getData("Text"),a=t.dataTransfer.getData("TrackingInfo");try{e=JSON.parse(n)}catch(u){return}var o={value1Type:"defId",value1:e.defId};try{var r=JSON.parse(a);r.library&&(o.value2Type="library",o.value2=r.library),r.location&&(o.value3Type="location",o.value3=r.location)}catch(u){}if(i.Pb.track("left.library.shape.drop",o),"template"===e.type)this.shapeManage.addTemplate(e,t.offsetX,t.offsetY);else{var s=void 0;if(e.sidebarEntity){var c=e.sidebarEntity.id,l=e.sidebarEntity.edefId;s=Object.assign(new ft.a(c,l),e.sidebarEntity)}this.shapeManage.addShape(e,t.offsetX,t.offsetY,s).subscribe()}},e.prototype.onFileDrop=function(t,e){var n=t.dataTransfer.files;if(n&&!(n.length<1)){for(var i=[],a=0;a<n.length;a++){var o=new St.b(n[a]);o.importType=St.a.DragAndDrop,i.push(o)}var r={position:{x:this.vToDcoordinate.x(t.offsetX),y:this.vToDcoordinate.y(t.offsetY)},upload:e};this.fileReceiver.receiveFiles(i,r).subscribe()}},e.prototype.onUrlDrop=function(t){var e,n=t.dataTransfer.getData("URLData");try{e=JSON.parse(n)}catch(a){return}var i=this.shapeManage.addURLData(e,t.offsetX,t.offsetY).subscribe();this.subs.push(i)},e.prototype.addPreDefQueryShapes=function(t,e,n){var a,o=this,r={},s=Object.values(t.shapes);if(t.eDefId&&!t.eDefId.startsWith("creately.edata.datasource")){var c=s[0].eData,l=c&&Object.keys(c)[0],u=this.state.get("projectEDataModels")[l],d=s[0].entityDefId,p=u.isCustom?u.customEntityDefs[d]:u.getEntityDef(d);s.forEach((function(e,n){var i,a=e.eData[l];u.entities[a]?(i=u.entities[a],Object.keys(t.shapes[i.id].data).forEach((function(e){p&&p.dataItems[e]&&(t.shapes[i.id].data[e].value=i.data[e]||p.dataItems[e].default)}))):delete t.shapes[a]}))}Object.values(t.shapes).forEach((function(a){var s,c=i.xb.shapeId(),l=new i.Ab(0,0,a.defaultBounds.width,a.defaultBounds.height);r[c]={id:c,defId:a.defId,version:a.version,defaultBounds:l,x:o.vToDcoordinate.x(e)+20,y:o.vToDcoordinate.y(n)+20,eData:a.eData,data:a.data,entityListId:a.entityListId,dataSource:a.dataSource,triggerNewEData:a.triggerNewEData,type:a.type,entityDefId:a.entityDefId,definedSearchQuery:t.definedSearchQuery,texts:a.texts,origin:y.l.PRE_DEFINED_QUERIES,style:a.style,$$createLinkOptions:null===(s=a.smartSetOptions)||void 0===s?void 0:s.createLinkConfig}}));var h=Object.values(t.shapes)[0];return this.commandService.dispatch(D.a.addPredefinedQueryShapes,{shapes:r,containerOptions:null===(a=h.smartSetOptions)||void 0===a?void 0:a.containerConfig}).pipe(Object(lt.a)(),Object(T.a)((function(t){var e=t.resultData[2].shapes;return Object(x.a)(o.commandService.dispatch(D.a.changeContainerData,{childrenData:Object(J.pick)(t.resultData[1].childrenData,Object.keys(e)),__origin__:"SmartSetAdd"}),o.eDataManageSvc.createSavedSet(r,e))}))).subscribe()},e.prototype.detectEndPointCollision=function(){var t=this;return Object(P.a)(this.interactionCanvas,Tt.b.interactionStart).pipe(Object(E.a)((function(t){return t.interactionName===Wt.prototype.name})),Object(M.a)((function(e){return t.handleEndPointMoveStart(e)})),Object(T.a)((function(){return Object(P.a)(t.interactionCanvas,Tt.b.interaction).pipe(Object(E.a)((function(t){return t.interactionName===Wt.prototype.name})),Object(ut.a)(t.endPointMoveThrottleTime),Object(M.a)((function(e){return t.handleEndPointMove(e)})),Object(it.a)(Object(x.a)(Object(P.a)(t.interactionCanvas,Tt.b.interactionEnd),Object(P.a)(t.interactionCanvas,Tt.b.interactionCancel)).pipe(Object(E.a)((function(t){return t.interactionName===Wt.prototype.name})),Object(M.a)((function(e){return t.handleEndPointMoveEnd(e)})))))})))},e.prototype.handleEndPointMoveStart=function(t){this.endPointCollision=new vt,this.endPointCollisionChildren=this.diagramCanvas.children.filter((function(t){return t.isShapeView}))},e.prototype.handleEndPointMove=function(t){var e,n=this.createFilterByMousePosition(t),i=((this.interactionCanvas.children.find((function(t){return"GluePointHandler"===t.name}))||{}).children||[]).filter((function(t){return t instanceof It&&n(t)}));if(i.length>0&&(e=this.endPointCollision.getColliding(i,t.handle))&&e.length>0){var a=e[e.length-1];this.fireEndPointHoverEvent(t.handle,a)}else if((e=this.endPointCollision.getColliding(this.endPointCollisionChildren,t.handle))&&e.length>0){a=e[e.length-1];this.fireEndPointHoverEvent(t.handle,a)}else this.fireEndPointHoverEvent(t.handle)},e.prototype.fireEndPointHoverEvent=function(t,e){if(this.endPointOverShape!==e){var n=this.endPointOverShape;e?(this.endPointOverShape=e,this.dispatchEndPointHoverEvent(G.over,t,e)):this.endPointOverShape=void 0,n&&this.dispatchEndPointHoverEvent(G.out,t,n)}},e.prototype.dispatchEndPointHoverEvent=function(t,e,n){n.stage===this.interactionCanvas?n.dispatchEvent(new Pt(t,e,n)):this.interactionCanvas.dispatchEvent(new Pt(t,e,n))},e.prototype.handleEndPointMoveEnd=function(t){this.endPointOverShape&&this.fireEndPointHoverEvent(t.handle),this.endPointOverShape=void 0,this.endPointCollision=void 0,this.endPointCollisionChildren=void 0},e.prototype.handleAddConnector=function(){var t=this;return this.state.changes("ConnectorAdded").pipe(Object(w.a)(1),Object(T.a)((function(e){return Object(P.a)(t.interactionCanvas,Tt.b.interactionStart).pipe(Object(E.a)((function(t){return t.interactionName===Wt.prototype.name})),Object(T.a)((function(){return Object(x.a)(Object(P.a)(t.interactionCanvas,Tt.b.interactionEnd),Object(P.a)(t.interactionCanvas,Tt.b.interactionCancel))})),Object(st.a)(),Object(I.a)((function(){return e})))})),Object(at.a)(10),Object(M.a)((function(e){return t.commandService.dispatch(D.a.adjustConnector,{connectorId:e})})))},e.prototype.addShapeFromMouseEvent=function(t,e,n){var i=this;if(void 0===n&&(n=!1),null==t?void 0:t.nativeEvent){var a=t.nativeEvent.clientX-y.A,o=t.nativeEvent.clientY-20;this.shapeManage.addShape(e,a,o).pipe(Object(M.a)((function(t){n&&(i.selectShapes([t.id]),i.openTextEditor(t.id))}))).subscribe()}},e.prototype.getSelectionInteractionStartEnd=function(){return Object(x.a)(Object(P.a)(this.gridCanvas,Tt.b.interactionStart),Object(P.a)(this.gridCanvas,Tt.b.interactionEnd),Object(P.a)(this.gridCanvas,Rt.start),Object(P.a)(this.gridCanvas,Rt.end))},e.prototype.getCursorByPosition=function(){var t=this,e=this.state.changes("Selected");return Object(x.a)(e.pipe(Object(I.a)((function(){return{x:t.interactionCanvas.getMouseX(),y:t.interactionCanvas.getMouseY()}}))),this.pointerMove()).pipe(Object(dt.a)(100),Object(I.a)((function(e){var n=["editor","normal"],i=t.getObjectsUnderPoint(e);return n.push.apply(n,Object(W.j)(t.getOnAndSelectedSubContexts(i))),t.getCursorByContext(i,n)})))},e.prototype.isSelected=function(t){return this.state.get("Selected").findIndex((function(e){return e===t}))>-1},e.prototype.getDataFromInteractionEvent=function(t){var e=t.target,n=null;"MoveInteraction"===t.interactionName&&(n=e.selectedIds[0]);var i=t.relatedEvent.nativeEvent,a=!t.relatedEvent.data||!t.relatedEvent.data.isSimulated;return{id:n,name:t.interactionName,type:t.type,nativeEvent:i,isUserInteraction:a}},e.prototype.createFilterByMousePosition=function(t){var e=t.relatedEvent,n=e.stageX,a=e.stageY,o=new i.rb(n,a),r=t.handle.getBounds().width/2;return function(t){return o.distanceTo(t)<r+t.radius}},e.\u0275fac=function(t){return new(t||e)(o.qc(i.B),o.qc(b.a),o.qc(i.Nb),o.qc(ee.a),o.qc(ht.a),o.qc(f.a),o.qc(Ot.a),o.qc(i.ub),o.qc($t.a),o.qc(mt.b),o.qc(r.e),o.qc(xt.a),o.qc(re.a))},e.\u0275prov=o.cc({token:e,factory:e.\u0275fac}),e}(bt.a);Object.defineProperty(se,"name",{value:"EditorInteractionHandler"});var ce=n("C+in"),le=n("ZTXN"),ue=function(t){function e(e,n,i,a){void 0===i&&(i=!0),void 0===a&&(a=!0);var o=t.call(this,e,n,i,a)||this;return o.setRelatedShape(n),o}return Object(W.e)(e,t),e}(ne.a),de=function(t){function e(e,n,i,a,o){var r=t.call(this,e,o,a)||this;return r.commandService=e,r.ll=n,r.random=i,r.state=a,r.vToDcoordinate=o,r._shapes={},r.addSource=new le.a,r.changeSource=new le.a,r}return Object(W.e)(e,t),Object.defineProperty(e.prototype,"defaultCursor",{get:function(){return{cursor:"crosshair",tail:null,type:"css"}},enumerable:!1,configurable:!0}),e.prototype.initialize=function(e,n,i){var a=this,o=t.prototype.initialize.call(this,e,n,i),r=this.getShapeOver().pipe(Object(M.a)((function(t){return a.shapeOver(t)}))),s=this.getAllCanvasMouseCapture().pipe(Object(M.a)((function(t){return t.stopPropagation()})),Object(E.a)((function(t){return"mousedown"===t.type})),Object(M.a)((function(t){a.commandService.dispatch(gt.a.changeMouseControlState,{state:pt.b.Normal}),a.createConnector(t).subscribe()})));return Object(x.a)(o,s,r)},e.prototype.getCursor=function(){var t=this;return this.pointerMove().pipe(Object(rt.a)({x:this.interactionCanvas.getMouseX(),y:this.interactionCanvas.getMouseY()}),Object(I.a)((function(e){var n=t.getObjectsUnderPoint(e).filter((function(t){return t.parent instanceof Xt.a||t instanceof It}));return t.getCursorByContext(n,["editor","createConnector"])})),Object(et.a)((function(t,e){return t.cursor===e.cursor&&t.tail===e.tail})))},e.prototype.createConnector=function(t){var e=t.nativeEvent,n=e.offsetX,i=e.offsetY,a=this.random.shapeId();return this.addConnector(a,{x:n,y:i},t.target)},e.prototype.addConnector=function(t,e,n){var i,a=this,o=this.state.get("MouseControlState"),r={id:t,points:[Object(W.a)({},e),Object(W.a)({},e)]};o===pt.b.Line&&(r.entryClass="connectors.bundle.js#ConnectorStraight");var s=r.points[0];return(n&&this.isValidTarget(n)?this.ll.forCurrent(!1).getShapeOnce(null===(i=null==n?void 0:n.parent)||void 0===i?void 0:i.name).pipe(Object(M.a)((function(t){if(n instanceof It)s.shapeId=n.shapeId,s.gluepointId=n.gluePointId,s.gluepointLocked=!0,delete r.entryClass;else if(n&&t){var i=a.positionOnShape(t,e);s.shapeId=t.id,s.onShape=!0,s.position=i}})),Object(Mt.a)(r)):Object($.a)(r)).pipe(Object(T.a)((function(e){return a.commandService.dispatch(D.a.addConnector,e).pipe(Object(st.a)(),Object(M.a)((function(){a.state.set("ConnectorAdded",t)})))})))},e.prototype.getShapeOver=function(){var t=this;return this.getShapes().pipe(Object(ot.a)((function(e){return Object(x.a)(Object(P.a)(e,"rollover"),Object(P.a)(e,"rollout")).pipe(Object(it.a)(Object(P.a)(t.diagramCanvas,"childRemoved").pipe(Object(E.a)((function(t){return t.child===e})))))})),Object(I.a)((function(t){return t})))},e.prototype.shapeOver=function(t){var e="rollover"===t.type?"shapeRollOver":"shapeRollOut";this.interactionCanvas.dispatchEvent(new ue(e,t))},e.prototype.positionOnShape=function(t,e){var n=e;n.x=this.vToDcoordinate.x(n.x),n.y=this.vToDcoordinate.y(n.y);var i=t.getPositionOnShape(n,5);return i={x:i.x.value,y:i.y.value}},e.prototype.isValidTarget=function(t){return t instanceof It||t.parent instanceof Xt.a},e.\u0275fac=function(t){return new(t||e)(o.qc(i.B),o.qc(b.a),o.qc(i.xb),o.qc(i.Nb),o.qc(ht.a))},e.\u0275prov=o.cc({token:e,factory:e.\u0275fac}),e}(bt.a);Object.defineProperty(de,"name",{value:"ConnectorInteractionHandler"});var pe=n("bUaT"),he=n("61p6"),ge=n("izw+"),fe=n("wp/b"),be=n("tHMF"),me=n("35j0"),ve=n("tqrN"),ye=n("flPR"),Se=function(t){function e(){var e=t.call(this)||this;return e.lineColor="#F05252",e.backgroundColor="#F05252",e.textPadding=5,e.lineThickness=.5,e.texts=[],e.lines=new Z.Shape,e.textBgRects=new Z.Shape,e.addChild(e.lines),e.addChild(e.textBgRects),e}return Object(W.e)(e,t),e.prototype.update=function(t){var e=this;this.clear(),t.forEach((function(t){return e.drawLine(t[0],t[1])}))},e.prototype.clear=function(){var t=this;this.lines.graphics.clear(),this.textBgRects.graphics.clear(),this.texts.forEach((function(e){return t.removeChild(e)}))},e.prototype.destroy=function(){},e.prototype.drawLine=function(t,e){if(t&&e){var n=new Z.Text(""+Math.round(t.distance),"12px Arial","#fff");this.addChild(n),this.texts.push(n);var a=n.getMeasuredWidth()+2*this.textPadding,o=n.getMeasuredHeight()+2*this.textPadding,r=new i.fb(t,e).split(.5);n.x=r.x-a/2+this.textPadding,n.y=r.y-o/2+this.textPadding,this.textBgRects.graphics.setStrokeStyle(1).beginStroke(this.backgroundColor).beginFill(this.backgroundColor).drawRect(r.x-a/2,r.y-o/2,a,o).endFill(),this.lines.graphics.setStrokeStyle(this.lineThickness).beginStroke(this.lineColor).moveTo(t.x,t.y).lineTo(e.x,e.y).endStroke()}},e}(Z.Container),Oe=function(t){function e(e,n,i,a){var o=t.call(this,i)||this;return o.vtoD=e,o.viewport=n,o.state=i,o.alignNodeLocator=a,o.threshold=10,o.distanceGuideDebounceTime=10,o.guidesThrottle=200,o.addSource=new le.a,o.removeSource=new le.a,o.changeSource=new le.a,o._indicator=new Se,o}return Object(W.e)(e,t),Object.defineProperty(e.prototype,"indicators",{get:function(){return[this._indicator]},enumerable:!1,configurable:!0}),e.prototype.initialize=function(){var t=this,e=this.state.changes("InterfaceControlState").pipe(Object(T.a)((function(e){return t.state.changes("ShowGuides").pipe(Object(et.a)(),Object(T.a)((function(n){return n&&"edit"===e?t.initForEditor():(t.removeSource.next(t._indicator),Object(C.b)())})))})));this.subs.push(e.subscribe())},e.prototype.createAddSource=function(){return this.addSource},e.prototype.createRemoveSource=function(){return this.removeSource},e.prototype.createChangeSource=function(){return this.changeSource},e.prototype.getDistancePairs=function(t){var e=this;return this.viewport.getShapeModels(t).pipe(Object(M.a)((function(){return e._indicator.clear()})),Object(ut.a)(this.distanceGuideDebounceTime),Object(T.a)((function(t){var n=Object(J.values)(t);if(1===n.length){if(n[0].isConnector()){var i=n[0];if(!i.isLine()||!i.isVertical()&&!i.isHorizontal())return Object($.a)([])}return e.searchNodes(n[0].viewBounds)}if(n.length){var a=n[0].viewBounds;return n.forEach((function(t,e){e>0&&(a=a.absorb(t.viewBounds))})),e.searchNodes(a)}return Object($.a)([])})))},e.prototype.searchNodes=function(t){var e=this,n=this.state.get("DiagramViewPort"),i=this.getSelectionNodesForRect(t),a=this.alignNodeLocator.search(n.left,n.right,t.top,t.bottom);a&&a.length&&a.push.apply(a,Object(W.j)(i));var o,r,s=this.alignNodeLocator.search(t.left,t.right,n.top,n.bottom);s&&s.length&&s.push.apply(s,Object(W.j)(i));var c,l,u=Object(J.maxBy)(a.filter((function(t){return"top"===t.pos})),(function(t){return t.y})),d=Object(J.minBy)(a.filter((function(t){return"bottom"===t.pos})),(function(t){return t.y})),p=Object(J.maxBy)(s.filter((function(t){return"left"===t.pos})),(function(t){return t.x})),h=Object(J.minBy)(s.filter((function(t){return"right"===t.pos})),(function(t){return t.x}));return u&&d&&(o=u.y+(d.y-u.y)/2,c=Object(J.uniq)(a.map((function(t){return t.shapeId})))),p&&h&&(r=p.x+(h.x-p.x)/2,l=Object(J.uniq)(s.map((function(t){return t.shapeId})))),this.viewport.getShapeModels().pipe(Object(j.a)(1),Object(I.a)((function(n){var i=[];if(void 0!==o&&c&&c.length){var a=e.findHorizontalPairs(t,Object(J.values)(n).filter((function(t){return c.includes(t.id)})),o);i.push.apply(i,Object(W.j)(a))}if(void 0!==r&&l&&l.length){var s=e.findVerticalPairs(t,Object(J.values)(n).filter((function(t){return l.includes(t.id)})),r);i.push.apply(i,Object(W.j)(s))}return i})))},e.prototype.findHorizontalPairs=function(t,e,n){return this.findPairs(t,e,n,"left","right","top","bottom","centerX").map((function(t){return t[0].x=t[0].v,t[1].x=t[1].v,t[0].y=n,t[1].y=n,t}))},e.prototype.findVerticalPairs=function(t,e,n){return this.findPairs(t,e,n,"top","bottom","left","right","centerY").map((function(t){return t[0].y=t[0].v,t[1].y=t[1].v,t[0].x=n,t[1].x=n,t}))},e.prototype.findPairs=function(t,e,n,i,a,o,r,s){var c=this,l=Object(J.sortBy)(e,(function(t){return t.viewBounds[s]})).filter((function(t){return t.viewBounds[o]<=n&&t.viewBounds[r]>=n})),u=l.filter((function(e){return e.viewBounds[i]>t[s]})),d=l.filter((function(e){return e.viewBounds[a]<t[s]})).reverse(),p=[],h=[];return u.unshift({viewBounds:t}),u.forEach((function(t,e){if(u[e]&&u[e+1]){var n=u[e].viewBounds[a],o=u[e+1].viewBounds[i];o>n&&h.push([{v:n,distance:Math.abs(c.vtoD.height(o-n))},{v:o}])}})),d.unshift({viewBounds:t}),d.forEach((function(t,e){if(d[e]&&d[e+1]){var n=d[e].viewBounds[i],o=d[e+1].viewBounds[a];n>o&&p.push([{v:n,distance:Math.abs(c.vtoD.height(o-n))},{v:o}])}})),this.getEqualySpacedPairs(h,p)},e.prototype.initForEditor=function(){var t=this;return this.state.changes("Selected").pipe(Object(T.a)((function(e){return t.duringSelectionInteraction([],e)})),Object(Q.lodashThrottle)(this.guidesThrottle),Object(T.a)((function(e){return e.length?(t.addSource.next(t._indicator),t.getDistancePairs(e).pipe(Object(M.a)((function(e){t.updateIndicator(e)})))):(t.removeSource.next(t._indicator),Object(C.b)())})))},e.prototype.getSelectionNodesForRect=function(t){return[{pos:"left",x:t.left,y:t.centerY,type:"selection"},{pos:"right",x:t.right,y:t.centerY,type:"selection"},{pos:"top",y:t.top,x:t.centerX,type:"selection"},{pos:"bottom",y:t.bottom,x:t.centerX,type:"selection"}]},e.prototype.getEqualySpacedPairs=function(t,e){var n=this,i=[],a=[];if(t.length>0){var o=t[0][0].distance;t.every((function(t,e){return Math.abs(t[0].distance-o)<=n.threshold&&(i.push(t),!0)}))}if(e.length>0){var r=e[0][0].distance;e.every((function(t,e){return Math.abs(t[0].distance-r)<=n.threshold&&(a.push(t),!0)}))}var s=[];if(1===a.length&&1===i.length){var c=Object(W.j)(a,i),l=c[0][0].distance;c.every((function(t,e){return Math.abs(t[0].distance-l)<=n.threshold&&(s.push(t),!0)}))}else s=a.length<=1?Object(W.j)(i):i.length<=1?Object(W.j)(a):Object(W.j)(a,i);return s.length>1?s:[]},e.prototype.updateIndicator=function(t){this._indicator.update(t),this.changeSource.next(this._indicator)},e.\u0275fac=function(t){return new(t||e)(o.qc(ht.a),o.qc(m.a),o.qc(i.Nb),o.qc(ve.a))},e.\u0275prov=o.cc({token:e,factory:e.\u0275fac}),e=Object(W.d)([Object(ye.a)(),Object(W.g)("design:paramtypes",[ht.a,m.a,i.Nb,ve.a])],e)}(ye.b),xe=function(t){function e(){var e=t.call(this)||this;return e.shape=new Z.Shape,e.addChild(e.shape),e}return Object(W.e)(e,t),e.prototype.update=function(t){var e=this;this.shape.graphics.clear(),t.forEach((function(t){return e.drawLine(t[0],t[1])}))},e.prototype.clear=function(){this.shape.graphics.clear()},e.prototype.destroy=function(){},e.prototype.drawLine=function(t,n){t&&n&&this.shape.graphics.setStrokeStyle(e.lineThickness).beginStroke(e.lineColor).moveTo(t.x,t.y).lineTo(n.x,n.y).endStroke()},e.lineColor="#F05252",e.lineThickness=.5,e}(Z.Container),Ce=n("HM3f"),Pe=function(t){function e(e,n,i,a){var o=t.call(this,i)||this;return o.vtoD=e,o.viewport=n,o.state=i,o.alignNodeLocator=a,o.showGuidesPrecision=0,o.snap=5,o.alignDebounceTime=10,o.guidesThrottle=200,o.addSource=new le.a,o.removeSource=new le.a,o.changeSource=new le.a,o._indicator=new xe,o}return Object(W.e)(e,t),Object.defineProperty(e.prototype,"indicators",{get:function(){return[this._indicator]},enumerable:!1,configurable:!0}),e.prototype.initialize=function(){var t=this,e=this.state.changes("InterfaceControlState").pipe(Object(T.a)((function(e){return Object(Ce.b)(t.state.changes("SnapToGuides"),t.state.changes("ShowGuides")).pipe(Object(I.a)((function(t){var e=Object(W.h)(t,2),n=e[0],i=e[1];return n||i})),Object(et.a)(),Object(T.a)((function(n){return n&&"edit"===e?t.initForEditor():(t.removeSource.next(t._indicator),Object(C.b)())})))})));this.subs.push(e.subscribe())},e.prototype.createAddSource=function(){return this.addSource},e.prototype.createRemoveSource=function(){return this.removeSource},e.prototype.createChangeSource=function(){return this.changeSource},e.prototype.getAlignmentNodesPaires=function(t){var e=this;return this.viewport.getShapeModels(t).pipe(Object(M.a)((function(){return e._indicator.clear()})),Object(ut.a)(this.alignDebounceTime),Object(I.a)((function(t){var n=Object(J.values)(t);if(1===n.length){if(n[0].isConnector()){var i=n[0];if(!i.isLine()||!i.isVertical()&&!i.isHorizontal())return[]}return e.snapForRect(n[0].viewBounds,e.snap)}if(n.length){var a=n[0].viewBounds;return n.forEach((function(t,e){e>0&&(a=a.absorb(t.viewBounds))})),e.snapForRect(a,e.snap)}return[]})))},e.prototype.searchNodes=function(t,e){var n=this.state.get("DiagramViewPort");return{verticalLeft:this.alignNodeLocator.search(t.x-e,t.x+e,n.top,n.bottom),verticalMiddle:this.alignNodeLocator.search(t.x+t.width/2-e,t.x+t.width/2+e,n.top,n.bottom),verticalRight:this.alignNodeLocator.search(t.x-e+t.width,t.x+t.width+e,n.top,n.bottom),horizontalTop:this.alignNodeLocator.search(n.left,n.right,t.y-e,t.y+e),horizontalMiddle:this.alignNodeLocator.search(n.left,n.right,t.y+t.height/2-e,t.y+t.height/2+e),horizontalBottom:this.alignNodeLocator.search(n.left,n.right,t.y+t.height-e,t.y+t.height+e)}},e.prototype.snapForRect=function(t,e){var n,i,a,o,r,s,c=this.searchNodes(t,e),l=c.verticalLeft;l.length>0&&(a=Object(J.minBy)(l,(function(e){return Math.abs(t.x-e.x)})).x,c.verticalLeft=l.filter((function(t){return t.x===a})),r=a);var u=c.verticalMiddle;if(u.length>0){var d=Object(J.minBy)(u,(function(e){return Math.abs(t.x+t.width/2-e.x)})).x;c.verticalMiddle=u.filter((function(t){return t.x===d}));var p=d-t.width/2;void 0!==r?Math.abs(t.x-r)>Math.abs(t.x-p)&&(r=p):r=p}var h=c.verticalRight;if(h.length>0){o=Object(J.minBy)(h,(function(e){return Math.abs(t.x+t.width-e.x)})).x,c.verticalRight=h.filter((function(t){return t.x===o}));var g=o-t.width;void 0!==r?Math.abs(t.x-r)>Math.abs(t.x-g)&&(r=g):r=g}var f=c.horizontalTop;f.length>0&&(n=Object(J.minBy)(f,(function(e){return Math.abs(t.y-e.y)})).y,c.horizontalTop=f.filter((function(t){return t.y===n})),s=n);var b=c.horizontalMiddle;if(b.length>0){var m=Object(J.minBy)(b,(function(e){return Math.abs(t.y+t.height/2-e.y)})).y;c.horizontalMiddle=b.filter((function(t){return t.y===m}));var v=m-t.height/2;void 0!==s?Math.abs(t.y-s)>Math.abs(t.y-v)&&(s=v):s=v}var y=c.horizontalBottom;if(y.length>0){i=Object(J.minBy)(y,(function(e){return Math.abs(t.y+t.height-e.y)})).y,c.horizontalBottom=y.filter((function(t){return t.y===i}));var S=i-t.height;void 0!==s?Math.abs(t.y-s)>Math.abs(t.y-S)&&(s=S):s=S}var O={tx:void 0!==r?this.vtoD.x(r):void 0,ty:void 0!==s?this.vtoD.y(s):void 0,top:void 0!==n?this.vtoD.y(n):void 0,bottom:void 0!==i?this.vtoD.y(i):void 0,left:void 0!==a?this.vtoD.x(a):void 0,right:void 0!==o?this.vtoD.x(o):void 0};return this.state.get("SnapToGuides")?Object(J.isEqual)(this.state.get("SnapData"),O)||this.state.set("SnapData",O):this.state.set("SnapData",{}),this.state.get("ShowGuides")?this.getNodePairesForRect(c,t):[]},e.prototype.initForEditor=function(){var t=this;return this.state.changes("Selected").pipe(Object(T.a)((function(e){return t.duringSelectionInteraction([],e)})),Object(Q.lodashThrottle)(this.guidesThrottle),Object(T.a)((function(e){return e.length?(t.addSource.next(t._indicator),t.getAlignmentNodesPaires(e).pipe(Object(M.a)((function(e){t.updateIndicator(e)})))):(t.removeSource.next(t._indicator),Object(C.b)())})))},e.prototype.getNodePairesForRect=function(t,e){var n=t.verticalLeft;n.length&&i.pb.isEqual(n[0].x,e.left,this.showGuidesPrecision)?n.push({pos:"left",x:e.x,y:e.centerY,type:"selection"}):n=[];var a=t.verticalMiddle;a.length&&i.pb.isEqual(a[0].x,e.centerX,this.showGuidesPrecision)?(a.push({pos:"top",x:e.centerX,y:e.y,type:"selection"}),a.push({pos:"bottom",x:e.centerX,y:e.y+e.height,type:"selection"})):a=[];var o=t.verticalRight;o.length&&i.pb.isEqual(o[0].x,e.right,this.showGuidesPrecision)?o.push({pos:"right",x:e.x+e.width,y:e.centerY,type:"selection"}):o=[];var r=t.horizontalTop;r.length&&i.pb.isEqual(r[0].y,e.top,this.showGuidesPrecision)?r.push({pos:"top",x:e.centerX,y:e.y,type:"selection"}):r=[];var s=t.horizontalMiddle;s.length&&i.pb.isEqual(s[0].y,e.centerY,this.showGuidesPrecision)?(s.push({pos:"left",x:e.x,y:e.centerY,type:"selection"}),s.push({pos:"right",x:e.x+e.width,y:e.centerY,type:"selection"})):s=[];var c=t.horizontalBottom;c.length&&i.pb.isEqual(c[0].y,e.bottom,this.showGuidesPrecision)?c.push({pos:"bottom",x:e.centerX,y:e.y+e.height,type:"selection"}):c=[];var l=[n,a,o].filter((function(t){return t&&t.length>1})).map((function(t){return[Object(J.minBy)(t,(function(t){return t.y})),Object(J.maxBy)(t,(function(t){return t.y}))]})),u=[r,s,c].filter((function(t){return t&&t.length>1})).map((function(t){return[Object(J.minBy)(t,(function(t){return t.x})),Object(J.maxBy)(t,(function(t){return t.x}))]}));return Object(W.j)(l,u)},e.prototype.updateIndicator=function(t){this._indicator.update(t),this.changeSource.next(this._indicator)},e.\u0275fac=function(t){return new(t||e)(o.qc(ht.a),o.qc(m.a),o.qc(i.Nb),o.qc(ve.a))},e.\u0275prov=o.cc({token:e,factory:e.\u0275fac}),e=Object(W.d)([Object(ye.a)(),Object(W.g)("design:paramtypes",[ht.a,m.a,i.Nb,ve.a])],e)}(ye.b),Te=n("Dnwm"),we=n("19Zn"),je=function(t){function e(e){var n=t.call(this)||this;return n.user=e,n.animationDuration=30,n.thickness=2,n.textPadding=5,n.subs=[],n.onChange=function(){return null},n.rect=new Z.Shape,n.textRect=new Z.Shape,n.path=new Z.Shape,n.textRect.alpha=0,n.text=new Z.Text(n.user.fullName,"12px Arial","#fff"),n.text.alpha=0,n.addChild(n.path),n.addChild(n.textRect),n.addChild(n.rect),n.addChild(n.text),n}return Object(W.e)(e,t),e.prototype.toggleUserName=function(t){var e=this.text.isVisible()&&this.textRect.isVisible();if(this.bounds){var n=this.bounds.contains({x:t.x,y:t.y,width:0,height:0});!e&&n&&this.setVisibilty([this.text,this.textRect],!0),e&&!n&&this.setVisibilty([this.text,this.textRect],!1)}else{var i=this.stage.getObjectsUnderPoint(t.x,t.y,0).includes(this.path);!e&&i&&this.setVisibilty([this.text,this.textRect],!0),e&&!i&&this.setVisibilty([this.text,this.textRect],!1)}},e.prototype.destroy=function(){for(;this.subs.length>0;)this.subs.pop().unsubscribe()},e.prototype.update=function(t){var e=this.text.getMeasuredWidth()+2*this.textPadding,n=this.text.getMeasuredHeight()+2*this.textPadding;t.isConnector()?this.drawPath(t,e,n).subscribe():this.drawBox(t,e,n)},e.prototype.setVisibilty=function(t,e){var n=this;t.forEach((function(t){return Z.Tween.get(t,{override:!0,onChange:n.onChange}).to({alpha:e?1:0,visible:e},n.animationDuration)}))},e.prototype.drawBox=function(t,e,n){var a=t.defaultBounds;this.bounds=a;var o=t.viewTransform,r=i.Ab.from(a).getTransformedPoints(o),s=r.topLeft,c=r.topRight,l=r.bottomLeft,u=r.bottomRight;this.rect.graphics.clear().setStrokeStyle(this.thickness).beginStroke(this.user.displayColor).moveTo(s.x,s.y).lineTo(c.x,c.y).lineTo(u.x,u.y).lineTo(l.x,l.y).lineTo(s.x,s.y).endStroke(),this.textRect.graphics.clear().setStrokeStyle(this.thickness).beginStroke(this.user.displayColor).beginFill(this.user.displayColor).drawRect(a.right-e,a.top-n,e,n).endFill(),this.text.x=a.right-e+this.textPadding,this.text.y=a.top-n+this.textPadding},e.prototype.drawPath=function(t,e,n){var i=this;return we.g.instance.create(t,Te.a).pipe(Object(j.a)(1),Object(M.a)((function(a){var o=t.splitByLength(t.length/2);i.path.graphics.clear(),a.points=t.viewPoints,a.shapeView=i.path,a.beginDrawHitArea(),a.graphics.setStrokeStyle(t.style.lineThickness).beginStroke(i.user.displayColor),a.draw(),a.endDraw(),i.textRect.graphics.clear().setStrokeStyle(i.thickness).beginStroke(i.user.displayColor).beginFill(i.user.displayColor).drawRect(o.x-e/2,o.y-n/2,e,n).endFill(),i.text.x=o.x-e/2+i.textPadding,i.text.y=o.y-n/2+i.textPadding})))},e}(Z.Container),Me=n("wkcE"),Ie=function(t){function e(e,n,i){var a=t.call(this,n)||this;return a.viewport=e,a.state=n,a.collabLocator=i,a._indicators={},a.addSource=new le.a,a.removeSource=new le.a,a.changeSource=new le.a,a.update=new O.a(!0),a}return Object(W.e)(e,t),Object.defineProperty(e.prototype,"indicators",{get:function(){return Object(J.values)(this._indicators)},enumerable:!1,configurable:!0}),e.prototype.initialize=function(){var t=this,e=this.state.changes("InterfaceControlState").pipe(Object(T.a)((function(e){return t.removeIndicators(),"edit"===e?t.initForEditor():Object(C.b)()})));this.subs.push(e.subscribe(),this.pointerMove().subscribe((function(e){t.indicators.forEach((function(t){return t.toggleUserName(e)}))})))},e.prototype.createAddSource=function(){return this.addSource},e.prototype.createRemoveSource=function(){return this.removeSource},e.prototype.createChangeSource=function(){return this.changeSource},e.prototype.pointerMove=function(t){return void 0===t&&(t=200),Object(P.a)(this.indicatorLayer.canvas,"mousemove").pipe(Object(Q.lodashThrottle)(t,{leading:!0,trailing:!0}),Object(I.a)((function(t){return{x:t.x,y:t.y}})))},e.prototype.initForEditor=function(){var t=this;return Object(x.a)(this.state.changes("SelectionBlocked").pipe(Object(T.a)((function(e){return t.state.changes("ActiveShapes").pipe(Object(T.a)((function(n){return t.manageIndicators(e,n)})))}))),this.state.changes("ActiveShapes").pipe(Object(T.a)((function(){return t.update})),Object(T.a)((function(){return t.viewport.getShapeModels(Object.keys(t._indicators)).pipe(Object(M.a)((function(e){return t.updateIndicators(e)})))}))))},e.prototype.manageIndicators=function(t,e){var n=this,i=Object(J.flatten)(t.map((function(t){return t.selected}))).filter((function(t){return e.includes(t)}));return this.manageIndicatorsRemove(i),this.manageIndicatorsAdd(t,i).pipe(Object(M.a)({complete:function(){return n.update.next(!0)}}))},e.prototype.manageIndicatorsRemove=function(t){var e=this;Object.keys(this._indicators).forEach((function(n){t.includes(n)||e.removeIndicator(n)}))},e.prototype.manageIndicatorsAdd=function(t,e){var n=this,i=[Object(C.b)()];return t.forEach((function(t){(t.selected||[]).filter((function(t){return e.includes(t)})).forEach((function(e){if(!n._indicators[e]&&n.state.get("CurrentUser")){var a=n.getUser(t.userId).pipe(Object(E.a)((function(t){return!!t})),Object(M.a)((function(t){n._indicators[e]=new je(t),n.addSource.next(n._indicators[e])})));i.push(a)}}))})),x.a.apply(void 0,Object(W.j)(i))},e.prototype.getUser=function(t){return this.collabLocator.getCollab(t).pipe(Object(E.a)((function(t){return null!==t})),Object(j.a)(1))},e.prototype.updateIndicators=function(t){var e=this;Object.keys(this._indicators).forEach((function(n){var i=t[n];if(i){var a=e._indicators[n];a.update(i),e.changeSource.next(a),a.onChange=function(){return e.changeSource.next(a)}}}))},e.prototype.removeIndicators=function(){var t=this;Object.keys(this._indicators).forEach((function(e){return t.removeIndicator(e)})),this._indicators={}},e.prototype.removeIndicator=function(t){var e=this._indicators[t];this.removeSource.next(e),e.destroy(),delete this._indicators[t]},e.\u0275fac=function(t){return new(t||e)(o.qc(m.a),o.qc(i.Nb),o.qc(Me.a))},e.\u0275prov=o.cc({token:e,factory:e.\u0275fac}),e=Object(W.d)([Object(ye.a)(),Object(W.g)("design:paramtypes",[m.a,i.Nb,Me.a])],e)}(ye.b),Ee=n("BQCR"),De=n("4y1S"),_e=n("f6YR"),ke=n("T4Sa"),Ae=n("Voii"),Le=n("SBw3"),Be=n("Fqp3"),Re=n("vg1f"),Ne=n("lu3Q"),He=n("PDpc"),Fe=n("HaSC"),Ge=n("3lSR"),qe=n("8lHc"),Ve=n("K6aZ"),Ue=n("6EBr"),ze=function(t){function e(e,n,i,a){var o=t.call(this)||this;return o.model=e,o.hitboxes={},o.circles={},o.plusSigns={},o.borders={},o.lastId="",o.verticalPadding=40,o.horizontalPadding=40,o.circleSize=5,o.instantScale=10/(o.circleSize+1),o.delayedScale=16/(o.circleSize+1),o.hovered=Ve.a.buttonDefs.reduce((function(t,e){return t[e.id]=!1,t}),{}),o.dToV=null,o.delayedTimers=[],o.dToV=a,o.prepare(n,i),o}return Object(W.e)(e,t),e.prototype.destroy=function(){},e.prototype.onHover=function(t){var e,n,i=this;if(t!==this.lastId){var a=t||this.lastId;this.lastId=t;var o=this.instantScale,r=this.delayedScale,s=this.circles[t||a],c=this.borders[t||a];if(t){if(s.scaleX===r&&s.scaleY===r)return;this.hovered[t]=!0,s.scaleX=o,s.scaleY=o,c.graphics.setStrokeStyle(1/o),c.scaleX=o,c.scaleY=o,null===(e=null==this?void 0:this.stage)||void 0===e||e.update()}if(!t&&(this.hovered[a]=!1,s.scaleX===o&&s.scaleY===o))return s.scaleX=1,s.scaleY=1,c.graphics.setStrokeStyle(1),c.scaleX=1,c.scaleY=1,void(null===(n=null==this?void 0:this.stage)||void 0===n||n.update());var l=Object(qe.a)(300).pipe(Object(j.a)(1));this.delayedTimers[a]=l,l.subscribe((function(){var e;if(t){if(!i.hovered[t])return;var n=i.plusSigns[t];if(!s||!n)return;n.alpha=1,s.scaleX=r,s.scaleY=r,c.graphics.setStrokeStyle(4),c.graphics.beginStroke("#FF0000"),c.scaleX=r,c.scaleY=r}else{if(i.hovered[a])return;n=i.plusSigns[a];if(!s||!n)return;n.alpha=0,s.scaleX=1,s.scaleY=1,c.graphics.setStrokeStyle(1),c.scaleX=1,c.scaleY=1}null===(e=null==i?void 0:i.stage)||void 0===e||e.update()}))}},e.prototype.move=function(t,e){var n=e.localX,i=e.localY,a=this.hitboxes[t];a.x+=n,a.y+=i},e.prototype.prepare=function(t,e){var n=this,i=this.horizontalPadding,a=this.verticalPadding,o=this.dToV.width(t.drawWidth)+i*e,r=this.dToV.height(t.drawHeight)+a*e,s=t.getCollapsedGlupepoints().map((function(e){return jt.a.side(e,t.bounds,t.defaultBounds,t.transform)})),c=Ve.a.buttonDefs.filter((function(t){return!s.includes(t.id)})).map((function(i){return n.createButton(i,o,r,e,t.angle)})),l=(new Z.Graphics).beginFill("rgb(255, 255, 255, 0)").drawRect(-i*e/2,-a*e/2,o,r),u=new Z.Shape(l);u.name="mainRect",u.mouseEnabled=!1,u.setBounds(-i*e/2,-a*e/2,o,r),this.addChild.apply(this,Object(W.j)([u],c)),this.addChild(u)},e.prototype.createButton=function(t,e,n,i,a){var o,r,s,c=this.horizontalPadding,l=this.verticalPadding,u=new Z.Container;u.name="buttonContainer",u.x=-c*i/2,u.y=-l*i/2;var d=this.circleSize/2,p=e*t.x,h=n*t.y,g=[0,0,2*d],f=(o=(new Z.Graphics).beginFill(Ue.a.backgroundColor)).drawCircle.apply(o,Object(W.j)(g)),b=new Z.Shape(f);b.name="circle",b.setBounds.apply(b,Object(W.j)(g,[2*d])),b.x=p,b.y=h;var m=(r=(new Z.Graphics).beginStroke("#ffffff").setStrokeStyle(1)).drawCircle.apply(r,Object(W.j)(g)),v=new Z.Shape(m);v.x=p,v.y=h,v.mouseEnabled=!1;var y=[0,0,30,30],S=(s=(new Z.Graphics).beginFill("rgb(255, 0, 0, 0.01)")).drawRect.apply(s,Object(W.j)(y)),O=new Z.Shape(S);O.name="hitbox",O.setBounds.apply(O,Object(W.j)(y)),O.x=p-15,O.y=h-15,O.mouseEnabled=!0,O.cursor="pointer";var x=(new Z.Graphics).setStrokeStyle(1.5,"round").beginStroke("#ffffff").moveTo(-7,0).lineTo(7,0).moveTo(0,-7).lineTo(0,7).endStroke(),C=new Z.Shape(x);return C.name="plusSign",C.mouseEnabled=!1,C.x=p,C.y=h,C.alpha=0,a&&(C.rotation=-a),u.addChild(b,O,C,v),this.hitboxes[t.id]=O,this.circles[t.id]=b,this.plusSigns[t.id]=C,this.borders[t.id]=v,u.setBounds(0,0,0,0),u},e}(Z.Container),Ye=n("0jHB"),Xe=n("0fSw"),Ke=n("Zog/"),We=n("uWBd"),Ze=function(t){function e(e,n,a,o,r,s,c,l,u,d){var p=t.call(this,a)||this;return p.ll=e,p.commandService=n,p.state=a,p.dToV=o,p.vToD=r,p.definitionLocator=s,p.toolbarManager=c,p.plusCreateService=l,p.pathingSvc=u,p.shapeBoundsLocator=d,p.delay=500,p.autoHideDelay=3e3,p._indicators=[],p.initialized=!1,p.lastShapeId="",p.isDragging=!1,p.blankId="",p.buttonSubs=[],p.tracker=i.Pb,p.redrawSource=new O.a(""),p.addSource=new le.a,p.removeSource=new le.a,p.changeSource=new le.a,p}return Object(W.e)(e,t),Object.defineProperty(e.prototype,"indicators",{get:function(){return this._indicators},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"contextualToolbar",{get:function(){return this.toolbarManager.get("contextual-toolbar")},enumerable:!1,configurable:!0}),e.prototype.initialize=function(){var t=this;if(!this.initialized){this.initialized=!0;var e=this.toolbarManager.get("plus-create-toolbar"),n=this.ll.forCurrentObserver(!1).pipe(Object(T.a)((function(t){return t.getDiagramChanges()})),Object(Fe.a)((function(){return t.isDragging})),Object(M.a)((function(e){var n=(e.modifier||{}).$set;n&&(Object(W.j)(new Set((JSON.stringify(n).match(/shapes\.(.*?)\../g)||[]).map((function(t){var e=Object(W.h)(t.split("."),3),n=e[1],i=e[2];return"t"===i||"c"===i?"":n})))).includes(t.lastShapeId)&&t.redrawSource.next(t.lastShapeId))}))).subscribe(),a=this.ll.forCurrentObserver(!0).pipe(Object(T.a)((function(t){return t.getDiagramChanges()})),Object(M.a)((function(e){if(t._indicators.length){var n=(e.modifier||{}).$set;if(n)Object.keys(n).reduce((function(t,e){return t||e.startsWith("shapes")}),!1)&&t.removeIndicators(t._indicators.length)}}))).subscribe(),o=this.listenToSelectedChanges().pipe(Object(T.a)((function(e){return!t._indicators.length||1===e.length&&t.lastShapeId===e[0]||t.removeIndicators(t._indicators.length),t.lastShapeId=1===e.length?t.lastShapeId:"",[e]})),Object(E.a)((function(e){return t.state.get("ActiveShapes").length&&e&&1===e.length&&!!e[0]&&t.lastShapeId!==e[0]&&t.blankId!==e[0]})),Object(M.a)((function(n){"redraw"===n[0]&&(n[0]=t.lastShapeId),t.removeIndicators(t._indicators.length);var a=Object(W.h)(n,1)[0];for(t.lastShapeId=a;t.buttonSubs.length;)t.buttonSubs.pop().unsubscribe();setTimeout((function(){t.ll.forCurrentObserver(!0).pipe(Object(st.a)(),Object(T.a)((function(t){return t.getDiagramOnce()})),Object(T.a)((function(e){var n=e.shapes[a];return n?t.definitionLocator.getDefinition(n.defId,n.version).pipe(Object(st.a)(),Object(T.a)((function(t){return Object($.a)([e,n,t])}))):[null]})),Object(st.a)(),Object(E.a)((function(t){var e=Object(W.h)(t,3)[2];return Ve.a.isPlusCreateEnabled(e)})),Object(M.a)((function(n){var a,o=Object(W.h)(n,3),r=o[0],s=o[1],c=o[2];if(t.isDragging=!1,t.buttonSubs.push(e.actionEmitter.pipe(Object(j.a)(1)).subscribe((function(e){if(e.def.callback){var n=t.toolbarManager.get("plus-create-toolbar").getCurrentRelativePosition();return n="top"===n?"up":"bottom"===n?"down":n,void e.def.callback({side:n})}var i=t,a=i.isDragging,o=i.plusCreatePoint;t.isDragging=!1,t.removeTemporaryConnector(),a&&o?t.dispatchPlusCreate(e,s,o,!0):t.dispatchPlusCreate(e,s)}))),!(null===(a=t.state.get("EditingText"))||void 0===a?void 0:a.open)){e.preparePanel(s);var l=t.state.get("DiagramZoomLevel"),u=new ze(r,s,l,t.dToV);u.x=t.dToV.x(s.x),u.y=t.dToV.y(s.y),s.angle&&(u.rotation=s.angle);var d=Object.entries(u.hitboxes).reduce((function(t,e){var n=Object(W.h)(e,2),i=n[0],a=n[1];return t.push(Object(P.a)(a,"rollover").pipe(Object(Mt.a)(i)),Object(P.a)(a,"rollout").pipe(Object(Mt.a)(""))),t}),[]),p=Object.entries(u.hitboxes).reduce((function(t,e){var n=Object(W.h)(e,2),i=n[0],a=n[1];return t.push(Object(P.a)(a,"click").pipe(Object(at.a)(10),Object(Mt.a)(i))),t}),[]),h=Object.entries(u.hitboxes).reduce((function(t,e){var n=Object(W.h)(e,2),i=n[0],a=n[1];return t.push(Object(P.a)(a,"pressmove").pipe(Object(w.a)(2),Object(I.a)((function(t){return{type:"move",id:i,e:t}})))),t}),[]),g=Object(x.a)(d).pipe(Object(Ge.a)()).subscribe((function(t){u.onHover(t)})),f=Object(x.a)(p).pipe(Object(Ge.a)()).subscribe((function(n){var a,o;t.isDragging||(i.Pb.track("canvas.shape.plusCreate.click",{value1Type:"defId",value1:s.defId,value2Type:"position",value2:n}),t.contextualToolbar.hide(),e.showAndPosition(s,n).pipe(Object(st.a)()).subscribe(),null===(o=null===(a=t.toolbarManager)||void 0===a?void 0:a.get("contextual-toolbar"))||void 0===o||o.show())})),b=Object(x.a)(h).pipe(Object(Ge.a)()).subscribe((function(e){var n=e.type,i=e.id;e.e;if("move"===n&&!t.isDragging&&!s.angle){var a=Ve.a.buttonDefs.find((function(t){var e=t.id;return i===e})),o=a.x,l=a.y,u={x:s.x+s.width*o,y:s.y+s.height*l};t.startDragging(c,s,u,r),t.side=i,t.isDragging=!0}}));t.buttonSubs.push(g,f,b,e.onHide.pipe(Object(j.a)(1)).subscribe((function(){t.contextualToolbar.show(),t.isDragging=!1,t.removeTemporaryConnector(),t.commandService.dispatch(gt.a.selectShapes,{shapeIds:[]})}))),t._indicators.push(u),t.addSource.next(u)}}))).subscribe()}))}))).subscribe();this.subs.push(o,a,n),this.initialized=!0}},e.prototype.createAddSource=function(){return this.addSource},e.prototype.createRemoveSource=function(){return this.removeSource},e.prototype.createChangeSource=function(){return this.changeSource},e.prototype.destroy=function(){var t;for((t=this.subs).push.apply(t,Object(W.j)(this.buttonSubs)),this.buttonSubs=[];this.subs.length;)this.subs.pop().unsubscribe()},e.prototype.destroyButtonSubs=function(){for(;this.buttonSubs.length;)this.buttonSubs.pop().unsubscribe()},e.prototype.dispatchPlusCreate=function(t,e,n,i){var a=this,o=(t.defId,t.def);void 0===i&&(i=!1);var r=this.toolbarManager;this.ll.forCurrentObserver(!0).pipe(Object(st.a)(),Object(T.a)((function(t){return t.getDiagramOnce()})),Object(M.a)((function(t){var s=t.shapes[e.id];if(s){var c=r.get("plus-create-toolbar"),l=i?a.side:c.getCurrentRelativePosition(),u=n||{x:a.indicatorLayer.getMouseX(),y:a.indicatorLayer.getMouseY()};a.plusCreateService.dispatchEvent(t,s,l,o,!0,u,i)}}))).subscribe(),this.destroyButtonSubs()},e.prototype.removeTemporaryConnector=function(){this.tempConnectorId&&(this.commandService.dispatch(D.a.removeShape,null,{shapeIds:[this.tempConnectorId]}),this.tempConnectorId="")},e.prototype.dispatchDragStart=function(t,e,n){var i=this;return this.isDragging=!0,this.ll.forCurrentObserver(!0).pipe(Object(st.a)(),Object(T.a)((function(t){return t.getDiagramOnce()})),Object(T.a)((function(a){var o=a.shapes[e.id];if(o){var r={x:i.vToD.x(i.indicatorLayer.getMouseX()),y:i.vToD.y(i.indicatorLayer.getMouseY())};return i.plusCreateService.dispatchDragEvent(o,t,r,n)}})))},e.prototype.waitForConnector=function(t,e){var n=this,a=i.xb.shapeId();return this.tempConnectorId=a,this.dispatchDragStart(t,e,a).pipe(Object(lt.a)(),Object(T.a)((function(){return n.ll.forCurrentObserver(!1).pipe(Object(T.a)((function(t){return t.getDiagramChanges()})),Object(E.a)((function(t){var e,n;return(null===(n=null===(e=null==t?void 0:t.added)||void 0===e?void 0:e[0])||void 0===n?void 0:n.id)===a})),Object(j.a)(1),Object(T.a)((function(t){return Object($.a)(t.added[0])})))})))},e.prototype.startDragging=function(t,e,n,a){var o=this;this.waitForConnector(t,e).pipe(Object(M.a)((function(t){var r=o.state.get("InteractionCanvas"),s=Object(P.a)(r,"stagemousemove").pipe().subscribe((function(e){var i,r=Object(J.cloneDeep)(t.getPoints());r[0].x=n.x,r[0].y=n.y,r[1].x=o.vToD.x(e.stageX),r[1].y=o.vToD.y(e.stageY);var s=o.pathingSvc.repath(t.id,a,r,!1),c=Lt.a.createPathFromPoints(s);Object(J.isEqual)(t.path,c)||o.commandService.preview(D.a.applyModifierDocument,{modifier:{$set:(i={},i["shapes."+t.id+".path"]=c,i)}})})),c=Object(P.a)(r,"stagemouseup").subscribe((function(t){s.unsubscribe(),c.unsubscribe();var n=o.vToD.x(t.stageX),a=o.vToD.y(t.stageY),r=o.shapeBoundsLocator.searchShapes(n,n,a,a,[],!1).filter((function(t){return"connector"!==t.type})).sort((function(t,e){return e.zIndex-t.zIndex}))[0];if(r){o.removeTemporaryConnector();var l=Ve.a.sideToGluepointCoordinates(o.side),u=Object.values(e.gluepoints).find((function(t){return t.x===l.x&&t.y===l.y})),d={points:[{id:i.xb.pointId(),x:e.x,y:e.y,shapeId:e.id},{id:i.xb.pointId(),x:e.x,y:e.y,shapeId:r.id}],endpoints:{},shapeToSelect:""};d.endpoints={from:{x:(null==u?void 0:u.x)||l.x,y:(null==u?void 0:u.y)||l.y}},d.shapeToSelect=r.id,o.commandService.dispatch(D.a.plusCreateDragConnect,d).pipe(Object(lt.a)(),Object(M.a)((function(){o.tracker.track("canvas.toolbar.createconnector.change",{value1:"plusCreate",value1Type:"sublocation"});var t={};t["shapes."+e.id+".x"]=e.x+1;var n=new D.a("ApplyModifierDocument",i.Q.SYSTEM);o.commandService.dispatch(n,{modifier:{$set:t}})}))).subscribe()}else{o.plusCreatePoint={x:n,y:a};var p=o.toolbarManager.get("plus-create-toolbar");o.contextualToolbar.hide(),p.showAtPoint(e,"right",{x:t.stageX,y:t.stageY})}}))}))).subscribe()},e.prototype.removeIndicators=function(t){var e=this,n=this._indicators.slice(0,t);this._indicators=this._indicators.slice(t),n.forEach((function(t){return e.removeSource.next(t)}))},e.prototype.listenToSelectedChanges=function(){return Object(x.a)(this.state.changes("Selected"),this.redrawSource.pipe(Object(E.a)((function(t){return""!==t})),Object(I.a)((function(){return["redraw"]}))))},e.removeForPanZoom=!0,e.\u0275fac=function(t){return new(t||e)(o.qc(b.a),o.qc(i.B),o.qc(i.Nb),o.qc(f.a),o.qc(ht.a),o.qc(Ye.a),o.qc(Xe.a),o.qc(Ke.a),o.qc(We.a),o.qc($t.a))},e.\u0275prov=o.cc({token:e,factory:e.\u0275fac}),e=Object(W.d)([Object(ye.a)(),Object(W.g)("design:paramtypes",[b.a,i.B,i.Nb,f.a,ht.a,Ye.a,Xe.a,Ke.a,We.a,$t.a])],e)}(ye.b),Qe=function(t){function e(e,n,i,a){var o=t.call(this)||this;return o.model=e,o.verticalPadding=4,o.horizontalPadding=8,o.prepare(n,i,a),o}return Object(W.e)(e,t),e.prototype.destroy=function(){},e.prototype.prepare=function(t,e,n){var i=new Z.Text(" ","italic 12px Inter","#88A1AA").getBounds().width,a=new Z.Text(""+t,"12px Inter","#88A1AA");a.x=this.horizontalPadding,a.y=this.verticalPadding+1;var o=(a.getBounds()||{}).width,r=a.x,s=new Z.Text(e,"italic 12px Inter","#64767D");s.x=o?r+o+i:this.horizontalPadding,s.y=this.verticalPadding+1;var c=s.getBounds().width,l=s.x,u=new Z.Text(""+n,"12px Inter","#88A1AA");u.x=l+c+i,u.y=this.verticalPadding+1;var d=u.getBounds()||s.getBounds(),p=d.height+2*this.verticalPadding,h=(n?d.width:0)+i+c+(o?o+i:0)+2*this.horizontalPadding,g=(new Z.Graphics).beginFill("#F1F4FA").drawRoundRect(0,0,h,p,6),f=new Z.Shape(g);f.setBounds(0,0,h,p),this.addChild(f,a,s,u)},e}(Z.Container),Je=function(t){function e(e,n,i,a,o,r){var s=t.call(this,n)||this;return s.ll=e,s.state=n,s.linkService=i,s.dToV=a,s.definitionLocator=o,s.translator=r,s._indicators=[],s.tooltipSubs=[],s.initialized=!1,s.shapeId="",s.addSource=new le.a,s.removeSource=new le.a,s.changeSource=new le.a,s}return Object(W.e)(e,t),Object.defineProperty(e.prototype,"indicators",{get:function(){return this._indicators},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){for(var t=Object(W.j)(this.subs,this.tooltipSubs);t.length>0;)t.pop().unsubscribe()},e.prototype.initialize=function(){var t=this;if(!this.initialized){this.initialized=!0;var e=JSON.parse(localStorage.getItem(this.getTooltipStatusId()));if(e){if(e.start>=2&&e.continue>=2)return}else localStorage.setItem(this.getTooltipStatusId(),JSON.stringify({start:0,continue:0}));var n=this.ll.forCurrentObserver(!0).pipe(Object(T.a)((function(t){return t.getDiagramChanges()})),Object(M.a)((function(e){if(t._indicators.length){var n=(e.modifier||{}).$set;if(n)Object.keys(n).reduce((function(t,e){return t||e.startsWith("shapes")&&!e.includes(".texts")}),!1)&&t.removeIndicators(t._indicators.length)}}))).subscribe(),a=Object(x.a)(this.listenToSelectedChanges(),this.listenToRotateShape()).pipe(Object(T.a)((function(e){return t.removeTooltipSubs(),!t._indicators.length||1===e.shapes.length&&t.shapeId===e.shapes[0]||t.removeIndicators(t._indicators.length),t.shapeId=1===e.shapes.length?t.shapeId:"",[e]})),Object(E.a)((function(t){return t&&1===t.shapes.length&&!!t.shapes[0]})),Object(M.a)((function(e){var n=Object(W.h)(e.shapes,1)[0];t.shapeId=n,setTimeout((function(){t.ll.forCurrentObserver(!0).pipe(Object(st.a)(),Object(T.a)((function(t){return t.getDiagramOnce()})),Object(T.a)((function(e){var i=e.shapes[n];return i?t.definitionLocator.getDefinition(i.defId,i.version).pipe(Object(st.a)(),Object(T.a)((function(t){return Object($.a)([e,i,t])}))):[null]})),Object(st.a)(),Object(E.a)((function(e){var n=Object(W.h)(e,3),i=n[0],a=n[2];return i&&t.shouldShowTooltip(a)})),Object(M.a)((function(n){var a=Object(W.h)(n,2),o=a[0],r=a[1],s=t.getActionData(o,r),c=s.translation,l=s.localStorageField,u=s.trackingData,d=c.START,p=c.SHORTCUT,h=c.END,g=JSON.parse(localStorage.getItem(t.getTooltipStatusId())||"")||{},f=Object.values(g).reduce((function(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),t+e}));if(g[l]>=2)f>=4&&t.subs.forEach((function(t){return t.unsubscribe()}));else{i.Pb.track("canvas.pluscreate.tooltip.load",{value1:u.shortcut+" "+u.text});var b=Ve.a.getRelativeBoundingBoxForRotatedShape(r.defaultBounds,r.transform,r.angle),m=new Qe(o,d,p,h);m.x=t.dToV.x(b.x+(b.width-m.getBounds().width)/2),m.y=t.dToV.y(b.y+b.height+20),t.positionIndicator(m),t._indicators.push(m),t.addSource.next(m),g[l]=g[l]+1,t.updateTooltipHistory(g,e.rotated?15e3:2e3)}}))).subscribe()}))}))).subscribe();this.subs.push(a,n),this.initialized=!0}},e.prototype.createAddSource=function(){return this.addSource},e.prototype.createRemoveSource=function(){return this.removeSource},e.prototype.createChangeSource=function(){return this.changeSource},e.prototype.updateTooltipHistory=function(t,e){var n=this;void 0===e&&(e=2e3),this.tooltipSubs.push(Object($.a)(null).pipe(Object(at.a)(e),Object(M.a)((function(){localStorage.setItem(n.getTooltipStatusId(),JSON.stringify(t))}))).subscribe())},e.prototype.removeTooltipSubs=function(){for(;this.tooltipSubs.length>0;)this.tooltipSubs.pop().unsubscribe()},e.prototype.updateIndicators=function(){var t=this;this._indicators.forEach((function(e){t.positionIndicator(e),t.changeSource.next(e)}))},e.prototype.positionIndicator=function(t){var e=this.state.get("DiagramZoomLevel");t.scaleX=e,t.scaleY=e},e.prototype.removeIndicators=function(t){var e=this,n=this._indicators.slice(0,t);this._indicators=this._indicators.slice(t),n.forEach((function(t){return e.removeSource.next(t)}))},e.prototype.listenToSelectedChanges=function(){return this.state.changes("Selected").pipe(Object(I.a)((function(t){return{shapes:t,rotated:!1}})))},e.prototype.listenToRotateShape=function(){var t=this;return this.ll.forCurrentObserver(!1).pipe(Object(st.a)(),Object(T.a)((function(t){return t.getDiagramChanges()})),Object(E.a)((function(e){return Object.keys(e.modifier.$set||{}).includes("shapes."+t.shapeId+".angle")})),Object(I.a)((function(t){var e=Object.keys(t.modifier.$set).find((function(t){return t.includes(".angle")}));return{shapes:[Object(W.h)(/shapes\.(.*?).angle/.exec(e),2)[1]],rotated:!0}})))},e.removeForPanZoom=!0,e.\u0275fac=function(t){return new(t||e)(o.qc(b.a),o.qc(i.Nb),o.qc(v.a),o.qc(f.a),o.qc(Ye.a),o.qc(r.e))},e.\u0275prov=o.cc({token:e,factory:e.\u0275fac}),e=Object(W.d)([Object(ye.a)(),Object(W.g)("design:paramtypes",[b.a,i.Nb,v.a,f.a,Ye.a,r.e])],e)}(ye.b),$e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(W.e)(e,t),e.prototype.getActionData=function(t,e){var n=Object(W.h)(Ve.a.getAllConnectedShapes(t,e),1)[0],i=n.length&&n.length>=1,a=this.translator.instant("TOOLTIP_TOUR.STEPS.PLUS_CREATE_TOOLTIP_SIBLING"),o=this.translator.instant("TOOLTIP_TOUR.STEPS.PLUS_CREATE_TOOLTIP_CHILD");return{translation:i?a:o,localStorageField:i?"continue":"start",trackingData:{text:i?"to add item":"to add child item",shortcut:i?"Shift + Enter":"Tab"}}},e.prototype.getTooltipStatusId=function(){return"plusCreateTooltipStatus"},e.prototype.shouldShowTooltip=function(t){return"connector"!==(null==t?void 0:t.type)&&Ve.a.isPlusCreateEnabled(t)},e.\u0275fac=function(t){return tn(t||e)},e.\u0275prov=o.cc({token:e,factory:e.\u0275fac}),e=Object(W.d)([Object(ye.a)()],e)}(Je),tn=o.oc($e);Object.defineProperty($e,"name",{value:"PlusCreateTooltipHandler"});var en=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(W.e)(e,t),e.prototype.getActionData=function(t,e){var n=this.translator.instant("TOOLTIP_TOUR.STEPS.IMAGE_RESIZE_TOOLTIP");return{translation:n,localStorageField:n?"continue":"start",trackingData:{null:null}}},e.prototype.getTooltipStatusId=function(){return"imageResizeTooltipStatus"},e.prototype.shouldShowTooltip=function(t){return"creately.basic.rasterimage"===t.defId||"creately.basic.vectorimage"===t.defId},e.\u0275fac=function(t){return nn(t||e)},e.\u0275prov=o.cc({token:e,factory:e.\u0275fac}),e=Object(W.d)([Object(ye.a)()],e)}(Je),nn=o.oc(en);Object.defineProperty(en,"name",{value:"ImageResizeTooltipHandler"});var an=n("elRR"),on=n("0itG"),rn=n("2ZsA"),sn=n("ujvC"),cn=n("2zxM"),ln=n("13fK"),un=n("1U5y"),dn=n("wf7V"),pn=n("zFpY"),hn=n("C3qL"),gn=n("aSB4"),fn=n("euU2"),bn=n("k0Sg"),mn=n("zsv6"),vn=n("Y1pE"),yn=n("/6pf"),Sn=n("dFmy"),On=n("Di8k"),xn=n("y9Mj"),Cn=n("pt/I"),Pn=n("oK6n"),Tn=n("aSzn"),wn={cursors:{rotate:'<svg xmlns="http://www.w3.org/2000/svg" width="16.83" height="15" ><title>cursors-tails</title><path d="M16.83,7.5A7.51,7.51,0,0,1,9.33,15a1,1,0,1,1,0-2A5.5,5.5,0,1,0,4.25,5.4l2.69,1c.26.09.34.34.16.45L2.39,9.51a.44.44,0,0,1-.57-.21L0,4.2C-.06,4,.17,3.87.42,4l2,.73A7.5,7.5,0,0,1,16.83,7.5Z"/></svg>',selectable:'<svg xmlns="http://www.w3.org/2000/svg" data-ox="8.5" data-oy="8.5" width="17.41" height="24.69" ><title>cursors-tails</title><circle cx="8.56" cy="8.56" r="2.03" style="fill:rgb(198,198,198)"/><polygon points="17.41 17.58 8.56 8.56 8.56 21.19 11.31 18.81 13.71 24.69 16.18 23.67 13.78 17.8 17.41 17.58"/><path d="M6.67,16.89H6.55A8.56,8.56,0,1,1,17.12,8.56a8.45,8.45,0,0,1-1.81,5.26.5.5,0,1,1-.79-.62,7.44,7.44,0,0,0,1.6-4.64A7.56,7.56,0,1,0,6.78,15.9a.5.5,0,0,1,.37.61A.49.49,0,0,1,6.67,16.89Z" style="fill:rgb(198,198,198)"/><path d="M6.67,13.46a.45.45,0,0,1-.2,0,5.32,5.32,0,1,1,6.54-2,.49.49,0,0,1-.69.15.5.5,0,0,1-.15-.69,4.29,4.29,0,1,0-5.3,1.63.5.5,0,0,1-.2,1Z" style="fill:rgb(198,198,198)"/></svg>'},tails:{textEdit:'<svg xmlns="http://www.w3.org/2000/svg" width="6.54" height="15.36"><path id="_Path_" d="M6.54.54V0A3.64,3.64,0,0,0,3.27,1.72,3.67,3.67,0,0,0,0,0V.54c1.65,0,3,1,3,2.25V7.9H1.35v.54H3v4.13c0,1.24-1.35,2.25-3,2.25v.54a3.65,3.65,0,0,0,3.27-1.73,3.66,3.66,0,0,0,3.27,1.73v-.54c-1.65,0-3-1-3-2.25V8.44H5.19V7.9H3.54V2.79C3.53,1.55,4.88.54,6.54.54Z"/></svg>',text:'<svg xmlns="http://www.w3.org/2000/svg" width="10.65" height="12.21" ><title>cursors-tails</title><path d="M.11,0H10.55l.1,3.14H10.2a3.76,3.76,0,0,0-.82-1.93A3.39,3.39,0,0,0,7.27.77h-1v9.44q0,1.06.33,1.32A2.91,2.91,0,0,0,8,11.87v.34H2.66v-.34a2.52,2.52,0,0,0,1.46-.39A2.39,2.39,0,0,0,4.41,10V.77h-1a3.5,3.5,0,0,0-2.09.44A3.28,3.28,0,0,0,.45,3.14H0Z"/></svg>',connector:'<svg xmlns="http://www.w3.org/2000/svg" width="14.93" height="12.35" ><title>cursors-tails</title><path d="M12.68,0a2.25,2.25,0,0,0-2.12,1.5H6.65V9.35H4.37a2.25,2.25,0,1,0,0,1.5H8.15V3h2.41a2.25,2.25,0,1,0,2.12-3ZM2.25,10.85A.75.75,0,1,1,3,10.1.76.76,0,0,1,2.25,10.85ZM12.68,3a.75.75,0,1,1,.75-.75A.75.75,0,0,1,12.68,3Z" style="fill:rgb(21,20,21)"/></svg>',move:'<svg xmlns="http://www.w3.org/2000/svg" width="12.6" height="12.6"><title>move-tail</title><path d="M6.3,4.87a.5.5,0,0,1-.5-.5V2.45A.5.5,0,0,1,6.3,2a.5.5,0,0,1,.5.5V4.37A.5.5,0,0,1,6.3,4.87Z" style="fill:rgb(21,20,21)"/><path d="M6.3,10.54a.5.5,0,0,1-.5-.5V8.46A.51.51,0,0,1,6.3,8a.5.5,0,0,1,.5.5V10A.5.5,0,0,1,6.3,10.54Z" style="fill:rgb(21,20,21)"/><path d="M6.48.07l2,2.39c.08.1,0,.22-.18.22h-4c-.16,0-.25-.12-.18-.22l2-2.39A.26.26,0,0,1,6.48.07Z" style="fill:rgb(21,20,21)"/><path d="M6.13,12.53l-2-2.39c-.07-.09,0-.21.18-.21h4c.16,0,.26.12.18.21l-2,2.39A.24.24,0,0,1,6.13,12.53Z" style="fill:rgb(21,20,21)"/><path d="M10.16,6.8H8.35a.5.5,0,0,1-.5-.5.5.5,0,0,1,.5-.5h1.81a.51.51,0,0,1,.5.5A.5.5,0,0,1,10.16,6.8Z" style="fill:rgb(21,20,21)"/><path d="M4.26,6.8H2.56a.5.5,0,0,1-.5-.5.5.5,0,0,1,.5-.5h1.7a.51.51,0,0,1,.5.5A.5.5,0,0,1,4.26,6.8Z" style="fill:rgb(21,20,21)"/><path d="M12.53,6.48l-2.39,2c-.09.08-.21,0-.21-.18v-4c0-.16.12-.25.21-.18l2.39,2A.24.24,0,0,1,12.53,6.48Z" style="fill:rgb(21,20,21)"/><path d="M.07,6.13l2.39-2c.1-.07.22,0,.22.18v4c0,.16-.12.26-.22.18l-2.39-2A.26.26,0,0,1,.07,6.13Z" style="fill:rgb(21,20,21)"/></svg>',resizeTopLeft:'<svg xmlns="http://www.w3.org/2000/svg" width="10.64" height="10.52" ><title>cursors-tails</title><path d="M10.64,10.15a.38.38,0,0,1-.36.37l-4.53-.34c-.18,0-.2-.23,0-.4L7.22,8.22,2.36,3.36.85,4.92c-.16.16-.38.15-.4,0L0,.37A.37.37,0,0,1,.36,0L4.89.34c.18,0,.2.23,0,.39L3.42,2.29,8.27,7.15,9.79,5.59c.16-.16.38-.14.4,0Z"/></svg>',resizeTopRight:'<svg xmlns="http://www.w3.org/2000/svg" width="10.52" height="10.64" ><title>cursors-tails</title><path d="M10.52.36l-.34,4.53c0,.18-.23.2-.4,0L8.23,3.41,3.37,8.27,4.92,9.79c.17.16.15.38,0,.4l-4.52.45A.37.37,0,0,1,0,10.28L.34,5.75c0-.18.23-.2.4,0L2.29,7.23,7.15,2.37,5.6.85c-.17-.16-.15-.38,0-.4L10.15,0A.37.37,0,0,1,10.52.36Z"/></svg>',resizeVertical:'<svg xmlns="http://www.w3.org/2000/svg" width="6.44" height="14.65" ><title>cursors-tails</title><path d="M6.41,11,3.53,14.54a.37.37,0,0,1-.51,0l-3-3.45c-.12-.13,0-.3.25-.3l2.18,0V3.89L.3,3.92c-.22,0-.37-.16-.26-.3L2.92.1a.38.38,0,0,1,.52,0l3,3.44c.12.13,0,.31-.25.31L4,3.88v6.87l2.17,0C6.37,10.72,6.52,10.88,6.41,11Z"/></svg>',resizeHorizontal:'<svg xmlns="http://www.w3.org/2000/svg" width="14.65" height="6.44" ><title>cursors-tails</title><path d="M14.55,3.43l-3.44,3c-.14.11-.31,0-.31-.26l0-2.17H3.9l0,2.17c0,.23-.17.37-.31.26L.11,3.52A.36.36,0,0,1,.1,3L3.54,0c.14-.12.31,0,.31.25l0,2.18h6.87l0-2.17c0-.23.17-.38.3-.26l3.52,2.87A.37.37,0,0,1,14.55,3.43Z"/></svg>',break:'<svg width="10" height="10" ></svg>',delete:'<svg width="10" height="10" ></svg>',drop:'<svg xmlns="http://www.w3.org/2000/svg" width="13.04" height="10.79" ><title>cursors-tails</title><path d="M13,4.94v5.85H4.19V4.94H5.56V3.53a2,2,0,0,0-4.06,0V4.94a.75.75,0,0,1-1.5,0V3.53a3.53,3.53,0,0,1,7.06,0V4.94Z" style="fill:rgb(21,20,21)"/></svg>',lock:'<svg width="12" height="15" viewBox="0 0 12 15" fill="none" xmlns="http://www.w3.org/2000/svg"><rect y="6" width="11" height="8" rx="1" fill="black"/><path d="M5.27579 0C5.50123 0 5.72667 0 5.95212 0C5.98402 0.00451488 6.01593 0.00948125 6.04783 0.0136951C6.22888 0.037323 6.41264 0.0480082 6.59052 0.0860837C8.42853 0.47948 9.84139 2.16188 9.81791 4.03585C9.81023 4.64942 9.83507 5.26345 9.8453 5.87732C9.8456 5.89403 9.84816 5.91073 9.84981 5.92984C9.87088 5.93361 9.88774 5.93767 9.9049 5.93933C10.6976 6.01683 11.4452 6.73891 11.4395 7.63241C11.4282 9.3914 11.4385 11.1506 11.435 12.9095C11.4347 13.0989 11.4205 13.292 11.381 13.4765C11.3179 13.7708 11.1456 14.0097 10.9338 14.219C10.6408 14.5087 10.3005 14.6968 9.87705 14.7056C9.55906 14.7122 9.24121 14.7295 8.92321 14.7296C6.65629 14.7307 4.38952 14.7293 2.1226 14.7262C1.88993 14.7259 1.6547 14.7272 1.42535 14.6949C1.00245 14.6353 0.669406 14.4085 0.397611 14.0837C0.168556 13.8095 0.0282933 13.5037 0.0263368 13.1403C0.0251328 12.9273 0.0159526 12.7145 0.00948125 12.5017C0.00842778 12.4645 0.00331091 12.4274 0 12.3902C0 11.0169 0 9.64348 0 8.27021C0.00496637 8.10286 0.00526736 7.93505 0.0162536 7.768C0.0291962 7.571 0.019715 7.36527 0.0753985 7.17986C0.261562 6.55937 0.688068 6.16898 1.30525 5.98553C1.40247 5.95663 1.50481 5.94535 1.60519 5.92593C1.60639 5.90983 1.60805 5.89749 1.6082 5.885C1.61858 5.22372 1.63303 4.56259 1.6377 3.90131C1.64056 3.48519 1.7149 3.08381 1.8672 2.699C2.41366 1.31699 3.40994 0.445619 4.85184 0.0866857C4.99165 0.0519211 5.13447 0.0285942 5.27579 0ZM5.71885 13.8815C7.10642 13.8815 8.494 13.8816 9.88157 13.881C9.91603 13.881 9.95411 13.8827 9.98436 13.8694C10.2355 13.7592 10.4355 13.592 10.5516 13.3376C10.5728 13.2911 10.5951 13.2394 10.5952 13.1901C10.6018 11.6391 10.6076 10.0882 10.6086 8.53719C10.6089 8.19421 10.5939 7.85108 10.58 7.50825C10.5754 7.39116 10.5654 7.2664 10.4792 7.17716C10.3773 7.07166 10.2685 6.97037 10.1505 6.88354C10.0352 6.79866 9.90249 6.76419 9.75064 6.7648C8.57602 6.76976 7.40139 6.76314 6.22662 6.7654C4.70646 6.76826 3.18615 6.77638 1.66599 6.78105C1.49894 6.7815 1.35055 6.83252 1.21902 6.93155C1.01585 7.08475 0.863847 7.2664 0.866857 7.54271C0.868814 7.7203 0.847744 7.89803 0.847895 8.07577C0.8494 9.79202 0.853011 11.5084 0.856774 13.2247C0.856774 13.2489 0.859483 13.2754 0.869416 13.2969C0.962723 13.5004 1.10359 13.6619 1.29487 13.7799C1.41015 13.8509 1.52919 13.8846 1.6687 13.8842C3.0188 13.8796 4.36875 13.8815 5.71885 13.8815ZM2.4585 5.91073C4.64039 5.91073 6.81235 5.91073 8.98853 5.91073C8.98973 5.88876 8.99154 5.87175 8.99154 5.85475C8.99033 5.27609 8.99154 4.69728 8.98672 4.11862C8.98386 3.78513 8.95181 3.45614 8.85338 3.13288C8.43109 1.74726 6.95743 0.556685 5.17872 0.880101C3.86233 1.11954 3.01143 1.92214 2.58582 3.18299C2.53977 3.31964 2.48619 3.46246 2.48303 3.60348C2.46663 4.34979 2.46512 5.0964 2.4585 5.84286C2.45835 5.86257 2.4585 5.88244 2.4585 5.91073Z" fill="black"/><path d="M5.32137 10.9636C5.32137 10.7432 5.32017 10.5227 5.32227 10.3024C5.32273 10.2559 5.31114 10.224 5.27351 10.1937C5.2073 10.1406 5.14138 10.085 5.08539 10.0217C4.89622 9.80723 4.8443 9.39397 4.96996 9.14369C5.12437 8.83638 5.44719 8.64495 5.76834 8.67023C6.33406 8.71463 6.68983 9.24287 6.50758 9.77096C6.44874 9.94162 6.33466 10.0744 6.1941 10.1839C6.14895 10.2191 6.13044 10.2562 6.13029 10.3152C6.12893 10.7534 6.12758 11.1918 6.11735 11.6299C6.11223 11.8498 5.95225 11.9885 5.72771 11.9891C5.50347 11.9897 5.34349 11.8504 5.33582 11.632C5.32799 11.4094 5.33416 11.1864 5.33416 10.9636C5.3298 10.9636 5.32559 10.9636 5.32137 10.9636Z" fill="white"/></svg>'}},jn=n("iim9"),Mn=n("GoAz"),In=n("wqq/"),En=n("TZl/"),Dn=function(t){function e(e,n,i,a){var o=t.call(this,e)||this;return o.commandService=n,o.viewport=i,o.ll=a,o.customGluepoint=null,o._shapes={},o.addSource=new le.a,o.changeSource=new le.a,o.removeSource=new le.a,o.isPreviewingConnect=new O.a(!1),o}var n;return Object(W.e)(e,t),n=e,Object.defineProperty(e.prototype,"indicators",{get:function(){return Object(J.flatten)(Object(J.values)(this._shapes).map((function(t){return t.gluePoints})))},enumerable:!1,configurable:!0}),e.prototype.initialize=function(){var t=this;this.subs.push(this.ll.forCurrentObserver(!1).pipe(Object(T.a)((function(t){return t.getDiagramModel()})),Object(et.a)((function(t,e){var n=Object.keys((null==t?void 0:t.shapes)||{}),i=Object.keys((null==e?void 0:e.shapes)||{});return Object(J.isEqual)(n,i)})),Object(T.a)((function(e){return t.listenToStates(e).pipe(Object(M.a)((function(n){return t.changeShapes(e,n)})))}))).subscribe())},e.prototype.destroy=function(){var e=this;t.prototype.destroy.call(this),Object.keys(this._shapes).forEach((function(t){return e.removeGluePointsFor(t)}))},e.prototype.listenToStates=function(t){var e=this;return this.state.changes("MouseControlState").pipe(Object(T.a)((function(n){return n===pt.b.Connector||n===pt.b.Line?e.duringConnectorControlState():n===pt.b.Normal?e.duringNormalControlState(t):Object($.a)({})})))},e.prototype.duringConnectorControlState=function(){var t=Object(P.a)(this.indicatorLayer,"shapeRollOver").pipe(Object(E.a)((function(t){return t.relatedShape.isShapeView})),Object(I.a)((function(t){return{shapeId:t.relatedShape.name,visibility:"show"}}))),e=Object(P.a)(this.indicatorLayer,"shapeRollOut").pipe(Object(E.a)((function(t){return t.relatedShape.isShapeView})),Object(I.a)((function(t){return{shapeId:t.relatedShape.name,visibility:"hide"}})));return Object(x.a)(t,e)},e.prototype.duringNormalControlState=function(t){var e=this;return this.duringConnectorSelection().pipe(Object(T.a)((function(n){return n?e.duringEndPointMovement(t,n):Object($.a)({})})))},e.prototype.duringConnectorSelection=function(){var t=this,e=Object(x.a)(Object(P.a)(this.indicatorLayer,Tt.b.interactionEnd),Object(P.a)(this.indicatorLayer,Tt.b.interactionCancel));return Object(x.a)(this.state.changes("Selected"),e.pipe(Object(at.a)(0),Object(I.a)((function(){return t.state.get("Selected")})))).pipe(Object(T.a)((function(e){return 1===e.length?t.getConnectorModel(e[0]):Object($.a)(null)})))},e.prototype.getConnectorModel=function(t,e){void 0===e&&(e=!0);var n=this.viewport.getShapeModel(t);return e&&(n=n.pipe(Object(j.a)(1))),n.pipe(Object(I.a)((function(t){return t instanceof Lt.a?t:null})))},e.prototype.duringEndPointMovement=function(t,e){var n=this,i=this.getEndpointInteraction().pipe(Object(In.a)(1));return Object(Gt.a)(Object(Ce.b)([this.getConnectorModel(e.id,!1),this.isPreviewingConnect]).pipe(Object(E.a)((function(t){var e=Object(W.h)(t,2);e[0];return!e[1]})),Object(T.a)((function(e){var i=Object(W.h)(e,1)[0];return Object(Gt.a)(Object($.a)({}),n.shapesAttachedToConnector(t,i))})),Object(it.a)(i)),i)},e.prototype.getEndpointInteraction=function(){return Object(x.a)(this.getEndpointInteractionStart(),this.getEndpointOverInteraction(),this.getEndpointOutInteraction(),this.getCustomGluepointInteraction())},e.prototype.getEndpointInteractionStart=function(){return Object(P.a)(this.indicatorLayer,Tt.b.interactionStart).pipe(Object(I.a)((function(){return{}})))},e.prototype.getEndpointOverInteraction=function(){var t=this;return Object(P.a)(this.indicatorLayer,G.over).pipe(Object(I.a)((function(e){return t.onEndPointOver(e)})),Object(E.a)((function(t){return!!t})))},e.prototype.getEndpointOutInteraction=function(){var t=this;return Object(P.a)(this.indicatorLayer,G.out).pipe(Object(I.a)((function(e){return t.onEndPointOut(e)})),Object(E.a)((function(t){return!!t})))},e.prototype.getCustomGluepointInteraction=function(){var t=this;return Object(P.a)(this.indicatorLayer,G.over).pipe(Object(at.a)(0),Object(T.a)((function(e){return Object(Gt.a)(Object(Gt.a)(Object($.a)(e),Object(P.a)(t.indicatorLayer,Tt.b.interactionEnd)).pipe(Object(T.a)((function(i){return Object(Gt.a)(Object($.a)(t.onEndPointHoverEnd(e)),Object($.a)(i).pipe(Object(at.a)(n.CUSTOM_HOVER_TIMEOUT),Object(I.a)((function(){return i.targetOver=e.targetOver,t.onEndPointHover(i)}))))})),Object(E.a)((function(t){return!!t})),Object(it.a)(Object(P.a)(t.indicatorLayer,G.out))),Object($.a)(t.onEndPointHoverEnd(e)))})))},e.prototype.onEndPointOver=function(t){if(t.targetOver instanceof Qt.a)return{shapeId:t.targetOver.name,visibility:"showOne",expandOn:"endpoint"}},e.prototype.onEndPointOut=function(t){if(t.targetOver instanceof Qt.a)return{shapeId:t.targetOver.name,visibility:"hide"}},e.prototype.onEndPointHover=function(t){if(t.targetOver instanceof Qt.a){var e={x:t.currentTarget.mouseX/t.currentTarget.scaleX,y:t.currentTarget.mouseY/t.currentTarget.scaleY};return{shapeId:t.targetOver.name,visibility:"create",mousePosition:e}}},e.prototype.onEndPointHoverEnd=function(t){return{shapeId:t.targetOver.name,visibility:"remove"}},e.prototype.shapesAttachedToConnector=function(t,e){var n=[],i=e.getFromEndpoint(t),a=e.getToEndpoint(t);return i.shape&&i.gluepoint&&n.push(this.getChangeForShape(i)),a.shape&&a.gluepoint&&n.push(this.getChangeForShape(a)),Object(Mn.a)(n)},e.prototype.getChangeForShape=function(t){var e=t.shape,n=Object.keys(e.gluepoints).filter((function(e){return e!==t.gluepoint.id}));return{visibility:"show",shapeId:e.id,gluePointIds:n,connectOnMouse:!0}},e.prototype.createAddSource=function(){return this.addSource},e.prototype.createRemoveSource=function(){return this.removeSource},e.prototype.createChangeSource=function(){return this.changeSource},e.prototype.changeShapes=function(t,e){"show"===e.visibility||"showOne"===e.visibility?(this.addGluePointsFor(t,e.shapeId,e.gluePointIds,e.expandOn,e.connectOnMouse),this.setShapeActive(e.shapeId,!0),"showOne"===e.visibility&&this.removeAllGluePoints([e.shapeId])):"hide"===e.visibility?(this.setShapeActive(e.shapeId,!1),this.isAnyGluePointActive(e.shapeId)||this.removeGluePointsFor(e.shapeId),this.removeCustomGluepoint()):"create"===e.visibility||"remove"===e.visibility?this.removeCustomGluepoint():(this.removeCustomGluepoint(),this.removeAllGluePoints())},e.prototype.addGluePointsFor=function(t,e,n,i,a){var o=this;void 0===i&&(i="mouse"),this.ensureShapeDataExists(e,i,!0),this.viewport.getShapeOnce(e).subscribe((function(r){o.ensureShapeDataExists(e,i),o.createGluePoints(t,r,n,a),n&&o.removeGluePointsFor(e,n)}))},e.prototype.removeGluePointsFor=function(t,e){var n=this;void 0===e&&(e=[]);var i=this._shapes[t];if(i){for(var a=[],o=i.gluePoints.length;o--;){var r=i.gluePoints[o];-1===e.indexOf(r.gluePointId)&&a.push(this.removeGluePoint(r))}x.a.apply(void 0,Object(W.j)(a)).subscribe({complete:function(){var e=n._shapes[t];e&&!e.gluePoints.length&&(e.shapeSub.unsubscribe(),delete n._shapes[t])}})}},e.prototype.removeAllGluePoints=function(t){var e=this;void 0===t&&(t=[]),Object.keys(this._shapes).forEach((function(n){-1!==t.indexOf(n)||e.isAnyGluePointActive(n)||e.removeGluePointsFor(n)}))},e.prototype.createGluePoints=function(t,e,n,i){for(var a in e.gluepoints){var o=e.gluepoints[a];this.shouldCreateGluePoint(e.id,o.id,n)&&(this.createGluePoint(t,e.id,o,!1,i),this.positionGluePoint(e,o))}var r=Et.createModel();this.shouldCreateGluePoint(e.id,r.id,n)&&(this.createGluePoint(t,e.id,r,!0,i),this.positionGluePoint(e,r),this.updateGluePointFull(e.id)),0===this.getGluePoints(e.id).length&&this.removeGluePointsFor(e.id)},e.prototype.positionGluePoints=function(t){for(var e in t.gluepoints){var n=t.gluepoints[e];this.positionGluePoint(t,n)}this.positionGluePoint(t,Et.createModel())},e.prototype.createCustomGluepoint=function(t,e){var n=this;this.viewport.getShapeOnce(t).subscribe((function(a){var o=new jt.a;o.id=i.xb.gluepointId(),o.type="custom",n.positionCustomGluePoint(o,a,e);var r=new It(o.id,t,o);r.type="custom",n.positionGluePoint(a,o,r),r.addSubscription(r.expand().subscribe((function(){return n.changeSource.next(r)}))),n.customGluepoint=r,n.addSource.next(r),n.state.set("CustomGluePoint",Object(W.j)(n.state.get("CustomGluePoint"),[{shapeId:t,gluepoint:Object(W.a)({},o)}])),r.show().subscribe({next:function(){return n.changeSource.next(r)}})}))},e.prototype.removeCustomGluepoint=function(){var t=this;if(this.customGluepoint){var e=this.customGluepoint;this.customGluepoint=null,this.removeSource.next(e),setTimeout((function(){t.state.set("CustomGluePoint",[])}),300)}},e.prototype.positionCustomGluePoint=function(t,e,i){var a=e.getPositionOnShape(i,n.CUSTOM_SNAP_THRESHOLD);t.x=a.x.value,t.y=a.y.value},e.prototype.hasShape=function(t){return!!this._shapes[t]},e.prototype.getGluePoints=function(t){return this._shapes[t]?this._shapes[t].gluePoints:[]},e.prototype.getGluePoint=function(t,e){return this.getGluePoints(t).find((function(t){return t.gluePointId===e}))},e.prototype.getGluePointFull=function(t){return this.getGluePoint(t,Et.id)},e.prototype.hasGluePoint=function(t,e){return!!this.getGluePoint(t,e)},e.prototype.addGluepoint=function(t,e){var n=this._shapes[t]&&this._shapes[t].gluePoints;if(!n)throw new Error("GluepointHandler: unexpected error: shape data not available");n.push(e)},e.prototype.shouldCreateGluePoint=function(t,e,n){return!this.hasGluePoint(t,e)&&(!n||n&&n.indexOf(e)>-1)},e.prototype.isShapeActive=function(t){return!!this.hasShape(t)&&!!this._shapes[t].shapeActive},e.prototype.isActive=function(t){return this.isShapeActive(t)||this.isAnyGluePointActive(t)},e.prototype.setShapeActive=function(t,e){this._shapes[t]&&(this._shapes[t].shapeActive=e,this.updateGluePointFull(t))},e.prototype.updateGluePointFull=function(t){var e=this,n=this.isShapeActive(t),i=this.getGluePointFull(t);i&&(n&&!i.isActive?i.expand().subscribe((function(){return e.changeSource.next(i)})):!n&&i.isActive&&i.retract().subscribe((function(){return e.changeSource.next(i)})))},e.prototype.isAnyGluePointActive=function(t){return!!this.hasShape(t)&&this.getGluePoints(t).reduce((function(t,e){return t||e.isActive}),!1)},e.prototype.createGluePoint=function(t,e,n,i,a){var o=this;void 0===i&&(i=!1),void 0===a&&(a=!1);var r=i?new Et(e,n):new It(n.id,e,n);this.addGluepoint(e,r),this.addSource.next(r),i||this.setupGluePointInteraction(t,r,a),r.show().subscribe((function(){return o.changeSource.next(r)}))},e.prototype.removeGluePoint=function(t){var e=this,n=this._shapes[t.shapeId].gluePoints,i=n.indexOf(t);return n.splice(i,1),t.hide().pipe(Object(M.a)({next:function(){return e.changeSource.next(t)},complete:function(){e.removeSource.next(t),t.destroy()}}))},e.prototype.positionGluePoint=function(t,e,n){var i=n||this.getGluePoint(t.id,e.id);if(i){var a={x:{type:e.xType||"relative",value:e.x},y:{type:e.yType||"relative",value:e.y}},o=En.a.onViewportRect(a,t.defaultBounds,t.viewTransform);i.setPosition(o),this.changeSource.next(i)}},e.prototype.setupGluePointInteraction=function(t,e,n){this.setupGluePointClickInteraction(t,e,n),this.setupGluePointRollOverInteraction(t,e,n),this.setupGluePointRollOutInteraction(e,n)},e.prototype.resetDiagramPreview=function(){return this.commandService.dispatch(D.a.resetDiagramPreview)},e.prototype.connectToGluepoint=function(t,e,n){var i=this;return void 0===n&&(n=!1),this.duringConnectorSelection().pipe(Object(E.a)((function(t){return Boolean(t)})),Object(T.a)((function(a){var o=a.getFromEndpoint(t),r=[a.getToEndpoint(t),o].find((function(t){return t.shape&&t.shape.id===e.shapeId}));if(!r)return C.a;var s={connectorId:a.id,endpointId:r.id,shapeId:e.shapeId,gluepointId:e.gluePointId};return n?i.commandService.preview(Ht.a.changeConnectedGluepoint,s):i.commandService.dispatch(Ht.a.changeConnectedGluepoint,s)})))},e.prototype.getOverEvent=function(t){return"mouse"===this._shapes[t].expandOn?"rollover":"endpoint-over"},e.prototype.getOutEvent=function(t){return"mouse"===this._shapes[t].expandOn?"rollout":"endpoint-out"},e.prototype.ensureShapeDataExists=function(t,e,n){var i=this;if(void 0===n&&(n=!1),!this.hasShape(t)){var a=n?this.viewport.getShapeModel(t).pipe(Object(w.a)(1)):this.viewport.getShapeModel(t);this._shapes[t]={gluePoints:[],expandOn:e},this._shapes[t].shapeSub=a.subscribe((function(t){return i.positionGluePoints(t)}))}},e.prototype.setupGluePointClickInteraction=function(t,e,n){var i=this;if(n){var a=Object(P.a)(e,"click").pipe(Object(T.a)((function(){return i.isPreviewingConnect.next(!1),i.connectToGluepoint(t,e,!1)}))).subscribe();e.addSubscription(a)}},e.prototype.setupGluePointRollOverInteraction=function(t,e,n){var i=this,a=Object(P.a)(e,this.getOverEvent(e.shapeId)),o=a.pipe(Object(T.a)((function(t){return e.expand()}))).subscribe((function(){return i.changeSource.next(e)}));if(e.addSubscription(o),n){var r=a.pipe(Object(T.a)((function(){return i.isPreviewingConnect.next(!0),i.connectToGluepoint(t,e,!0)}))).subscribe();e.addSubscription(r)}},e.prototype.setupGluePointRollOutInteraction=function(t,e){var n=this,i=Object(P.a)(t,this.getOutEvent(t.shapeId)),a=i.pipe(Object(T.a)((function(e){return t.retract().pipe(Object(M.a)({complete:function(){n.isActive(t.shapeId)||n.removeGluePointsFor(t.shapeId)}}))}))).subscribe((function(){return n.changeSource.next(t)}));if(t.addSubscription(a),e){var o=i.pipe(Object(T.a)((function(){return n.isPreviewingConnect.next(!1),n.resetDiagramPreview()}))).subscribe();t.addSubscription(o)}},e.removeForPanZoom=!0,e.CUSTOM_HOVER_TIMEOUT=800,e.CUSTOM_SNAP_THRESHOLD=5,e.\u0275fac=function(t){return new(t||e)(o.qc(i.Nb),o.qc(i.B),o.qc(m.a),o.qc(b.a))},e.\u0275prov=o.cc({token:e,factory:e.\u0275fac}),e=n=Object(W.d)([Object(ye.a)(),Object(W.g)("design:paramtypes",[i.Nb,i.B,m.a,b.a])],e)}(ye.b);Object.defineProperty(Dn,"name",{value:"GluePointHandler"});var _n=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.color=Ue.a.primarySelectionLineColor,e.colorHover=Ue.a.primarySelectionLineColorHover,e.objectColor=Ue.a.primaryObjectLineColor,e.objectColorHover=Ue.a.primaryObjectLineColorHover,e.thickness=1,e.thicknessHover=8,e}return Object(W.e)(e,t),e.prototype.drawHightlight=function(t,e,n){var i=this;this.removeAllChildren();var a=[Object($.a)({})];if(!Object(J.isEmpty)(t)){var o=this.initRectShape();Object(J.forEach)(t,(function(t){if(!t.eData)if(!t.isConnector()&&t.visible){var r=0;n&&n.indexOf(t.id)>-1?(o.graphics.endStroke().setStrokeStyle(i.thicknessHover).beginStroke(i.colorHover),r=4):o.graphics.endStroke().setStrokeStyle(i.thickness).beginStroke(i.color),a.push(i.drawRectHighLight(o,t,e,r))}else a.push(i.drawPathHightlight(t))})),o.graphics.endStroke(),Object(J.forEach)(t,(function(t){if(t.eData&&!t.isConnector()&&t.visible){var r=0;n&&n.indexOf(t.id)>-1?(o.graphics.endStroke().setStrokeStyle(i.thicknessHover).beginStroke(i.objectColorHover),r=4):o.graphics.endStroke().setStrokeStyle(i.thickness).beginStroke(i.objectColor),a.push(i.drawRectHighLight(o,t,e,r))}})),o.graphics.endStroke()}return x.a.apply(void 0,Object(W.j)(a))},e.prototype.destroy=function(){},e.prototype.initRectShape=function(){var t=new Z.Shape;return t.graphics.setStrokeStyle(this.thickness).beginStroke(this.color),this.addChild(t),t},e.prototype.drawRectHighLight=function(t,e,n,a){void 0===a&&(a=0);var o=e.defaultBounds,r=(e.style&&e.style.lineThickness?e.style.lineThickness:0)*n,s=e.viewTransform,c=(null==s?void 0:s.scaleX)||1,l=(null==s?void 0:s.scaleY)||1,u=(Ue.a.selectionLineSpacing+r/2)/Math.abs(c),d=(Ue.a.selectionLineSpacing+r/2)/Math.abs(l),p=-u,h=-d,g=o.width+2*u,f=o.height+2*d,b=i.Ab.from({x:p,y:h,width:g,height:f}).getTransformedPoints(s),m=b.topLeft,v=b.topRight,y=b.bottomLeft,S=b.bottomRight,O=m.x-a*Math.cos(s.angle*(Math.PI/180)),x=m.y-a*Math.sin(s.angle*(Math.PI/180));return t.graphics.moveTo(O,x).lineTo(v.x,v.y).lineTo(S.x,S.y).lineTo(y.x,y.y).lineTo(m.x,m.y),Object($.a)({})},e.prototype.drawPathHightlight=function(t){var e=this;return we.g.instance.create(t,Te.a).pipe(Object(M.a)((function(n){n.initialize(),n.points=t.viewPoints,n.graphics.setStrokeStyle(e.thickness).beginStroke(e.color),n.draw(),e.addChild(n.shapeView)})))},e}(Z.Container),kn=function(t){function e(e,n,i,a){var o=t.call(this,e,i)||this;return o.state=e,o.viewport=n,o.viewToDiagram=i,o.ll=a,o.highlightIndicator=new _n,o.addSource=new le.a,o.removeSource=new le.a,o.changeSource=new le.a,o}return Object(W.e)(e,t),Object.defineProperty(e.prototype,"indicators",{get:function(){return[this.highlightIndicator]},enumerable:!1,configurable:!0}),e.prototype.initialize=function(){var t=this;this.hoverInit();var e=Object(x.a)(this.state.changes("Highlighted"),this.state.changes("Selected").pipe(Object(I.a)((function(e){return t.state.get("EditingText").open?[]:e}))),this.state.changes("EditingText").pipe(Object(I.a)((function(e){return e.open?[]:t.state.get("Selected")})))).pipe(Object(E.a)((function(e){return!!t.state.get("CurrentDiagram")})),Object(et.a)(J.isEqual),Object(T.a)((function(e){return t.viewport.getShapeModels(e).pipe(Object(it.a)(t.state.changes("Selected").pipe(Object(w.a)(1),Object(E.a)((function(t){return t&&0===t.length})))))})));this.subs.push(e.pipe(Object(T.a)((function(e){return t.selectedModels=e,t.draw(e),Object($.a)({})}))).subscribe())},e.prototype.hoverInit=function(){var t=this;this.activeShapesSub=this.ll.forCurrentObserver(!1).pipe(Object(T.a)((function(e){return Object(x.a)(e.getDiagramModel(),t.state.changes("Selected"),t.state.changes("ActiveShapes"))})),Object(I.a)((function(){return t.state.get("ActiveShapes").filter((function(e){return!t.state.get("Selected").includes(e)}))})),Object(T.a)((function(e){return e.length?t.viewport.getShapeModels(e):Object($.a)({})})),Object(T.a)((function(e){return t.hoverOnShapes(e).pipe(Object(et.a)(J.isEqual),Object(M.a)((function(n){var i={};n[0]&&(i[n[0]]=e[n[0]]),t.draw(Object(W.a)(Object(W.a)({},i),t.selectedModels))})))}))).subscribe()},e.prototype.draw=function(t){var e=this.hoverShapes.length&&!this.selectedModels[this.hoverShapes[0]]?[this.hoverShapes[0]]:[];this.highlightIndicator.drawHightlight(t,this.state.get("DiagramZoomLevel"),e),this.sourceAdded?this.changeSource.next(this.highlightIndicator):(this.addSource.next(this.highlightIndicator),this.sourceAdded=!0)},e.prototype.createAddSource=function(){return this.addSource},e.prototype.createRemoveSource=function(){return this.removeSource},e.prototype.createChangeSource=function(){return this.changeSource},e.prototype.destroy=function(){var e;t.prototype.destroy.call(this),null===(e=this.hoverSub)||void 0===e||e.unsubscribe(),this.activeShapesSub.unsubscribe(),this.addSource.complete(),this.addSource=void 0,this.changeSource.complete(),this.changeSource=void 0,this.removeSource.complete(),this.removeSource=void 0},e.removeForPanZoom=!0,e.removeForSelectionInteractions=!0,e.\u0275fac=function(t){return new(t||e)(o.qc(i.Nb),o.qc(m.a),o.qc(ht.a),o.qc(b.a))},e.\u0275prov=o.cc({token:e,factory:e.\u0275fac}),e=Object(W.d)([Object(ye.a)(),Object(W.g)("design:paramtypes",[i.Nb,m.a,ht.a,b.a])],e)}(ye.b);Object.defineProperty(kn,"name",{value:"HighlightHandler"});var An=n("rYDR"),Ln=n("i9xl"),Bn=function(t){function e(e,n){var i=t.call(this)||this;return i.vtod=e,i.dtov=n,i.bounds=new le.a,i}return Object(W.e)(e,t),Object.defineProperty(e.prototype,"changes",{get:function(){return this.bounds},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selectionStart",{get:function(){return this.getDragStart()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selectionEnd",{get:function(){var t=this;return Object(Ln.a)((function(){return t.getDragEnd().pipe(Object(I.a)((function(){var e=t.getBounds();if(e)return new i.Ab(e.x,e.y,e.width,e.height)})),Object(E.a)((function(t){return Boolean(t)})))}))},enumerable:!1,configurable:!0}),e.prototype.initialize=function(){this.subs=[],this.alpha=.3,this.subs.push(this.getIndicatorDraw().subscribe())},e.prototype.destroy=function(){for(;this.subs&&this.subs.length>0;)this.subs.pop().unsubscribe()},e.prototype.position=function(t){this.graphics.clear().beginFill("#b4b4b4").drawRect(t.x,t.y,t.width,t.height).endFill(),this.setBounds(t.x,t.y,t.width,t.height),this.bounds.next(t)},e.prototype.calculateBounds=function(t,e,n,a){var o=Math.min(t,n),r=Math.min(e,a),s=Math.abs(t-n),c=Math.abs(e-a);return new i.Ab(o,r,s,c)},e.prototype.getIndicatorDraw=function(){var t,e=this;return this.getDragStart().pipe(Object(T.a)((function(n){e.setBounds(0,0,0,0);var i=new Z.Point(n.stageX,n.stageY);t={x:e.vtod.x(i.x),y:e.vtod.y(i.y)};var a=e.getDragEnd().pipe(Object(M.a)((function(){return e.graphics.clear()})));return e.getDrag().pipe(Object(M.a)((function(n){var i=e.calculateBounds(e.dtov.x(t.x),e.dtov.y(t.y),n.stageX,n.stageY);e.position(i)})),Object(it.a)(a))})))},e.prototype.getDragStart=function(){return this.getGridDragEvent(Rt.start)},e.prototype.getDrag=function(){return this.getGridDragEvent(Rt.drag)},e.prototype.getDragEnd=function(){return this.getGridDragEvent(Rt.end)},e.prototype.getGridDragEvent=function(t){return Object(P.a)(this.parent.parent,t).pipe(Object(I.a)((function(t){return t.relatedEvent})))},e}(Z.Shape),Rn=function(t){function e(e,n,i,a,o,r){var s=t.call(this,e)||this;return s.ll=n,s.commandService=i,s.shapeBoundsLocator=a,s.dToVCordinate=o,s.vToDcoordinate=r,s.inProgress=!1,s.selection=new Bn(r,o),s.removeSource=new le.a,s}return Object(W.e)(e,t),Object.defineProperty(e.prototype,"indicators",{get:function(){return[this.selection]},enumerable:!1,configurable:!0}),e.prototype.initialize=function(){},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.selection.destroy()},e.prototype.setupSelection=function(){var t=this;this.selection.initialize();var e=this.getMultiSelection().subscribe((function(e){return t.selectShapes(e,!0)})),n=this.getHightlight().subscribe(),i=this.getMultiSelectionStart().subscribe();this.subs.push(e,i,n)},e.prototype.getMultiSelection=function(){var t=this;return this.selection.selectionEnd.pipe(Object(I.a)((function(e){return t.getContainedShapeIds(e)})),Object(M.a)((function(){t.selection.setBounds(0,0,0,0),t.state.set("Highlighted",[]),t.inProgress=!1,t.state.set("MultiSelectionInteractionState",pt.c.Stopped)})))},e.prototype.getMultiSelectionStart=function(){var t=this;return this.selection.selectionStart.pipe(Object(M.a)((function(e){t.state.set("Highlighted",[]),t.selectShapes([],!1)})))},e.prototype.getHightlight=function(){var t=this;return this.selection.changes.pipe(Object(I.a)((function(e){return t.getContainedShapeIds(e)})),Object(M.a)((function(e){t.inProgress||(t.state.set("MultiSelectionInteractionState",pt.c.Started),t.inProgress=!0),t.state.set("Highlighted",e)})))},e.prototype.getContainedShapeIds=function(t){return t=this.vToDcoordinate.bounds(t),this.shapeBoundsLocator.searchShapes(t.left,t.right,t.top,t.bottom,void 0,!0).map((function(t){return t.id}))},e.prototype.createAddSource=function(){var t=this;return Object(qe.a)(0).pipe(Object(Mt.a)(this.selection),Object(M.a)({complete:function(){return t.setupSelection()}}))},e.prototype.createRemoveSource=function(){return Object(An.b)()},e.prototype.createChangeSource=function(){return Object(Gt.a)(Object(qe.a)(0),Object(x.a)(this.selection.changes,this.selection.selectionEnd)).pipe(Object(Mt.a)(this.selection))},e.prototype.selectShapes=function(t,e){this.commandService.dispatch(gt.a.selectShapes,this.state.get("CurrentDiagram"),{shapeIds:t,add:e})},e.\u0275fac=function(t){return new(t||e)(o.qc(i.Nb),o.qc(b.a),o.qc(i.B),o.qc($t.a),o.qc(f.a),o.qc(ht.a))},e.\u0275prov=o.cc({token:e,factory:e.\u0275fac}),e=Object(W.d)([Object(ye.a)(),Object(W.g)("design:paramtypes",[i.Nb,b.a,i.B,$t.a,f.a,ht.a])],e)}(ye.b);Object.defineProperty(Rn,"name",{value:"MultiSelectionHandler"});var Nn,Hn=n("IdLP"),Fn=function(t){function e(e,n,i){var a=t.call(this)||this;return a.container=e,a.state=n,a.restriction=i,a.prepare(),a}return Object(W.e)(e,t),Object.defineProperty(e.prototype,"selectedIds",{get:function(){return this.container.selectedIds},enumerable:!1,configurable:!0}),e.prototype.isSingleSelection=function(t){return this.container.isSelected(t)&&1===this.container.selectionCount},e.prototype.refresh=function(){this.container.selectionType!==Ct.None&&this.redraw()},e.prototype.destroy=function(){this.move.destroy(),this.container.destroy(),this.removeAllChildren()},e.prototype.getInteractionStart=function(){var t=this;return this.getShapeDragEvent("shapeDragMove").pipe(Object(E.a)((function(){return!t.move.inProgress})))},e.prototype.getImmediateInteraction=function(){var t=this;return Object(P.a)(this,"added").pipe(Object(T.a)((function(){return Object(P.a)(t.parent.parent,"keyboardSelectionInteraction")})),Object(I.a)((function(e){var n=e.relatedEvent;return n.handle=t,n})))},e.prototype.getInteraction=function(){var t=this;return this.getShapeDragEvent("shapeDragMove").pipe(Object(E.a)((function(){return t.move.inProgress})))},e.prototype.getInteractionEnd=function(){return this.getShapeDragEvent("shapeDragEnd")},e.prototype.prepare=function(){this.addChild(this.container),this.move=new zt(this.container,this.state,this.restriction),this.move.register(this)},e.prototype.redraw=function(){this.container.selectionType!==Ct.MultiShape?this.container.position():this.interactionInProgress||this.container.position()},e.prototype.getShapeDragEvent=function(t){var e=this;return Object(P.a)(this,"added").pipe(Object(T.a)((function(){return Object(P.a)(e.parent.parent,t)})),Object(E.a)((function(t){return e.container.isSelected(t.relatedShape.name)})),Object(I.a)((function(t){var n=t.relatedMouseEvent.clone();return n.data=t.relatedMouseEvent.data,n.target=e,n.startX=t.startX,n.startY=t.startY,n})))},e}(Z.Container),Gn=function(t){function e(){var n=t.call(this)||this;return n.radius=e.RADIOUS,n.refresh(),n.beginRender(),n.render(),n.endRender(),n}return Object(W.e)(e,t),Object.defineProperty(e.prototype,"selection",{get:function(){return this.parent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"indicatorLayer",{get:function(){if(this.selection&&this.selection.parent&&this.selection.parent.parent)return this.selection.parent.parent},enumerable:!1,configurable:!0}),e.prototype.setPosition=function(t,e){this.x=t,this.y=e},e.prototype.setMovement=function(t){this.movement=t},e.prototype.getMovement=function(){return this.movement},e.prototype.beginRender=function(){this.graphics.clear(),this.graphics.beginStroke(Ue.a.primarySelectionHandleColor),this.graphics.beginFill("white")},e.prototype.render=function(){this.graphics.drawRoundRect(-4,-4,8,8,1),this.setBounds(-this.radius,-this.radius,2*this.radius,2*this.radius)},e.prototype.endRender=function(){this.graphics.endFill(),this.graphics.endStroke()},e.prototype.refresh=function(){this.beginRender(),this.render(),this.endRender()},e.prototype.getHitPoints=function(){var t=this;return Object(J.range)(0,360,22.5).map((function(e){return{x:t.radius*Math.sin(2*Math.PI*e/360),y:t.radius*Math.cos(2*Math.PI*e/360)}}))},e.prototype.getInteractionStart=function(){var t=this;return this.waitUntilAddedToCanvas().pipe(Object(T.a)((function(){return Object(P.a)(t,"mousedown")})),Object(I.a)((function(t){return t.preventDefault(),t})))},e.prototype.getImmediateInteraction=function(){return Object(C.b)()},e.prototype.getInteraction=function(){var t=this;return this.waitUntilAddedToCanvas().pipe(Object(T.a)((function(){return Object(P.a)(t,"mousedown")})),Object(T.a)((function(){return Object(P.a)(t.indicatorLayer,"stagemousemove").pipe(Object(I.a)((function(e){return e.target=t,e})),Object(it.a)(Object(P.a)(t.indicatorLayer,"stagemouseup")))})))},e.prototype.getInteractionEnd=function(){var t=this;return this.waitUntilAddedToCanvas().pipe(Object(T.a)((function(){return Object(P.a)(t,"mousedown")})),Object(T.a)((function(){return Object(x.a)(Object(P.a)(t.indicatorLayer,"stagemousedown"),Object(P.a)(t.indicatorLayer,"stagemouseup")).pipe(Object(j.a)(1))})),Object(I.a)((function(e){return e.preventDefault(),e.target=t,e})))},e.prototype.waitUntilAddedToCanvas=function(){var t=this;return this.selection?this.indicatorLayer?Object($.a)(null):Object(P.a)(this.selection,"added").pipe(Object(T.a)((function(){return t.waitUntilAddedToCanvas()}))):Object(P.a)(this,"added").pipe(Object(T.a)((function(){return t.waitUntilAddedToCanvas()})))},e.RADIOUS=5,e}(Z.Shape),qn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(W.e)(e,t),e.getName=function(t,e){return"X"+t+"Y"+e},e.prototype.beginRender=function(){this.graphics.clear(),this.xPosition===i.yb.Middle||this.yPosition===i.yb.Middle?this.graphics.beginFill("rgba(0,0,0,0.01)"):t.prototype.beginRender.call(this)},e.prototype.render=function(){this.xPosition===i.yb.Middle||this.yPosition===i.yb.Middle?(this.graphics.drawRect(-this.radius,-this.radius,2*this.radius,2*this.radius),this.setBounds(-this.radius,-this.radius,2*this.radius,2*this.radius)):t.prototype.render.call(this)},e.prototype.getCursor=function(t){return this.getScaleHandleCursor()},e.prototype.configurePosition=function(t,n){this.xPosition=t,this.yPosition=n,this.name=e.getName(this.xPosition,this.yPosition),this.refresh()},e.prototype.position=function(t,e,n){var a=e.decompose(),o=this.xPosition?this.xPosition*t.width:t.x,r=this.yPosition?this.yPosition*t.height:t.y,s=e.transformPoint(o,r),c=s.x,l=s.y;this.x=c,this.y=l,this.xPosition===i.yb.Middle&&(this.scaleX=a.scaleX*t.width/(2*this.radius)),this.yPosition===i.yb.Middle&&(this.scaleY=a.scaleY*t.height/(2*this.radius)),this.rotation=n},e.prototype.getImmediateInteraction=function(){return Object(C.b)()},e.prototype.getScaleHandleCursor=function(){var t="nwse-resize",e="nesw-resize",n="ew-resize",i="ns-resize";return(this.rotation>=45&&this.rotation<=135||this.rotation>=-135&&this.rotation<=-45)&&(t="nesw-resize",e="nwse-resize",n="ns-resize",i="ew-resize"),0===this.xPosition&&0===this.yPosition||1===this.xPosition&&1===this.yPosition?{cursor:t,tail:null,type:"css"}:1===this.xPosition&&0===this.yPosition||0===this.xPosition&&1===this.yPosition?{cursor:e,tail:null,type:"css"}:0===this.xPosition&&.5===this.yPosition||1===this.xPosition&&.5===this.yPosition?{cursor:n,tail:null,type:"css"}:{cursor:i,tail:null,type:"css"}},e}(Gn),Vn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(W.e)(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"ScaleInteraction"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selectionContainer",{get:function(){return this.container},enumerable:!1,configurable:!0}),e.prototype.interactionStart=function(t){var e=t.target;this.state.set("SelectionInteraction",{rotation:this.container.rotation,bounds:this.container.getTransformedBounds(),type:"scale",handle:e.name}),this.setRegistration(e)},e.prototype.interactionEnd=function(t){i.Pb.track("canvas.selection.scale.change"),this.setScaleXState(pt.d.Stopped),this.container.reg.reset()},e.prototype.interactionCancel=function(t){this.setScaleXState(pt.d.Stopped),this.container.reg.reset()},e.prototype.interaction=function(t){var e,n,a=t.target,o=this.restriction.pointOnViewport({x:t.stageX,y:t.stageY},["GridService"]),r=this.getOpposingXHandle(a),s=this.getOpposingYHandle(a),c=t.nativeEvent.shiftKey||this.selectionContainer.transformSettings&&this.selectionContainer.transformSettings.fixAspectRatio,l={scaleX:this.container.scaleX,scaleY:this.container.scaleY,x:this.container.x,y:this.container.y,angle:this.container.rotation,skewX:this.container.skewX,skewY:this.container.skewY},u={x:a.x,y:a.y};if(a.xPosition===i.yb.Origin?u.x-=this.selectionContainer.outerBoundsSpacing.xStart:a.xPosition===i.yb.End&&(u.x-=this.selectionContainer.outerBoundsSpacing.xEnd),a.yPosition===i.yb.Origin?u.y-=this.selectionContainer.outerBoundsSpacing.yStart:a.yPosition===i.yb.End&&(u.y-=this.selectionContainer.outerBoundsSpacing.yEnd),a!==r&&(e=this.getScaleChangeToMouse(u,r,o)),a!==s&&(n=this.getScaleChangeToMouse(u,s,o)),this.selectionContainer.isSingleSelection||this.selectionContainer.isMultiSelection){var d=this.selectionContainer.selectedShape.defId;"creately.basic.rasterimage"!==d&&"creately.basic.vectorimage"!==d||(c=!c)}if(c){if(void 0!==e&&void 0===n)l.scaleX*=e,l.scaleY*=e;else if(void 0!==n&&void 0===e)l.scaleX*=n,l.scaleY*=n;else if(void 0!==e&&void 0!==n){var p=Math.max(e||0,n||0);l.scaleX=l.scaleX*p,l.scaleY=l.scaleY*p}}else void 0!==e&&(l.scaleX*=e),void 0!==n&&(l.scaleY*=n);if(this.selectionContainer.isSingleSelection){var h=this.restriction.shapeTransform(this.selectionContainer.selectedShape,l,["ShapeBounds"]);l.scaleX=h.scaleX,l.scaleY=h.scaleY}this.container.scaleX!==l.scaleX&&(this.setScaleXState(pt.d.Started),this.container.scaleX=l.scaleX),this.container.scaleY!==l.scaleY&&(this.container.scaleY=l.scaleY),this.state.set("SelectionInteraction",{rotation:this.container.rotation,bounds:this.container.getTransformedBounds(),type:"scale",handle:a.name})},e.prototype.setScaleXState=function(t){this.state.get("SelectionInteractionStateScaleX")!==t&&this.state.set("SelectionInteractionStateScaleX",t)},e.prototype.interactionImmediate=function(t){this.setScaleXState(pt.d.Started);var e=Vt.a.gridSize*this.state.get("DiagramZoomLevel"),n=this.container.getTransformedBounds(),i=this.container.getBounds();if(i&&n){var a=this.getDirectionByKeycode(t.keyCode),o=a.xDirection,r=a.yDirection,s=n.width+n.x+e*o,c=n.height+n.y+e*r,l=this.restriction.pointOnViewport({x:s,y:c},["GridService"]),u=l.x,d=l.y;o&&u!==n.x&&(this.container.scaleX=(u-n.x)/i.width,this.selectionContainer.transformSettings&&this.selectionContainer.transformSettings.fixAspectRatio&&(this.container.scaleY=this.container.scaleX)),r&&d!==n.y&&(this.container.scaleY=(d-n.y)/i.height,this.selectionContainer.transformSettings&&this.selectionContainer.transformSettings.fixAspectRatio&&(this.container.scaleX=this.container.scaleY)),this.interactionEnd(null),this.setScaleXState(pt.d.Stopped)}},e.prototype.setRegistration=function(t){var e=this.getOpposingHandle(t),n=this.container.getBounds();this.container.reg.change(e.xPosition*n.width,e.yPosition*n.height)},e.prototype.getOpposingHandle=function(t){var e=Math.abs(t.xPosition-1),n=Math.abs(t.yPosition-1);return t.parent.getChildByName(qn.getName(e,n))},e.prototype.getOpposingXHandle=function(t){var e=Math.abs(t.xPosition-1),n=t.yPosition;return t.parent.getChildByName(qn.getName(e,n))},e.prototype.getOpposingYHandle=function(t){var e=t.xPosition,n=Math.abs(t.yPosition-1);return t.parent.getChildByName(qn.getName(e,n))},e.prototype.getScaleChangeToMouse=function(t,e,n){var i=this.restriction.pointOnViewport({x:n.x,y:n.y},["SelectionScaleSnap"]),a=i.x,o=i.y,r=this.identifyThePointToScaleTo(t,e,{x:a,y:o});return this.getScaleChange(t,e,r)},e.prototype.identifyThePointToScaleTo=function(t,e,n){return new i.fb(new i.rb(e.x,e.y),new i.rb(t.x,t.y)).perpendicularTo(n)},e.prototype.getScaleChange=function(t,e,n){var a=new i.rb(e.x,e.y),o=new i.rb(t.x,t.y),r=0===a.distanceTo(o)?1:a.distanceTo(o),s=o.distanceTo(n),c=0===a.distanceTo(n)?1:a.distanceTo(n);return 2*s>r+c?-c/r:c/r},e}(Ut),Un=n("5uDM"),zn=function(t){function e(e,n,i){var a=t.call(this,e,n,i)||this;return a.container=e,a.state=n,a.restriction=i,a}return Object(W.e)(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"VisualVectorInteraction"},enumerable:!1,configurable:!0}),e.prototype.restrictWithInShapeBounds=function(t,e){var n=this.container.selectedShapeList.find((function(e){return e.id===t})),a=n.viewTransform,o=n.defaultBounds,r=o.x,s=o.x+o.width,c=o.y,l=o.y+o.height;return(e=i.jb.fromTransform(a).invert().transformPoint(e.x,e.y)).x=e.x<r?r:e.x>s?s:e.x,e.y=e.y<c?c:e.y>l?l:e.y,{x:(e=i.jb.fromTransform(a).transform(e.x,e.y)).x,y:e.y}},e.prototype.interactionStart=function(t){},e.prototype.interaction=function(t){this.updatePreviewData(t)},e.prototype.interactionImmediate=function(t){},e.prototype.interactionEnd=function(t){this.updatePreviewData(t)},e.prototype.interactionCancel=function(t){},e.prototype.updatePreviewData=function(t){var e=this,n=t.target,i=this.container.selectedShape.id,a={vectorId:n.name,points:[]},o=this.restriction.pointOnViewport({x:t.stageX,y:t.stageY},["GridService"]),r=o.x,s=o.y,c=this.restriction.pointOnViewport({x:r,y:s},["SelectionMoveSnap"]),l={x:c.x,y:c.y};n.isWithInBounds()&&(l=this.restrictWithInShapeBounds(i,l)),a.points=n.points.map((function(t){return e.restrictMovement(i,n.getMovement(),{x:t.x,y:t.y},l)})),this.container.previewVectorData=a},e}(Ut),Yn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(W.e)(e,t),e.prototype.beginRender=function(){this.graphics.beginStroke(Ue.a.primarySelectionHandleColor),this.graphics.beginFill("white")},e.prototype.render=function(){t.prototype.render.call(this),this.graphics.setStrokeDash(Ue.a.selectionBoundDashStyle),this.graphics.moveTo(this.radius,-this.radius),this.graphics.lineTo(e.LINE_END,-e.LINE_END)},e.prototype.getCursor=function(t){return{cursor:"default",tail:null,type:"css",viewingArea:"app"}},e.prototype.position=function(t,n){var a=i.jb.fromMatrix(n).toTransform(),o=n.transformPoint(t.x-e.DISTANCE/Math.abs(a.scaleX),t.height+e.DISTANCE/Math.abs(a.scaleY));this.x=o.x,this.y=o.y,this.rotation=a.angle+(a.scaleX<0?a.scaleY<0?0:-90:a.scaleY<0?90:0)},e.DISTANCE=25*Math.cos(Math.PI/4),e.LINE_END=e.DISTANCE-e.RADIOUS+1,e}(Gn),Xn=function(t){function e(e,n,i){var a=t.call(this,e,n,i)||this;return a.container=e,a.state=n,a.restriction=i,a}return Object(W.e)(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"RotationInteraction"},enumerable:!1,configurable:!0}),e.prototype.interactionStart=function(t){this.setRegistration()},e.prototype.interaction=function(t){var e=t.target,n=this.container.getBounds(),a=this.container.getMatrix().transformPoint(n.width/2,n.height/2),o=new i.fb(a,{x:e.x,y:e.y}).angle,r=new i.fb(a,{x:t.stageX,y:t.stageY}).angle,s=this.container.rotation+(r-o);this.container.rotation=this.snapToAngle(s,t.nativeEvent.shiftKey),this.state.set("SelectionInteraction",{bounds:{},rotation:this.container.rotation,type:"rotate"})},e.prototype.snapToAngle=function(t,n){if(n)return Math.round(t/e.SNAP_ON_SHIFT_ANGLE)*e.SNAP_ON_SHIFT_ANGLE;var i=Math.abs(t%90);return i<e.SNAP_REGULAR_ANGLE||i>90-e.SNAP_REGULAR_ANGLE?90*Math.round(t/90):t},e.prototype.interactionImmediate=function(t){},e.prototype.interactionEnd=function(t){i.Pb.track("canvas.selection.rotate.change"),this.container.reg.reset()},e.prototype.interactionCancel=function(t){this.container.reg.reset()},e.prototype.setRegistration=function(){var t=this.container.getBounds();this.container.reg.change(t.width/2,t.height/2)},e.SNAP_REGULAR_ANGLE=5,e.SNAP_ON_SHIFT_ANGLE=15,e}(Ut),Kn=function(t){function e(e){var n=t.call(this)||this;return n.name=e.id,n.movement=e.movement,n.withInBounds=e.withInBounds,n.updateHandle(e),n}return Object(W.e)(e,t),Object.defineProperty(e.prototype,"points",{get:function(){return[{x:this.x,y:this.y}]},enumerable:!1,configurable:!0}),e.prototype.updateHandle=function(t){this.name=t.id,this.movement=t.movement,this.withInBounds=t.withInBounds,this.setPosition(t.points[0].x,t.points[0].y)},e.prototype.isWithInBounds=function(){return this.withInBounds},e.prototype.beginRender=function(){this.graphics.beginStroke(Ue.a.secondarySelectionHandleColor),this.graphics.beginFill("white")},e.prototype.getCursor=function(t){switch(this.movement){case"vertical":return{cursor:"ns-resize",tail:null,type:"css"};case"horizontal":return{cursor:"ew-resize",tail:null,type:"css"};case"diagonal-nesw":return{cursor:"nesw-resize",tail:null,type:"css"};case"diagonal-nwse":return{cursor:"nwse-resize",tail:null,type:"css"};case"free":default:return{cursor:"default",tail:null,type:"css",viewingArea:"app"}}},e}(Gn),Wn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(W.e)(e,t),Object.defineProperty(e.prototype,"points",{get:function(){return[{x:this.x,y:this.y},{x:this.x2,y:this.y2}]},enumerable:!1,configurable:!0}),e.prototype.updateHandle=function(e){t.prototype.updateHandle.call(this,e),this.x2=e.points[1].x,this.y2=e.points[1].y,this.graphics.clear(),this.beginRender(),this.render(),this.endRender()},e.prototype.render=function(){var t=this.x2-this.x,e=this.y2-this.y,n=this.getDelta();this.graphics.moveTo(-n.x,-n.y),this.graphics.lineTo(t-n.x,e-n.y),this.graphics.lineTo(t+n.x,e+n.y),this.graphics.lineTo(n.x,n.y),this.graphics.lineTo(-n.x,-n.y),this.setBounds(0,0,t+2*n.x,e+2*n.y),this.alpha=.01},e.prototype.getHitPoints=function(){var t=this.x2-this.x,e=this.y2-this.y,n=this.getDelta();return[{x:-n.x,y:-n.y},{x:t-n.x,y:e-n.y},{x:t+n.x,y:e+n.y},{x:n.x,y:n.y}]},e.prototype.getDelta=function(){return this.x2-this.x>this.y2-this.y?{x:0,y:e.HANDLE_WIDTH}:{x:e.HANDLE_WIDTH,y:0}},e.HANDLE_WIDTH=2,e}(Kn),Zn=function(){function t(){}return t.create=function(t){if(1===t.points.length)return new Kn(t);if(2===t.points.length)return new Wn(t);throw new Error("Invalid vector data.")},t}(),Qn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(W.e)(e,t),e.prototype.position=function(t,e){var n=e.transformPoint(t.x,t.y),i=e.transformPoint(t.width,t.y),a=e.transformPoint(t.x,t.height),o=e.transformPoint(t.width,t.height);this.graphics.clear().beginStroke(Ue.a.primarySelectionLineColor).moveTo(n.x,n.y).lineTo(i.x,i.y).lineTo(o.x,o.y).lineTo(a.x,a.y).lineTo(n.x,n.y).closePath().endStroke()},e}(Z.Shape),Jn=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Selection",e.vectorHandles={},e}return Object(W.e)(e,t),Object.defineProperty(e.prototype,"interactionInProgress",{get:function(){return this.scaleInteraction.inProgress||this.move.inProgress||this.rotationInteraction.inProgress},enumerable:!1,configurable:!0}),e.prototype.outerBounds=function(){var t=this,e=this.container.getBounds(),n=this.state.get("DiagramZoomLevel");if(this.container.children.length){var i=[],a=[],o=[],r=[];this.container.children.forEach((function(e){var s=t.container.selectedShapes[e.name],c=e.getTransformedBounds(),l=s.style.lineThickness*n,u=l/2+Ue.a.selectionLineSpacing,d=l/2+Ue.a.selectionLineSpacing;i.push(c.x-u/Math.abs(t.container.scaleX)),a.push(c.y-d/Math.abs(t.container.scaleY)),o.push(c.x+c.width+u/Math.abs(t.container.scaleX)),r.push(c.y+c.height+d/Math.abs(t.container.scaleY))})),e.x=Math.min.apply(Math,Object(W.j)(i)),e.y=Math.min.apply(Math,Object(W.j)(a)),e.width=Math.max.apply(Math,Object(W.j)(o)),e.height=Math.max.apply(Math,Object(W.j)(r))}var s=this.container.getBounds();return this.container.outerBoundsSpacing={xStart:(e.x-s.x)*this.container.scaleX,yStart:(e.y-s.y)*this.container.scaleY,xEnd:(e.width-s.width)*this.container.scaleX,yEnd:(e.height-s.height)*this.container.scaleY},e},e.prototype.startShapeMovement=function(t){var e=this;void 0===t&&(t=!1);var n=Object(x.a)(Object(P.a)(this.parent.parent,"stagemousedown"),Object($.a)(!0).pipe(Object(at.a)(200),Object(Un.a)((function(){return Object(P.a)(e.parent.parent,"stagemouseup")})))).pipe(Object(j.a)(1));return Object(x.a)(Object(P.a)(this.parent.parent,"stagemousemove").pipe(Object(it.a)(n)),n).pipe(Object(it.a)(Object(P.a)(this,"removed")),Object(M.a)((function(n){if(t&&!e.move.inProgress){var i=e.container.getTransformedBounds();e.container.x=-i.width/2+n.stageX,e.container.y=-i.height/2+n.stageY}var a="stagemousemove"===n.type?"shapeDragMove":"shapeDragEnd",o=new ae(a,n);o.relatedShape={name:e.container.selectedIds[0]},e.parent.parent.dispatchEvent(o)})))},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.scaleInteraction.destroy(),this.visualVector.destroy(),this.rotationInteraction.destroy()},e.prototype.setHandlesVisibility=function(t){for(var e in this.rotationHandle&&this.container.canRotate()&&(this.rotationHandle.visible=t),this.scaleHandles||{})this.scaleHandles[e]&&(this.scaleHandles[e].visible=t);for(var n in this.vectorHandles||{})for(var e in this.vectorHandles[n]||{})this.vectorHandles[n][e]&&(this.vectorHandles[n][e].visible=t)},e.prototype.prepare=function(){t.prototype.prepare.call(this),this.border=new Qn,this.addChild(this.border),this.createVectorHandles(),this.prepareScaleInteraction(),this.createRotationHandle()},e.prototype.redraw=function(){t.prototype.redraw.call(this),this.border.position(this.outerBounds(),this.container.getMatrix()),this.updateVectorHandles(),this.createScaleHandles(),this.positionScaleHandles(),this.updateRotationHandle()},e.prototype.prepareScaleInteraction=function(){this.scaleHandles={},this.scaleInteraction=new Vn(this.container,this.state,this.restriction)},e.prototype.createScaleHandles=function(){var t=this.container.isSingleSelection,e=t?this.container.selectedShape:null;!t||e.transformSettings.hScale?(this.createScaleHandle(i.yb.Origin,i.yb.Middle),this.createScaleHandle(i.yb.End,i.yb.Middle)):(this.removeScaleHandle(i.yb.Origin,i.yb.Middle),this.removeScaleHandle(i.yb.End,i.yb.Middle)),!t||e.transformSettings.vScale?(this.createScaleHandle(i.yb.Middle,i.yb.Origin),this.createScaleHandle(i.yb.Middle,i.yb.End)):(this.removeScaleHandle(i.yb.Middle,i.yb.Origin),this.removeScaleHandle(i.yb.Middle,i.yb.End)),!t||e.transformSettings.hScale||e.transformSettings.vScale?(this.createScaleHandle(i.yb.Origin,i.yb.Origin),this.createScaleHandle(i.yb.Origin,i.yb.End),this.createScaleHandle(i.yb.End,i.yb.Origin),this.createScaleHandle(i.yb.End,i.yb.End)):(this.removeScaleHandle(i.yb.Origin,i.yb.Origin),this.removeScaleHandle(i.yb.Origin,i.yb.End),this.removeScaleHandle(i.yb.End,i.yb.Origin),this.removeScaleHandle(i.yb.End,i.yb.End))},e.prototype.createScaleHandle=function(t,e){var n="X"+t+"Y"+e;if(!this.scaleHandles[n]){var i=new qn;i.configurePosition(t,e),this.addChild(i),this.scaleHandles[n]=i,this.scaleInteraction.register(i)}},e.prototype.removeScaleHandle=function(t,e){var n="X"+t+"Y"+e,i=this.scaleHandles[n];i&&(this.removeChild(i),this.scaleInteraction.unregister(i),delete this.scaleHandles[n])},e.prototype.positionScaleHandles=function(){var t=this.outerBounds(),e=this.container.getMatrix(),n=this.container.rotation;for(var i in this.scaleHandles){var a=this.scaleHandles[i];a.position(t,e,n),a.refresh()}this.sortChildren((function(t,e){return t instanceof qn&&!(e instanceof qn)?1:!(t instanceof qn)&&e instanceof qn?-1:0}))},e.prototype.createAndRegisterVectorHandle=function(t){var e=Zn.create(t);return this.addChild(e),this.visualVector.register(e),e},e.prototype.createVectorHandles=function(){var t=this;this.visualVector=new zn(this.container,this.state,this.restriction);var e=this.container.getVisualVectorData();Object(J.keys)(e).forEach((function(n){t.vectorHandles[n]={},Object(J.values)(e[n]).forEach((function(e){t.vectorHandles[n][e.id]=t.createAndRegisterVectorHandle(e)}))}))},e.prototype.updateVectorHandles=function(){var t=this,e=this.container.getVisualVectorData();this.destroyRemovedVectorHandles(e),Object(J.keys)(e).forEach((function(n){t.vectorHandles[n]?Object(J.keys)(e[n]).forEach((function(i){var a=e[n][i];t.vectorHandles[n][i]?t.vectorHandles[n][i].updateHandle(a):t.vectorHandles[n][i]=t.createAndRegisterVectorHandle(a)})):(t.vectorHandles[n]={},Object(J.values)(e[n]).forEach((function(e){t.vectorHandles[n][e.id]=t.createAndRegisterVectorHandle(e)})))}))},e.prototype.destroyRemovedVectorHandles=function(t){var e=this;Object(J.keys)(this.vectorHandles).forEach((function(n){t[n]?Object(J.keys)(e.vectorHandles[n]).forEach((function(i){t[n][i]||(e.removeChild(e.vectorHandles[n][i]),delete e.vectorHandles[n][i])})):(Object(J.values)(e.vectorHandles[n]).forEach((function(t){return e.removeChild(t)})),delete e.vectorHandles[n])}))},e.prototype.createRotationHandle=function(){this.createRotationInteraction(),this.rotationHandle=new Yn,this.addChild(this.rotationHandle),this.rotationInteraction.register(this.rotationHandle)},e.prototype.createRotationInteraction=function(){this.rotationInteraction=new Xn(this.container,this.state,this.restriction)},e.prototype.updateRotationHandle=function(){if(this.rotationHandle&&this.container.canRotate()){this.rotationHandle.visible=!0;var t=this.outerBounds(),e=this.container.getMatrix();this.rotationHandle.position(t,e)}else this.rotationHandle&&(this.rotationHandle.visible=!1)},e}(Fn),$n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(W.e)(e,t),Object.defineProperty(e.prototype,"selectionType",{get:function(){var t=this.selectionCount;return t>1?Ct.MultiShape:1===t?Ct.SingleShape:Ct.None},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isSingleSelection",{get:function(){return this.selectionType===Ct.SingleShape},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isMultiSelection",{get:function(){return this.selectionType===Ct.MultiShape},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selectedShape",{get:function(){if(this.isSingleSelection)return this.selectedShapes[this.selectedIds[0]];if(this.isMultiSelection)return this.selectedShapes[this.selectedIds[0]];throw Error("Single selected shape should not be used when there are multiple selected")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transformSettings",{get:function(){return this.selectedShapeList.reduce((function(t,e){return e instanceof _t.a&&e.transformSettings&&(t?(t.fixAspectRatio=t.fixAspectRatio||e.transformSettings.fixAspectRatio,t.hScale=t.hScale&&e.transformSettings.hScale,t.vScale=t.vScale&&e.transformSettings.vScale,t.rotate=t.rotate&&e.transformSettings.rotate):t=Object(W.a)({},e.transformSettings)),t}),null)},enumerable:!1,configurable:!0}),e.prototype.position=function(){this.isSingleSelection?this.positionSingle():this.positionMultiple()},e.prototype.previewInteraction=function(t){return this.previewVectorData?this.fireVectorChange(!0):this.fireTransformCommand(!0,void 0,t)},e.prototype.completeInteraction=function(t,e){return this.previewVectorData?this.fireVectorChange(!1):this.fireTransformCommand(!1,t,e)},e.prototype.getVisualVectorData=function(){var t={};return this.isSingleSelection&&this.selectedShapes?(Object(J.values)(this.selectedShapes).forEach((function(e){e instanceof _t.a&&e.vectors&&(t[e.id]={},Object(J.values)(e.vectors).forEach((function(n){if(n.getVectorData){var i=n.getVectorData(e.defaultBounds,e.viewTransform);t[e.id][i.id]=i}})))})),t):t},e.prototype.canRotate=function(){return!this.selectedShapeList.find((function(t){return t instanceof _t.a&&!t.transformSettings.rotate}))},e.prototype.positionSingle=function(){var t=this.selectedShape;this.setTranslation(t),this.setTransformation(t),this.updateChild(t,!1)},e.prototype.positionMultiple=function(){var t=this;this.resetTransformation();var e=this.selectedShapeList,n=e.map((function(t){return t.viewBounds}));this.setMinimumTranslation(n),e.forEach((function(e){t.updateChild(e,!0)}))},e.prototype.updateChild=function(t,e){var n=this.getChildByName(t.id);n.setDefaultBounds(t),e?(n.setTranslation(t),n.setTransformation(t)):n.resetTransformation()},e.prototype.setTranslation=function(t){if(t instanceof _t.a){var e=t.viewTransform;this.setTranslationByValues(e.x,e.y,e.scaleX,e.scaleY,e.angle)}if(t instanceof Lt.a){var n=t.viewBounds,i=n.x,a=n.y;this.setTranslationByValues(i,a)}},e.prototype.setTranslationByValues=function(t,e,n,a,o,r,s){void 0===n&&(n=1),void 0===a&&(a=1),void 0===o&&(o=0),void 0===r&&(r=0),void 0===s&&(s=0);var c=new i.jb;c.appendTransform(t,e,n,a,o,r,s,0,0);var l=c.transformPoint(this.regX,this.regY);this.x=l.x,this.y=l.y},e.prototype.setMinimumTranslation=function(t){var e=t[0].x,n=t[0].y;t.forEach((function(t){e=Math.min(t.x,e),n=Math.min(t.y,n)})),this.setTranslationByValues(e,n)},e.prototype.setTransformation=function(t){if(t instanceof _t.a){var e=t.viewTransform;this.scaleX=e.scaleX,this.scaleY=e.scaleY,this.rotation=e.angle}},e.prototype.resetTransformation=function(){this.scaleX=1,this.scaleY=1,this.rotation=0},e.prototype.fireTransformCommand=function(t,e,n){var i=this,a=this.getShapeMatrices(),o=this.getConnectorMatrices(t,e);if(!Object.keys(a).length&&!Object.keys(o).length)return Object(C.b)();t||Object.keys(o).forEach((function(t){i.baseConnectorMatrices[t]=o[t].next}));var r=Ht.a.transformShapesAndConnectors,s={shapes:a,connectors:o,handle:{name:n.name}};return t||Object.values(this.selectedShapes).forEach((function(t){t.type===y.v.Image&&t.hash&&i.commandService.dispatch(D.a.uploadScaledImage,{shapeId:t.id})})),this.fireCommandEvent(r,s,t)},e.prototype.fireVectorChange=function(t){var e=Ht.a.moveVisualVector,n={shapeId:this.selectedShape.id,vectorId:this.previewVectorData.vectorId,points:this.previewVectorData.points};return this.previewVectorData=null,this.fireCommandEvent(e,n,t)},e.prototype.fireCommandEvent=function(t,e,n){var i=n?"preview":"dispatch";return this.commandService[i](t,e)},e}(Nt),ti=function(t){function e(e){var n=t.call(this)||this;return n.name=e,n}return Object(W.e)(e,t),Object.defineProperty(e.prototype,"pointId",{get:function(){return this.name},enumerable:!1,configurable:!0}),e.prototype.getCursor=function(t){return{cursor:"default",tail:null,type:"css",viewingArea:"app"}},e}(Gn),ei=function(t){function e(e){var n=t.call(this)||this;return n.name=e,n}return Object(W.e)(e,t),Object.defineProperty(e.prototype,"pointId",{get:function(){return this.name},enumerable:!1,configurable:!0}),e.prototype.getCursor=function(t){return{cursor:"default",tail:null,type:"css",viewingArea:"app"}},e.prototype.getEndpointOver=function(){var t=this;return this.waitUntilAddedToCanvas().pipe(Object(T.a)((function(){return Object(P.a)(t.indicatorLayer,"endpoint-over")})))},e.prototype.getEndpointOut=function(){var t=this;return this.waitUntilAddedToCanvas().pipe(Object(T.a)((function(){return Object(P.a)(t.indicatorLayer,"endpoint-out")})))},e}(Gn),ni=function(t){function e(e){var n=t.call(this)||this;return n.previousPointId=e,n.name="bp-"+e,n}return Object(W.e)(e,t),e.prototype.getCursor=function(t){return null},e}(Gn),ii=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(W.e)(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"PathPointMoveInteraction"},enumerable:!1,configurable:!0}),e.prototype.interaction=function(t){var e=t.target,n=this.restriction.pointOnViewport({x:t.stageX,y:t.stageY},["GridService"]),i=n.x,a=n.y,o=this.restriction.pointOnViewport({x:i,y:a},["SelectionMoveSnap"]);this.container.onPathPointMove(e.pointId,{x:o.x,y:o.y})},e.prototype.interactionEnd=function(e){t.prototype.interactionEnd.call(this,e);var n=e.target,i=this.restriction.pointOnViewport({x:e.stageX,y:e.stageY},["GridService"]),a=i.x,o=i.y,r=this.restriction.pointOnViewport({x:a,y:o},["SelectionMoveSnap"]);this.container.onPathPointDrop(n.pointId,{x:r.x,y:r.y})},e}(Yt),ai=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(W.e)(e,t),Object.defineProperty(e.prototype,"interactionInProgress",{get:function(){return!1},enumerable:!1,configurable:!0}),e.prototype.startEndpointMovement=function(t){var e=this.endPointHandles.get(t);if(!e)throw new Error("Unable to find endpoint handle with given id");var n=new Z.Event("mousedown",!1,!0);e.dispatchEvent(n),this.stage.dispatchEvent(new Z.MouseEvent("stagemousemove",!1,!0,this.stage.mouseX,this.stage.mouseY,null,null,!1,this.stage.mouseX,this.stage.mouseY))},e.prototype.setHandlesVisibility=function(t){var e=this.endPointHandles?this.endPointHandles.getAll():{};for(var n in e||{})e[n].visible=t;var i=this.pathPointHandles?this.pathPointHandles.getAll():{};for(var n in i||{})i[n].visible=t;var a=this.breakPointHandles?this.breakPointHandles.getAll():{};for(var n in a||{})a[n].visible=t},e.prototype.getTransformedBounds=function(){var e=this.container.selectedShape.viewBounds;return this.setBounds(e.x,e.y,e.width,e.height),t.prototype.getTransformedBounds.call(this)},e.prototype.prepare=function(){t.prototype.prepare.call(this),this.prepareInteractions(),this.prepareHandleMaps(),this.updateHandles()},e.prototype.redraw=function(){t.prototype.redraw.call(this),this.updateHandles()},e.prototype.prepareInteractions=function(){this.endPointMove=new Wt(this.container,this.state,this.restriction),this.pathPointMove=new ii(this.container,this.state,this.restriction)},e.prototype.prepareHandleMaps=function(){this.endPointHandles=new i.ib,this.endPointHandles.onCreate=this.createEndPointHandle.bind(this),this.endPointHandles.onUpdate=this.updateEndPointHandle.bind(this),this.endPointHandles.onDelete=this.deleteEndPointHandle.bind(this),this.pathPointHandles=new i.ib,this.pathPointHandles.onCreate=this.createPathPointHandle.bind(this),this.pathPointHandles.onUpdate=this.updatePathPointHandle.bind(this),this.pathPointHandles.onDelete=this.deletePathPointHandle.bind(this),this.breakPointHandles=new i.ib,this.breakPointHandles.onCreate=this.createBreakPointHandle.bind(this),this.breakPointHandles.onUpdate=this.updateBreakPointHandle.bind(this),this.breakPointHandles.onDelete=this.deleteBreakPointHandle.bind(this)},e.prototype.updateHandles=function(){this.endPointHandles.reset(Object(J.keyBy)(this.container.getEndPoints(),"id")),this.pathPointHandles.reset(Object(J.keyBy)(this.container.getPathPoints(),"id")),this.breakPointHandles.reset(Object(J.keyBy)(this.container.getBreakPoints(),"id"))},e.prototype.createEndPointHandle=function(t,e){var n=new ei(t);return n.setPosition(e.position.x,e.position.y),this.addChild(n),this.endPointMove.register(n),n},e.prototype.updateEndPointHandle=function(t,e,n){return t.setPosition(n.position.x,n.position.y),t},e.prototype.deleteEndPointHandle=function(t,e){this.removeChild(t)},e.prototype.createPathPointHandle=function(t,e){var n=new ti(t);return n.setPosition(e.position.x,e.position.y),n.setMovement(e.movement),this.addChild(n),this.pathPointMove.register(n),n},e.prototype.updatePathPointHandle=function(t,e,n){return t.setMovement(n.movement),t.setPosition(n.position.x,n.position.y),t},e.prototype.deletePathPointHandle=function(t,e){this.removeChild(t)},e.prototype.createBreakPointHandle=function(t,e){var n=new ni(t);return n.setPosition(e.position.x,e.position.y),this.addChild(n),n},e.prototype.updateBreakPointHandle=function(t,e,n){return t.setPosition(n.position.x,n.position.y),t},e.prototype.deleteBreakPointHandle=function(t,e){this.removeChild(t)},e}(Fn),oi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(W.e)(e,t),e}(Ft),ri=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(W.e)(e,t),e}(Ft),si=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(W.e)(e,t),e}(Ft);!function(t){t.added="selection-added",t.removed="selection-removed",t.changed="selection-changed"}(Nn||(Nn={}));var ci=function(t){function e(e,n){var i=t.call(this,e,!0,!0)||this;return i.type=e,i.selection=n,i}return Object(W.e)(e,t),e}(Z.Event),li=function(t){function e(e,n,i,a,o,r){var s=t.call(this,e,r)||this;return s.ll=n,s.viewport=i,s.commandService=a,s.restriction=o,s.viewToDiagram=r,s.shapeIds=[],s.addSource=new le.a,s.removeSource=new le.a,s}return Object(W.e)(e,t),Object.defineProperty(e.prototype,"indicators",{get:function(){return[this.selection]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shapeCount",{get:function(){return this.shapeIds.length},enumerable:!1,configurable:!0}),e.prototype.initialize=function(){var t=this;this.subs.push(Object(x.a)(this.state.changes("Selected").pipe(Object(I.a)((function(e){return t.state.get("EditingText").open?[]:e}))),this.state.changes("EditingText").pipe(Object(I.a)((function(e){return e.open?[]:t.state.get("Selected")})))).pipe(Object(et.a)(J.isEqual),Object(T.a)((function(e){var n=t.selection;return t.resetSelection(e).pipe(Object(T.a)((function(){if(!t.selection)return Object(C.b)();var i=t.viewport.getShapeModels(e),a=i.pipe(Object(w.a)(1),Object(M.a)((function(n){e.forEach((function(e){n[e]&&t.shapeChanged(n[e])}))}))),o=i.pipe(Object(j.a)(1),Object(M.a)((function(n){e.filter((function(e){return!t.shapeIds.includes(e)&&n[e]})).forEach((function(e){return t.shapeAdded(n[e])}))})));return Object(x.a)(o,a).pipe(Object(M.a)((function(){t.removeShapes(e),t.updateChanges(),t.emitSelectionEvent(n)})))})))}))).subscribe(),this.duringSelectionInteraction(!0,!1).pipe(Object(M.a)((function(e){return t.handleVisibility(e)}))).subscribe(),this.duringPanMouseControlState(!0,!1).pipe(Object(M.a)((function(e){return t.handleVisibility(e)}))).subscribe())},e.prototype.destroy=function(){var e,n;t.prototype.destroy.call(this),null===(e=this.hoverSub)||void 0===e||e.unsubscribe(),this.destroySelection(),this.changesObserver.complete(),this.changesObserver=void 0,this.addSource.complete(),this.addSource=void 0,this.removeSource.complete(),this.removeSource=void 0,null===(n=this.hoverSub)||void 0===n||n.unsubscribe()},e.prototype.createAddSource=function(){var t=this;return Object(Ln.a)((function(){var e=t.addSource;return t.selection&&(e=Object(Gt.a)(Object($.a)(t.selection),e)),e}))},e.prototype.createRemoveSource=function(){return this.removeSource},e.prototype.createChangeSource=function(){var t=this;return Hn.a.create((function(e){return t.changesObserver=e}))},e.prototype.removeShapes=function(t){var e=this;this.shapeIds.forEach((function(n){t.includes(n)||e.selectionContainer.removeShape(n)})),this.shapeIds=Object(W.j)(t)},e.prototype.shapeAdded=function(t){this.shapeIds.push(t.id),this.selectionContainer.addShape(t)},e.prototype.shapeChanged=function(t){this.selectionContainer.changeShape(t)},e.prototype.updateChanges=function(){this.selection.refresh(),this.changesObserver.next(this.selection)},e.prototype.resetSelection=function(t){var e=this;return this.selectionTypeFor(t).pipe(Object(I.a)((function(t){var n=t.selectionType,i=t.containerType;return n?!(e.selection instanceof n&&e.selectionContainer instanceof i)&&(e.selection&&e.removeSelection(),e.createSelection(n,i),!0):!!e.selection&&(e.removeSelection(),!0)})))},e.prototype.selectionTypeFor=function(t){var e=this;return t.length?t.length>1?Object($.a)({selectionType:Jn,containerType:$n}):this.ll.forCurrent(!1).getShapeOnce(t[0]).pipe(Object(I.a)((function(t){return t instanceof _t.a?{selectionType:Jn,containerType:e.containerTypeForShape(t)}:t instanceof Lt.a?{selectionType:ai,containerType:e.containerTypeForConnector(t)}:{selectionType:null,containerType:null}}))):Object($.a)({selectionType:null,containerType:null})},e.prototype.containerTypeForShape=function(t){return $n},e.prototype.containerTypeForConnector=function(t){var e=t.entryClassName;return"ConnectorStraight"===e||"ConnectorDouble"===e||"ConnectorTriple"===e||"ConnectorDivided"===e?oi:"ConnectorCurved"===e?ri:"ConnectorAngled"===e||"ConnectorSmoothAngled"===e||"ConnectorWavy"===e||"ConnectorDoubleWavy"===e||"ConnectorIndented"===e||"ConnectorAngledDivided"===e?si:Ft},e.prototype.removeSelection=function(){this.removeSource.next(this.selection),this.destroySelection()},e.prototype.createSelection=function(t,e){this.selectionContainer=new e(this.commandService),this.selection=new t(this.selectionContainer,this.state,this.restriction),this.addSource.next(this.selection)},e.prototype.emitSelectionEvent=function(t){var e;t?e=this.selection?Nn.changed:Nn.removed:this.selection&&(e=Nn.added);var n=new ci(e,this.selection);this.indicatorLayer.dispatchEvent(n),this.state.set("CurrentSelection",this.selection||{})},e.prototype.handleVisibility=function(t){this.selection&&this.selection.setHandlesVisibility(t)},e.prototype.destroySelection=function(){var t=this;this.selectionContainer&&(this.shapeIds.forEach((function(e){return t.selectionContainer.removeShape(e)})),this.shapeIds=[],this.selectionContainer.destroy(),this.selectionContainer=void 0),this.selection&&(this.selection.destroy(),this.selection=void 0)},e.removeForPanZoom=!0,e.\u0275fac=function(t){return new(t||e)(o.qc(i.Nb),o.qc(b.a),o.qc(m.a),o.qc(i.B),o.qc(Kt.a),o.qc(ht.a))},e.\u0275prov=o.cc({token:e,factory:e.\u0275fac}),e=Object(W.d)([Object(ye.a)(),Object(W.g)("design:paramtypes",[i.Nb,b.a,m.a,i.B,Kt.a,ht.a])],e)}(ye.b);Object.defineProperty(li,"name",{value:"SelectionHandler"});var ui=n("jDMA"),di=n("OOUj"),pi=n("SBjo"),hi=function(t){function e(e){var n=t.call(this)||this;n.dToVcoordinate=e,n.color="#AAAAAA",n.thickness=1;var i=new Image;return i.src="data:image/svg+xml;base64,"+btoa('<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" width="28.25" height="28.25" viewBox="0 0 28.25 28.25"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#d1d1e6;}.cls-3{fill:#04263d;}</style></defs><circle class="cls-1" cx="14.12" cy="14.13" r="13.63"/><path class="cls-2" d="M15,29.12A14.12,14.12,0,1,1,29.12,15,14.13,14.13,0,0,1,15,29.12ZM15,1.88A13.12,13.12,0,1,0,28.12,15,13.13,13.13,0,0,0,15,1.88Z" transform="translate(-0.88 -0.88)"/><path class="cls-3" d="M20.43,12.36H19V10.08a3.86,3.86,0,0,0-3.86-3.86H14.7a3.84,3.84,0,0,0-3.85,3.86v2.28H9.48a1.26,1.26,0,0,0-1.25,1.26v7.61a1.26,1.26,0,0,0,1.25,1.26h11a1.26,1.26,0,0,0,1.25-1.26V13.62A1.26,1.26,0,0,0,20.43,12.36Zm-8.35-2.28a2.45,2.45,0,0,1,2.63-2.69h.43a2.58,2.58,0,0,1,1.93.73,2.68,2.68,0,0,1,.7,2v2.28H12.08ZM16,16.75a1.08,1.08,0,0,1-.4.52.18.18,0,0,0-.08.17c0,.55,0,1.11,0,1.67a.45.45,0,0,1-.49.46.47.47,0,0,1-.5-.46c0-.28,0-.56,0-.84h0v-.85a.15.15,0,0,0-.06-.14l-.24-.21A1.13,1.13,0,0,1,14,16a1.06,1.06,0,0,1,2,.8Z" transform="translate(-0.88 -0.88)"/><path class="cls-3" d="M20.43,22.73H9.48A1.5,1.5,0,0,1,8,21.23V13.62a1.51,1.51,0,0,1,1.5-1.51H10.6v-2A4.08,4.08,0,0,1,14.7,6h.44a4.12,4.12,0,0,1,4.11,4.11v2h1.18a1.51,1.51,0,0,1,1.5,1.51v7.61A1.5,1.5,0,0,1,20.43,22.73ZM9.48,12.61a1,1,0,0,0-1,1v7.61a1,1,0,0,0,1,1h11a1,1,0,0,0,1-1V13.62a1,1,0,0,0-1-1H18.75V10.08a3.61,3.61,0,0,0-3.61-3.61H14.7a3.59,3.59,0,0,0-3.6,3.61v2.53ZM15,19.82a.72.72,0,0,1-.75-.7c0-.28,0-.57,0-.85v-.82a2.29,2.29,0,0,1-.23-.21,1.39,1.39,0,0,1-.19-1.4,1.3,1.3,0,0,1,1.27-.74,1.34,1.34,0,0,1,1,.59,1.31,1.31,0,0,1,.13,1.14h0a1.39,1.39,0,0,1-.48.64V18c0,.38,0,.75,0,1.13A.7.7,0,0,1,15,19.82Zm0-4.23a.84.84,0,0,0-.72.47.9.9,0,0,0,.11.84,1.12,1.12,0,0,0,.2.18.44.44,0,0,1,.16.34v.85c0,.27,0,.55,0,.83a.23.23,0,0,0,.25.22c.09,0,.24,0,.24-.21,0-.38,0-.75,0-1.12v-.55a.43.43,0,0,1,.19-.37.89.89,0,0,0,.31-.4h0a.81.81,0,0,0-.08-.7.85.85,0,0,0-.65-.38Zm3.07-3H11.83V10.08A2.71,2.71,0,0,1,14.7,7.14h.44A2.85,2.85,0,0,1,17.25,8,3,3,0,0,1,18,10.08Zm-5.69-.5h5.19v-2a2.5,2.5,0,0,0-.62-1.79,2.4,2.4,0,0,0-1.76-.65h-.43a2.2,2.2,0,0,0-2.38,2.44Z" transform="translate(-0.88 -0.88)"/><path class="cls-1" d="M16,16.71a1.3,1.3,0,0,1-.42.56.17.17,0,0,0-.09.17c0,.58,0,1.17,0,1.76a.48.48,0,0,1-.52.48.48.48,0,0,1-.52-.48c0-.3,0-.6,0-.89h0v-.89a.18.18,0,0,0-.07-.15l-.25-.22A1.19,1.19,0,0,1,14,15.87a1.11,1.11,0,0,1,2.06.84Z" transform="translate(-0.88 -0.88)"/></svg>'),n.icon=new Z.Bitmap(i),n.icon.regX=14.25,n.icon.regY=28.5,n.addChild(n.icon),n.shapeView=new Z.Shape,n.addChild(n.shapeView),n}return Object(W.e)(e,t),e.prototype.destroy=function(){},e.prototype.update=function(){var t=i.tb.onRect({x:{type:"relative",value:.5},y:{type:"fixed-start",value:0}},this.shape.defaultBounds,this.shape.transform);this.icon.x=this.dToVcoordinate.x(t.x),this.icon.y=this.dToVcoordinate.y(t.y),this.icon.rotation=this.shape.transform.angle||0,this.isShapeSelected&&this.drawRectHighLight()},e.prototype.add=function(t,e){this.name=t.id,this.shape=t,this.isShapeSelected=e},e.prototype.drawRectHighLight=function(){var t=this.shape.defaultBounds,e=this.shape.transform,n=i.Ab.from(t).getTransformedPoints(e),a=n.topLeft,o=n.topRight,r=n.bottomLeft,s=n.bottomRight;this.shapeView.graphics.clear().setStrokeStyle(this.thickness).beginStroke(this.color).moveTo(this.dToVcoordinate.x(a.x),this.dToVcoordinate.y(a.y)).lineTo(this.dToVcoordinate.x(o.x),this.dToVcoordinate.y(o.y)).lineTo(this.dToVcoordinate.x(s.x),this.dToVcoordinate.y(s.y)).lineTo(this.dToVcoordinate.x(r.x),this.dToVcoordinate.y(r.y)).lineTo(this.dToVcoordinate.x(a.x),this.dToVcoordinate.y(a.y)).endStroke()},e}(Z.Container),gi=function(t){function e(e,n,i,a,o){var r=t.call(this,i)||this;return r.dToVcoordinate=e,r.vtod=n,r.state=i,r.ll=a,r.commandService=o,r._indicators=[],r.addSource=new le.a,r.removeSource=new le.a,r.changeSource=new le.a,r}return Object(W.e)(e,t),Object.defineProperty(e.prototype,"locator",{get:function(){return this.ll.forCurrent(!1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"indicators",{get:function(){return this._indicators},enumerable:!1,configurable:!0}),e.prototype.initialize=function(){var t=this,e=this.state.changes("InterfaceControlState").pipe(Object(T.a)((function(e){return t.removeIndicators(),"edit"===e?t.initForEditor():Object(C.b)()})));this.subs.push(e.subscribe(),this.listenToViewportChanges().subscribe())},e.prototype.duringSelectionChange=function(){var t=this;return this.state.changes("Selected").pipe(Object(T.a)((function(e){return t.removeIndicatorsBySelectedState(!0),e&&e.length>0?t.locator.getDiagramOnce().pipe(Object(I.a)((function(t){var n,i,a=t.filterShapeIdsByLockedState(e,!0),o=[];try{for(var r=Object(W.k)(a),s=r.next();!s.done;s=r.next()){var c=s.value;t.shapes[c].isConnector()||o.push(t.shapes[c])}}catch(l){n={error:l}}finally{try{s&&!s.done&&(i=r.return)&&i.call(r)}finally{if(n)throw n.error}}return o.length>0?o:null}))):Object($.a)(null)})))},e.prototype.createAddSource=function(){return this.addSource},e.prototype.createRemoveSource=function(){return this.removeSource},e.prototype.createChangeSource=function(){return this.changeSource},e.prototype.initForEditor=function(){var t=this;return Object(x.a)(this.duringSelectionChange(),this.getShapeUnderPointer()).pipe(Object(M.a)((function(e){t.removeIndicatorsBySelectedState(!1),e&&(e.forEach((function(e){var n=new hi(t.dToVcoordinate);n.add(e,t.state.get("Selected").includes(e.id)),t.handleClick(n),t._indicators.push(n),t.addSource.next(n)})),t.updateIndicators())})))},e.prototype.listenToViewportChanges=function(){var t=this;return Object(x.a)(this.state.changes("DiagramPan"),this.state.changes("DiagramZoomLevel")).pipe(Object(M.a)((function(){t.updateIndicators()})))},e.prototype.updateIndicators=function(){var t=this;this._indicators.forEach((function(e){e.update(),t.changeSource.next(e)}))},e.prototype.removeIndicators=function(){for(;this._indicators.length>0;)this.removeSource.next(this._indicators.pop())},e.prototype.removeIndicatorsBySelectedState=function(t){var e=this;this._indicators.forEach((function(n){n.isShapeSelected===t&&e.removeSource.next(n)}))},e.prototype.getShapeUnderPointer=function(){var t=this;return Object(P.a)(this.indicatorLayer.canvas,"mousemove").pipe(Object(T.a)((function(e){var n,i=t.indicatorLayer.getObjectUnderPoint(e.x,e.y,0);i&&i.parent instanceof hi&&(n=i.parent.name);var a=t.state.get("DiagramCanvas");if(a){var o=a.getObjectUnderPoint(t.vtod.x(e.x),t.vtod.y(e.y),0);o&&o.parent&&(n=o.parent.name)}return n&&!t.state.get("Selected").includes(n)?t.locator.getShapeOnce(n).pipe(Object(I.a)((function(t){return t&&t.isLocked?[t]:null}))):Object($.a)(null)})))},e.prototype.handleClick=function(t){var e=this;Object(P.a)(t,"click").subscribe((function(){e.removeIndicators(),e.commandService.dispatch(D.a.toggleShapeLock,{shouldLock:!1,shapeIds:[t.name]})}))},e.\u0275fac=function(t){return new(t||e)(o.qc(f.a),o.qc(ht.a),o.qc(i.Nb),o.qc(b.a),o.qc(i.B))},e.\u0275prov=o.cc({token:e,factory:e.\u0275fac}),e=Object(W.d)([Object(ye.a)(),Object(W.g)("design:paramtypes",[f.a,ht.a,i.Nb,b.a,i.B])],e)}(ye.b),fi=n("53e4"),bi=n("wuOO"),mi=n("J8oI"),vi=n("AM7v"),yi=n("u7ZA"),Si=n("6qzS"),Oi=n("TQyE"),xi=n("UCH/"),Ci=n("6ppF"),Pi=function(t){function e(e,n,i,a,o,r){var s=t.call(this,e,a,i)||this;return s.commandService=e,s.random=n,s.state=i,s.vToDcoordinate=a,s.dToVcoordinate=o,s.shapeManage=r,s.basicCardDef={defId:"creately.datasource.lib.basic",version:"1"},s.stickyNotesDef={defId:"creately.datasource.lib.sticky",version:"1"},s.rectDef={defId:"creately.basic.rectangle",version:"4"},s}return Object(W.e)(e,t),Object.defineProperty(e.prototype,"defaultCursor",{get:function(){switch(this.state.get("MouseControlState")){case pt.b.BasicCard:return{cursor:"card",tail:null,type:"svg",viewingArea:"canvas"};case pt.b.Rectangle:return{cursor:"rectangle",tail:null,type:"svg",viewingArea:"canvas"};case pt.b.StickyNote:return{cursor:"stickynote",tail:null,type:"svg",viewingArea:"canvas"};default:return{cursor:"default",tail:null,type:"css",viewingArea:"app"}}},enumerable:!1,configurable:!0}),e.prototype.initialize=function(e,n,i){var a=this,o=t.prototype.initialize.call(this,e,n,i),r=this.getAllCanvasMouseCapture().pipe(Object(M.a)((function(t){return t.stopPropagation()})),Object(E.a)((function(t){return"pressup"===t.type})),Object(M.a)((function(t){var e=a.state.get("MouseControlState");return a.commandService.dispatch(gt.a.changeMouseControlState,{state:pt.b.Normal}),a.addShape(t,e)})));return Object(x.a)(o,r)},e.prototype.addShape=function(t,e){switch(e){case pt.b.BasicCard:return this.dispatchAddShapeCmd(t,this.basicCardDef);case pt.b.Rectangle:return this.dispatchAddShapeCmd(t,this.rectDef);case pt.b.StickyNote:return this.dispatchAddShapeCmd(t,this.stickyNotesDef)}},e.prototype.dispatchAddShapeCmd=function(t,e){var n=this.vToDcoordinate.x(t.nativeEvent.offsetX)-y.A,i=this.vToDcoordinate.y(t.nativeEvent.offsetY)-20;this.shapeManage.addShape(e,this.dToVcoordinate.x(n),this.dToVcoordinate.y(i)).subscribe()},e.\u0275fac=function(t){return new(t||e)(o.qc(i.B),o.qc(i.xb),o.qc(i.Nb),o.qc(ht.a),o.qc(f.a),o.qc(xt.a))},e.\u0275prov=o.cc({token:e,factory:e.\u0275fac}),e}(bt.a);Object.defineProperty(Pi,"name",{value:"QuickToolsInteractionHandler"});var Ti,wi=n("uiwn"),ji=n("qp/C");!function(t){t.exportSVG="exportSVG",t.exportPNG="exportPNG",t.addCollaborator="addCollaborator",t.removeCollaborator="removeCollaborator",t.addShape="addShape",t.duplicateShapes="duplicateShapes",t.addConnector="addConnector",t.setText="setText"}(Ti||(Ti={}));var Mi=function(){function t(){}return t.executeCommand=function(t,e,n){switch(e){case Ti.exportSVG:return t.execute("ExportAsSvgAPI",n.documentId,n);case Ti.exportPNG:return t.execute("ExportAsPngAPI",n.documentId,n);default:return Object($.a)(null)}},t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=o.cc({token:t,factory:t.\u0275fac}),t}(),Ii=n("bI8T"),Ei=n("LFZc"),Di=n("YJdE"),_i=n("HsO4"),ki=function(){function t(t,e,n,i,a,o){this.state=t,this.commands=e,this.elkService=n,this.ll=i,this.sps=a,this.vp2dg=o}return t.prototype.initialize=function(){var t=this;this.ll.forCurrentObserver(!1).pipe(Object(T.a)((function(e){return t.state.changes("TemplateContext").pipe(Object(E.a)((function(t){return t&&!Object(J.isEmpty)(t)})),Object(M.a)((function(e){return t.updateContextStateMap(e)})),Object(T.a)((function(e){return e.contextData?Object($.a)(e.contextData):t.fetchContext(e)})),Object(T.a)((function(e){return e.content.containerId?Object(_i.a)(t.sps.generateShapesInContainer(e.content)):Object(_i.a)(t.sps.generateShapesAndLayout({x:0,y:0,width:100,height:40},e.content,e.content.layoutingId,void 0,void 0,e.content.name))})),Object(M.a)((function(){return t.state.set("TemplateContext",{})})))}))).subscribe()},t.prototype.fetchContext=function(t){return this.commands.dispatch(D.a.getTemplateContext,t).pipe(Object(lt.a)(),Object(I.a)((function(e){var n;return(null===(n=null==e?void 0:e.resultData)||void 0===n?void 0:n[0])?{id:t.id,content:e.resultData[0],diagramName:t.renameDiagram?e.resultData[0].name:null,mainContainerId:t.containerId,appendShapes:t.appendShapes,type:t.type}:{}})))},t.prototype.fetchContextDummy=function(t){return Object($.a)({id:t.id,content:JSON.parse({contextid1:'{ "Business Problem": [ { "Title": "Manual Translation ernekjrnkwj nrwke jrnekrj newkrj nwekrj kerj nekwrjnwekrj newkrjnewkrjnew rkjwenrkewjn r", "Description": "The process of manually translating every piece of text in an app is time-consuming and prone to errors." }, { "Title": "Cultural Nuances", "Description": "There\'s also the risk of misinterpretations due to cultural nuances that are not taken into consideration." } ], "Business Outcomes": [ { "Title": "Efficiency and Cost-Effectiveness", "Description": "Reducing the time and cost involved in translating apps, while increasing the accuracy of translations." }, { "Title": "Improved User Experience", "Description": "Improving user experience globally by providing more culturally accurate translations." } ], "Users & Customers": [ { "Title": "Primary Users", "Description": "App developers who want to localize their products for global markets." }, { "Title": "Secondary Users", "Description": "Project managers, UX designers, and localization teams working with developers." } ], "User Outcomes": [ { "Title": "Efficient Translation", "Description": "App developers can seamlessly and accurately translate their app into multiple languages without the need for professional translators or extensive linguistic knowledge." }, { "Title": "Expanded User Base", "Description": "They can cater to a more diverse audience, ultimately improving the user experience." } ], "Solution Ideas": [ { "Title": "AI-Powered Translation", "Description": "A language translation app that uses AI and machine learning to provide accurate translations in real-time, with the ability to understand contextual nuances." }, { "Title": "API Integration", "Description": "The app could also include an API for easy integration into the app development process." }, { "Title": "Community-Driven Improvement", "Description": "A feature that allows community-driven translations or corrections to continuously improve the quality of translations." } ], "Hypothesis": [ { "Title": "Improved Localization Process", "Description": "We believe that by providing an AI-powered language translation app for app developers, we will reduce the time and cost associated with localization. We will know this to be true when we see a reduction in the time it takes for apps to be localized, an increase in the number of apps being localized, and positive feedback from developers regarding the accuracy of translations." } ], "What\'s the biggest risk?": [ { "Title": "Inaccurate Translations", "Description": "The most significant risk is providing inaccurate translations that can lead to misunderstandings or offend users." }, { "Title": "Integration Resistance", "Description": "Another risk is developers\' resistance to integrating a new tool into their workflow." }, { "Title": "AI Model Performance", "Description": "The AI model\'s training and continuous learning are critical, and poor performance could hurt the reputation of the product." } ], "What will we learn?": [ { "Title": "Understanding Developers\' Needs", "Description": "We will learn more about the specific needs and pain points of app developers in the localization process." }, { "Title": "AI for Translation", "Description": "We will also gain insights into how AI can be leveraged for language translation, including its limitations and strengths." }, { "Title": "Community Feedback", "Description": "Feedback from the community will help improve our translation model and the overall product." } ] } ',contextid2:'{ "Strengths": [ { "Title": "Experienced Production Team", "Description": "Our production team is well-versed in the soap making process, with years of experience in the field. They understand the intricate details of soap manufacturing, from sourcing quality raw materials to the final stages of packaging and distribution. This wealth of knowledge and experience allows for a smooth operation, eliminating unnecessary delays, and maintaining high product quality. The team\'s adaptability and dedication to continuous learning make it well-positioned to overcome new challenges and changes in the soap production industry. Their mastery of current manufacturing technologies contributes to optimizing production efficiency, ultimately reducing costs and increasing profitability." }, { "Title": "Strong Brand Reputation", "Description": "Our soap company is known for its quality products, ethical sourcing, and commitment to sustainability. We\'ve earned the trust of consumers in our existing markets, resulting in a strong brand reputation. Our products are known for their consistency, effectiveness, and eco-friendly properties. This established brand image will serve as an important asset as we venture into the Argentinian market, as it will lend credibility to our new division and its products. Our reputation for prioritizing customer satisfaction and ethical practices is likely to resonate well with Argentinian consumers, contributing to the overall success of our expansion." }, // Include the rest of the Strengths here... ], "Opportunities": [ { "Title": "Expanding Market for Natural Soaps", "Description": "The global shift toward healthier, more sustainable lifestyles presents a significant opportunity for our company. There\'s a growing consumer trend in Argentina favoring organic and natural products, including soaps. As our company already prioritizes natural ingredients and sustainable practices, we\'re well positioned to meet this demand. Launching our new division here will allow us to tap into this market, reaching a larger customer base and creating opportunities for increased sales and revenue growth. Furthermore, our commitment to sustainability will help differentiate us in a competitive market, further driving consumer interest and loyalty." }, { "Title": "Underserved Rural Markets", "Description": "Many rural areas in Argentina are underserved by existing soap brands, presenting an untapped market with potential for growth. Our company could extend its distribution network to reach these areas, providing access to quality soap products where they may currently be lacking. We have experience in successfully navigating logistics and distribution challenges in diverse geographic settings, making us well-equipped to handle this expansion. Successfully reaching these rural markets could significantly increase our customer base and drive sales, while also aligning with our company\'s mission to promote health and hygiene in underserved communities." }, // Include the rest of the Opportunities here... ], "Aspirations": [ { "Title": "Become a Market Leader in Argentina", "Description": "Our ultimate aspiration is to become a market leader in the Argentinian soap industry. We aim to achieve this by offering high-quality, natural, and sustainable soap products that cater to the evolving needs of the Argentinian consumer. To accomplish this, we will continually invest in research and development to innovate and improve our products, ensuring they remain relevant and competitive. We also aspire to maintain a strong brand presence and build lasting relationships with our customers through excellent customer service, engaging marketing initiatives, and community outreach programs. We believe that this commitment to our customers and to the quality of our products will ultimately propel us to a leading position in the market." }, { "Title": "Promote Sustainable Living and Well-being", "Description": "In line with our company\'s values, we aspire to promote sustainable living and well-being in Argentina through our products. We aim to do this by educating consumers about the benefits of using natural, eco-friendly soaps, and the positive impacts these choices can have on their health and the environment. By extending our reach in Argentina, we hope to influence more consumers to make environmentally conscious decisions, contributing to broader sustainability efforts in the country. Our commitment to this cause goes beyond our products; we also aspire to implement sustainable business practices in all aspects of our operations, further reinforcing our role as a socially responsible company." }, // Include the rest of the Aspirations here... ], "Results": [ { "Title": "Increased Market Share", "Description": "The launch of our new division in Argentina should ultimately result in an increased market share for our company. By offering high-quality, natural soap products that align with consumer trends, and by extending our distribution to underserved areas, we expect to attract a substantial customer base and drive sales. Our strong brand reputation, coupled with our commitment to sustainability and customer satisfaction, should set us apart from competitors and contribute to our market share growth. Regular monitoring and analysis of sales and market data will be essential to measure our progress and make necessary adjustments to our strategies." }, { "Title": "Positive Brand Perception", "Description": "A key result we aim to achieve is positive brand perception among Argentinian consumers. Through our high-quality products, sustainable practices, and commitment to customer satisfaction, we aim to build a strong, positive reputation for our brand in the Argentinian market. We believe that focusing on these areas will not only result in customer loyalty but also lead to positive word-of-mouth marketing, further strengthening our brand image. Regular customer surveys and social media analysis will help us gauge our brand perception and provide insights into areas for improvement." }] }',kanban:'{  "Review": [{"Title":"One", "Description":"d"}],  "Todo": [{"Title":"One", "Description":"d"}], "In progress": [{"Title":"Two", "Description":"mm"},{"Title":"Three","Description":"v"}] }',flow1:'{ "id": "userSignUpFlow", "layoutOptions": { "org.eclipse.elk.algorithm": "layered" },\n                "children": [\n                    { "id": "start", "labels": [{"text": "Start"}], "shape": "roundedRectangle", "width": 100, "height": 50 },\n                    { "id": "userInput", "labels": [{"text": "Collect User Data"}], "shape": "rectangle", "width": 150, "height": 60 }\n                ],\n                "edges": [\n                    { "id": "startToUserInput", "sources": ["start"], "targets": ["userInput"] }\n                ]}',flow:'{ "id": "userSignUpFlow", "layoutOptions": { "org.eclipse.elk.algorithm": "layered" }, "children": [ { "id": "start", "labels": [{"text": "Start"}], "shape": "roundedRectangle", "width": 100, "height": 50 }, { "id": "userInput", "labels": [{"text": "Collect User Data"}], "shape": "rectangle", "width": 150, "height": 60 }, { "id": "validateData", "labels": [{"text": "Validate Data"}], "shape": "rectangle", "width": 130, "height": 60 }, { "id": "createAccount", "labels": [{"text": "Create Account"}], "shape": "rectangle", "width": 140, "height": 60 }, { "id": "sendVerification", "labels": [{"text": "Send Verification"}], "shape": "rectangle", "width": 140, "height": 60 }, { "id": "branchOptions", "labels": [{"text": "Branch Options"}], "shape": "diamond", "width": 120, "height": 70 }, { "id": "option1", "labels": [{"text": "Option 1"}], "shape": "roundedRectangle", "width": 100, "height": 50 }, { "id": "option2", "labels": [{"text": "Option 2"}], "shape": "roundedRectangle", "width": 100, "height": 50 }, { "id": "end", "labels": [{"text": "End"}], "shape": "roundedRectangle", "width": 100, "height": 50 } ], "edges": [ { "id": "startToUserInput", "sources": ["start"], "targets": ["userInput"] }, { "id": "userInputToValidateData", "sources": ["userInput"], "targets": ["validateData"] }, { "id": "validateDataToCreateAccount", "sources": ["validateData"], "targets": ["createAccount"] }, { "id": "createAccountToSendVerification", "sources": ["createAccount"], "targets": ["sendVerification"] }, { "id": "sendVerificationToBranchOptions", "sources": ["sendVerification"], "targets": ["branchOptions"] }, { "id": "branchOptionsToOption1", "sources": ["branchOptions"], "targets": ["option1"] }, { "id": "branchOptionsToOption2", "sources": ["branchOptions"], "targets": ["option2"] }, { "id": "option1ToEnd", "sources": ["option1"], "targets": ["end"] }, { "id": "option2ToEnd", "sources": ["option2"], "targets": ["end"] } ] }',flow2:'{ "id": "CRM_Tool_Development_Plan", "Name": "CRM Tool Development Plan", "Type": "flowchart", "containerId": "flowchart", "layoutOptions": { "org.eclipse.elk.algorithm": "layered" }, "children": [ { "id": "Start", "labels": [{ "text": "Start" }], "shape": "startend", "width": 100, "height": 50 }, { "id": "Outline_Functionalities", "labels": [{ "text": "Outline Functionalities" }], "shape": "process", "width": 150, "height": 50 }, { "id": "Breakdown_Functionalities", "labels": [{ "text": "Breakdown Functionalities" }], "shape": "process", "width": 150, "height": 50 }, { "id": "Customer_Data_Management", "labels": [{ "text": "Customer Data Management" }], "shape": "process", "width": 200, "height": 50 }, { "id": "Sales_Tracking", "labels": [{ "text": "Sales Tracking" }], "shape": "process", "width": 150, "height": 50 }, { "id": "Service_Request_Handling", "labels": [{ "text": "Service Request Handling" }], "shape": "process", "width": 200, "height": 50 }, { "id": "Customer_Interaction_Optimization", "labels": [{ "text": "Customer Interaction Optimization" }], "shape": "process", "width": 250, "height": 50 }, { "id": "Data_Security_Plan", "labels": [{ "text": "Data Security Plan" }], "shape": "process", "width": 200, "height": 50 }, { "id": "Encryption_Methods", "labels": [{ "text": "Encryption Methods" }], "shape": "process", "width": 150, "height": 50 }, { "id": "Microservices_Architecture", "labels": [{ "text": "Microservices Architecture" }], "shape": "process", "width": 200, "height": 50 }, { "id": "Performance_Testing", "labels": [{ "text": "Performance Testing" }], "shape": "process", "width": 150, "height": 50 }, { "id": "Load_Stress_Compatibility_Testing", "labels": [{ "text": "Load, Stress, Compatibility Testing" }], "shape": "process", "width": 250, "height": 50 }, { "id": "API_Integrations", "labels": [{ "text": "API Integrations" }], "shape": "process", "width": 150, "height": 50 }, { "id": "API_Functionality_Testing", "labels": [{ "text": "API Functionality Testing" }], "shape": "process", "width": 200, "height": 50 }, { "id": "Integration_Testing", "labels": [{ "text": "Integration Testing" }], "shape": "process", "width": 150, "height": 50 }, { "id": "Project_Timeline", "labels": [{ "text": "Project Timeline" }], "shape": "process", "width": 150, "height": 50 }, { "id": "Development_Estimate", "labels": [{ "text": "Development Estimate" }], "shape": "process", "width": 200, "height": 50 }, { "id": "Testing_Plan", "labels": [{ "text": "Testing Plan" }], "shape": "process", "width": 150, "height": 50 }, { "id": "Working_Prototype", "labels": [{ "text": "Working Prototype" }], "shape": "process", "width": 150, "height": 50 }, { "id": "Finalization", "labels": [{ "text": "Finalization" }], "shape": "process", "width": 150, "height": 50 }, { "id": "Project_Check-ins", "labels": [{ "text": "Project Check-ins" }], "shape": "process", "width": 150, "height": 50 }, { "id": "User_Feedback_Focus_Group", "labels": [{ "text": "User Feedback Focus Group" }], "shape": "process", "width": 250, "height": 50 }, { "id": "End", "labels": [{ "text": "End" }], "shape": "startend", "width": 100, "height": 50 } ], "edges": [ { "id": "Start_Outline_Functionalities", "sources": ["Start"], "targets": ["Outline_Functionalities"] }, { "id": "Outline_Functionalities_Breakdown_Functionalities", "sources": ["Outline_Functionalities"], "targets": ["Breakdown_Functionalities"] }, { "id": "Breakdown_Functionalities_Customer_Data_Management", "sources": ["Breakdown_Functionalities"], "targets": ["Customer_Data_Management"] }, { "id": "Breakdown_Functionalities_Sales_Tracking", "sources": ["Breakdown_Functionalities"], "targets": ["Sales_Tracking"] }, { "id": "Breakdown_Functionalities_Service_Request_Handling", "sources": ["Breakdown_Functionalities"], "targets": ["Service_Request_Handling"] }, { "id": "Breakdown_Functionalities_Customer_Interaction_Optimization", "sources": ["Breakdown_Functionalities"], "targets": ["Customer_Interaction_Optimization"] }, { "id": "Customer_Interaction_Optimization_Data_Security_Plan", "sources": ["Customer_Interaction_Optimization"], "targets": ["Data_Security_Plan"] }, { "id": "Data_Security_Plan_Encryption_Methods", "sources": ["Data_Security_Plan"], "targets": ["Encryption_Methods"] }, { "id": "Data_Security_Plan_Microservices_Architecture", "sources": ["Data_Security_Plan"], "targets": ["Microservices_Architecture"] }, { "id": "Customer_Interaction_Optimization_Performance_Testing", "sources": ["Customer_Interaction_Optimization"], "targets": ["Performance_Testing"] }, { "id": "Performance_Testing_Load_Stress_Compatibility_Testing", "sources": ["Performance_Testing"], "targets": ["Load_Stress_Compatibility_Testing"] }, { "id": "Customer_Data_Management_API_Integrations", "sources": ["Customer_Data_Management"], "targets": ["API_Integrations"] }, { "id": "API_Integrations_API_Functionality_Testing", "sources": ["API_Integrations"], "targets": ["API_Functionality_Testing"] }, { "id": "API_Functionality_Testing_Integration_Testing", "sources": ["API_Functionality_Testing"], "targets": ["Integration_Testing"] }, { "id": "Integration_Testing_Project_Timeline", "sources": ["Integration_Testing"], "targets": ["Project_Timeline"] }, { "id": "Project_Timeline_Development_Estimate", "sources": ["Project_Timeline"], "targets": ["Development_Estimate"] }, { "id": "Project_Timeline_Testing_Plan", "sources": ["Project_Timeline"], "targets": ["Testing_Plan"] }, { "id": "Development_Estimate_Working_Prototype", "sources": ["Development_Estimate"], "targets": ["Working_Prototype"] }, { "id": "Testing_Plan_Working_Prototype", "sources": ["Testing_Plan"], "targets": ["Working_Prototype"] }, { "id": "Working_Prototype_Finalization", "sources": ["Working_Prototype"], "targets": ["Finalization"] }, { "id": "Finalization_Project_Check-ins", "sources": ["Finalization"], "targets": ["Project_Check-ins"] }, { "id": "Project_Check-ins_User_Feedback_Focus_Group", "sources": ["Project_Check-ins"], "targets": ["User_Feedback_Focus_Group"] }, { "id": "User_Feedback_Focus_Group_End", "sources": ["User_Feedback_Focus_Group"], "targets": ["End"] } ] }',mindmap1:'{ "id": "CRMToolPlan", "Name": "CRM Tool Plan", "Type": "SWOT", "containerId": "mindmap", "layoutOptions": { "org.eclipse.elk.algorithm": "mrtree", "org.eclipse.elk.direction": "RIGHT" }, "children": [ { "id": "Functionalities", "labels": [{ "text": "Functionalities" }], "shape": "ellipse", "width": 100, "height": 50 }, { "id": "DataManagement", "labels": [{ "text": "Customer Data Management" }], "shape": "ellipse", "width": 100, "height": 50 }, { "id": "SalesTracking", "labels": [{ "text": "Sales Tracking" }], "shape": "ellipse", "width": 100, "height": 50 }, { "id": "ServiceRequests", "labels": [{ "text": "Service Requests" }], "shape": "ellipse", "width": 100, "height": 50 }, { "id": "CustomerInteractions", "labels": [{ "text": "Customer Interactions" }], "shape": "ellipse", "width": 100, "height": 50 }, { "id": "Security", "labels": [{ "text": "Security" }], "shape": "ellipse", "width": 100, "height": 50 }, { "id": "DataEncryption", "labels": [{ "text": "Data Encryption" }], "shape": "ellipse", "width": 100, "height": 50 }, { "id": "MicroservicesArchitecture", "labels": [{ "text": "Microservices Architecture" }], "shape": "ellipse", "width": 100, "height": 50 }, { "id": "PerformanceTesting", "labels": [{ "text": "Performance Testing" }], "shape": "ellipse", "width": 100, "height": 50 }, { "id": "CompatibilityTesting", "labels": [{ "text": "Compatibility Testing" }], "shape": "ellipse", "width": 100, "height": 50 }, { "id": "APIIntegration", "labels": [{ "text": "API Integration" }], "shape": "ellipse", "width": 100, "height": 50 }, { "id": "APIFunctionalityTesting", "labels": [{ "text": "API Functionality Testing" }], "shape": "ellipse", "width": 100, "height": 50 }, { "id": "IntegrationTesting", "labels": [{ "text": "Integration Testing" }], "shape": "ellipse", "width": 100, "height": 50 }, { "id": "ProjectTimeline", "labels": [{ "text": "Project Timeline" }], "shape": "ellipse", "width": 100, "height": 50 }, { "id": "RegularMeetings", "labels": [{ "text": "Regular Meetings" }], "shape": "ellipse", "width": 100, "height": 50 }, { "id": "UserFeedback", "labels": [{ "text": "User Feedback" }], "shape": "ellipse", "width": 100, "height": 50 } ], "edges": [ { "id": "FuncToDataMgmt", "sources": ["Functionalities"], "targets": ["DataManagement"] }, { "id": "FuncToSalesTracking", "sources": ["Functionalities"], "targets": ["SalesTracking"] }, { "id": "FuncToServiceRequests", "sources": ["Functionalities"], "targets": ["ServiceRequests"] }, { "id": "FuncToCustomerInteractions", "sources": ["Functionalities"], "targets": ["CustomerInteractions"] }, { "id": "DataMgmtToDataEncryption", "sources": ["DataManagement"], "targets": ["DataEncryption"] }, { "id": "DataMgmtToMicroservices", "sources": ["DataManagement"], "targets": ["MicroservicesArchitecture"] }, { "id": "SalesTrackingToPerformanceTesting", "sources": ["SalesTracking"], "targets": ["PerformanceTesting"] }, { "id": "SalesTrackingToCompatibilityTesting", "sources": ["SalesTracking"], "targets": ["CompatibilityTesting"] }, { "id": "ServiceRequestsToSecurity", "sources": ["ServiceRequests"], "targets": ["Security"] }, { "id": "ServiceRequestsToAPIIntegration", "sources": ["ServiceRequests"], "targets": ["APIIntegration"] }, { "id": "APIIntegrationToAPIFunctionalityTesting", "sources": ["APIIntegration"], "targets": ["APIFunctionalityTesting"] }, { "id": "APIIntegrationToIntegrationTesting", "sources": ["APIIntegration"], "targets": ["IntegrationTesting"] }, { "id": "ProjectTimelineToRegularMeetings", "sources": ["ProjectTimeline"], "targets": ["RegularMeetings"] }, { "id": "RegularMeetingsToUserFeedback", "sources": ["RegularMeetings"], "targets": ["UserFeedback"] } ] }',bmc:'{ "Customer Segments": [ { "Title": "Hobbyists", "Description": "Individuals interested in creating miniatures for their hobbies", "appendShapes": false }, { "Title": "Gamers", "Description": "People who play tabletop games and need miniatures for their game pieces", "appendShapes": false }, { "Title": "Designers", "Description": "Professionals who need prototypes or models for their designs", "appendShapes": false } ], "Value Propositions": [ { "Title": "Customization", "Description": "Offering customers the ability to create unique miniatures with different materials and colors", "appendShapes": false }, { "Title": "Quality", "Description": "Providing high-quality prints with attention to detail", "appendShapes": false }, { "Title": "Speed", "Description": "Fast turnaround times for orders", "appendShapes": false } ], "Channels": [ { "Title": "Online Store", "Description": "A website where customers can place orders and view available options", "appendShapes": false }, { "Title": "Social Media", "Description": "Using platforms like Instagram and Facebook to showcase products and reach potential customers", "appendShapes": false }, { "Title": "Local Events", "Description": "Attending conventions and fairs to showcase products and network with potential customers", "appendShapes": false } ], "Customer Relationships": [ { "Title": "Personal Assistance", "Description": "Providing one-on-one assistance to customers with their printing needs", "appendShapes": false }, { "Title": "Communication", "Description": "Maintaining open lines of communication with customers throughout the printing process", "appendShapes": false }, { "Title": "Feedback", "Description": "Soliciting feedback from customers to improve the quality of service", "appendShapes": false } ], "Revenue Streams": [ { "Title": "Product Sales", "Description": "Revenue generated from selling 3D printed miniatures", "appendShapes": false }, { "Title": "Service Fees", "Description": "Charging customers for 3D printing services", "appendShapes": false }, { "Title": "Shipping Fees", "Description": "Charging customers for shipping and handling", "appendShapes": false } ], "Key Resources": [ { "Title": "3D Printers", "Description": "The primary tool used to create the miniatures", "appendShapes": false }, { "Title": "Materials", "Description": "The raw materials used to create the miniatures", "appendShapes": false }, { "Title": "Software", "Description": "The software used to design and prepare the files for printing", "appendShapes": false } ], "Key Activities": [ { "Title": "Printing", "Description": "The primary activity of the business - creating 3D printed miniatures", "appendShapes": false }, { "Title": "Design", "Description": "Assisting customers with designing their miniatures", "appendShapes": false }, { "Title": "Maintenance", "Description": "Regularly maintaining and repairing the 3D printers", "appendShapes": false } ], "Key Partnerships": [ { "Title": "Suppliers", "Description": "Partnering with suppliers to obtain high-quality materials at a reasonable cost", "appendShapes": false }, { "Title": "Shipping Providers", "Description": "Partnering with shipping providers to ensure timely and reliable info_customer_cart of orders", "appendShapes": false }, { "Title": "Local Businesses", "Description": "Partnering with local businesses to promote each other\'s services", "appendShapes": false } ], "Cost Structure": [ { "Title": "Electricity Cost", "Description": "The cost of electricity required to power the 3D printers", "appendShapes": false }, { "Title": "Material Cost", "Description": "The cost of raw materials used to create the miniatures", "appendShapes": false }, { "Title": "Maintenance Cost", "Description": "The cost of maintaining and repairing the 3D printers", "appendShapes": false } ] } '}[t.id]),diagramName:"Diagram name",mainContainerId:t.containerId,appendShapes:t.appendShapes,type:t.type})},t.prototype.renderContext=function(t,e){return Object(W.c)(this,void 0,void 0,(function(){var n,i,a,o,r,s,c,l,u,d,p,h=this;return Object(W.f)(this,(function(g){switch(g.label){case 0:return"elk"===t.type?[2,this.renderElkData(t,e)]:(n=t.mainContainerId,a=t.appendShapes,o={},r={},Object.keys(t.content).forEach((function(a){var s,c=t.content[a],l=[];if(n){if(i=Object.keys(e.shapes).map((function(t){return e.shapes[t]})).find((function(t){return e.getIdentifier(t.id)===n})),Object(J.isEmpty)(i.containerRegions||{}))i.isContainer&&!Object(J.isEmpty)(i.children)&&(l=Object.keys(i.children));else if(s=i.getContainerRegionByName(a)){var u=c.map((function(t,e){var n=t.Title;return{id:e+t.Title,data:{label:n,description:t.Description},width:100,height:100,position:{x:200,y:100}}})).filter((function(t){return t}));r[s.id]={children:u}}}else l=Object.keys(e.shapes);var d=l.map((function(t){return e.shapes[t]})).find((function(t){return e.getIdentifier(t.id)===a}));if(d){u=c.map((function(t,e){var n=t.Title;return{id:e+t.Title,data:{label:n,description:t.Description},width:100,height:100,position:{x:200,y:100}}}));o[d.id]={children:u}}})),s=[],c=[],Object(J.isEmpty)(o)?i&&!Object(J.isEmpty)(r)&&(a?(p=e.getStyleRefShape(i.id))&&c.push(p.id):(d=e.getChildShapesInLayoutArea(i.id),c.push.apply(c,Object(W.j)(d.map((function(t){return t.id}))))),u=Object.keys(r).map((function(t){return Object(W.c)(h,void 0,void 0,(function(){return Object(W.f)(this,(function(e){switch(e.label){case 0:return[4,this.elkService.insertIntoRegion(i.id,t,r[t])];case 1:return[2,e.sent()]}}))}))}))):u=Object.keys(o).map((function(t){return Object(W.c)(h,void 0,void 0,(function(){var n,i;return Object(W.f)(this,(function(r){switch(r.label){case 0:return a?(i=e.getStyleRefShape(t))&&c.push(i.id):(n=e.getChildShapesInLayoutArea(t),c.push.apply(c,Object(W.j)(n.map((function(t){return t.id}))))),[4,this.elkService.inserIntoContainer(t,o[t])];case 1:return[2,r.sent()]}}))}))})),[4,Promise.all(u)]);case 1:return l=g.sent(),0===(s=[].concat.apply([],Object(W.j)(l.map((function(t){return t.shapes}))))).length?[2,Promise.resolve()]:[2,this.generateShapes(s,c,t,e)]}}))}))},t.prototype.renderContextInTable=function(t,e){return Object(W.c)(this,void 0,void 0,(function(){var n,i,a,o,r,s,c,l,u=this;return Object(W.f)(this,(function(d){switch(d.label){case 0:return"elk"===t.type?[2,this.renderElkData(t,e)]:(n=t.mainContainerId,a=t.appendShapes,o={},Object.keys(t.content).forEach((function(a){var r,s=t.content[a];if(n&&(i=Object.keys(e.shapes).map((function(t){return e.shapes[t]})).find((function(t){return e.getIdentifier(t.id)===n})),!Object(J.isEmpty)(i.containerRegions||{})&&(r=e.getRegionIdByIdentifier(i.id,a)))){var c=i.containerRegions[r],l=s.map((function(t,e){var n=t.Title;return{id:e+t.Title,data:{label:n,description:t.Description},width:100,height:100,position:{x:200,y:100}}})).filter((function(t){return t}));o[c.id]={children:l}}})),r=[],s=[],i&&!Object(J.isEmpty)(o)&&(l=Object.keys(o).map((function(t){return Object(W.c)(u,void 0,void 0,(function(){var n,r;return Object(W.f)(this,(function(c){switch(c.label){case 0:return a?(r=e.getStyleRefShapeInRegion(i.id,t))&&s.push(r.id):(n=e.getLayoutingShapesInRegion(i.id,t),s.push.apply(s,Object(W.j)(n.map((function(t){return t.id}))))),[4,this.elkService.insertIntoRegion(i.id,t,o[t])];case 1:return[2,c.sent()]}}))}))}))),[4,Promise.all(l)]);case 1:return c=d.sent(),0===(r=[].concat.apply([],Object(W.j)(c.map((function(t){return t.shapes}))))).length?[2,Promise.resolve()]:[2,this.generateShapes(r,s,t,e)]}}))}))},t.prototype.renderElkData=function(t,e){return Object(W.c)(this,void 0,void 0,(function(){var n,a,o,r,s,c,l,u,d=this;return Object(W.f)(this,(function(p){switch(p.label){case 0:return n=t.bounds||{x:0,y:0,width:1e3,height:100},a=i.Ab.from(n),o=t.content,r=o.layoutOptions,s=function(t,e){for(var n in t)if(!(n in e)||t[n]!==e[n])return!1;return!0},c=Object.values(Ei.b).find((function(t){return"elk"===t.layoutingData.source&&s(r,t.layoutingData.options)})),[4,this.elkService.convertToCreately(a,o)];case 1:return l=p.sent(),u={shapeIds:Object.values(l).map((function(t){return t.data.id})),selected:!0,copyEdata:!1,shapesToCopy:l,dataDefs:{}},[2,this.commands.dispatch(D.a.generateShapes,{shapesData:u,shapeIdsToRemove:[],diagramName:t.diagramName||e.name}).pipe(Object(lt.a)(),Object(T.a)((function(t){var e=t.resultData[2].shapesToBeClone.map((function(t){return t.id}));return d.commands.dispatch(Ht.a.layoutShapesAndFitToScreen,{bounds:n,shapeIds:e,layoutingId:c.id})})),Object(lt.a)(),Object(T.a)((function(t){return d.commands.dispatch(D.a.changeContainerDataAndUpdateBounds,t.data[1])})),Object(lt.a)()).toPromise()]}}))}))},t.prototype.generateShapes=function(t,e,n,i){var a=this,o={shapeIds:t.map((function(t){return t.data.id})),selected:!0,copyEdata:!1,shapesToCopy:t,dataDefs:{}};return this.commands.dispatch(D.a.generateShapes,{shapesData:o,shapeIdsToRemove:e,diagramName:n.diagramName||i.name}).pipe(Object(lt.a)(),Object(T.a)((function(t){return a.commands.dispatch(D.a.changeContainerDataAndUpdateBounds,t.data[6])})),Object(lt.a)()).toPromise()},t.prototype.updateContextStateMap=function(t){var e=this.state.get("TemplateContextMap")||this.state.set("TemplateContextMap",{})||{};e[t.id]=t,this.state.set("TemplateContextMap",e)},t.\u0275fac=function(e){return new(e||t)(o.qc(i.Nb),o.qc(i.B),o.qc(Ii.a),o.qc(b.a),o.qc(Di.a),o.qc(ht.a))},t.\u0275prov=o.cc({token:t,factory:t.\u0275fac}),t}(),Ai=n("g8+x"),Li=n("8upt"),Bi=n("gf/W"),Ri=n("6z+W"),Ni=n("2MV1"),Hi=function(t){function e(e,n,i,a,o,r,s){var c=t.call(this,e)||this;return c.ll=n,c.commandService=i,c.shapeBoundsLocator=a,c.viewportSvc=o,c.dToVCordinate=r,c.vToDcoordinate=s,c.prevIds=[],c.maxWidthHeight=8e3,c.minNumberOfShapesToCache=1,c.addSource=new le.a,c.removeSource=new le.a,c.changeSource=new le.a,c.cacheObervable=new O.a(!0),c}return Object(W.e)(e,t),Object.defineProperty(e.prototype,"indicators",{get:function(){return[this.cachedImage]},enumerable:!1,configurable:!0}),e.prototype.initialize=function(){var t=this;this.subs.push(this.state.changes("Selected").pipe(Object(et.a)(J.isEqual),Object(T.a)((function(){return t.cacheObervable})),Object(T.a)((function(){return t.state.changes("SelectionInteraction").pipe(Object(E.a)((function(t){return!!t.bounds})),Object(j.a)(1),Object(T.a)((function(){return t.createSelectionCache(t.state.get("Selected"))})),Object(T.a)((function(e){var n=e.actions,i=e.ids;return t.state.changes("SelectionInteractionState").pipe(Object(I.a)((function(t){return{state:t,actions:n,ids:i}})))})),Object(I.a)((function(e){var n=e.state,i=e.actions,a=e.ids;t.updateCacheImagePos();var o=t.state.get("SelectionInteraction");if(t.cachedImage&&"scale"===o.type&&!i.includes("scale"))return t.cachedImage.visible=!1,t.changeSource.next(t.cachedImage),void t.showActualShapes();"started"===n&&t.cachedImage&&a.length>=t.minNumberOfShapesToCache?(t.hideActualShapes(t.prevIds),t.cachedImage.visible=!0,t.changeSource.next(t.cachedImage)):t.cachedImage&&(t.cachedImage.visible=!1,t.changeSource.next(t.cachedImage),t.showActualShapes()),t.state.set("SelectionInteraction",{})})))}))).subscribe(),this.updateCacheImage().subscribe(),this.multipleShapesAdded().subscribe())},e.prototype.destroy=function(){t.prototype.destroy.call(this)},e.prototype.createAddSource=function(){return this.addSource},e.prototype.createRemoveSource=function(){return this.removeSource},e.prototype.createChangeSource=function(){return this.changeSource},e.prototype.createSelectionCache=function(t){var e=this;return this.ll.forCurrent(!1).getDiagramOnce().pipe(Object(I.a)((function(n){var i,a=["move","scale","rotate"],o=!1;if(1===t.length){var r=n.shapes[t[0]];r&&r.isContainer&&(a=["move"],i=r.angle,o=!0)}var s=n.getBounds(t),c=e.dToVCordinate.bounds(s),l=new Set(t),u=new Set,d=new Set,p=e.shapeBoundsLocator.searchShapes(s.left,s.right,s.top,s.bottom).map((function(t){return"connector"===t.type?u.add(t.id):d.add(t.id),t.id}));o?l=new Set(p):(d.forEach((function(t){l.has(t)&&n.getNestedChildrenIds(t).forEach((function(t){return l.add(t)}))})),u.forEach((function(t){var e,i,a=n.shapes[t];if(null==a?void 0:a.isConnector()){var o=null===(e=a.getFromEndpoint(n))||void 0===e?void 0:e.shape,r=null===(i=a.getToEndpoint(n))||void 0===i?void 0:i.shape;o&&l.has(o.id)&&r&&l.has(r.id)?l.add(t):l.delete(t)}})));var h=Array.from(l);return e.drawSelectionCache(h,s,c,i),{actions:a,ids:h}})))},e.prototype.drawSelectionCache=function(t,e,n,a){if(this.cachedImage&&(this.removeSource.next(this.cachedImage),this.cachedImage=void 0),t.length>this.minNumberOfShapesToCache&&(this.prevIds=t,!this.cachedImage)){var o=t.length>200,r=Math.min(this.maxWidthHeight/Math.max(e.width,e.height),1),s=t,c=this.state.get("ShapeViews"),l=this.state.get("DiagramCanvas");l.removeAllChildren(),c.forEach((function(t){var e;s.includes(t.name)&&(t.visible=!0,o&&(null===(e=t.children)||void 0===e||e.forEach((function(t){t instanceof Jt.a&&(t.alpha=0)}))),l.addChild(t))}));try{l.cache(e.x,e.y,e.width,e.height,r);var u=l.bitmapCache.getCacheDataURL();l.uncache(),this.cachedImage=new Z.Bitmap(u),this.cachedImage.mouseEnabled=!1,this.cachedImage.containerAngle=a,this.cachedImage.quality=r,this.cachedImage.regX=e.width/2*r,this.cachedImage.regY=e.height/2*r,this.cachedImage.x=n.x+n.width/2,this.cachedImage.y=n.y+n.height/2,this.cachedImage.scaleX=n.width/e.width/r,this.cachedImage.scaleY=n.height/e.height/r,this.cachedImage.setBounds(e.x,e.y,e.width,e.height),this.cachedImage.visible=!1,this.addSource.next(this.cachedImage)}catch(p){i.hb.error("Failed to cache the selection",p)}finally{var d=this.state.get("ActiveShapes");l.removeAllChildren(),c.forEach((function(t){var e;(s.includes(t.name)||d.includes(t.name))&&(t.visible=!0,o&&(null===(e=t.children)||void 0===e||e.forEach((function(t){t instanceof Jt.a&&(t.alpha=1)}))),l.addChild(t))})),l.update()}}},e.prototype.updateCacheImage=function(){var t=this;return this.state.changes("SelectionInteraction").pipe(Object(E.a)((function(e){return!!e.bounds&&"started"===t.state.get("SelectionInteractionState")})),Object(M.a)((function(e){return t.updateCacheImagePos()})),Object(T.a)((function(e){return t.state.changes("SelectionInteractionState").pipe(Object(E.a)((function(t){return"stopped"===t})),Object(Mt.a)(e))})),Object(T.a)((function(e){return t.ll.forCurrent(!1).getDiagramChanges().pipe(Object(at.a)(100),Object(Mt.a)(e))})),Object(M.a)((function(e){"move"!==e.type&&t.cacheObervable.next(!0)})))},e.prototype.updateCacheImagePos=function(){var t=this.state.get("SelectionInteraction"),e=t.bounds,n=t.rotation;if(e&&void 0!==n&&this.cachedImage){var i=this.cachedImage.getBounds(),a=this.cachedImage.quality;this.cachedImage.regX=i.width/2*a,this.cachedImage.regY=i.height/2*a,Object(J.isEmpty)(e)||(this.cachedImage.x=e.x+e.width/2,this.cachedImage.y=e.y+e.height/2,this.cachedImage.scaleX=e.width/i.width/a,this.cachedImage.scaleY=e.height/i.height/a),void 0!==n&&(void 0!==this.cachedImage.containerAngle?this.cachedImage.rotation=n-this.cachedImage.containerAngle:this.cachedImage.rotation=n),this.changeSource.next(this.cachedImage)}},e.prototype.multipleShapesAdded=function(){var t=this;return this.ll.forCurrentObserver(!1).pipe(Object(T.a)((function(t){return t.getDiagramChanges()})),Object(E.a)((function(t){return t.added.length>1})),Object(at.a)(100),Object(M.a)((function(){return t.cacheObervable.next(!0)})))},e.prototype.showActualShapes=function(){var t=this.state.get("ShapeViews"),e=this.state.get("DiagramCanvas");this.prevIds.forEach((function(e){var n=t.find((function(t){return t.name===e}));n&&(n.visible=!0)})),e.update()},e.prototype.hideActualShapes=function(t){var e=this.state.get("ShapeViews"),n=this.state.get("DiagramCanvas");t.forEach((function(t){var n=e.find((function(e){return e.name===t}));n&&(n.visible=!1)})),n.update()},e.prototype.removeIndicator=function(t){var e=this.cachedImage;this.removeSource.next(e),this.cachedImage=null},e.\u0275fac=function(t){return new(t||e)(o.qc(i.Nb),o.qc(b.a),o.qc(i.B),o.qc($t.a),o.qc(m.a),o.qc(f.a),o.qc(ht.a))},e.\u0275prov=o.cc({token:e,factory:e.\u0275fac}),e=Object(W.d)([Object(ye.a)(),Object(W.g)("design:paramtypes",[i.Nb,b.a,i.B,$t.a,m.a,f.a,ht.a])],e)}(ye.b);Object.defineProperty(Hi,"name",{value:"SelectionPlaceholderHandler"});var Fi=function(t){function e(e,n,i){void 0===n&&(n=5),void 0===i&&(i="active");var a=t.call(this)||this;return a.subs=[],a.isHovered=e,a.amount=n,a.votingProgress=i,a.prepare(),a}return Object(W.e)(e,t),e.prototype.destroy=function(){for(;this.subs.length;)this.subs.pop().unsubscribe()},e.prototype.getIndicator=function(){var t,e=new Z.Container,n=[0,0,(this.amount>0?22:19)/2],i=(t=(new Z.Graphics).beginFill(this.amount>0?"#08436B":"#D9D9D9")).drawCircle.apply(t,Object(W.j)(n)),a=new Z.Shape(i);if(a.name="circle",a.setBounds.apply(a,Object(W.j)(n,[this.amount>0?22:19])),a.x=0,a.y=0,e.addChild(a),this.amount>0){var o=new Z.Text(this.amount.toString(),"12px Inter","#ffffff"),r=o.getBounds()||{},s=r.width,c=r.height;o.x=-s/2,o.y=-c/2+1,e.addChild(o),e.setChildIndex(o,e.numChildren-1)}return e.setBounds(0,0,0,0),e.cursor="pointer",e},e.prototype.getHoveredIndicator=function(){var t,e=new Z.Container,n=(t=(new Z.Graphics).beginFill("#08436B")).drawRoundRect.apply(t,Object(W.j)([0,0,39,22,8])),i=new Z.Shape(n);i.setBounds(0,0,44,22),e.addChild(i),e.x=-19.5,e.y=-11;var a=new Z.Container,o=new Z.Shape((new Z.Graphics).beginFill("rgb(255, 255, 255, 0.01)").drawRoundRect(0,0,20,22,8)),r=new Z.Container,s=new Z.Shape((new Z.Graphics).beginFill("rgb(255, 255, 255, 0.01)").drawRoundRect(20,0,20,22,8)),c=new Z.Shape((new Z.Graphics).setStrokeStyle(1.5,"round").beginStroke("#ffffff").moveTo(34,11).lineTo(27,11).moveTo(30.5,7.5).lineTo(30.5,14.5).endStroke()),l=new Z.Shape((new Z.Graphics).setStrokeStyle(1.5,"round").beginStroke("#ffffff").moveTo(5,11).lineTo(13,11).endStroke());a.addChild(l),a.setChildIndex(l,a.numChildren-1),r.addChild(c),a.setChildIndex(l,a.numChildren-1),s.cursor="pointer",r.cursor="pointer",o.cursor="pointer",a.cursor="pointer",o.name="minis",s.name="plus",this.minus=o,this.plus=s;var u=new Z.Text(this.amount.toString(),"12px Inter","#ffffff"),d=u.getBounds()||{},p=d.width,h=d.height;u.x=22-p+1,u.y=11-h/2+1;var g=Object(P.a)(r,"click").pipe().subscribe((function(t){return s.dispatchEvent(t)})),f=Object(P.a)(a,"click").pipe().subscribe((function(t){return o.dispatchEvent(t)}));return this.subs.push(g,f),e.addChild(o,a,s,r,u),e.setChildIndex(u,e.numChildren-1),e},e.prototype.prepare=function(){var t=this.isHovered&&"active"===this.votingProgress?this.getHoveredIndicator():this.getIndicator();return this.addChild(t),t},e}(Z.Container),Gi=n("uO8R"),qi=function(t){function e(e,n,i,a,o){var r=t.call(this,i)||this;return r.viewport=e,r.ll=n,r.state=i,r.shapeVotingService=a,r.dToV=o,r._indicators=[],r.hoverId="",r.indicatorSubs=[],r.addSource=new le.a,r.removeSource=new le.a,r.changeSource=new le.a,r}return Object(W.e)(e,t),Object.defineProperty(e.prototype,"indicators",{get:function(){return this._indicators},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"visible",{set:function(t){this.indicators.forEach((function(e){return e.visible=t}))},enumerable:!1,configurable:!0}),e.prototype.initialize=function(){this.shapeVotingService.initialize(),this.subs.push(this.listenToViewportChanges().subscribe())},e.prototype.createAddSource=function(){return this.addSource},e.prototype.createRemoveSource=function(){return this.removeSource},e.prototype.createChangeSource=function(){return this.changeSource},e.prototype.destroy=function(){for(;this.subs.length;)this.subs.pop().unsubscribe();this.removeIndicatorSubs()},e.prototype.removeIndicatorSubs=function(){for(;this.indicatorSubs.length;)this.indicatorSubs.pop().unsubscribe();this._indicators.forEach((function(t){for(;t.subs.length;)t.subs.pop().unsubscribe()}))},e.prototype.listenToViewportChanges=function(){var t=this;return Object(x.a)(this.state.changes("DiagramPan"),this.state.changes("DiagramZoomLevel"),this.state.changes("ShapeVoting"),this.state.changes("ActiveShapes")).pipe(Object(M.a)((function(){t.renderIndicators()})))},e.prototype.renderIndicators=function(){var t,e=this,n=null===(t=this.state.get("ShapeVoting"))||void 0===t?void 0:t.shapeIds;n?this.ll.forCurrentObserver(!1).pipe(Object(T.a)((function(t){return t.getDiagramOnce()})),Object(M.a)((function(t){e.removeIndicators();var i=e.state.get("ShapeVoting").progress;if("active"===i||"results"===i){var a=[];"results"===i&&(a=e.shapeVotingService.getVotingResult()),n.map((function(e){return t.shapes[e]})).forEach((function(t){var n="active"===i?e.state.get("ShapeVoting").votedShapes[t.id]||0:a.find((function(e){return e.shapeId===t.id})).votes||0,o=new Fi(e.hoverId===t.id,n,i);if(o.x=e.dToV.x(t.x+t.bounds.width),o.y=e.dToV.y(t.y+t.bounds.height),e._indicators.push(o),e.addSource.next(o),o.minus&&e.indicatorSubs.push(Object(P.a)(o.minus,"click").pipe(Object(M.a)((function(){return e.handleDecrement(t.id)}))).subscribe()),o.plus)e.indicatorSubs.push(Object(P.a)(o.plus,"click").pipe(Object(M.a)((function(){return e.handleIncrement(t.id)}))).subscribe());else{var r=Object(P.a)(o,"click").pipe(Object(M.a)((function(){return e.handleClick(t.id)}))).subscribe();e.indicatorSubs.push(r)}var s=Object(x.a)([Object(P.a)(o,"rollover").pipe(Object(Fe.a)((function(){return!!e.hoverId})),Object(Mt.a)({id:t.id,hover:!0})),Object(P.a)(o,"rollout").pipe(Object(Mt.a)({id:t.id,hover:!1}))]).pipe(Object(Ge.a)()).pipe(Object(M.a)((function(t){return e.handleHover(t)}))).subscribe();e.indicatorSubs.push(s)})),e.visible=!0}}))).subscribe():this.removeIndicators()},e.prototype.removeIndicators=function(t){var e=this;void 0===t&&(t=this._indicators.length),this.removeIndicatorSubs();var n=this._indicators.slice(0,t);this._indicators=this._indicators.slice(t),n.forEach((function(t){return e.removeSource.next(t)}))},e.prototype.handleClick=function(t){this.handleIncrement(t)},e.prototype.handleIncrement=function(t){this.shapeVotingService.incrementShapeVote(t)},e.prototype.handleDecrement=function(t){this.shapeVotingService.decrementShapeVote(t)},e.prototype.handleHover=function(t){var e=t.id,n=t.hover;this.hoverId=n?e:"",this.renderIndicators()},e.\u0275fac=function(t){return new(t||e)(o.qc(m.a),o.qc(b.a),o.qc(i.Nb),o.qc(Gi.a),o.qc(f.a))},e.\u0275prov=o.cc({token:e,factory:e.\u0275fac}),e=Object(W.d)([Object(ye.a)(),Object(W.g)("design:paramtypes",[m.a,b.a,i.Nb,Gi.a,f.a])],e)}(ye.b),Vi=n("eWm9"),Ui=n("a7qF"),zi=n("J+x+"),Yi=function(t){function e(e,n,i,a){var o=t.call(this)||this;o.shape=n,o.gp=i,o.dv=a,o.radius=14,o.tooltip="",o.iconSize=29,o.displacement=70,o.subs=[],o.alpha=1;var r=o.positionGluePoint(n,i).angle;return"collapsed"===i.connectionState?(o.tooltip="Expand",o.drawForCollapsed(e,n.id,i.id,r)):(o.tooltip="Collapse",o.rotation=r-180,o.drawForExpanded()),o}return Object(W.e)(e,t),e.prototype.getCursor=function(t){return{cursor:"pointer",tail:null,type:"css"}},e.prototype.setPosition=function(t){this.x=t.x,this.y=t.y},e.prototype.destroy=function(){for(;this.subs.length>0;)this.subs.pop().unsubscribe()},e.prototype.drawForExpanded=function(){var t=new Image;t.src="data:image/svg+xml;base64,"+btoa(this.getSvgIcon()),this.icon=new Z.Bitmap(t),this.icon.regX=this.iconSize/2,this.icon.regY=this.iconSize/2,this.addChild(this.icon)},e.prototype.drawForCollapsed=function(t,e,n,i){var a=new Z.Shape;this.circle=a;var o=t.getAllShapesStartedFromGp(e,n).shapeIds,r=new Z.Text(""+o.length,"12px Inter","#ffffff");this.text=r,this.text.text=""+o.length;var s=r.getBounds();r.x=r.x-s.width/2,r.y=r.y-s.height/2,a.graphics.clear(),a.graphics.beginFill(Ue.a.backgroundColor),a.graphics.drawCircle(0,0,this.radius),a.graphics.endFill(),a.graphics.setStrokeStyle(3).beginStroke(Ue.a.backgroundColor);var c=this.getPoint({x:0,y:0},i,this.radius);a.graphics.moveTo(c.x,c.y);var l=this.getPoint({x:0,y:0},i,this.dv.width(this.displacement));a.graphics.lineTo(l.x,l.y),a.graphics.endStroke(),this.addChild(this.circle),this.addChild(this.text)},e.prototype.getPoint=function(t,e,n){var i=(e+180)*(Math.PI/180);return{x:t.x+n*Math.cos(i),y:t.y+n*Math.sin(i)}},e.prototype.positionGluePoint=function(t,e){var n=jt.a.getPosition(e,t.defaultBounds,t.transform),i=t.getGluepointsCentre(),a={x:this.dv.x(i.x),y:this.dv.y(i.y)},o={x:this.dv.x(n.x),y:this.dv.y(n.y)},r=this.findPointC(a,o,this.dv.width(this.displacement));return this.setPosition(r),{angle:this.getAngle(a,o),a:a,b:o,c:r}},e.prototype.getAngle=function(t,e){var n=e.x-t.x,i=e.y-t.y,a=Math.atan2(i,n)*(180/Math.PI);return a=(a+360)%360},e.prototype.findPointC=function(t,e,n){var i=n/Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2));return{x:e.x+i*(e.x-t.x),y:e.y+i*(e.y-t.y)}},e.prototype.getSvgIcon=function(t){return void 0===t&&(t="#0C5E96"),'<svg style="transform: rotate(90deg)" width="'+this.iconSize+'" height="'+this.iconSize+'" viewBox="0 0 29 29" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path fill="#fff" d="M16 1.143c7.574 0 13.714 6.14 13.714 13.714s-6.14 13.714-13.714 13.714c-7.574 0-13.714-6.14-13.714-13.714s6.14-13.714 13.714-13.714z"></path>\n            <path fill="none" stroke="#0c5e96" stroke-linejoin="miter" stroke-linecap="butt" stroke-miterlimit="4" stroke-width="1.8286" d="M16 2.057c7.069 0 12.8 5.731 12.8 12.8s-5.731 12.8-12.8 12.8c-7.069 0-12.8-5.731-12.8-12.8s5.731-12.8 12.8-12.8z"></path>\n            <path fill="#0c5e96" d="M9.018 16.532c0.3 0.1 0.6 0 0.8-0.2l5.9-5.9 5.9 5.9c0.2 0.2 0.4 0.3 0.7 0.2 0.2-0.1 0.4-0.3 0.5-0.5 0.1-0.3 0-0.5-0.2-0.7l-6.4-6.4c-0.1-0.1-0.3-0.2-0.5-0.2s-0.4 0.1-0.5 0.2l-6.4 6.4c-0.1 0.1-0.2 0.3-0.2 0.5 0 0.3 0.2 0.6 0.4 0.7z"></path>\n            <path fill="#0c5e96" d="M9.018 20.532c0.3 0.1 0.6 0 0.8-0.2l5.9-5.9 5.9 5.9c0.2 0.2 0.4 0.3 0.7 0.2 0.2-0.1 0.4-0.3 0.5-0.5 0.1-0.3 0-0.5-0.2-0.7l-6.4-6.4c-0.1-0.1-0.3-0.2-0.5-0.2s-0.4 0.1-0.5 0.2l-6.4 6.4c-0.1 0.1-0.2 0.3-0.2 0.5 0 0.3 0.2 0.6 0.4 0.7z"></path>\n        </svg>\n        '},e}(Z.Container),Xi=function(t){function e(e,n,i){var a=t.call(this)||this;a.shape=n,a.dv=i,a.radius=14,a.tooltip="",a.iconSize=29,a.displacement=70,a.subs=[],a.alpha=1;var o=a.position(n).angle;return a.tooltip="Load More",a.drawForCollapsed(e,n.id,o),a}return Object(W.e)(e,t),e.prototype.getCursor=function(t){return{cursor:"pointer",tail:null,type:"css"}},e.prototype.setPosition=function(t){this.x=t.x,this.y=t.y},e.prototype.destroy=function(){for(;this.subs.length>0;)this.subs.pop().unsubscribe()},e.prototype.drawForCollapsed=function(t,e,n){var i=new Z.Shape;this.circle=i;var a=new Z.Text("","14px Inter","#ffffff");this.text=a,this.text.text="...";var o=a.getBounds();a.x=a.x-o.width/2,a.y=a.y-o.height/2,i.graphics.clear(),i.graphics.beginFill(Ue.a.backgroundColor),i.graphics.drawCircle(0,0,this.radius),i.graphics.endFill(),i.graphics.setStrokeStyle(3).beginStroke(Ue.a.backgroundColor);var r=this.getPoint({x:0,y:0},n,this.radius);i.graphics.moveTo(r.x,r.y);var s=this.getPoint({x:0,y:0},n,this.dv.width(this.displacement));i.graphics.lineTo(s.x,s.y),i.graphics.endStroke(),this.addChild(this.circle),this.addChild(this.text)},e.prototype.getPoint=function(t,e,n){var i=(e+180)*(Math.PI/180);return{x:t.x+n*Math.cos(i),y:t.y+n*Math.sin(i)}},e.prototype.position=function(t){var e=t.bounds,n={x:e.x+e.width/2,y:e.y+e.height},i=t.getGluepointsCentre(),a={x:this.dv.x(i.x),y:this.dv.y(i.y)},o={x:this.dv.x(n.x),y:this.dv.y(n.y)},r=this.findPointC(a,o,this.dv.width(this.displacement));return this.setPosition(r),{angle:this.getAngle(a,o),a:a,b:o,c:r}},e.prototype.getAngle=function(t,e){var n=e.x-t.x,i=e.y-t.y,a=Math.atan2(i,n)*(180/Math.PI);return a=(a+360)%360},e.prototype.findPointC=function(t,e,n){var i=n/Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2));return{x:e.x+i*(e.x-t.x),y:e.y+i*(e.y-t.y)}},e}(Z.Container),Ki=n("B5wR"),Wi=n("lWYQ"),Zi=function(t){function e(e,n,i,a,o,r,s){var c=t.call(this,e,i)||this;return c.state=e,c.viewport=n,c.viewToDiagram=i,c.dv=a,c.ll=o,c.commandService=r,c.smartSetSvc=s,c.indicatorsMap={},c.defIds=["creately.orgchart","creately.mindmap","creately.concept-map","creately.people"],c.addSource=new le.a,c.removeSource=new le.a,c.changeSource=new le.a,c}return Object(W.e)(e,t),Object.defineProperty(e.prototype,"indicators",{get:function(){return Object.values(this.indicatorsMap)},enumerable:!1,configurable:!0}),e.prototype.initialize=function(){var t=this,e=this.getIndicatorChanges().pipe(Object(T.a)((function(e){if(t.indicatorsMap={},e){var n=[Object($.a)()];return t.state.set("GlobalTooltip",{show:!1}),e.forEach((function(e){var i=e.diagram,a=e.shape,o=e.gpModel,r=new Yi(i,a,o,t.dv);t.indicatorsMap[a.id+"-"+o.id]=r,t.addSource.next(r);var s=Object(P.a)(r,"click").pipe(Object(M.a)((function(e){return t.indicatorClicked(a.id,r)})));n.push(s);var c=Object(P.a)(r,"rollover").pipe(Object(M.a)((function(e){return t.state.set("GlobalTooltip",{placement:"top",show:!0,x:r.x,y:r.y-15,content:r.tooltip})})));n.push(c);var l=Object(P.a)(r,"rollout").pipe(Object(M.a)((function(e){return t.state.set("GlobalTooltip",{show:!1})})));n.push(l)})),x.a.apply(void 0,Object(W.j)(n))}return Object($.a)()}))).subscribe(),n=this.getLoadMoreIndicatorChanges().pipe(Object(T.a)((function(e){var n=e.diagram,i=e.shapeId;t.loadMoreIndicator&&t.removeSource.next(t.loadMoreIndicator);var a=[];t.state.set("GlobalTooltip",{show:!1});var o=n.shapes[i];t.loadMoreIndicator=new Xi(n,o,t.dv),t.addSource.next(t.loadMoreIndicator);var r=Object(P.a)(t.loadMoreIndicator,"click").pipe(Object(M.a)((function(e){return t.loadMoreClicked(o.id)})));a.push(r);var s=Object(P.a)(t.loadMoreIndicator,"rollover").pipe(Object(M.a)((function(e){return t.state.set("GlobalTooltip",{placement:"top",show:!0,x:t.loadMoreIndicator.x,y:t.loadMoreIndicator.y-15,content:t.loadMoreIndicator.tooltip})})));a.push(s);var c=Object(P.a)(t.loadMoreIndicator,"rollout").pipe(Object(M.a)((function(e){return t.state.set("GlobalTooltip",{show:!1})})));return a.push(c),x.a.apply(void 0,Object(W.j)(a))}))).subscribe();this.subs.push(e,n)},e.prototype.getIndicatorChanges=function(){var t=this;return this.ll.forCurrentObserver(!1).pipe(Object(T.a)((function(t){return t.getDiagramModel()})),Object(T.a)((function(e){return t.state.changes("Selected").pipe(Object(T.a)((function(n){if(1===n.length){var i=n[0];return Object.values(t.indicatorsMap).forEach((function(e){return t.removeSource.next(e)})),t.viewport.getShapeModels([i]).pipe(Object(j.a)(1),Object(I.a)((function(n){var i,a=Object.values(n)[0];if(t.defIds.some((function(t){return null==a?void 0:a.defId.includes(t)}))&&(null===(i=a.connectorIds)||void 0===i?void 0:i.length))return Object.values(e.shapes[a.id].gluepoints||{}).map((function(t){for(var n,i,o=0;o<a.connectorIds.length;o++){var r=a.connectorIds[o],s=e.shapes[r];if(s){var c=s.getFromEndpoint(e),l=s.getToEndpoint(e);if((null===(n=c.shape)||void 0===n?void 0:n.id)===a.id&&l.shape&&(null===(i=c.gluepoint)||void 0===i?void 0:i.id)===t.id)return{diagram:e,shape:a,gpModel:t}}}})).filter((function(t){return!!t}))})),Object(E.a)((function(t){return!!t})))}return Object($.a)(null)})))})))},e.prototype.getLoadMoreIndicatorChanges=function(){var t=this;return this.ll.forCurrentObserver(!1).pipe(Object(T.a)((function(t){return t.getDiagramModel()})),Object(T.a)((function(e){return t.state.changes("Selected").pipe(Object(T.a)((function(n){if(1===n.length){var i=n[0];return t.canLoadMore(i).pipe(Object(I.a)((function(t){return t?{diagram:e,shapeId:i}:null})))}return Object($.a)(null)})))})),Object(E.a)((function(t){return!!t})))},e.prototype.hoverInit=function(){var t=this;this.activeShapesSub=this.ll.forCurrentObserver(!1).pipe(Object(T.a)((function(e){return Object(x.a)(e.getDiagramModel(),t.state.changes("Selected"),t.state.changes("ActiveShapes"))})),Object(I.a)((function(){return t.state.get("ActiveShapes").filter((function(e){return!t.state.get("Selected").includes(e)}))})),Object(T.a)((function(e){return e.length?t.viewport.getShapeModels(e):Object($.a)({})})),Object(T.a)((function(e){return t.hoverOnShapes(e).pipe(Object(et.a)(J.isEqual),Object(M.a)((function(n){var i={};n[0]&&(i[n[0]]=e[n[0]]),t.draw(Object(W.a)(Object(W.a)({},i),t.selectedModels))})))}))).subscribe()},e.prototype.draw=function(t){},e.prototype.createAddSource=function(){return this.addSource},e.prototype.createRemoveSource=function(){return this.removeSource},e.prototype.createChangeSource=function(){return this.changeSource},e.prototype.destroy=function(){var e,n;t.prototype.destroy.call(this),null===(e=this.hoverSub)||void 0===e||e.unsubscribe(),null===(n=this.activeShapesSub)||void 0===n||n.unsubscribe(),this.addSource.complete(),this.addSource=void 0,this.changeSource.complete(),this.changeSource=void 0,this.removeSource.complete(),this.removeSource=void 0,this.state.set("GlobalTooltip",{show:!1})},e.prototype.indicatorClicked=function(t,e){var n;this.commandService.dispatch(D.a.collapseExapndBranch,((n={})[t]={gpIds:[e.gp.id]},n))},e.prototype.canLoadMore=function(t){var e=this;return this.ll.forCurrentObserver(!1).pipe(Object(j.a)(1),Object(T.a)((function(t){return t.getDiagramOnce()})),Object(I.a)((function(n){var i=n.shapes[t];if(!e.defIds.some((function(t){return i.defId.startsWith(t)})))return!1;var a=i.eDataId,o=i.entityId,r=i.entityListId,s=i.displayListId,c=i.containerId;if(!a)return!1;var l=e.state.get("projectEDataModels")[a];if(!l)return!1;var u=e.getHandshake(i,l),d=l.entities[o];if(r){var p=l.entityLists[r].containers[n.id][c];return(d.data[u]||[]).some((function(t){var e;return null===(e=p[t])||void 0===e?void 0:e.pending}))}if(s){var h=n.displayLists[s],g=h.entities,f=h.added;return(d.data[u]||[]).some((function(t){return!f.includes(t)&&g.includes(t)}))}return!1})))},e.prototype.loadMoreClicked=function(t){var e=this;this.ll.forCurrentObserver(!1).pipe(Object(j.a)(1),Object(T.a)((function(t){return t.getDiagramOnce()})),Object(M.a)((function(n){var i=n.shapes[t],a=i.eDataId,o=i.entityId,r=i.entityListId,s=i.displayListId,c=i.containerId;if(a){var l=e.state.get("projectEDataModels")[a],u=e.getHandshake(i,l),d={error:function(t){e.state.set("AcknowledgementMessage",{open:!0,message:"Load failed",showLoader:!1}),e.clearAckMessage()},complete:function(){e.state.set("AcknowledgementMessage",{open:!0,message:"Loaded",showLoader:!1}),e.clearAckMessage()}};if((r||s)&&e.state.set("AcknowledgementMessage",{open:!0,message:"Loading",showLoader:!0}),r){var p=l.entityLists[r],h=p.entities,g=[];for(var f in p.containers[n.id][c])p.containers[n.id][c][f].pending||g.push(f);var b=e.getEntitiesToAdd(l,o,h,u,g);e.smartSetSvc.addMoreShapes(b,l,c,p,!0).subscribe(d)}else if(s){var m=n.displayLists[s],v=m.entities,y=m.added,S=m.searchQuery,O=e.getEntitiesToAdd(l,o,v,u,y);e.smartSetSvc.addMoreShapes(O,l,c,{id:s,search:S},!1).pipe(Object(M.a)((function(){var t;e.commandService.dispatch(D.a.applyModifierDocument,{modifier:{$set:(t={},t["displayLists."+s+".added"]=y.concat(O),t)}})}))).subscribe(d)}}}))).subscribe()},e.prototype.getEntitiesToAdd=function(t,e,n,a,o,r){void 0===r&&(r=3);var s={};return n.forEach((function(e){t.entities[e]&&(s[e]={id:e,parentId:null})})),n.forEach((function(e){var n;((null===(n=t.entities[e])||void 0===n?void 0:n.data[a])||[]).forEach((function(t){s[t]&&(s[t].parentId=e)}))})),i.eb.getNextTreeNodes(Object.values(s),e,r,100,o).map((function(t){return t.id}))},e.prototype.getHandshake=function(t,e){var n,i,a,o=t.entityDefId;a=e.isCustom?e.customEntityDefs[o]:Ki.a.instance.getEntityDefById(o,e.defId);var r=Object.values(a.dataItems).filter((function(t){return t.type===y.d.LOOKUP})).filter((function(t){return t.options.eDefId===o})),s=(null===(i=null===(n=t.smartSetOptions)||void 0===n?void 0:n.createLinkConfig)||void 0===i?void 0:i.useMirrorHandshake)||!1,c=[];return r.forEach((function(t){s&&t.options.isMirrorField?c.push(t.id):s||t.options.isMirrorField||c.push(t.id)})),c.length,c[0]},e.prototype.clearAckMessage=function(t){var e=this;void 0===t&&(t=3e3),setTimeout((function(){e.state.set("AcknowledgementMessage",{open:!1})}),t)},e.removeForPanZoom=!0,e.removeForSelectionInteractions=!0,e.\u0275fac=function(t){return new(t||e)(o.qc(i.Nb),o.qc(m.a),o.qc(ht.a),o.qc(f.a),o.qc(b.a),o.qc(i.B),o.qc(Wi.a))},e.\u0275prov=o.cc({token:e,factory:e.\u0275fac}),e=Object(W.d)([Object(ye.a)(),Object(W.g)("design:paramtypes",[i.Nb,m.a,ht.a,f.a,b.a,i.B,Wi.a])],e)}(ye.b);Object.defineProperty(Zi,"name",{value:"CollapseExpandBrancHandler"});var Qi=function(t){function e(e,n,i,a,o,r,s,c,l,u,d,p,h,g,f,b,m,v,y,S,O){var x=t.call(this,e)||this;return x.state=e,x.gridService=n,x.featureList=i,x.injector=a,x.cursorGen=o,x.keyBoardController=r,x.ll=s,x.translate=c,x.env=l,x.postmessage=u,x.commandService=d,x.planPermManager=p,x.alignmentNodeLocator=h,x.shapeBoundsLocator=g,x.authService=f,x.libraryList=b,x.location=m,x.userLocator=v,x.modalController=y,x.diagramInfoLocator=S,x.templateContextHandler=O,x.subscribedPostMessages=[],x}return Object(W.e)(e,t),e.prototype.resolve=function(t,e){return this.updateInterfaceControlState(),this.setEditorStatus("opening"),this.state.initialize("Highlighted",[]),this.state.initialize("SelectionBlocked",[]),this.state.set("EditingText",{open:!1}),this.state.set("TextContent",{}),this.state.set("EditorSuggestions",{suggestions:[],searchTerm:""}),this.state.set("PlusCreateState",{inProgress:!1}),this.state.set("TextToolbarState-notes",{styles:{},takeFocus:!1}),this.state.set("TextEditorState-notes",{styles:{}}),this.state.set("TextToolbarState-shapeText",{styles:{},takeFocus:!1}),this.state.set("TextEditorState-shapeText",{styles:{}}),this.state.set("HyperlinkEditState",{open:!1,origin:null}),this.state.set("ConvertToObjectState",{open:!1}),this.state.set("ShapelinkEditState",{open:!1,origin:null}),this.state.set("AppStatusIndicatorState",{open:!1}),this.state.set("GoogleTokenInfo",{}),this.state.set("TiptapDocument",{}),this.state.set("MultiSelectionInteractionState",pt.c.Stopped),this.state.set("SelectionInteractionState",pt.d.Stopped),this.state.set("SelectionInteractionStateScaleX","init"),this.state.set("SelectionInteraction",{}),this.state.set("FreeHandLastUsedItem",{state:pt.b.Pen,styles:{"stroke-width":2,"stroke-dasharray":"0, 0",stroke:"#000000"}}),this.state.set("CurrentFreeHandShape",!1),this.state.set("LastAddedShape",""),this.state.set("ShapeVoting",{}),this.state.set("LastAddedEDataCandidateShape",""),this.state.set("originalEDataLinks",{}),this.state.set("pastedAs","newObject"),this.hideLoadingScreen(),this.cursorGen.addCursors(wn),this.updateIndicatorHandlers(),this.updateInteractionHandler(),this.setCurrentProject(),this.setCurrentLibraries(),this.setSideBarPanels(),this.setDataSources(),this.registerFeatures(),this.startSelectionToURLSync(),this.keyBoardController.registerFeatures(),this.state.set("MouseControlState",pt.b.Normal),this.gridService.showGrid.next(!0),this.handlePostMessagesRecv(),this.subs.push(this.alignmentNodeLocator.initialize().subscribe()),this.subs.push(this.shapeBoundsLocator.initialize().subscribe()),this.templateContextHandler.initialize(),Object($.a)(!0)},e.prototype.canDeactivate=function(t,e,n,i){return this.state.get("ApplicationIsEmbedded")&&"msteams"!==this.state.get("PluginApp")?Object($.a)(!1):(this.destroy(),this.state.set("Selected",[]),this.setEditorStatus("closing"),Object($.a)(!0))},e.prototype.canActivate=function(t,e){return!0},e.prototype.getProjectDiagramsIfNotAvailable=function(t){t&&!this.diagramInfoLocator.hasProjectDiagrams(t)&&this.commandService.dispatch(g.s.getProjectDiagrams,t,null)},e.prototype.showMedia=function(){var t=this;return this.userLocator.getUserDataAfterUserSubscriptionStarted().pipe(Object(E.a)((function(t){return!!t})),Object(j.a)(1),Object(at.a)(5e3),Object(T.a)((function(e){var n=Object.keys(e.seenMedia).find((function(t){return t.includes("video")}))||"in_app_video",a=e.seenMedia[n]||[],o=i.Xb.filter((function(t){return t.mediaType===n&&!a.includes(t.id)}));return 0===o.length?Object($.a)():(t.filterMediaByTag(o).subscribe((function(e){i.Pb.track("helpWidget.videos.compactVid.load",{value1Type:"mediaTitle",value1:e.name}),t.state.set("FloatingMedia",Object(W.a)({open:!0},e))})),Object($.a)(o[0]))})))},e.prototype.filterMediaByTag=function(t){return this.ll.forCurrentObserver(!1).pipe(Object(T.a)((function(t){return t.getDiagramOnce()})),Object(j.a)(1),Object(E.a)((function(t){return!!t})),Object(I.a)((function(e){return t.forEach((function(t){return t.tagCount=Object(J.intersection)([e.tags],t.tags)})),Object(J.orderBy)(t,["tagCount","priority"],["desc","asc"])[0]})))},e.prototype.setDataSources=function(){this.state.set("DataSources",this.planPermManager.check([y.t.GITHUB_INTEGRATION])?[{defId:"git",id:"git",name:"GitHub",type:pe.a,status:"opened",secondaryMenu:!0}]:[])},e.prototype.handlePostMessagesRecv=function(){var t=this;if(this.state.get("ApplicationIsEmbedded")){var e=this.postmessage.recv().pipe(Object(M.a)((function(e){return t.handleIncomingMessages(e)}))).subscribe();this.subs.push(e)}},e.prototype.handleIncomingMessages=function(t){if(!t||"object"!=typeof t)return Object($.a)();var e=t,n=e.event,i=e.data;this.subscribedPostMessages.includes(n)||("document:modify"===n&&this.commandService.dispatch(gt.a.documentChange,i),"document:data:subscribe"===n&&this.handleDocumentDatatPostMessageSubscribe(),"shape:select:subscribe"===n&&this.handleShapeSelectPostMessageSubscribe(),"creately:command:execute"===n&&this.handleCommandExecute(i))},e.prototype.setEditorStatus=function(t){this.state.set("EditorStatus",{status:t})},e.prototype.updateInterfaceControlState=function(){this.commandService.dispatch(gt.a.changeInterfaceControlState,{state:pt.a.Edit})},e.prototype.updateIndicatorHandlers=function(){this.state.set("IndicatorHandlerList",new Set([Hi,gi,ui.a,Rn,_e.a,Dn,Tn.a,X.a,Ci.a,Ze,qi,Ie,He.a,$e,en,be.a,fe.a,Pe,Oe,li,kn,Zi]))},e.prototype.updateInteractionHandler=function(){var t=this,e=this.state;this.subs.push(this.state.changes("MouseControlState").subscribe((function(n){return e.set("CurrentInteractionHandler",{injector:t.injector,type:t.getEditorInteractionHandler(n)})})))},e.prototype.setCurrentProject=function(){var t=this;this.subs.push(this.ll.forCurrentObserver(!1).pipe(Object(T.a)((function(t){return t.getDiagramOnce()})),Object(T.a)((function(e){return t.diagramInfoLocator.getDiagram(e.id)})),Object(E.a)((function(t){return!!t})),Object(M.a)((function(e){t.state.set("FolderPanelDataChangeEvent",{id:e.id,type:"diagram",action:"create",payload:e})})),Object(j.a)(1)).subscribe())},e.prototype.startSelectionToURLSync=function(){var t=this;this.subs.push(this.state.changes("Selected").pipe(Object(M.a)((function(e){if(t.location){var n=t.location.path(),i=n.indexOf("/edit"),a=n.indexOf("?")>-1?n.substring(n.indexOf("?")):"",o=n.substring(0,i)+"/edit";i>-1&&(e.length>0?(o=o+"/s/"+e[0]+a,t.location.replaceState(o)):t.location.replaceState(o+a))}}))).subscribe())},e.prototype.setCurrentLibraries=function(){var t=this;this.state.has("CurrentLibraries")||this.state.initialize("CurrentLibraries",[]),this.state.has("CurrentLibraryGroup")||this.state.initialize("CurrentLibraryGroup",""),this.subs.unshift(this.state.changes("SelectedFloatingPanel").pipe(Object(E.a)((function(t){return"shapes"===t})),Object(j.a)(1),Object(T.a)((function(){return t.getLibrariesForCurrentDoc()}))).subscribe())},e.prototype.setSideBarPanels=function(){var t=this.state,e={diagraminfo:on.a,shapePanel:xi.a,shapeData:he.a};("plugin"===i.m.get("APP_MODE")||t.get("ApplicationIsEmbedded")||(e.diagramcomments=ke.a,e.historyPanel=fi.a),t.get("ApplicationIsEmbedded"))&&("msteams"===t.get("PluginApp")&&(e.diagramcomments=ke.a,e.historyPanel=fi.a));t.set("AvailableSideBarPanels",e)},e.prototype.registerFeatures=function(){var t=this;this.featureList.register({id:"selectAll",commandEvent:Ht.a.selectAll,label:this.translate.instant("COMMANDS.SELECT_ALL"),shortcuts:[{keySequence:[y.m.Meta,y.m.A]}],data:{},shortcutText:"",icon:"nu-ic-select-all",context:Be.a.Canvas}),this.featureList.register({id:"remove",commandEvent:D.a.removeShape,label:this.translate.instant("COMMANDS.DELETE"),shortcuts:[{keySequence:[y.m.Backspace]},{keySequence:[y.m.Delete]}],data:{},shortcutText:"",icon:"nu-ic-delete",context:Be.a.Canvas,transformer:pi.a}),this.featureList.register({id:"copyShapes",commandEvent:D.a.copyShapes,label:this.translate.instant("COMMANDS.COPY"),shortcuts:[{keySequence:[y.m.Meta,y.m.C]}],data:{copyEdata:!0},shortcutText:"",icon:"nu-ic-copy",context:Be.a.Canvas,transformer:pi.a}),this.featureList.register({id:"cutShapes",commandEvent:D.a.cutShapes,label:this.translate.instant("COMMANDS.CUT"),shortcuts:[{keySequence:[y.m.Meta,y.m.X]}],data:{},shortcutText:"",icon:"nu-ic-cut",context:Be.a.Canvas,transformer:pi.a}),this.featureList.register({id:"pasteShapes",commandEvent:D.a.pasteShapes,label:this.translate.instant("COMMANDS.PASTE"),shortcuts:[{keySequence:[y.m.Meta,y.m.V],repeatOnKeyPress:300}],data:{},shortcutText:"",icon:"nu-ic-paste-blank",context:Be.a.Canvas}),this.featureList.register({id:"duplicateShapes",commandEvent:D.a.duplicateShapes,label:this.translate.instant("COMMANDS.DUPLICATE"),shortcuts:[{keySequence:[y.m.Meta,y.m.D],repeatOnKeyPress:300}],data:{},shortcutText:"",icon:"nu-ic-duplicate",context:Be.a.Canvas,transformer:pi.a}),this.featureList.register({id:"editText",commandEvent:D.a.openTextEditor,label:this.translate.instant("COMMANDS.EDIT_TEXT"),shortcuts:[{keySequence:[y.m.T]}],data:{},shortcutText:"",context:Be.a.CanvasSelected,attachKeyEventToData:!0,icon:"nu-ic-text",tooltip:this.translate.instant("TOOLTIPS.EDIT_TEXT"),transformer:ji.a}),this.featureList.register({id:"loadMoreShapes",commandEvent:D.a.openTextEditor,label:this.translate.instant("COMMANDS.LOAD_MORE_SHAPES"),shortcuts:[],data:{},shortcutText:"",context:Be.a.CanvasSelected,attachKeyEventToData:!0,icon:"nu-ic-table-add",tooltip:this.translate.instant("TOOLTIPS.LOAD_MORE_SHAPES")}),this.featureList.register({id:"openEmojiList",commandEvent:null,dataType:y.d.EMOJI,label:this.translate.instant("COMMANDS.ADD_REACTION"),shortcuts:[],data:{},shortcutText:"",context:Be.a.CanvasSelected,attachKeyEventToData:!0,icon:"emoji",tooltip:this.translate.instant("TOOLTIPS.ADD_REACTION"),transformer:Bi.a}),this.featureList.register({id:"editShapeData",commandEvent:D.a.openShapeDataEditor,label:this.translate.instant("COMMANDS.EDIT_SHAPE_DATA"),shortcuts:[{keySequence:[y.m.N]}],data:{open:!0},shortcutText:"",context:Be.a.CanvasSelected,attachKeyEventToData:!1,icon:"nu-ic-notes"}),this.featureList.register({id:"switchReplaceText",commandEvent:D.a.replaceTextShape,label:this.translate.instant("COMMANDS.EDIT_TEXT"),shortcuts:[{keySequence:[y.m.T]}],data:{},shortcutText:"",context:Be.a.CanvasSelected,attachKeyEventToData:!0,icon:"nu-ic-text",tooltip:this.translate.instant("TOOLTIPS.EDIT_TEXT"),transformer:ji.a}),this.featureList.register({id:"createConnector",commandEvent:D.a.addConnector,label:this.translate.instant("COMMANDS.CREATE_CONNECTION"),shortcuts:[],data:{},shortcutText:"",context:Be.a.Canvas,icon:"nu-ic-line",transformer:cn.a,tooltip:this.translate.instant("TOOLTIPS.CREATE_CONNECTOR")}),this.featureList.register({id:"styleShape",dataType:y.d.CUSTOM_STYLE_PALETTES,commandEvent:D.a.applyShapeStyle,label:this.translate.instant("COMMANDS.STYLE_SHAPE"),shortcuts:[],data:{},shortcutText:"",context:Be.a.Canvas,icon:"styles",transformer:Pn.a,tooltip:this.translate.instant("TOOLTIPS.STYLE_SHAPE")}),this.featureList.register({id:"flipConnector",commandEvent:Ht.a.flipConnector,label:this.translate.instant("COMMANDS.FLIP"),shortcuts:[],data:{},shortcutText:"",context:Be.a.Canvas,icon:"nu-ic-flip",transformer:gn.a,tooltip:this.translate.instant("TOOLTIPS.FLIP_CONNECTOR")}),this.featureList.register({id:"uploadShapeImage",commandEvent:D.a.uploadShapeImage,label:this.translate.instant("COMMANDS.UPLOAD_SHAPE_IMAGE"),shortcuts:[],data:{},shortcutText:"",context:Be.a.Canvas,icon:"nu-ic-image",tooltip:this.translate.instant("TOOLTIPS.UPLOAD_SHAPE_IMAGE")}),this.featureList.register({id:"changeLeftArrowHead",dataType:y.d.OPTION_IMAGES,commandEvent:D.a.changeArrowHeads,label:"",shortcuts:[],data:{},shortcutText:"",context:Be.a.Canvas,transformer:un.a,tooltip:this.translate.instant("TOOLTIPS.CHANGE_LEFT_ARROWHEAD")}),this.featureList.register({id:"changeRightArrowHead",dataType:y.d.OPTION_IMAGES,commandEvent:D.a.changeArrowHeads,label:"",shortcuts:[],data:{},shortcutText:"",context:Be.a.Canvas,transformer:un.a,tooltip:this.translate.instant("TOOLTIPS.CHANGE_RIGHT_ARROWHEAD")}),this.featureList.register({id:"changeDrawStyle",dataType:y.d.OPTION_IMAGES,commandEvent:D.a.changeDrawStyle,label:"",shortcuts:[],data:{},shortcutText:"",context:Be.a.Canvas,transformer:dn.a,tooltip:this.translate.instant("TOOLTIPS.CHANGE_DRAW_STYLE")}),this.featureList.register({id:"changeConnectorType",dataType:y.d.OPTION_IMAGES,commandEvent:D.a.setConnectorConnection,label:"",shortcuts:[],data:{},shortcutText:"",context:Be.a.Canvas,transformer:pn.a,tooltip:this.translate.instant("TOOLTIPS.CHANGE_CONNECTOR_TYPE")}),this.featureList.register({id:"keyboardSelectionNavigation",commandEvent:D.a.keyboardSelectionInteraction,label:this.translate.instant("COMMANDS.MOVE"),shortcuts:[{keySequence:[y.m.ArrowUp],repeatOnKeyPress:50},{keySequence:[y.m.ArrowDown],repeatOnKeyPress:50},{keySequence:[y.m.ArrowLeft],repeatOnKeyPress:50},{keySequence:[y.m.ArrowRight],repeatOnKeyPress:50}],data:{},attachKeyEventToData:!0,shortcutText:"\u2190 \u2192 \u2191 \u2193",context:Be.a.Canvas}),this.featureList.register({id:"keyboardPlusCreate",commandEvent:D.a.keyboardPlusCreateInteraction,label:this.translate.instant("COMMANDS.PLUSCREATE"),shortcuts:[{keySequence:[y.m.Tab]},{keySequence:[y.m.Shift,y.m.Enter]}],data:{},attachKeyEventToData:!0,shortcutText:"Tab | Enter",context:Be.a.CanvasSelected}),this.featureList.register({id:"keyboardSelectionMove",commandEvent:D.a.keyboardSelectionInteraction,label:this.translate.instant("COMMANDS.MOVE"),shortcuts:[{keySequence:[y.m.Shift,y.m.ArrowUp],repeatOnKeyPress:50},{keySequence:[y.m.Shift,y.m.ArrowDown],repeatOnKeyPress:50},{keySequence:[y.m.Shift,y.m.ArrowLeft],repeatOnKeyPress:50},{keySequence:[y.m.Shift,y.m.ArrowRight],repeatOnKeyPress:50}],data:{},attachKeyEventToData:!0,shortcutText:"Shift + \u2190  \u2192  \u2191  \u2193",context:Be.a.CanvasSelected}),this.featureList.register({id:"undo",commandEvent:D.a.undoAction,label:this.translate.instant("COMMANDS.UNDO"),shortcuts:[{keySequence:[y.m.Meta,y.m.Z]}],data:{},shortcutText:"",context:Be.a.Canvas,icon:"nu-ic-undo"}),this.featureList.register({id:"redo",commandEvent:D.a.redoAction,label:this.translate.instant("COMMANDS.REDO"),shortcuts:[{keySequence:[y.m.Meta,y.m.Shift,y.m.Z]},{keySequence:[y.m.Meta,y.m.Y]}],data:{},shortcutText:"",context:Be.a.Canvas,icon:"nu-ic-redo"}),this.featureList.register({id:"switchToPanMouseControlState",commandEvent:gt.a.changeMouseControlState,label:this.translate.instant("COMMANDS.PAN"),shortcuts:[{keySequence:[y.m.Space],action:"keyup"},{keySequence:[y.m.Space],action:"keydown"}],data:{},shortcutText:"Space + Drag",attachKeyEventToData:!0,context:Be.a.Canvas,icon:"nu-ic-move"}),this.featureList.register({id:"boldModelText",commandEvent:D.a.applyShapeStyle,label:this.translate.instant("COMMANDS.BOLD"),shortcuts:[{keySequence:[y.m.Meta,y.m.B]}],data:{style:"bold",value:null},shortcutText:"",attachKeyEventToData:!1,context:Be.a.All,transformer:Sn.a,icon:"nu-ic-bold"}),this.featureList.register({id:"italicModelText",commandEvent:D.a.applyShapeStyle,label:this.translate.instant("COMMANDS.ITALIC"),shortcuts:[{keySequence:[y.m.Meta,y.m.I]}],data:{style:"italic",value:null},shortcutText:"",attachKeyEventToData:!1,context:Be.a.All,transformer:Sn.a,icon:"nu-ic-italic"}),this.featureList.register({id:"underlineModelText",commandEvent:D.a.applyShapeStyle,label:this.translate.instant("COMMANDS.UNDERLINE"),shortcuts:[{keySequence:[y.m.Meta,y.m.U]}],data:{style:"underline",value:null},shortcutText:"",attachKeyEventToData:!1,context:Be.a.All,transformer:Sn.a,icon:"nu-ic-underline"}),this.featureList.register({id:"strikeoutModelText",commandEvent:D.a.applyShapeStyle,label:this.translate.instant("COMMANDS.STRIKE_OUT"),shortcuts:[],data:{style:"strikeout",value:null},shortcutText:"",attachKeyEventToData:!1,context:Be.a.All,transformer:Sn.a,icon:"nu-ic-strikethrough"}),this.featureList.register({id:"leftAlignModelText",commandEvent:D.a.applyShapeStyle,label:this.translate.instant("COMMANDS.LEFT_ALIGN"),shortcuts:[],data:{style:"align",value:"left"},shortcutText:"",attachKeyEventToData:!1,context:Be.a.All,transformer:Sn.a,icon:"nu-ic-text-align-left"}),this.featureList.register({id:"centerAlignModelText",commandEvent:D.a.applyShapeStyle,label:this.translate.instant("COMMANDS.CENTER_ALIGN"),shortcuts:[],data:{style:"align",value:"center"},shortcutText:"",attachKeyEventToData:!1,context:Be.a.All,transformer:Sn.a,icon:"nu-ic-text-align-center"}),this.featureList.register({id:"rightAlignModelText",commandEvent:D.a.applyShapeStyle,label:this.translate.instant("COMMANDS.RIGHT_ALIGN"),shortcuts:[],data:{style:"align",value:"right"},shortcutText:"",attachKeyEventToData:!1,context:Be.a.All,transformer:Sn.a,icon:"nu-ic-text-align-right"}),this.featureList.register({id:"justifyModelText",commandEvent:D.a.applyShapeStyle,label:this.translate.instant("COMMANDS.JUSTIFY"),shortcuts:[],data:{style:"align",value:"justify"},shortcutText:"",attachKeyEventToData:!1,context:Be.a.All,transformer:Sn.a,icon:"nu-ic-text-align-justify"}),this.featureList.register({id:"sizeModelText",dataType:y.d.OPTION_LIST_COMBO,commandEvent:D.a.applyShapeStyle,label:this.translate.instant("COMMANDS.SIZE"),shortcuts:[],data:{style:"size",validation:{type:y.d.NUMBER,rules:{max:500,min:1,decimal:!1}}},shortcutText:"",attachKeyEventToData:!1,context:Be.a.All,transformer:Sn.a,icon:"nu-ic-size"}),this.featureList.register({id:"fontModelText",dataType:y.d.OPTION_LIST_COMBO,commandEvent:D.a.applyShapeStyle,label:this.translate.instant("COMMANDS.FONT"),shortcuts:[],data:{style:"font",readOnly:!0,validation:{type:y.d.STRING,rules:{}}},shortcutText:"",attachKeyEventToData:!1,context:Be.a.All,transformer:Sn.a}),this.featureList.register({id:"colorModelText",dataType:y.d.COLOR,commandEvent:D.a.applyShapeStyle,label:this.translate.instant("COMMANDS.TEXT_COLOR"),shortcuts:[],data:{style:"color"},shortcutText:"",attachKeyEventToData:!1,context:Be.a.All,transformer:Sn.a}),this.featureList.register({id:"colorFill",dataType:y.d.COLOR,commandEvent:D.a.applyShapeStyle,label:this.translate.instant("COMMANDS.FILL_COLOR"),shortcuts:[],data:{style:"fillColor",type:Oi.b.Fill},shortcutText:"",attachKeyEventToData:!1,context:Be.a.All,transformer:bn.a}),this.featureList.register({id:"colorLine",dataType:y.d.COLOR,commandEvent:D.a.applyShapeStyle,label:this.translate.instant("COMMANDS.LINE_COLOR"),shortcuts:[],data:{style:"lineColor",type:Oi.b.Border},shortcutText:"",attachKeyEventToData:!1,context:Be.a.All,transformer:bn.a}),this.featureList.register({id:"styleLine",dataType:y.d.OPTION_LIST,commandEvent:D.a.applyShapeStyle,label:this.translate.instant("COMMANDS.LINE_STYLE"),dropdownDirection:"down",shortcuts:[],data:{style:"lineStyle"},shortcutText:"",attachKeyEventToData:!1,context:Be.a.All,transformer:bn.a}),this.featureList.register({id:"lineThickness",dataType:y.d.NUMBER,commandEvent:D.a.applyShapeStyle,label:this.translate.instant("COMMANDS.LINE_THICKNESS"),labelPosition:"top",shortcuts:[],data:{style:"lineThickness"},shortcutText:"",attachKeyEventToData:!1,context:Be.a.All,transformer:bn.a}),this.featureList.register({id:"alignText",dataType:y.d.OPTION_LIST,commandEvent:D.a.applyTextEditorStyles,label:this.translate.instant("COMMANDS.ALIGN"),shortcuts:[],data:{validation:{type:y.d.STRING,rules:{}},stateContext:"shapeText"},shortcutText:"",attachKeyEventToData:!1,context:Be.a.Text,icon:"nu-ic-italic",tooltip:this.translate.instant("TOOLTIPS.ALIGN_TEXT"),transformer:Ee.a}),this.featureList.register({id:"leftAlignText",commandEvent:D.a.applyTextEditorStyles,label:this.translate.instant("COMMANDS.LEFT_ALIGN"),shortcuts:[],data:{styles:{align:"left"},stateContext:"shapeText"},shortcutText:"",attachKeyEventToData:!1,context:Be.a.Text,icon:"nu-ic-text-align-left"}),this.featureList.register({id:"rightAlignText",commandEvent:D.a.applyTextEditorStyles,label:this.translate.instant("COMMANDS.RIGHT_ALIGN"),shortcuts:[],data:{styles:{align:"right"},stateContext:"shapeText"},shortcutText:"",attachKeyEventToData:!1,context:Be.a.Text,icon:"nu-ic-text-align-right"}),this.featureList.register({id:"centerAlignText",commandEvent:D.a.applyTextEditorStyles,label:this.translate.instant("COMMANDS.CENTER_ALIGN"),shortcuts:[],data:{styles:{align:"center"},stateContext:"shapeText"},shortcutText:"",attachKeyEventToData:!1,context:Be.a.Text,icon:"nu-ic-text-align-center"}),this.featureList.register({id:"justifyText",commandEvent:D.a.applyTextEditorStyles,label:this.translate.instant("COMMANDS.JUSTIFY"),shortcuts:[],data:{styles:{align:"justify"},stateContext:"shapeText"},shortcutText:"",attachKeyEventToData:!1,context:Be.a.Text,icon:"nu-ic-text-align-justify"}),this.featureList.register({id:"boldText",commandEvent:D.a.applyTextEditorStyles,label:this.translate.instant("COMMANDS.BOLD"),shortcuts:[],data:{styles:{bold:null},stateContext:"shapeText"},shortcutText:"",attachKeyEventToData:!1,context:Be.a.Text,icon:"nu-ic-bold",tooltip:this.translate.instant("TOOLTIPS.BOLD_TEXT")}),this.featureList.register({id:"italicText",commandEvent:D.a.applyTextEditorStyles,label:this.translate.instant("COMMANDS.ITALIC"),shortcuts:[],data:{styles:{italic:null},stateContext:"shapeText"},shortcutText:"",attachKeyEventToData:!1,context:Be.a.Text,icon:"nu-ic-italic",tooltip:this.translate.instant("TOOLTIPS.ITALIC_TEXT")}),this.featureList.register({id:"underlineText",commandEvent:D.a.applyTextEditorStyles,label:this.translate.instant("COMMANDS.UNDERLINE"),shortcuts:[],data:{styles:{underline:null},stateContext:"shapeText"},shortcutText:"",attachKeyEventToData:!1,context:Be.a.Text,icon:"nu-ic-underline",tooltip:this.translate.instant("TOOLTIPS.UNDERLINE_TEXT")}),this.featureList.register({id:"strikeoutText",commandEvent:D.a.applyTextEditorStyles,label:this.translate.instant("COMMANDS.STRIKE_OUT"),shortcuts:[],data:{styles:{strikeout:null},stateContext:"shapeText"},shortcutText:"",attachKeyEventToData:!1,context:Be.a.Text,icon:"nu-ic-strikethrough",tooltip:this.translate.instant("TOOLTIPS.STRIKEOUT_TEXT")}),this.featureList.register({id:"bringToFront",commandEvent:D.a.bringToFront,label:this.translate.instant("COMMANDS.BRING_TO_FRONT"),shortcuts:[{keySequence:[y.m.Meta,y.m.Alt,y.m.BracketRight]}],data:{},shortcutText:"",icon:"nu-ic-bring-to-front",context:Be.a.Canvas}),this.featureList.register({id:"copyShapeLink",commandEvent:D.a.copyShapeLink,label:this.translate.instant("COMMANDS.COPY_SHAPE_LINK"),shortcuts:[],data:{},shortcutText:"",icon:"nu-ic-copy-link",transformer:me.a,context:Be.a.CanvasSelected}),this.featureList.register({id:"sendToBack",commandEvent:D.a.sendToBack,label:this.translate.instant("COMMANDS.SEND_TO_BACK"),shortcuts:[{keySequence:[y.m.Meta,y.m.Alt,y.m.BracketLeft]}],data:{},shortcutText:"",icon:"nu-ic-send-to-back",context:Be.a.Canvas}),this.featureList.register({id:"sendBackward",commandEvent:D.a.sendBackward,label:this.translate.instant("COMMANDS.SEND_BACKWARDS"),shortcuts:[{keySequence:[y.m.Meta,y.m.BracketLeft]}],data:{},shortcutText:"",icon:"nu-ic-send-backwards",context:Be.a.Canvas}),this.featureList.register({id:"shapeVoting",commandEvent:D.a.shapeVoteState,label:this.translate.instant("LABELS.START_VOTING"),shortcuts:[],data:{},shortcutText:"",context:Be.a.Canvas,icon:"nu-ic-vote",transformer:zi.a}),this.featureList.register({id:"bringForward",commandEvent:D.a.bringForward,label:this.translate.instant("COMMANDS.BRING_FORWARD"),shortcuts:[{keySequence:[y.m.Meta,y.m.BracketRight]}],data:{},shortcutText:"",icon:"nu-ic-bring-forward",context:Be.a.Canvas}),this.featureList.register({id:"alignShapes",dataType:y.d.OPTION_IMAGES,commandEvent:Ht.a.alignShapes,label:"",icon:"align-v-center",shortcuts:[],data:{},shortcutText:"",context:Be.a.Canvas,transformer:ln.a,tooltip:this.translate.instant("TOOLTIPS.ALIGN_SHAPES")}),this.featureList.register({id:"layoutShapes",dataType:y.d.GRID_IMAGES,commandEvent:Ht.a.layoutShapes,label:"",icon:"",shortcuts:[],data:{},shortcutText:"",context:Be.a.Canvas,transformer:wi.a,tooltip:this.translate.instant("TOOLTIPS.LAYOUT_SHAPES")}),this.featureList.register({id:"sizeText",dataType:y.d.OPTION_LIST_COMBO,commandEvent:D.a.applyTextEditorStyles,label:this.translate.instant("COMMANDS.SIZE"),shortcuts:[],data:{validation:{type:y.d.NUMBER,rules:{max:500,min:1,decimal:!1}},stateContext:"shapeText"},shortcutText:"",attachKeyEventToData:!1,context:Be.a.Text,icon:"",transformer:sn.a,tooltip:this.translate.instant("TOOLTIPS.SIZE_TEXT")}),this.featureList.register({id:"colorText",dataType:y.d.OPTION_IMAGES,commandEvent:D.a.applyTextEditorStyles,label:this.translate.instant("COMMANDS.COLOR"),shortcuts:[],data:{stateContext:"shapeText"},shortcutText:"",attachKeyEventToData:!1,context:Be.a.Text,icon:"",transformer:rn.a,tooltip:this.translate.instant("TOOLTIPS.COLOR_TEXT")}),this.featureList.register({id:"colorTextAlt",dataType:y.d.COLOR,commandEvent:D.a.applyTextEditorStyles,label:this.translate.instant("COMMANDS.TEXT_COLOR"),shortcuts:[],data:{style:"color",stateContext:"shapeText"},shortcutText:"",attachKeyEventToData:!1,context:Be.a.Text,icon:"",transformer:mi.a,tooltip:this.translate.instant("TOOLTIPS.COLOR_TEXT")}),this.featureList.register({id:"fontText",dataType:y.d.OPTION_LIST_COMBO,commandEvent:D.a.applyTextEditorStyles,label:this.translate.instant("COMMANDS.FONT"),shortcuts:[],data:{style:"font",validation:{type:y.d.STRING,rules:{}},stateContext:"shapeText"},shortcutText:"",attachKeyEventToData:!1,icon:"",context:Be.a.Text,transformer:bi.a}),this.featureList.register({id:"openHyperlinkEditor",commandEvent:D.a.openHyperlinkEditor,label:this.translate.instant("COMMANDS.ADD_HYPERLINK"),shortcuts:[{keySequence:[y.m.Meta,y.m.K]}],data:{open:!0,state:"edit",origin:"toolbar"},shortcutText:"",context:Be.a.Text,icon:"nu-ic-link",tooltip:this.translate.instant("TOOLTIPS.ADD_HYPERLINK")}),this.featureList.register({id:"unlinkHyperlink",commandEvent:D.a.applyTextEditorStyles,label:this.translate.instant("COMMANDS.REMOVE_HYPERLINK"),shortcuts:[],data:{styles:{link:void 0,color:y.c.color,underline:!1,stateContext:"shapeText"}},shortcutText:"",context:Be.a.Text,icon:"nu-ic-unlink",tooltip:this.translate.instant("TOOLTIPS.UNLINK_HYPERLINK")}),this.featureList.register({id:"openShapelinkEditor",commandEvent:D.a.openShapelinkEditor,label:this.translate.instant("COMMANDS.ADD_HYPERLINK"),shortcuts:[{keySequence:[y.m.Meta,y.m.K]}],data:{open:!0,state:"edit",origin:"toolbar"},shortcutText:"",context:Be.a.CanvasSelected,icon:"nu-ic-link",transformer:me.a,tooltip:this.translate.instant("TOOLTIPS.ADD_HYPERLINK")}),this.featureList.register({id:"manageIndicators",dataType:y.d.OPTION_LIST,commandEvent:D.a.updateDisplayRules,label:this.translate.instant("LABELS.SHAPE_INDICATORS"),shortcuts:[],data:{indicators:[{name:"tagsIndicator",icon:"tag",label:this.translate.instant("LABELS.TAGS")},{name:"userIndicator",icon:"user",label:this.translate.instant("LABELS.EDITORS")},{name:"emojiIndicator",icon:"emoji",label:this.translate.instant("LABELS.REACTIONS")},{name:"dueDateIndicator",icon:"calendar",label:this.translate.instant("LABELS.DUE_DATE")},{name:"linkIndicator",icon:"link",label:this.translate.instant("LABELS.LINK")}],header:this.translate.instant("LABELS.SHAPE_INFO").toUpperCase(),actionLabel:this.translate.instant("LABELS.CLEAR_ALL")},shortcutText:"",context:Be.a.Canvas,icon:"shape-indicator",transformer:vn.a,tooltip:this.translate.instant("TOOLTIPS.SHAPE_INDICATORS")}),this.featureList.register({id:"textPosition",dataType:y.d.TEXT_POSITION,commandEvent:D.a.positionText,label:"Position Text",shortcuts:[],data:{},shortcutText:"",attachKeyEventToData:!1,context:Be.a.Canvas,icon:"",transformer:yn.a}),this.featureList.register({id:"selectionPositionX",dataType:y.d.NUMBER,commandEvent:Ht.a.transformShapesAndConnectors,label:"X",labelPosition:"left",shortcuts:[],data:{readOnly:!0},shortcutText:"",attachKeyEventToData:!1,context:Be.a.All,transformer:mn.a}),this.featureList.register({id:"selectionPositionY",dataType:y.d.NUMBER,commandEvent:Ht.a.transformShapesAndConnectors,label:"Y",labelPosition:"left",shortcuts:[],data:{readOnly:!0},shortcutText:"",attachKeyEventToData:!1,context:Be.a.All,transformer:mn.a}),this.featureList.register({id:"selectionWidth",dataType:y.d.NUMBER,commandEvent:Ht.a.transformShapesAndConnectors,label:"W",labelPosition:"left",shortcuts:[],data:{readOnly:!0},shortcutText:"",attachKeyEventToData:!1,context:Be.a.All,transformer:mn.a}),this.featureList.register({id:"selectionHeight",dataType:y.d.NUMBER,commandEvent:Ht.a.transformShapesAndConnectors,label:"H",labelPosition:"left",shortcuts:[],data:{readOnly:!0},shortcutText:"",attachKeyEventToData:!1,context:Be.a.All,transformer:mn.a}),this.featureList.register({id:"selectionAngle",dataType:y.d.NUMBER,commandEvent:Ht.a.transformShapesAndConnectors,label:"A",labelPosition:"left",shortcuts:[],data:{readOnly:!0},shortcutText:"",attachKeyEventToData:!1,context:Be.a.All,transformer:mn.a}),this.featureList.register({id:"connectorStartX",dataType:y.d.NUMBER,commandEvent:Ht.a.transformShapesAndConnectors,label:"X1",labelPosition:"left",shortcuts:[],data:{readOnly:!0},shortcutText:"",attachKeyEventToData:!1,context:Be.a.All,transformer:mn.a}),this.featureList.register({id:"connectorStartY",dataType:y.d.NUMBER,commandEvent:Ht.a.transformShapesAndConnectors,label:"Y1",labelPosition:"left",shortcuts:[],data:{readOnly:!0},shortcutText:"",attachKeyEventToData:!1,context:Be.a.All,transformer:mn.a}),this.featureList.register({id:"connectorEndX",dataType:y.d.NUMBER,commandEvent:Ht.a.transformShapesAndConnectors,label:"X2",labelPosition:"left",shortcuts:[],data:{readOnly:!0},shortcutText:"",attachKeyEventToData:!1,context:Be.a.All,transformer:mn.a}),this.featureList.register({id:"connectorEndY",dataType:y.d.NUMBER,commandEvent:Ht.a.transformShapesAndConnectors,label:"Y2",labelPosition:"left",shortcuts:[],data:{readOnly:!0},shortcutText:"",attachKeyEventToData:!1,context:Be.a.All,transformer:mn.a}),this.featureList.register({id:"customShapeStyles",dataType:y.d.CUSTOM_SHAPE_STYLE,commandEvent:D.a.applyShapeStyle,label:"Custom Styles",labelPosition:"top",shortcuts:[],data:{},shortcutText:"",attachKeyEventToData:!1,context:Be.a.All,transformer:hn.a}),this.featureList.register({id:"groupShapes",dataType:y.d.BINARY,commandEvent:Ht.a.groupShapes,label:this.translate.instant("COMMANDS.GROUP"),shortcuts:[{keySequence:[y.m.Meta,y.m.G]}],data:{},icon:"nu-ic-group",shortcutText:"",context:Be.a.Canvas,transformer:fn.a,tooltip:this.translate.instant("TOOLTIPS.GROUP_SHAPES")}),this.featureList.register({id:"ungroupShapes",dataType:y.d.BINARY,commandEvent:Ht.a.unGroupShapes,label:this.translate.instant("COMMANDS.UNGROUP"),shortcuts:[{keySequence:[y.m.Meta,y.m.Shift,y.m.G]}],data:{},icon:"nu-ic-ungroup",shortcutText:"",context:Be.a.Canvas,transformer:fn.a,tooltip:this.translate.instant("TOOLTIPS.UNGROUP_SHAPES")}),this.featureList.register({id:"showConnectorBumps",commandEvent:D.a.toggleConnectorLineBumps,label:this.translate.instant("COMMANDS.SHOW_LINE_BUMPS"),shortcuts:[],data:{showLineBumps:!0,selection:!0},shortcutText:"",icon:"nu-ic-linebump",context:Be.a.Canvas,transformer:On.a}),this.featureList.register({id:"hideConnectorBumps",commandEvent:D.a.toggleConnectorLineBumps,label:this.translate.instant("COMMANDS.HIDE_LINE_BUMPS"),shortcuts:[],data:{showLineBumps:!1,selection:!0},shortcutText:"",icon:"nu-ic-linebump",context:Be.a.Canvas,transformer:On.a}),this.featureList.register({id:"pasteItems",commandEvent:D.a.pasteItems,label:this.translate.instant("COMMANDS.PASTE"),shortcuts:[{keySequence:[y.m.Meta,y.m.V],repeatOnKeyPress:300}],data:{},shortcutText:"",context:Be.a.Canvas}),this.featureList.register({id:"changeSnapState",commandEvent:D.a.changeSnapState,label:this.translate.instant("LABELS.SNAP_TO_GUIDES"),shortcuts:[{keySequence:[y.m.Control],action:"keyup"},{keySequence:[y.m.Control],action:"keydown"}],data:{},attachKeyEventToData:!0,shortcutText:"Ctrl + Drag",context:Be.a.Canvas}),this.featureList.register({id:"openAppStatusToolTip",commandEvent:D.a.openAppStatusToolTip,label:"",shortcuts:[{keySequence:[y.m.Meta,y.m.S]}],data:{open:!0},shortcutText:"",attachKeyEventToData:!0,context:Be.a.Canvas}),this.featureList.register({id:"drawLine",commandEvent:gt.a.changeMouseControlState,label:this.translate.instant("COMMANDS.DRAW_LINE"),shortcuts:[{keySequence:[y.m.L]}],data:{state:pt.b.Connector},shortcutText:"L",attachKeyEventToData:!1,context:Be.a.Canvas,icon:"nu-ic-line"}),this.featureList.register({id:"addText",commandEvent:gt.a.changeMouseControlState,label:this.translate.instant("COMMANDS.ADD_TEXT"),shortcuts:[{keySequence:[y.m.T]}],data:{state:pt.b.Text},shortcutText:"T",attachKeyEventToData:!1,context:Be.a.Canvas,icon:"nu-ic-text"}),this.featureList.register({id:"addRectangle",commandEvent:gt.a.changeMouseControlState,label:this.translate.instant("COMMANDS.ADD_RECTANGLE"),shortcuts:[{keySequence:[y.m.R]}],data:{state:pt.b.Rectangle},shortcutText:"R",attachKeyEventToData:!1,context:Be.a.CanvasNotSelected,icon:"nu-ic-rectangle"}),this.featureList.register({id:"stickyNote",commandEvent:gt.a.changeMouseControlState,label:this.translate.instant("COMMANDS.ADD_STICKY_NOTE"),shortcuts:[],data:{state:pt.b.StickyNote},shortcutText:"Double click",attachKeyEventToData:!1,context:Be.a.Canvas,icon:"nu-ic-note-thick"}),this.featureList.register({id:"lockShape",commandEvent:D.a.toggleShapeLock,label:this.translate.instant("COMMANDS.LOCK_SHAPE"),shortcuts:[],data:{shouldLock:!0},shortcutText:"",icon:"nu-ic-lock",context:Be.a.Canvas,transformer:di.a}),this.featureList.register({id:"unlockShape",commandEvent:D.a.toggleShapeLock,label:this.translate.instant("COMMANDS.UNLOCK_SHAPE"),shortcuts:[],data:{shouldLock:!1},shortcutText:"",icon:"nu-ic-lock",context:Be.a.Canvas,transformer:di.a}),this.featureList.register({id:"containerize",commandEvent:D.a.changeContainerData,label:this.translate.instant("COMMANDS.USE_AS_FRAME"),shortcuts:[],data:{},shortcutText:"",transformer:ge.a,attachKeyEventToData:!1,context:Be.a.Canvas,icon:"nu-ic-frame"}),this.featureList.register({id:"switchShape",commandEvent:D.a.switchShape,dataType:y.d.GRID_IMAGES,label:this.translate.instant("COMMANDS.SWITCHSHAPE"),shortcuts:[],data:{},icon:"",attachKeyEventToData:!1,context:Be.a.CanvasSelected,tooltip:this.translate.instant("COMMANDS.SWITCHSHAPE"),transformer:yi.a}),this.featureList.register({id:"showConnector",commandEvent:D.a.toggleConnectorVisibility,label:this.translate.instant("COMMANDS.SHOW_CONNECTOR"),shortcuts:[],data:{hideConnector:!0,selection:!0},shortcutText:"",icon:"nu-ic-line",context:Be.a.Canvas,transformer:xn.a}),this.featureList.register({id:"hideConnector",commandEvent:D.a.toggleConnectorVisibility,label:this.translate.instant("COMMANDS.HIDE_CONNECTOR"),shortcuts:[],data:{hideConnector:!1,selection:!0},shortcutText:"",icon:"nu-ic-line",context:Be.a.Canvas,transformer:xn.a}),this.featureList.register({id:"vizPrompt",dataType:y.d.OPTION_LIST,commandEvent:D.a.vizPrompt,label:"",shortcuts:[],data:{},shortcutText:"",icon:"viz",removeItemMarginbottom:!0,context:Be.a.Canvas,transformer:Ai.a}),this.featureList.register({id:"convertToObject",commandEvent:D.a.openConvertToObjectDialog,label:this.translate.instant("COMMANDS.CONVERT_TO_OBJECT"),shortcuts:[],data:{},shortcutText:"",icon:"nu-ic-data",context:Be.a.CanvasSelected,transformer:Li.a}),this.featureList.register({id:"convertToPredefinedObject",commandEvent:D.a.openConvertToObjectDialog,dataType:y.d.OPTION_LIST,label:this.translate.instant("COMMANDS.CONVERT_TO_OBJECT"),shortcuts:[],data:{value:[{id:"convert-to-object",label:this.translate.instant("COMMANDS.CONVERT_TO_OBJECT"),itemIcon:{type:"svg",value:"data"},value:"convertToObject"},{id:"learn-more",label:this.translate.instant("COMMANDS.LEARN_MORE"),itemIcon:{type:"svg",value:"help"},value:"learnMore"}]},shortcutText:"",icon:"data",context:Be.a.CanvasSelected,tooltip:this.translate.instant("TOOLTIPS.CONVERT_TO_OBJECT"),alterFunctions:{getApplyData:function(t,e){return e&&"learnMore"===e.value?Object($.a)({learnMore:!0}):Object($.a)({defId:""})},isEnabled:function(e){return t.state.changes("CurrentProject").pipe(Object(j.a)(1),Object(I.a)((function(t){return"home"!==t})))}}}),this.featureList.register({id:"pasteAsItem",commandEvent:D.a.pasteAsItem,dataType:y.d.OPTION_LIST,label:this.translate.instant("COMMANDS.PASTE_AS"),shortcuts:[],data:{value:[{id:"new-object",label:this.translate.instant("COMMANDS.PASTE_AS_NEW_OBJECT"),itemIcon:{type:"svg",value:"paste-data"},value:"newObject"},{id:"linked-object",label:this.translate.instant("COMMANDS.PASTE_AS_LINKED_OBJECT"),itemIcon:{type:"svg",value:"paste-linked"},value:"linkedObject"},{id:"blank-object",label:this.translate.instant("COMMANDS.PASTE_AS_BLANK_OBJECT"),itemIcon:{type:"svg",value:"paste-blank"},value:"blankObject"}]},shortcutText:"",icon:"data",context:Be.a.CanvasSelected,tooltip:this.translate.instant("TOOLTIPS.PASTE_AS"),alterFunctions:{isEnabled:function(e){return t.state.changes("originalEDataLinks").pipe(Object(j.a)(1),Object(I.a)((function(e){return e&&Object.keys(e).length>0&&"home"!==t.state.get("CurrentProject")})))},getApplyData:function(t,e){return Object($.a)({pasteAs:e.value})}}}),this.featureList.register({id:"toggleDataFields",dataType:y.d.OPTION_LIST,commandEvent:D.a.toggleDataFields,label:this.translate.instant("COMMANDS.ADD_DATA_FIELDS"),shortcuts:[],data:{header:this.translate.instant("LABELS.DATA_FIELDS").toUpperCase(),actionLabel:this.translate.instant("LABELS.SHOW_ALL")},shortcutText:"",context:Be.a.Canvas,icon:"add-data-fields",transformer:Ri.a,tooltip:this.translate.instant("TOOLTIPS.ADD_DATA_FIELDS")}),this.featureList.register({id:"createNewSlideFromSelection",commandEvent:D.a.updatePresentation,label:this.translate.instant("LABELS.NEW_SLIDE"),shortcuts:[],data:{},shortcutText:"",icon:"nu-ic-add-slide",context:Be.a.Canvas,transformer:Vi.a,tooltip:this.translate.instant("LABELS.NEW_SLIDE")}),this.featureList.register({id:"showGrid",commandEvent:D.a.changeGridGuidesShowSnap,label:this.translate.instant("LABELS.SHOW_GRID"),shortcuts:[],data:{},shortcutText:"",context:Be.a.Canvas,transformer:Ui.a}),this.featureList.register({id:"snapToGrid",commandEvent:D.a.changeGridGuidesShowSnap,label:this.translate.instant("LABELS.SNAP_TO_GRID"),shortcuts:[],data:{},shortcutText:"",context:Be.a.Canvas,transformer:Ui.a}),this.featureList.register({id:"showGuides",commandEvent:D.a.changeGridGuidesShowSnap,label:this.translate.instant("LABELS.SHOW_GUIDES"),shortcuts:[],data:{},shortcutText:"",context:Be.a.Canvas,transformer:Ui.a}),this.featureList.register({id:"snapToGuides",commandEvent:D.a.changeGridGuidesShowSnap,label:this.translate.instant("LABELS.SNAP_TO_GUIDES"),shortcuts:[],data:{},shortcutText:"",context:Be.a.Canvas,transformer:Ui.a}),this.featureList.register({id:"addFrame",commandEvent:D.a.addShapeByDefId,label:this.translate.instant("COMMANDS.ADD_FRAME"),shortcuts:[],data:{defId:"creately.basic.frame_paper",version:"1"},shortcutText:"",icon:"nu-ic-paper-frame",context:Be.a.Canvas,transformer:Ui.a}),this.featureList.register({id:"addTemplate",commandEvent:D.a.addTemplate,label:this.translate.instant("COMMANDS.ADD_TEMPLATE"),shortcuts:[],data:{},shortcutText:"",icon:"nu-ic-templates-2",context:Be.a.Canvas}),this.featureList.register({id:"collapseExapndBranch",commandEvent:D.a.collapseExapndBranch,label:this.translate.instant("COMMANDS.ADD_TEMPLATE"),shortcuts:[{keySequence:[y.m.Meta,y.m.P],repeatOnKeyPress:300}],data:{},shortcutText:"",icon:"nu-ic-templates-2",context:Be.a.CanvasSelected})},e.prototype.handleDocumentDatatPostMessageSubscribe=function(){var t=this,e=Object(x.a)(this.ll.forCurrent(!0).getDiagramOnce().pipe(Object(I.a)((function(t){return{data:t}}))),this.ll.forCurrent(!0).getDiagramChanges().pipe(Object(I.a)((function(t){return{modifier:t}})))).pipe(Object(M.a)((function(e){return t.postmessage.sendToParent("document:data",e)}))).subscribe();this.subs.push(e),this.subscribedPostMessages.push("document:data:subscribe")},e.prototype.handleShapeSelectPostMessageSubscribe=function(){var t=this,e=this.state.changes("Selected").pipe(Object(M.a)((function(e){return t.postmessage.sendToParent("shape:select",{shapeIds:e})}))).subscribe();this.subs.push(e),this.subscribedPostMessages.push("shape:select:subscribe")},e.prototype.handleCommandExecute=function(t){t&&t.commandName&&t.payload&&this.subs.push(Mi.executeCommand(this.commandService,t.commandName,t.payload).subscribe())},e.prototype.getEditorInteractionHandler=function(t){return t===pt.b.Normal?se:t===pt.b.Pan?an.a:t===pt.b.Text?ce.b:t===pt.b.Comment?Cn.a:t===pt.b.Pen?(this.updateFreeHandLastUsedItemState(t),vi.a):t===pt.b.Highlighter?(this.updateFreeHandLastUsedItemState(t),Ni.a):t===pt.b.Rectangle||t===pt.b.StickyNote||t===pt.b.BasicCard?Pi:de},e.prototype.updateFreeHandLastUsedItemState=function(t){var e=this.state.get("FreeHandLastUsedItem"),n="highlighter"===t?{styles:{"stroke-width":20,"stroke-dasharray":"0, 0",stroke:"#ffff0066"}}:"pen"===e.state?e:{state:pt.b.Pen,styles:{"stroke-width":2,"stroke-dasharray":"0, 0",stroke:"#000000"}};this.state.set("FreeHandLastUsedItem",{state:t,styles:n.styles})},e.prototype.getLibrariesForCurrentDoc=function(){var t=this,e=this.state;return this.ll.forCurrentObserver(!1).pipe(Object(T.a)((function(n){return n.getDiagramModel().pipe(Object(E.a)((function(t){return!!t&&!!t.name})),Object(j.a)(1),Object(M.a)((function(n){var i,a=n.getLibraries(t.authService.currentUserId);a&&a.length>0?(i=a.map((function(e){return{id:e[0],type:jn.c.Static,libGroup:t.libraryList.getMainGroupForLibrary(e[0]),status:"loading",isCollapsed:e[1]===y.q.Collapsed}})),t.state.set("CurrentLibraryGroup",i[0].libGroup)):(t.state.set("CurrentLibraryGroup","Shapes"),i=[{id:"sticky",type:jn.c.Static,libGroup:t.libraryList.getMainGroupForLibrary("sticky"),status:"loading",isCollapsed:!1,order:1},{id:"popular-diagrams",type:jn.c.Static,libGroup:t.libraryList.getMainGroupForLibrary("popular-diagrams"),status:"loading",isCollapsed:!1,order:2},{id:"reaction",type:jn.c.Static,libGroup:t.libraryList.getMainGroupForLibrary("reaction"),status:"loading",isCollapsed:!1,order:3},{id:"common-shapes",type:jn.c.Static,libGroup:t.libraryList.getMainGroupForLibrary("common-shapes"),status:"loading",isCollapsed:!1,order:4},{id:"concept-map",type:jn.c.Static,libGroup:t.libraryList.getMainGroupForLibrary("concept-map"),status:"loading",isCollapsed:!1,order:5},{id:"mindmap",type:jn.c.Static,libGroup:t.libraryList.getMainGroupForLibrary("mindmap"),status:"loading",isCollapsed:!1,order:6},{id:"org-chart",type:jn.c.Static,libGroup:t.libraryList.getMainGroupForLibrary("org-chart"),status:"loading",isCollapsed:!1,order:7},{id:"flowchart",type:jn.c.Static,libGroup:t.libraryList.getMainGroupForLibrary("flowchart"),status:"loading",isCollapsed:!1,order:8}]),e.set("CurrentLibraries",i)})))})))},e.\u0275fac=function(t){return new(t||e)(o.qc(i.Nb),o.qc("GridService"),o.qc(Le.a),o.qc(o.C),o.qc(Ne.a),o.qc(Re.a),o.qc(b.a),o.qc(r.e),o.qc(i.F),o.qc(i.ub),o.qc(i.B),o.qc(De.m),o.qc(ve.a),o.qc($t.a),o.qc(De.a),o.qc(Si.a),o.qc(k.n),o.qc(De.B),o.qc(i.kb),o.qc(g.g),o.qc(ki))},e.\u0275prov=o.cc({token:e,factory:e.\u0275fac}),e}(Ae.a),Ji=n("sEIs"),$i=n("nIj0"),ta=n("xcrX"),ea=n("z3tU"),na=n("5Jpj"),ia=n("6T0K"),aa=n("Kz6v"),oa=n("lP4r"),ra=n("B82N"),sa=n("fRR/"),ca=n("yZNT"),la=n("P1E4"),ua=n("A7ZO"),da=n("8EYK"),pa=n("Sf0Q"),ha=n("YIQW"),ga=n("jHi0"),fa=n("K0+f"),ba=n("1OUs"),ma=function(){return["MouseControlState","pen","active"]},va=function(t){return{value1:"pen",value2:t}},ya=function(t){return{event:"fab.button.quick.click",data:t}};function Sa(t,e){if(1&t){var n=o.nc();o.mc(0,"button",5),o.uc("click",(function(){return o.Rc(n),o.yc().setMouseControlState("pen")})),o.hc(1,"img",12),o.lc()}if(2&t){var i=o.yc();o.Dc("ifStateClass",o.Hc(2,ma))("trackAction",o.Ic(5,ya,o.Ic(3,va,i.freeHandStatus)))}}var Oa=function(){return["MouseControlState","highlighter","active"]},xa=function(t){return{value1:"highlighter",value2:t}};function Ca(t,e){if(1&t){var n=o.nc();o.mc(0,"button",5),o.uc("click",(function(){return o.Rc(n),o.yc().setMouseControlState("highlighter")})),o.xc(),o.mc(1,"svg",13),o.hc(2,"use",14),o.lc(),o.lc()}if(2&t){var i=o.yc();o.Dc("ifStateClass",o.Hc(2,Oa))("trackAction",o.Ic(5,ya,o.Ic(3,xa,i.freeHandStatus)))}}var Pa=function(){return{event:"left.toolbar.templates.click"}},Ta=function(){return["MouseControlState","rectangle","active"]},wa=function(){return{value1:"rectangle"}},ja=function(){return["MouseControlState","basic-card","active"]},Ma=function(){return{value1:"card"}},Ia=function(){return["MouseControlState","sticky-note","active"]},Ea=function(){return{value1:"sticky-note"}},Da=function(){return["MouseControlState","text","active"]},_a=function(){return{value1:"text"}},ka=function(){return["MouseControlState","line","active","connector"]},Aa=function(){return{value1:"line"}},La=function(){function t(t,e,n){this.state=t,this.defLocator=e,this.commandService=n}return Object.defineProperty(t.prototype,"lastUsedFreeHandItem",{get:function(){return this.state.changes("FreeHandLastUsedItem").pipe(Object(I.a)((function(t){return t.state})))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"freeHandStatus",{get:function(){var t=[pt.b.Pen,pt.b.Highlighter];return i.Pb.track("toolbar.freehand.click"),t.includes(this.state.get("MouseControlState"))?"close":"open"},enumerable:!1,configurable:!0}),t.prototype.handleMoreButtonClick=function(){this.handleShowTemplates()},t.prototype.setMouseControlState=function(t){t!==this.state.get("MouseControlState")?this.commandService.dispatch(gt.a.changeMouseControlState,{state:t}):this.commandService.dispatch(gt.a.changeMouseControlState,{state:pt.b.Normal})},t.prototype.handleDragStart=function(t,e){var n=this;return this.defLocator.getDefinition(e).pipe(Object(j.a)(1),Object(M.a)((function(e){n.commandService.dispatch(gt.a.changeMouseControlState,{state:pt.b.Normal});var i=t.target.querySelector(".thumbnail-drag");t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("Text",JSON.stringify(e)),t.dataTransfer.setData("TrackingInfo",JSON.stringify({location:"FAB.QuickTool",library:"QuickTool"})),i&&t.dataTransfer.setDragImage(i,i.width/2,i.height/2)}))).subscribe()},t.prototype.handleShowTemplates=function(){this.state.set("TemplateOriginLocation","floating-panel"),this.state.set("ToggleTemplatesModal",!0)},t.\u0275fac=function(e){return new(e||t)(o.gc(i.Nb),o.gc(Ye.a),o.gc(i.B))},t.\u0275cmp=o.ac({type:t,selectors:[["insert-buttons-container"]],decls:38,vars:38,consts:[[1,"fx-justify-space-between","fx-center-all"],["placement","top","tooltip",""],[1,"btn-medium","btn-icon","fx-center-all","fx-padding-8",3,"trackAction","click"],["src","./assets/images/quick-tool/templates.svg",1,"nu-icon","quick-tool-icon"],["translate","",1,"tooltip-content"],[1,"btn-medium","btn-icon","fx-center-all","fx-padding-8",3,"ifStateClass","trackAction","click"],["src","./assets/images/quick-tool/rectangle.svg",1,"nu-icon","quick-tool-icon"],["src","./assets/images/quick-tool/card.svg",1,"nu-icon","quick-tool-icon"],["src","./assets/images/quick-tool/sticky.svg",1,"nu-icon","quick-tool-icon"],["src","./assets/images/quick-tool/text.svg",1,"nu-icon","quick-tool-icon"],["src","./assets/images/quick-tool/arrow.svg",1,"nu-icon","quick-tool-icon"],["class","btn-medium btn-icon fx-center-all fx-padding-8",3,"ifStateClass","trackAction","click",4,"ngIf"],["src","./assets/images/quick-tool/freehand.svg",1,"nu-icon","quick-tool-icon","nu-ic-pen"],[1,"nu-icon","nu-ic-highlighter"],[0,"xlink","href","./assets/icons/symbol-defs.svg#nu-ic-highlighter"]],template:function(t,e){1&t&&(o.mc(0,"div",0),o.mc(1,"div",1),o.mc(2,"button",2),o.uc("click",(function(){return e.handleMoreButtonClick()})),o.hc(3,"img",3),o.lc(),o.mc(4,"span",4),o.gd(5,"TOOLTIPS.TEMPLATES"),o.lc(),o.lc(),o.mc(6,"div",1),o.mc(7,"button",5),o.uc("click",(function(){return e.setMouseControlState("rectangle")})),o.hc(8,"img",6),o.lc(),o.mc(9,"span",4),o.gd(10,"TOOLTIPS.ADD_RECTANGLE"),o.lc(),o.lc(),o.mc(11,"div",1),o.mc(12,"button",5),o.uc("click",(function(){return e.setMouseControlState("basic-card")})),o.hc(13,"img",7),o.lc(),o.mc(14,"span",4),o.gd(15,"TOOLTIPS.ADD_CARD"),o.lc(),o.lc(),o.mc(16,"div",1),o.mc(17,"button",5),o.uc("click",(function(){return e.setMouseControlState("sticky-note")})),o.hc(18,"img",8),o.lc(),o.mc(19,"span",4),o.gd(20,"TOOLTIPS.ADD_STICKY_NOTE"),o.lc(),o.lc(),o.mc(21,"div",1),o.mc(22,"button",5),o.uc("click",(function(){return e.setMouseControlState("text")})),o.hc(23,"img",9),o.lc(),o.mc(24,"span",4),o.gd(25,"TOOLTIPS.ADD_TEXT"),o.lc(),o.lc(),o.mc(26,"div",1),o.mc(27,"button",5),o.uc("click",(function(){return e.setMouseControlState("line")})),o.hc(28,"img",10),o.lc(),o.mc(29,"span",4),o.gd(30,"TOOLTIPS.LINE"),o.lc(),o.lc(),o.mc(31,"div",1),o.ed(32,Sa,2,7,"button",11),o.zc(33,"async"),o.ed(34,Ca,3,7,"button",11),o.zc(35,"async"),o.mc(36,"span",4),o.gd(37,"TOOLTIPS.FREEHANDTOOL"),o.lc(),o.lc(),o.lc()),2&t&&(o.Sb(2),o.Dc("trackAction",o.Hc(17,Pa)),o.Sb(5),o.Dc("ifStateClass",o.Hc(18,Ta))("trackAction",o.Ic(20,ya,o.Hc(19,wa))),o.Sb(5),o.Dc("ifStateClass",o.Hc(22,ja))("trackAction",o.Ic(24,ya,o.Hc(23,Ma))),o.Sb(5),o.Dc("ifStateClass",o.Hc(26,Ia))("trackAction",o.Ic(28,ya,o.Hc(27,Ea))),o.Sb(5),o.Dc("ifStateClass",o.Hc(30,Da))("trackAction",o.Ic(32,ya,o.Hc(31,_a))),o.Sb(5),o.Dc("ifStateClass",o.Hc(34,ka))("trackAction",o.Ic(36,ya,o.Hc(35,Aa))),o.Sb(5),o.Dc("ngIf","pen"===o.Ac(33,13,e.lastUsedFreeHandItem)),o.Sb(2),o.Dc("ngIf","highlighter"===o.Ac(35,15,e.lastUsedFreeHandItem)))},directives:[ga.a,fa.a,r.a,ba.a,k.t],pipes:[k.b],styles:[".quick-tool-icon[_ngcontent-%COMP%]{width:24px;height:24px}"],changeDetection:0}),t}(),Ba=n("1IJ2"),Ra=function(t){function e(e,n,i,a){var o=t.call(this,e)||this;return o.state=e,o.loader=n,o.planPermManager=i,o.libraryList=a,o}return Object(W.e)(e,t),e.prototype.openLibrary=function(t){var e=this;i.Pb.track("left.shapes.search.library.click",{value1Type:"libName",value1:t.title}),this.loader.load(t.id,0,-1).pipe(Object(j.a)(1)).subscribe((function(n){var i=e.state.get("CurrentLibraries");if(!i.map((function(t){return t.id})).includes(t.id)){var a=e.libraryList.getMainGroupForLibrary(t.id);e.state.set("CurrentLibraries",Object(W.j)(i,[{id:t.id,type:n.type,libGroup:a,status:"loading"}])),e.state.set("CurrentLibraryGroup",a)}}))},e.\u0275fac=function(t){return new(t||e)(o.gc(i.Nb),o.gc(ta.a),o.gc(De.m),o.gc(Si.a))},e.\u0275cmp=o.ac({type:e,selectors:[["library-search-item"]],inputs:{item:"item"},features:[o.Pb],decls:10,vars:1,consts:[[1,"library-search-item-container","search-result-item","fx-ellipsis",3,"click"],[1,"library-search-item-icon"],[1,"nu-icon"],[0,"xlink","href","./assets/icons/symbol-defs.svg#nu-ic-library"],[1,"library-search-item-label","caption","fx-ellipsis"],[1,"caption","grey","fx-margin-top-5"]],template:function(t,e){1&t&&(o.mc(0,"div",0),o.uc("click",(function(){return e.openLibrary(e.item)})),o.mc(1,"div",1),o.xc(),o.mc(2,"svg",2),o.hc(3,"use",3),o.lc(),o.lc(),o.wc(),o.mc(4,"label",4),o.gd(5),o.hc(6,"br"),o.mc(7,"span",5),o.gd(8,"Open Library"),o.lc(),o.lc(),o.hc(9,"div"),o.lc()),2&t&&(o.Sb(5),o.id(" ",e.item.title," "))},styles:[".search-result-item[_ngcontent-%COMP%]{display:flex;align-items:center;cursor:pointer}.search-result-item[_ngcontent-%COMP%]:hover   label[_ngcontent-%COMP%]{color:#04263d;cursor:pointer}.library-search-item-icon[_ngcontent-%COMP%]{width:40px}.library-search-item-label[_ngcontent-%COMP%]{padding-left:.375rem;flex:1}.library-search-item-label[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:block}"],changeDetection:0}),e}(Ba.a),Na=n("pYIu"),Ha=n("TdEb"),Fa=n("pVzg"),Ga=["searchDDBtn"];function qa(t,e){if(1&t){var n=o.nc();o.xc(),o.wc(),o.mc(0,"simple-dropdown-item",10),o.uc("click",(function(){o.Rc(n);var t=e.$implicit;return o.yc().emitChange(t)})),o.mc(1,"div",11),o.xc(),o.mc(2,"svg",12),o.hc(3,"use"),o.lc(),o.wc(),o.mc(4,"a",13),o.gd(5),o.lc(),o.lc(),o.lc()}if(2&t){var i=e.$implicit;o.Dc("item",i),o.Sb(3),o.Tb("href","./assets/icons/symbol-defs.svg#nu-ic-"+i.icon,null,"xlink"),o.Sb(2),o.hd(i.label)}}var Va=function(){return{closeOnItemClicked:!0,openOnHover:!1,closeOnBlur:!1,multiselectable:!1}},Ua=function(){function t(){this.change=new O.a("search")}return Object.defineProperty(t.prototype,"icon",{get:function(){var t=this.items.find((function(t){return t.selected}));if(t)return t.icon},enumerable:!1,configurable:!0}),t.prototype.emitChange=function(t){this.change.next(t.id),this.onClick()},t.prototype.onClick=function(){var t=this.searchBtn.nativeElement;t.classList.contains("open-search")?t.classList.remove("open-search"):t.classList.add("open-search")},t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=o.ac({type:t,selectors:[["search-type-dropdown"]],viewQuery:function(t,e){var n;(1&t&&o.ld(Ga,!0),2&t)&&(o.Mc(n=o.vc())&&(e.searchBtn=n.first))},inputs:{items:"items"},outputs:{change:"change"},decls:11,vars:4,consts:[[1,"dd-container"],["direction","top",3,"settings"],["dropdown",""],["ddbutton","",3,"clicked"],[1,"dd-button","btn-icon"],["searchDDBtn",""],[1,"nu-icon","nu-icon-small"],[1,"nu-icon","dd-arrow"],[0,"xlink","href","./assets/icons/symbol-defs.svg#nu-ic-collapse-fill"],["class","dd-items-container","dditem","",3,"item","click",4,"ngFor","ngForOf"],["dditem","",1,"dd-items-container",3,"item","click"],[1,"search-type-item","btn-small","fx-no-margin","no-border"],[1,"nu-icon","nu-icon-small","nu-icon-primary-fill"],[1,"body"]],template:function(t,e){1&t&&(o.mc(0,"div",0),o.mc(1,"abs-dropdown",1,2),o.mc(3,"simple-dropdown-button",3),o.uc("clicked",(function(){return e.onClick()})),o.mc(4,"div",4,5),o.xc(),o.mc(6,"svg",6),o.hc(7,"use"),o.lc(),o.mc(8,"svg",7),o.hc(9,"use",8),o.lc(),o.lc(),o.lc(),o.ed(10,qa,6,3,"simple-dropdown-item",9),o.lc(),o.lc()),2&t&&(o.Sb(1),o.Dc("settings",o.Hc(3,Va)),o.Sb(6),o.Tb("href","./assets/icons/symbol-defs.svg#nu-ic-"+e.icon,null,"xlink"),o.Sb(3),o.Dc("ngForOf",e.items))},directives:[Na.a,Ha.a,k.s,Fa.a],styles:[".dd-button[_ngcontent-%COMP%]{margin-left:.75rem;padding:.25rem;display:flex;align-items:center;border-radius:6px}.dd-button[_ngcontent-%COMP%]   .nu-icon[_ngcontent-%COMP%]{fill:#64767d}.dd-arrow[_ngcontent-%COMP%]{transform:rotate(90deg);width:10px}.open-search[_ngcontent-%COMP%]{background:#e1f1fb}.open-search[_ngcontent-%COMP%]   .nu-icon[_ngcontent-%COMP%]{fill:#08436b}.dd-container[_ngcontent-%COMP%]  .abs-dropdown-items-container{margin-top:.375rem;min-width:313px;min-height:72px;border:none;box-shadow:0 4px 9px -2px rgba(39,41,50,.12)}.dd-container[_ngcontent-%COMP%]  .abs-dropdown-inner-wrapper{margin-left:.375rem}.dd-items-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;border-radius:6px}.search-type-item[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;align-items:center;height:28px;width:100%}.search-type-item[_ngcontent-%COMP%]   .nu-icon[_ngcontent-%COMP%]{margin-right:.625rem}"],changeDetection:0}),t}(),za=n("hX56"),Ya=n("P4Xx"),Xa=n("55zG"),Ka=n("ZC55"),Wa=["textInput"];function Za(t,e){1&t&&(o.mc(0,"div",4),o.hc(1,"panel-search-results"),o.lc())}var Qa=function(t){function e(e,n,i,a,o,r,s,c,l,u,d,p){var h=t.call(this,n)||this;return h.modalController=e,h.state=n,h.searchService=i,h.defLocator=a,h.elementRef=o,h.loader=r,h.commandService=s,h.vToDcoordinate=c,h.datastore=l,h.translateService=u,h.libraryList=d,h.shapeManageService=p,h.isOpen=new O.a(!1),h.searchResults=new O.a([]),h.allLibWithShapeDefs=[],h.placeholder="PLACEHOLDERS.SEARCH_ITEMS",h.childItems=[],h.subs=[],h.lastSearchTime=0,h.onSearchQueryChange=new O.a(""),h}return Object(W.e)(e,t),e.prototype.focus=function(){this.textInput.focus()},e.prototype.clear=function(){this.textInput.clear()},e.prototype.ngOnInit=function(){var t=this;this.subs.push(this.getMouseDownEventOnDocument().subscribe(),this.loadAllLibrariesWithShapes().pipe(Object(T.a)((function(){return t.onSearchQueryChange})),Object(T.a)((function(e){return e.length>2?t.isOpen.next(!0):t.isOpen.next(!1),C.a}))).subscribe(),this.libraryStatusChange().subscribe())},e.prototype.libraryStatusChange=function(){var t=this;return this.state.changes("CurrentLibraries").pipe(Object(M.a)((function(){t.onSearchQueryChange.next("")})))},e.prototype.clickOut=function(t){this.elementRef.nativeElement.contains(t.target)&&("text"===t.target.type&&this.onSearchQueryChange.getValue().length>2||"text"!==t.target.type)?this.isOpen.next(!0):this.isOpen.next(!1)},e.prototype.handleKeydown=function(t){t.keyCode===y.m.Enter&&Date.now()-this.lastSearchTime>1500&&(this.lastSearchTime=Date.now(),this.filterShapesAndSetState())},e.prototype.createShapeTemplateItem=function(t){return{id:t.defId,title:t.name,type:"shape",data:t,thumbnailType:"image",thumbnailUrl:t.thumbnail}},e.prototype.ngOnDestroy=function(){for(;this.subs.length>0;)this.subs.pop().unsubscribe()},e.prototype.openLibBrowser=function(){i.Pb.track("left.shapes.search.browseShapes"),this.modalController.show(Ka.a)},e.prototype.openGoogleSearch=function(){i.Pb.track("left.shapes.search.google"),this.state.set("ShapeSearchQuery",this.textInput.value),this.state.set("SelectedFloatingPanel","asset")},e.prototype.filterShapesAndSetState=function(){var t=this.searchResults.getValue().filter((function(t){return"shape"===t.type}));this.setState(t,this.onSearchQueryChange.getValue())},e.prototype.getDataForTracking=function(t){if(t)return{shapesCount:t.filter((function(t){return"shape"===t.type})).length,libsCount:t.filter((function(t){return"libs"===t.type})).length}},e.prototype.search=function(t){return Object(Ya.a)([this.searchAllByName(t),this.searchShapesByTags(t)]).pipe(Object(I.a)((function(t){var e=Object(W.h)(t,2),n=e[0],i=e[1],a=n.concat(i);return Object(J.uniqBy)(a,"id")})))},e.prototype.searchShapesByTags=function(t){var e=this;return this.searchShapes(t,["tags"]).pipe(Object(T.a)((function(t){var n=t.map((function(t){return t.id})),i=e.getLibrariesAndNonMatchingDefs(n),a=t.filter((function(t){return i.defIds.includes(t.id)})).map((function(t){return e.defLocator.getDefinition(t.id,t.version).pipe(Object(I.a)((function(t){return e.createLibraryItem(t)})))}));return a.length>0?Object(Ya.a)(a).pipe(Object(I.a)((function(t){return i.libs.concat(t)}))):i.libs.length>0?Object($.a)(i.libs):Object($.a)([])})))},e.prototype.searchAllByName=function(t){var e=this;return Object(Ya.a)(this.searchShapes(t,["name"]),this.searchLibs(t,["label"])).pipe(Object(T.a)((function(t){var n=Object(W.h)(t,2),i=n[0],a=n[1],o=e.sortResultsByScore(i.concat(a));return e.updateSearchResults(o)})))},e.prototype.createLibraryItem=function(t){return"template"===t.type?this.createShapeTemplateItem(t):this.createShapeCanvasItem(t)},e.prototype.addShape=function(t,e,n){e=this.vToDcoordinate.x(e-t.defaultBounds.width/2),n=this.vToDcoordinate.y(n-t.defaultBounds.height/2),this.shapeManageService.addShape(t,e,n).subscribe()},e.prototype.addTemplate=function(t,e,n){var i=this,a=t.defId+":"+t.version;Object(Gt.a)(this.commandService.dispatch(D.a.getTemplate,t.diagram,{templateId:a}),Object(Ln.a)((function(){return i.datastore.findOneLatest(Xa.a,{id:a}).pipe(Object(T.a)((function(t){var a=t.clone({x:i.vToDcoordinate.x(e),y:i.vToDcoordinate.y(n)});return i.commandService.dispatch(D.a.addDiagramShape,{cloned:!0,shapes:a.shapes,groups:a.groups,connections:a.connections,dataDefs:a.dataDefs})})))}))).subscribe()},e.prototype.translate=function(t,e){return this.translateService.get(t,e).pipe(Object(j.a)(1))},e.prototype.doSearch=function(t){var e=this;return this.search(t).pipe(Object(j.a)(1),Object(I.a)((function(t){return e.searchResults.next(t),C.a})))},e.prototype.loadAllLibrariesWithShapes=function(){var t=this,e=[];return this.libraryList.getAllGroups().forEach((function(n){return t.libraryList.getLibrariesInGroup(n).map((function(n){return e.push(t.loader.getLibrary(n.id).pipe(Object(I.a)((function(e){return{shapeIds:t.removeVersionFromDefIds(e.defs),libTitle:n.label,libId:n.id,groups:t.libraryList.getGroupsForLibrary(n.id),libGroup:t.libraryList.getMainGroupForLibrary(n.id)}})),Object(tt.a)((function(){return Object($.a)(void 0)}))))}))})),Ya.a.apply(void 0,Object(W.j)(e)).pipe(Object(M.a)((function(e){e=e.filter((function(t){return!!t})),t.allLibWithShapeDefs=e})))},e.prototype.removeVersionFromDefIds=function(t){return t.map((function(t){var e=t.lastIndexOf(".");return t.substring(0,e)}))},e.prototype.getMouseDownEventOnDocument=function(){var t=this;return Object(P.a)(document,"mousedown").pipe(Object(M.a)((function(e){return t.clickOut(e)})))},e.prototype.getRespectiveLibs=function(t){switch(t){case"icons":return this.libraryList.getAllIconsGroups();case"frames":return this.libraryList.getAllFramesGroups();case"embeds":return this.libraryList.getAllEmbedsGroups();default:return[]}},e.prototype.getLibrariesAndNonMatchingDefs=function(t){var e=this,n=[],i=[];return this.allLibWithShapeDefs.filter((function(t){var n=e.state.get("SelectedFloatingPanel"),i=e.getRespectiveLibs(n);if(!i.length)return!0;var a=!1;return i.forEach((function(e){t.groups.includes(e)&&(a=!0)})),a})).forEach((function(e){var a=e.shapeIds.filter((function(e){return t.includes(e)})),o=(a.length/e.shapeIds.length*100).toFixed(2);parseFloat(o)>80&&(-1===i.findIndex((function(t){return t.id===e.libId}))&&i.push({id:e.libId,title:e.libTitle,type:"libs"}),n=n.concat(a),n=Object(J.uniq)(n))})),{libs:i,defIds:t.filter((function(t){return!n.includes(t)}))}},e.prototype.updateSearchResults=function(t){var e=this;if(t&&t.length>0){var n=t.map((function(t){return"shape"===t.type?e.defLocator.getDefinition(t.id,t.version).pipe(Object(I.a)((function(t){return e.createLibraryItem(t)}))):Object($.a)(t)}));return Object(Ya.a)(n)}return Object($.a)([])},e.prototype.sortResultsByScore=function(t){return t.sort((function(t,e){return t.score<e.score?1:t.score>e.score?-1:0}))},e.prototype.searchShapes=function(t,e){return this.searchService.search(t,["shape"],{keys:e,threshold:-1e4})},e.prototype.searchLibs=function(t,e){return this.searchService.search(t,["libs"],{keys:e,threshold:-1e4})},e.prototype.createShapeCanvasItem=function(t){return{id:t.defId,title:t.name,type:"shape",data:t,thumbnailType:"canvas",canvasIdPrefix:"thumb-search-drop"}},e.\u0275fac=function(t){return new(t||e)(o.gc(i.kb),o.gc(i.Nb),o.gc(ca.a),o.gc(Ye.a),o.gc(o.r),o.gc(ta.a),o.gc(i.B),o.gc(ht.a),o.gc(za.b),o.gc(r.e),o.gc(Si.a),o.gc(xt.a))},e.\u0275cmp=o.ac({type:e,selectors:[["panel-search"]],viewQuery:function(t,e){var n;(1&t&&o.ld(Wa,!0),2&t)&&(o.Mc(n=o.vc())&&(e.textInput=n.first))},inputs:{placeholder:"placeholder"},features:[o.Pb],decls:6,vars:9,consts:[["tooltip-tour-step","fab-1.4.3",1,"search-input-field"],["icon","search-larger","autoFocus","true",3,"showClearButton","emitForInputChange","placeholder","debounce","updateText","keydown"],["textInput",""],["class","search-result-dropdown",4,"ngIf"],[1,"search-result-dropdown"]],template:function(t,e){1&t&&(o.mc(0,"div",0),o.mc(1,"text-input",1,2),o.uc("updateText",(function(t){return e.onSearchQueryChange.next(t)}))("keydown",(function(t){return e.handleKeydown(t)})),o.zc(3,"translate"),o.lc(),o.lc(),o.ed(4,Za,2,0,"div",3),o.zc(5,"async")),2&t&&(o.Sb(1),o.Ec("placeholder",o.Ac(3,5,e.placeholder)),o.Dc("showClearButton",!0)("emitForInputChange",!0)("debounce",100),o.Sb(3),o.Dc("ngIf",o.Ac(5,7,e.isOpen)))},styles:[".search-result-dropdown[_ngcontent-%COMP%]{border-radius:0 0 4px 4px;bottom:68px;left:0;background-color:#fff;width:270px;z-index:3}.search-input-field[_ngcontent-%COMP%]  .text-input-inner{height:40px;position:static;display:flex;flex-flow:row-reverse;align-items:center}.search-input-field[_ngcontent-%COMP%]  .text-input{border:0;border-radius:0;margin-top:0;font-size:16px}.search-input-field[_ngcontent-%COMP%]  .text-input-item.has-icon .text-input{padding:0}.search-input-field[_ngcontent-%COMP%]  .text-input-item.has-icon .text-input-icon{margin:10px}.search-input-field[_ngcontent-%COMP%]  .text-input-icon{position:static;color:#899092;width:24px;height:24px}"],changeDetection:0}),e}(Ba.a),Ja=n("SKds"),$a=n("crdX"),to=n("H+7l");function eo(t,e){if(1&t){var n=o.nc();o.mc(0,"div",6),o.uc("click",(function(){return o.Rc(n),o.yc(2).filterShapesAndSetState()})),o.mc(1,"label",7),o.gd(2),o.zc(3,"async"),o.lc(),o.lc()}if(2&t){var i=o.yc(2);o.Sb(2),o.hd(o.Ac(3,1,i.getSearchResultsLabel()))}}function no(t,e){if(1&t&&(o.mc(0,"div"),o.mc(1,"p",8),o.gd(2,"LABELS.NO_SEARCH_RESULTS "),o.lc(),o.hc(3,"message-card",9),o.lc()),2&t){var n=o.yc(2);o.Sb(3),o.Dc("title",n.suggestionsTitle)("body",n.suggestionsBody)("titleIcon",n.emptyStateIcon)}}function io(t,e){if(1&t){var n=o.nc();o.mc(0,"shape-search-item",14,15),o.uc("click",(function(){o.Rc(n);var t=o.yc().$implicit;return o.yc(3).handleShapeClick(t.data)}))("dragstart",(function(t){o.Rc(n);var e=o.yc().$implicit;return o.yc(3).handleDragStart(t,e.data)})),o.lc()}if(2&t){var i=o.yc().$implicit;o.Dc("item",i)}}function ao(t,e){if(1&t&&o.hc(0,"library-search-item",16),2&t){var n=o.yc().$implicit;o.Dc("item",n)}}function oo(t,e){if(1&t&&(o.mc(0,"div"),o.ed(1,io,2,1,"shape-search-item",12),o.ed(2,ao,1,1,"library-search-item",13),o.lc()),2&t){var n=e.$implicit;o.Sb(1),o.Dc("ngIf","shape"===n.type),o.Sb(1),o.Dc("ngIf","libs"===n.type)}}var ro=function(){return{scrollYMarginOffset:1}};function so(t,e){if(1&t&&(o.mc(0,"perfect-scrollbar",10),o.mc(1,"div"),o.ed(2,oo,3,2,"div",11),o.lc(),o.lc()),2&t){var n=o.yc().ngIf;o.Dc("config",o.Hc(2,ro)),o.Sb(2),o.Dc("ngForOf",n)}}function co(t,e){if(1&t&&(o.mc(0,"div",1),o.mc(1,"div",2),o.ed(2,eo,4,3,"div",3),o.ed(3,no,4,3,"div",4),o.lc(),o.ed(4,so,3,3,"perfect-scrollbar",5),o.lc()),2&t){var n=e.ngIf;o.Sb(2),o.Dc("ngIf",n.length>0),o.Sb(1),o.Dc("ngIf",0===n.length),o.Sb(1),o.Dc("ngIf",n.length>0)}}var lo=function(t){function e(e,n,i,a,o,r,s,c,l,u,d,p){var h=t.call(this,e,n,i,a,o,r,s,c,l,u,d,p)||this;return h.modalController=e,h.state=n,h.searchService=i,h.defLocator=a,h.elementRef=o,h.loader=r,h.commandService=s,h.vToDcoordinate=c,h.datastore=l,h.translateService=u,h.libraryList=d,h.shapeManageService=p,h.searchResults=new O.a([]),h.placeholder="PLACEHOLDERS.SEARCH_ITEMS",h.childItems=[],h.subs=[],h.lastSearchTime=0,h.onSearchQueryChange=new O.a(""),h}return Object(W.e)(e,t),Object.defineProperty(e.prototype,"suggestionsTitle",{get:function(){return"LABELS.SUGGESTIONS"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"suggestionsBody",{get:function(){return["LABELS.TRY_DIFF_KEYWORD","LABELS.SWITCH_SEARCH"]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"emptyStateIcon",{get:function(){return"./assets/images/shape-search-result.svg"},enumerable:!1,configurable:!0}),e.prototype.getSearchResultsLabel=function(){return this.translate("LABELS.FOUND_RESULTS",{noOfResults:this.searchResults.getValue().length})},e.prototype.ngOnInit=function(){var t=this;this.subs.push(this.state.changes("ShapeSearchQuery").pipe(Object(et.a)(),Object(M.a)((function(e){return t.onSearchQueryChange.next(e)}))).subscribe(),this.loadAllLibrariesWithShapes().pipe(Object(T.a)((function(){return t.onSearchQueryChange})),Object(T.a)((function(e){return t.doSearch(e)}))).subscribe())},e.prototype.ngOnDestroy=function(){for(;this.subs.length>0;)this.subs.pop().unsubscribe()},e.prototype.handleDragStart=function(t,e){i.Pb.track("left.shapes.search.shape.drag",{value1Type:"shapeDefId",value1:e.defId});var n=t.target.querySelector(".shape-thumbnail-image");t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("Text",JSON.stringify(e)),t.dataTransfer.setData("TrackingInfo",JSON.stringify({location:"FAB"})),t.dataTransfer.setDragImage(n,n.width/2,n.height/2)},e.prototype.handleShapeClick=function(t){i.Pb.track("left.shapes.search.shape.click",{value1Type:"shapeDefId",value1:t.defId});var e=this.state.get("DiagramViewPort");"template"===t.type?this.addTemplate(t,e.centerX,e.centerY):this.addShape(t,e.centerX,e.centerY)},e.\u0275fac=function(t){return new(t||e)(o.gc(i.kb),o.gc(i.Nb),o.gc(ca.a),o.gc(Ye.a),o.gc(o.r),o.gc(ta.a),o.gc(i.B),o.gc(ht.a),o.gc(za.b),o.gc(r.e),o.gc(Si.a),o.gc(xt.a))},e.\u0275cmp=o.ac({type:e,selectors:[["panel-search-results"]],inputs:{placeholder:"placeholder"},features:[o.Pb],decls:2,vars:3,consts:[["class","search-results-dropdown-results",4,"ngIf"],[1,"search-results-dropdown-results"],[1,"fx-margin-top-15","fx-margin-left-10","fx-margin-right-10"],["class","fx-margin-bottom-5",3,"click",4,"ngIf"],[4,"ngIf"],["class","search-result-scrollbar",3,"config",4,"ngIf"],[1,"fx-margin-bottom-5",3,"click"],[1,"grey","body"],["translate","",1,"body","fx-margin-bottom-15","search-result-text"],[3,"title","body","titleIcon"],[1,"search-result-scrollbar",3,"config"],[4,"ngFor","ngForOf"],[3,"item","click","dragstart",4,"ngIf"],[3,"item",4,"ngIf"],[3,"item","click","dragstart"],["tile",""],[3,"item"]],template:function(t,e){1&t&&(o.ed(0,co,5,3,"div",0),o.zc(1,"async")),2&t&&o.Dc("ngIf",o.Ac(1,1,e.searchResults))},directives:[k.t,r.a,Ja.a,$a.b,k.s,to.a,Ra],pipes:[k.b],styles:[".search-results-dropdown-results[_ngcontent-%COMP%]{background-color:#fff;height:100%;bottom:68px;left:0;z-index:3}[_nghost-%COMP%]   .search-result-scrollbar[_ngcontent-%COMP%] {height:calc(100% - 15px)}[_nghost-%COMP%]   .search-result-scrollbar[_ngcontent-%COMP%]  .ps-content{padding-left:.625rem;padding-right:.625rem;padding-top:.5rem}.search-result-text[_ngcontent-%COMP%]{color:#64767d}"],changeDetection:0}),e}(Qa),uo=n("C5+t"),po=n("gg05"),ho=n("xEGh"),go=n("fRBV"),fo=["textInput"];function bo(t,e){1&t&&o.hc(0,"loading-bubbles",10)}function mo(t,e){1&t&&(o.mc(0,"div",11),o.mc(1,"span",12),o.gd(2,"GOOGLE_SEARCH_IMPORT.NO_RESULTS"),o.lc(),o.lc())}var vo=function(){return{event:"left.googleSearch.pd.searchTerm.click"}};function yo(t,e){if(1&t){var n=o.nc();o.mc(0,"a",15),o.uc("click",(function(){o.Rc(n);var t=e.$implicit;return o.yc(2).searchImages(t)})),o.gd(1),o.lc()}if(2&t){var i=e.$implicit;o.Dc("trackAction",o.Hc(2,vo)),o.Sb(1),o.hd(i)}}function So(t,e){if(1&t&&(o.kc(0),o.mc(1,"div",13),o.ed(2,yo,2,3,"a",14),o.zc(3,"async"),o.lc(),o.jc()),2&t){var n=o.yc();o.Sb(2),o.Dc("ngForOf",o.Ac(3,1,n.tags))}}function Oo(t,e){if(1&t){var n=o.nc();o.mc(0,"div",16),o.mc(1,"div",17),o.xc(),o.mc(2,"svg",18),o.hc(3,"use",19),o.lc(),o.lc(),o.wc(),o.mc(4,"div",20),o.mc(5,"p",21),o.gd(6,"GOOGLE_SEARCH_IMPORT.UPGRADE_TITLE"),o.lc(),o.mc(7,"p",22),o.gd(8,"GOOGLE_SEARCH_IMPORT.UPGRADE_DESC"),o.lc(),o.lc(),o.mc(9,"button",23),o.uc("click",(function(){return o.Rc(n),o.yc().goToPlans()})),o.gd(10," LABELS.UPGRADE "),o.lc(),o.lc()}}function xo(t,e){1&t&&(o.mc(0,"div",24),o.mc(1,"div",25),o.mc(2,"p",26),o.gd(3,"OFFLINE.PANEL.HEADING"),o.lc(),o.mc(4,"p",27),o.gd(5,"OFFLINE.PANEL.GOOGLE_SEARCH_PANEL"),o.lc(),o.lc(),o.lc())}function Co(t,e){1&t&&(o.mc(0,"div",24),o.mc(1,"div",25),o.mc(2,"div",28),o.xc(),o.mc(3,"svg",29),o.hc(4,"use",30),o.lc(),o.lc(),o.wc(),o.mc(5,"p",26),o.gd(6,"GOOGLE_SEARCH_IMPORT.SERVICE_UNAVAILABLE.HEADING"),o.lc(),o.mc(7,"p",27),o.gd(8,"GOOGLE_SEARCH_IMPORT.SERVICE_UNAVAILABLE.DESCRIPTION"),o.lc(),o.lc(),o.lc())}function Po(t,e){if(1&t){var n=o.nc();o.mc(0,"library-tile",33,34),o.uc("dragstart",(function(t){o.Rc(n);var i=e.$implicit;return o.yc(2).handleDragStart(t,i.data)}))("mouseenter",(function(t){o.Rc(n);var i=e.$implicit;return o.yc(2).handleMouseEnter(i,t)}))("clicked",(function(t){o.Rc(n);var i=e.$implicit;return o.yc(2).handleClick(t,i.data)}))("mouseleave",(function(t){return o.Rc(n),o.yc(2).handleMouseLeave(t)})),o.lc()}if(2&t){var i=e.$implicit;o.Dc("item",i)}}function To(t,e){if(1&t&&(o.mc(0,"perfect-scrollbar",31),o.ed(1,Po,2,1,"library-tile",32),o.zc(2,"async"),o.lc()),2&t){var n=o.yc();o.Sb(1),o.Dc("ngForOf",o.Ac(2,1,n.items))}}var wo=function(){return["Enter"]},jo=function(t){function e(e,n,i,a,o,r,s){var c=t.call(this,a,i,s)||this;return c.modalController=e,c.translate=n,c.commandService=i,c.state=a,c.ll=o,c.planPermManager=r,c.shapeManageService=s,c.items=new Hn.a,c.searchTags=[],c.tags=new le.a,c.showResultsNotFound=new O.a(!1),c.showUpgradeDialog=new O.a(!1),c.serviceUnavailable=new O.a(!1),c.showLoadingIndicator=new O.a(!1),c.id="google-search-import",c.subs=[],c.trackingInfo={location:"FAB.GoogleSearch"},c}return Object(W.e)(e,t),Object.defineProperty(e.prototype,"appConnectionStatus",{get:function(){var t=this;return this.state.changes(uo.c).pipe(Object(M.a)((function(e){"asset"===t.state.get("SelectedFloatingPanel")&&(e===uo.c.ONLINE?t.tags.next(t.searchTags):e===uo.c.OFFLINE&&(t.items=null))})))},enumerable:!1,configurable:!0}),e.prototype.onOpen=function(){this.isMaxSearchReached()&&this.showUpgradeDialog.next(!0),this.setSearchTags(),this.state.get("ShapeSearchQuery")?(i.Pb.track("left.googleSearch.click",{value1Type:"location",value1:"generalSearch"}),this.searchImages(this.state.get("ShapeSearchQuery")),this.state.set("ShapeSearchQuery","")):i.Pb.track("left.googleSearch.click",{value1Type:"location",value1:"direct"})},e.prototype.searchImages=function(t){var e=this;t.trim().length>0&&!this.showUpgradeDialog.value&&(this.showLoadingIndicator.next(!0),this.items=this.fetchResultsFromAPI(t).pipe(Object(I.a)((function(n){return n?(e.serviceUnavailable.next(!1),n.length>0?(e.onSearchResultsFound(t),n.map((function(t){return e.createImageLibraryItem(t)}))):void e.onNoSearchResultsFound(t)):void e.serviceUnavailable.next(!0)})),Object(M.a)((function(){e.updateMaxSearch(),e.showLoadingIndicator.next(!1)})),Object(In.a)(1)))},e.prototype.handleDragStart=function(t,e){i.Pb.track("left.googleSearch.shape.drag",{value1Type:"imageName",value1:e.name,value2Type:"imageSource",value2:e.url}),this.hidePopoverPreview();var n=t.target.querySelector(".shape-thumbnail-image");t.dataTransfer.effectAllowed="move",e.upload=!0,t.dataTransfer.setData("URLData",JSON.stringify(e)),t.dataTransfer.setDragImage(n,n.width/2,n.height/2)},e.prototype.handleClick=function(t,e){var n=this.state.get("DiagramViewPort");i.Pb.track("left.googleSearch.shape.click",{value1Type:"imageName",value1:e.name,value2Type:"imageSource",value2:e.url});var a={x:n.centerX,y:n.centerY},o=this.shapeManageService.addURLData(e,a.x,a.y).subscribe();this.subs.push(o)},e.prototype.onSearchQueryChange=function(t){0===t.length&&this.showResultsNotFound.next(!1)},e.prototype.goToPlans=function(){i.Pb.track("left.googleSearch.upgrade.click"),window.open(i.m.get("PLAN_PAGE_URL"),"_blank")},e.prototype.setSearchTags=function(){var t=this;this.ll.forCurrent(!1).getDiagramModel().pipe(Object(j.a)(1),Object(M.a)((function(e){t.searchTags=e.searchTags||[],t.tags.next(t.searchTags)}))).subscribe()},e.prototype.fetchResultsFromAPI=function(t){var e=this;return this.doSearch(t,0).pipe(Object(T.a)((function(n){return n?n.length>=10?e.doSearch(t,11).pipe(Object(I.a)((function(t){return n.concat(t)}))):Object($.a)(n):Object($.a)(void 0)})))},e.prototype.doSearch=function(t,e){return this.commandService.dispatch(D.a.getGoogleImages,{query:t,startIndex:e}).pipe(Object(lt.a)(),Object(I.a)((function(t){return t&&t.resultData[1]&&t.resultData[1].items?t.resultData[1].items:[]})),Object(tt.a)((function(){return Object($.a)(void 0)})))},e.prototype.onSearchResultsFound=function(t){i.Pb.track("left.googleSearch.searchTerm",{value1Type:"searchedTerm",value1:t,value2Type:"resultsFound",value2:"true"}),this.updateSearchTags(t),this.showResultsNotFound.next(!1)},e.prototype.onNoSearchResultsFound=function(t){i.Pb.track("left.googleSearch.searchTerm",{value1Type:"searchedTerm",value1:t,value2Type:"resultsFound",value2:"false"}),this.tags.next(this.searchTags),this.showResultsNotFound.next(!0)},e.prototype.updateSearchTags=function(t){this.searchTags.includes(t)||(this.searchTags.push(t),this.tags.next(this.searchTags))},e.prototype.createImageLibraryItem=function(t){return{id:t.image.contextLink,text:{line1:t.title,line2:t.displayLink,line3:t.mime,line4:t.image.width+" x "+t.image.height},popoverCssClass:"google-img-preview-container",type:"image",data:{name:t.title,url:t.link},thumbnailType:"image",thumbnailUrl:t.image.thumbnailLink}},e.prototype.updateMaxSearch=function(){this.updateSearchCount(),this.isMaxSearchReached()&&(this.showUpgradeDialog.next(!0),this.showUpgradeDialogWindow())},e.prototype.isMaxSearchReached=function(){return!this.planPermManager.check([y.t.CREATELY_GOOGLE_SEARCH])&&!this.isNewDay()},e.prototype.updateSearchCount=function(){this.isNewDay()&&(localStorage.googleSearchedDate=(new Date).getTime().toString(),localStorage.googleSearchedCount=0);var t=parseInt(localStorage.googleSearchedCount,10)||0;t++,localStorage.googleSearchedCount=t},e.prototype.isNewDay=function(){var t=new Date(parseFloat(localStorage.googleSearchedDate)),e=new Date;return!i.J.isSameDay(t,e)},e.prototype.hidePopoverPreview=function(){this.state.has("CurrentLibraryPreview")&&this.state.is("CurrentLibraryPreview",{})||this.state.set("CurrentLibraryPreview",{})},e.prototype.showUpgradeDialogWindow=function(){var t={id:y.t.CREATELY_GOOGLE_SEARCH,buttons:[{type:"upgrade",clickHandler:function(){}}],integrationContext:{embedded:this.state.get("ApplicationIsEmbedded"),environment:this.state.get("PluginApp")}};this.modalController.show(De.x,{inputs:{dialogData:t}})},e.\u0275fac=function(t){return new(t||e)(o.gc(i.kb),o.gc(r.e),o.gc(i.B),o.gc(i.Nb),o.gc(b.a),o.gc(De.m),o.gc(xt.a))},e.\u0275cmp=o.ac({type:e,selectors:[["google-search-import-panel"]],viewQuery:function(t,e){var n;(1&t&&o.ld(fo,!0),2&t)&&(o.Mc(n=o.vc())&&(e.textInput=n.first))},features:[o.Pb],decls:26,vars:42,consts:[[1,"google-search-import-panel","left-sidebar-panel"],[1,"left-sidebar-panel-padding"],["testId","google-search-input","icon","search-thin",3,"disabled","showClearButton","submitOnCode","placeholder","updateText","submit"],["textInput",""],["class","fx-margin-top-10","color","secondary",4,"ngIf"],["class","fx-margin-top-10 fx-center",4,"ngIf"],[4,"ngIf"],["class","google-search-upgrade-dialog fx-margin-top-20 fx-margin-bottom-20 fx-center-column left-sidebar-panel-padding",4,"ngIf"],["class","fx-margin-top-20 fx-center-column left-sidebar-panel-padding",4,"ngIf"],["class","fx-margin-top-10 left-sidebar-panel-padding",4,"ngIf"],["color","secondary",1,"fx-margin-top-10"],[1,"fx-margin-top-10","fx-center"],["translate","",1,"grey"],[1,"google-search-term-tag-container","fx-margin-top-10","left-sidebar-panel-padding"],["class","google-search-term-tag",3,"trackAction","click",4,"ngFor","ngForOf"],[1,"google-search-term-tag",3,"trackAction","click"],[1,"google-search-upgrade-dialog","fx-margin-top-20","fx-margin-bottom-20","fx-center-column","left-sidebar-panel-padding"],[1,"google-search-upgrade-dialog-icon-container","fx-center-all"],[1,"nu-icon","white"],[0,"xlink","href","./assets/icons/symbol-defs.svg#nu-ic-star"],[1,"google-search-upgrade-dialog-message"],["translate","",1,"google-search-upgrade-dialog-message-heading"],["data-testid","google-search-limit-message","translate","",1,"grey","nu-text-small"],["data-testid","google-search-upgrade-limit-button","translate","",1,"google-search-upgrade-dialog-button","nu-btn-small","primary",3,"click"],[1,"fx-margin-top-20","fx-center-column","left-sidebar-panel-padding"],[1,"google-search-offline-message","fx-margin-bottom-10"],["translate","",1,"navy-blue","nu-text-small","fx-margin-bottom-5","fx-center-all"],["translate","",1,"grey","nu-text-small"],[1,"service-unavailable-icon-container","fx-margin-bottom-10","fx-center-all"],[1,"nu-icon","nu-icon-med","light-nv-blue"],[0,"xlink","href","./assets/icons/symbol-defs.svg#nu-ic-warning"],[1,"fx-margin-top-10","left-sidebar-panel-padding"],[3,"item","dragstart","mouseenter","clicked","mouseleave",4,"ngFor","ngForOf"],[3,"item","dragstart","mouseenter","clicked","mouseleave"],["tile",""]],template:function(t,e){1&t&&(o.mc(0,"div",0),o.mc(1,"div",1),o.mc(2,"text-input",2,3),o.uc("updateText",(function(t){return e.onSearchQueryChange(t)}))("submit",(function(t){return e.searchImages(t)})),o.zc(4,"async"),o.zc(5,"async"),o.zc(6,"translate"),o.lc(),o.lc(),o.ed(7,bo,1,0,"loading-bubbles",4),o.zc(8,"async"),o.ed(9,mo,3,0,"div",5),o.zc(10,"async"),o.ed(11,So,4,3,"ng-container",6),o.zc(12,"async"),o.zc(13,"async"),o.zc(14,"async"),o.zc(15,"async"),o.ed(16,Oo,11,0,"div",7),o.zc(17,"async"),o.zc(18,"async"),o.ed(19,xo,6,0,"div",8),o.zc(20,"async"),o.ed(21,Co,9,0,"div",8),o.zc(22,"async"),o.zc(23,"async"),o.ed(24,To,3,3,"perfect-scrollbar",9),o.zc(25,"async"),o.lc()),2&t&&(o.Sb(2),o.Ec("placeholder",o.Ac(6,15,"PLACEHOLDERS.GOOGLE_SEARCH")),o.Dc("disabled",o.Ac(4,11,e.showUpgradeDialog)||0===o.Ac(5,13,e.appConnectionStatus))("showClearButton",!0)("submitOnCode",o.Hc(41,wo)),o.Sb(5),o.Dc("ngIf",o.Ac(8,17,e.showLoadingIndicator)),o.Sb(2),o.Dc("ngIf",o.Ac(10,19,e.showResultsNotFound)),o.Sb(2),o.Dc("ngIf",!(o.Ac(12,21,e.items)||o.Ac(13,23,e.showUpgradeDialog)||0===o.Ac(14,25,e.appConnectionStatus)||o.Ac(15,27,e.serviceUnavailable))),o.Sb(5),o.Dc("ngIf",o.Ac(17,29,e.showUpgradeDialog)&&!(0===o.Ac(18,31,e.appConnectionStatus))),o.Sb(3),o.Dc("ngIf",0===o.Ac(20,33,e.appConnectionStatus)),o.Sb(2),o.Dc("ngIf",o.Ac(22,35,e.serviceUnavailable)&&!(0===o.Ac(23,37,e.appConnectionStatus))),o.Sb(3),o.Dc("ngIf",!(0===o.Ac(25,39,e.appConnectionStatus))))},directives:[A.a,k.t,ho.a,r.a,k.s,fa.a,$a.b,go.a],pipes:[k.b,r.d],styles:[".nu-beta-tag[_ngcontent-%COMP%]{padding:2px 3px;background-color:#ffc648;color:#04263d;border-radius:2px;font-size:11px;display:inline-block}.left-sidebar-panel[_ngcontent-%COMP%]{padding-bottom:.5rem;height:100vh;box-sizing:border-box}.left-sidebar-panel.expanded[_ngcontent-%COMP%], .left-sidebar-panel.fullscreen[_ngcontent-%COMP%]{width:100%;background-color:#fff;z-index:4}.left-sidebar-panel.closed[_ngcontent-%COMP%]{transform:translateX(-215px);width:0}.left-sidebar-panel-container[_ngcontent-%COMP%]{width:310px;padding-top:1.375rem;padding-bottom:1.375rem}.left-sidebar-add-btn[_ngcontent-%COMP%]{margin:1rem 0}.left-sidebar-heading[_ngcontent-%COMP%]{font-family:Inter,Arial,sans-serif,ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Noto Sans,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;font-size:1rem;font-weight:500;line-height:1.5rem;padding-bottom:.875rem;color:#04263d}.col-menu-scrollbar[_ngcontent-%COMP%]{height:calc(100vh - calc(calc(140px) + calc(22px + 24px + 14px)))}library-tile[_ngcontent-%COMP%]{display:inline-block;margin-right:2px;background:#fff}.google-search-import-panel[_ngcontent-%COMP%]  .lib-tile-container{border-radius:4px;padding:2px;height:60px;border:1px solid #d3d3e7;overflow:hidden;width:60px;margin-right:1px;margin-left:1px}.google-search-import-panel[_ngcontent-%COMP%]  .thumb-img-container{height:100%}.google-search-term-tag[_ngcontent-%COMP%]{height:20px;line-height:20px;background:#ececec;margin:5px 10px 0 0;padding:0 5px;border-radius:2px;display:inline-flex;overflow:hidden}  .google-img-preview-container{padding:50px}  .google-img-preview-container .lib-preview-text>p{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.google-search-upgrade-dialog-icon[_ngcontent-%COMP%]{width:110px}.google-search-upgrade-dialog-buttons[_ngcontent-%COMP%]{padding:10px;text-align:right;height:60px;display:flex;align-items:center;justify-content:flex-end}.google-search-upgrade-dialog-icon-container[_ngcontent-%COMP%]{background-color:#f5ab1c;width:46px;height:46px;border-radius:100%;margin-bottom:16px}.google-search-upgrade-dialog-icon-container[_ngcontent-%COMP%]   .nu-icon[_ngcontent-%COMP%]{width:30px;height:30px}.google-search-upgrade-dialog-message[_ngcontent-%COMP%]{margin-bottom:20px}.google-search-upgrade-dialog-message[_ngcontent-%COMP%]   .google-search-upgrade-dialog-message-heading[_ngcontent-%COMP%]{font-size:14px;margin-bottom:5px}"],changeDetection:0}),e}(po.a);function Mo(t,e){1&t&&o.hc(0,"loading-bubbles",7)}function Io(t,e){1&t&&(o.mc(0,"div",8),o.mc(1,"span",9),o.gd(2,"GOOGLE_SEARCH_IMPORT.NO_RESULTS"),o.lc(),o.lc())}function Eo(t,e){if(1&t){var n=o.nc();o.mc(0,"div"),o.mc(1,"message-card",10),o.uc("buttonClicked",(function(){return o.Rc(n),o.yc().goToPlans()})),o.lc(),o.lc()}if(2&t){var i=o.yc();o.Sb(1),o.Dc("title",i.upgradeMsgTitle)("body",i.upgradeMsgBody)("button",i.upgradeMsgButton)("titleIcon",i.emptyStateIcon)}}function Do(t,e){1&t&&(o.mc(0,"div",11),o.mc(1,"div",12),o.mc(2,"p",13),o.gd(3,"OFFLINE.PANEL.HEADING"),o.lc(),o.mc(4,"p",14),o.gd(5,"OFFLINE.PANEL.GOOGLE_SEARCH_PANEL"),o.lc(),o.lc(),o.lc())}function _o(t,e){1&t&&(o.mc(0,"div",11),o.mc(1,"div",12),o.mc(2,"div",15),o.xc(),o.mc(3,"svg",16),o.hc(4,"use",17),o.lc(),o.lc(),o.wc(),o.mc(5,"p",13),o.gd(6,"GOOGLE_SEARCH_IMPORT.SERVICE_UNAVAILABLE.HEADING"),o.lc(),o.mc(7,"p",18),o.gd(8,"GOOGLE_SEARCH_IMPORT.SERVICE_UNAVAILABLE.DESCRIPTION"),o.lc(),o.lc(),o.lc())}function ko(t,e){if(1&t){var n=o.nc();o.mc(0,"library-tile",21,22),o.uc("dragstart",(function(t){o.Rc(n);var i=e.$implicit;return o.yc(2).handleDragStart(t,i.data)}))("mouseenter",(function(t){o.Rc(n);var i=e.$implicit;return o.yc(2).handleMouseEnter(i,t)}))("mouseleave",(function(t){return o.Rc(n),o.yc(2).handleMouseLeave(t)}))("clicked",(function(t){o.Rc(n);var i=e.$implicit;return o.yc(2).handleClick(t,i.data)}))("closed",(function(t){return o.Rc(n),o.yc(2).handleClose(t)})),o.lc()}if(2&t){var i=e.$implicit;o.Dc("item",i)}}function Ao(t,e){if(1&t&&(o.mc(0,"perfect-scrollbar",19),o.ed(1,ko,2,1,"library-tile",20),o.zc(2,"async"),o.lc()),2&t){var n=o.yc();o.Sb(1),o.Dc("ngForOf",o.Ac(2,1,n.items))}}var Lo=function(t){function e(e,n,i,a,o,r,s){var c=t.call(this,e,n,i,a,o,r,s)||this;return c.modalController=e,c.translate=n,c.commandService=i,c.state=a,c.ll=o,c.planPermManager=r,c.shapeManageService=s,c.id="google-img-search-results",c.trackingInfo={location:"FAB.GoogleSearch"},c}return Object(W.e)(e,t),Object.defineProperty(e.prototype,"appConnectionStatus",{get:function(){var t=this;return this.state.changes(uo.c).pipe(Object(M.a)((function(e){e===uo.c.ONLINE?t.tags.next(t.searchTags):e===uo.c.OFFLINE&&(t.items=null)})))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"emptyStateIcon",{get:function(){return"./assets/images/shape-search-result.svg"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"upgradeMsgTitle",{get:function(){return"GOOGLE_SEARCH_IMPORT.UPGRADE_TITLE"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"upgradeMsgBody",{get:function(){return["GOOGLE_SEARCH_IMPORT.UPGRADE_DESC"]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"upgradeMsgButton",{get:function(){return{label:"LABELS.GOOGLE_UPGRADE",icon:null}},enumerable:!1,configurable:!0}),e.prototype.ngOnInit=function(){this.state.set("ShapeSearchQuery","")},e.prototype.ngAfterViewInit=function(){this.subs.push(this.listenShapeSearchQueryChanges().subscribe())},e.prototype.ngOnDestroy=function(){for(;this.subs.length;)this.subs.pop().unsubscribe();this.items=null},e.prototype.listenShapeSearchQueryChanges=function(){var t=this;return this.state.changes("ShapeSearchQuery").pipe(Object(M.a)((function(e){e&&t.searchImages(e)})))},e.\u0275fac=function(t){return new(t||e)(o.gc(i.kb),o.gc(r.e),o.gc(i.B),o.gc(i.Nb),o.gc(b.a),o.gc(De.m),o.gc(xt.a))},e.\u0275cmp=o.ac({type:e,selectors:[["google-img-search-results"]],features:[o.Pb],decls:18,vars:24,consts:[[1,"image-import-container-tiles","fx-margin-top-15","container-padding"],["translate","",1,"fx-margin-bottom-15","body","google-search-content"],["class","fx-margin-top-10","color","secondary",4,"ngIf"],["class","fx-margin-top-10 fx-center",4,"ngIf"],[4,"ngIf"],["class","fx-margin-top-20 fx-center-column",4,"ngIf"],["class","col-menu-scrollbar",4,"ngIf"],["color","secondary",1,"fx-margin-top-10"],[1,"fx-margin-top-10","fx-center"],["translate","",1,"body","grey"],[3,"title","body","button","titleIcon","buttonClicked"],[1,"fx-margin-top-20","fx-center-column"],[1,"google-search-offline-message","fx-margin-bottom-10"],["translate","",1,"navy-blue","caption","fx-margin-bottom-5","fx-center-all"],["translate","",1,"google-search-content","caption"],[1,"service-unavailable-icon-container","fx-margin-bottom-10","fx-center-all"],[1,"nu-icon","nu-icon-med","light-nv-blue"],[0,"xlink","href","./assets/icons/symbol-defs.svg#nu-ic-warning"],["translate","",1,"grey","caption"],[1,"col-menu-scrollbar"],[3,"item","dragstart","mouseenter","mouseleave","clicked","closed",4,"ngFor","ngForOf"],[3,"item","dragstart","mouseenter","mouseleave","clicked","closed"],["tile",""]],template:function(t,e){1&t&&(o.mc(0,"div",0),o.mc(1,"p",1),o.gd(2,"LABELS.GOOGLE_SEARCH_RESULTS"),o.lc(),o.ed(3,Mo,1,0,"loading-bubbles",2),o.zc(4,"async"),o.ed(5,Io,3,0,"div",3),o.zc(6,"async"),o.zc(7,"async"),o.ed(8,Eo,2,4,"div",4),o.zc(9,"async"),o.zc(10,"async"),o.ed(11,Do,6,0,"div",5),o.zc(12,"async"),o.ed(13,_o,9,0,"div",5),o.zc(14,"async"),o.zc(15,"async"),o.ed(16,Ao,3,3,"perfect-scrollbar",6),o.zc(17,"async"),o.lc()),2&t&&(o.Sb(3),o.Dc("ngIf",o.Ac(4,6,e.showLoadingIndicator)),o.Sb(2),o.Dc("ngIf",o.Ac(6,8,e.showResultsNotFound)&&!o.Ac(7,10,e.showUpgradeDialog)),o.Sb(3),o.Dc("ngIf",o.Ac(9,12,e.showUpgradeDialog)&&!(0===o.Ac(10,14,e.appConnectionStatus))),o.Sb(3),o.Dc("ngIf",0===o.Ac(12,16,e.appConnectionStatus)),o.Sb(2),o.Dc("ngIf",o.Ac(14,18,e.serviceUnavailable)&&!(0===o.Ac(15,20,e.appConnectionStatus))),o.Sb(3),o.Dc("ngIf",!o.Ac(17,22,e.showUpgradeDialog)))},directives:[r.a,k.t,ho.a,Ja.a,$a.b,k.s,go.a],pipes:[k.b],styles:["library-tile[_ngcontent-%COMP%]{display:inline-block;margin-right:16px;background:#fff}.container-padding[_ngcontent-%COMP%]{padding-left:8px;padding-right:8px}.image-import-container-tiles[_ngcontent-%COMP%]{height:calc(100% - 40px)}.image-import-container-tiles[_ngcontent-%COMP%]  .lib-tile-container{border-radius:4px;padding:2px;height:85px;border:1px solid #d3d3e7;overflow:hidden;width:85px;margin-right:1px;margin-left:1px;position:relative}.image-import-container-tiles[_ngcontent-%COMP%]  .thumb-img-container{height:100%}.col-menu-scrollbar[_ngcontent-%COMP%]   perfect-scrollbar[_ngcontent-%COMP%]{max-height:inherit}.google-search-content[_ngcontent-%COMP%]{color:#64767d}"],changeDetection:0}),e}(jo),Bo=["textInput"];function Ro(t,e){1&t&&o.hc(0,"panel-search-results",8,9)}function No(t,e){1&t&&o.hc(0,"google-img-search-results")}var Ho=function(){return["Enter"]},Fo=function(){function t(t,e,n){this.state=t,this.elementRef=e,this.translate=n,this.selected="search",this.showSearchResults=new O.a(!1),this.subs=[]}return Object.defineProperty(t.prototype,"icon",{get:function(){var t=this.items.find((function(t){return t.selected}));if(t)return t.icon},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"placeholder",{get:function(){return"search"===this.selected?"PLACEHOLDERS.SEARCH_ITEMS":"PLACEHOLDERS.GOOGLE_SEARCH"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"items",{get:function(){return[{id:"search",label:"Creately Libraries",icon:"search-larger",selected:"search"===this.selected},{id:"google-search",label:"Google Images",icon:"google-search",selected:"google-search"===this.selected}]},enumerable:!1,configurable:!0}),t.prototype.ngOnInit=function(){this.subs.push(this.libraryStatusChange().subscribe())},t.prototype.onSearchTypeChange=function(t){if(this.textInput){var e=this.textInput.isEmpty.value?"":this.textInput.value||"";this.state.set("ShapeSearchQuery",e),this.selected=t,this.focus(),this.textInput.inputChange.next(e)}"google-search"===this.selected&&i.Pb.track("left.googlesearch.click")},t.prototype.libraryStatusChange=function(){var t=this;return this.state.changes("CurrentLibraries").pipe(Object(M.a)((function(){t.state.set("ShapeSearchQuery","")})))},t.prototype.showResults=function(t){t.length>2?(this.state.set("ShapeSearchQuery",t),this.showSearchResults.next(!0)):this.showSearchResults.next(!1)},t.prototype.clickOut=function(t){this.elementRef.nativeElement.contains(t.target)&&"text"===t.target.type&&this.textInput.value.length>2?this.showSearchResults.next(!0):this.showSearchResults.next(!1)},t.prototype.clear=function(){this.textInput.clear()},t.prototype.focus=function(){this.textInput.focus()},t.\u0275fac=function(e){return new(e||t)(o.gc(i.Nb),o.gc(o.r),o.gc(r.e))},t.\u0275cmp=o.ac({type:t,selectors:[["multi-search"]],viewQuery:function(t,e){var n;(1&t&&o.ld(Bo,!0),2&t)&&(o.Mc(n=o.vc())&&(e.textInput=n.first))},inputs:{selected:"selected"},decls:11,vars:14,consts:[[1,"fx-flex"],[1,"search-icon",3,"items","change"],["autoFocus","true",1,"search-input",3,"emitForInputChange","placeholder","debounce","submitOnCode","updateText","submit"],["textInput",""],[1,"search-results"],["translate","",1,"clear-btn","body","btn-link",3,"click"],["class","search-input",4,"ngIf"],[4,"ngIf"],[1,"search-input"],["searchPanel",""]],template:function(t,e){1&t&&(o.mc(0,"div",0),o.mc(1,"search-type-dropdown",1),o.uc("change",(function(t){return e.onSearchTypeChange(t)})),o.lc(),o.mc(2,"text-input",2,3),o.uc("updateText",(function(t){return e.showResults(t)}))("submit",(function(t){return e.showResults(t)})),o.zc(4,"translate"),o.lc(),o.lc(),o.mc(5,"div",4),o.zc(6,"async"),o.mc(7,"a",5),o.uc("click",(function(){return e.clear()})),o.gd(8,"TOOLTIPS.CLEAR_TEXTBOX"),o.lc(),o.ed(9,Ro,2,0,"panel-search-results",6),o.ed(10,No,1,0,"google-img-search-results",7),o.lc()),2&t&&(o.Sb(1),o.Dc("items",e.items),o.Sb(1),o.Ec("placeholder",o.Ac(4,9,e.placeholder)),o.Dc("emitForInputChange",!0)("debounce",100)("submitOnCode",o.Hc(13,Ho)),o.Sb(3),o.Yb("fx-hidden",!o.Ac(6,11,e.showSearchResults)),o.Sb(4),o.Dc("ngIf","search"===e.selected),o.Sb(1),o.Dc("ngIf","google-search"===e.selected))},directives:[Ua,A.a,r.a,k.t,lo,Lo],pipes:[r.d,k.b],styles:[".search-input[_ngcontent-%COMP%]{flex-grow:1}.search-input[_ngcontent-%COMP%]  .text-input-inner{height:40px;position:static;display:flex;flex-flow:row-reverse;align-items:center}.search-input[_ngcontent-%COMP%]  .text-input{margin-top:0;font-family:Inter,Arial,sans-serif,ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Noto Sans,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;font-size:1rem;font-weight:400;border:0}.clear-btn[_ngcontent-%COMP%]{margin:1rem;position:absolute;z-index:3;right:0;color:#0c5e96}.search-results[_ngcontent-%COMP%]{position:absolute;background:#fff;z-index:2;width:100%;height:calc(100% - 170px)}.search-icon[_ngcontent-%COMP%]{align-items:center;display:flex}"],changeDetection:0}),t}(),Go=n("XCiK"),qo=n("o+Mh");function Vo(t,e){if(1&t&&(o.mc(0,"div"),o.hc(1,"message-card",9),o.lc()),2&t){var n=o.yc();o.Sb(1),o.Dc("title",n.msgTitle)("body",n.msgBody)("titleIcon",n.emptyStateIcon)}}function Uo(t,e){if(1&t){var n=o.nc();o.mc(0,"library-tile",10,11),o.uc("dragstart",(function(t){o.Rc(n);var i=e.$implicit;return o.yc().handleDragStart(t,i.data)}))("mouseenter",(function(t){o.Rc(n);var i=e.$implicit;return o.yc().handleMouseEnter(i,t)}))("mouseleave",(function(t){return o.Rc(n),o.yc().handleMouseLeave(t)}))("clicked",(function(t){o.Rc(n);var i=e.$implicit;return o.yc().handleClick(t,i.data)}))("closed",(function(t){return o.Rc(n),o.yc().handleClose(t)})),o.lc()}if(2&t){var i=e.$implicit;o.Dc("item",i)}}var zo,Yo,Xo=function(t){function e(e,n,i,a,o,r,s){var c=t.call(this,e,n,i,a,o,r,s)||this;return c.modalController=e,c.translate=n,c.commandService=i,c.state=a,c.ll=o,c.planPermManager=r,c.shapeManageService=s,c.id="image-import-container",c.importMode=!0,c.trackingInfo={location:"FAB.Images"},c}return Object(W.e)(e,t),Object.defineProperty(e.prototype,"msgTitle",{get:function(){return"FILE_IMPORTS.ADD_IMAGES"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"msgBody",{get:function(){return["FILE_IMPORTS.TO_ADD_IMAGES1","FILE_IMPORTS.TO_ADD_IMAGES2"]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"emptyStateIcon",{get:function(){return"./assets/images/fab/fab-empty-state.svg"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"appConnectionStatus",{get:function(){var t=this;return this.state.changes(uo.c).pipe(Object(M.a)((function(e){"asset"===t.state.get("SelectedFloatingPanel")&&(e===uo.c.ONLINE?t.importMode||t.tags.next(t.searchTags):e===uo.c.OFFLINE&&(t.importMode?t.items=t.getUploadedImages():t.items=null))})))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"locator",{get:function(){return this.ll.forCurrent(!1)},enumerable:!1,configurable:!0}),e.prototype.ngOnInit=function(){this.items=this.getUploadedImages()},e.prototype.ngOnDestroy=function(){for(;this.subs.length;)this.subs.pop().unsubscribe();this.items=null},e.prototype.handleDragStart=function(t,e){this.importMode?i.Pb.track("left.image.import.drag",{value1Type:"imageLink",value1:e.url}):i.Pb.track("left.googleSearch.shape.drag",{value1Type:"imageName",value1:e.name,value2Type:"imageSource",value2:e.url}),this.hidePopoverPreview();var n=t.target.querySelector(".shape-thumbnail-image");t.dataTransfer.effectAllowed="move",e.upload=!this.importMode,t.dataTransfer.setData("URLData",JSON.stringify(e)),t.dataTransfer.setDragImage(n,n.width/2,n.height/2)},e.prototype.handleClose=function(t){if(this.importMode){i.Pb.track("left.image.import.remove",{value1Type:"imageHash",value1:t});var e={};e[t]={action:"remove"},this.commandService.dispatch(D.a.changeImageGallery,e),this.hidePopoverPreview()}},e.prototype.openImportImageWindow=function(){var t=this;this.switchImportMode(!0);var e={note:this.translate.instant("FILE_IMPORTS.FILE_MAX_MSG")};this.modalController.show(qo.a,{inputs:{importOptions:{allowMultipleUploads:!1,restrictions:{maxFileSize:5e6,maxNumberOfFiles:1,minNumberOfFiles:1,allowedFileTypes:[".jpg",".jpeg",".bmp",".gif",".ico",".svg",".png"]}},uiOptions:e,onComplete:function(e){return t.onImageUploadCompletion(e)}}})},e.prototype.switchImportMode=function(t){this.importMode!==t&&(this.importMode=t,this.items=t?this.getUploadedImages():Object($.a)([]))},e.prototype.onImageUploadCompletion=function(t){this.commandService.dispatch(D.a.importImageAndUpload,void 0,{files:t})},e.prototype.getUploadedImages=function(){return this.locator.getDiagramModel().pipe(Object(I.a)((function(t){return Object(J.clone)(t.imageGallery)})),Object(et.a)(J.isEqual),Object(I.a)((function(t){var e=[];return Object(J.forEach)(t,(function(t,n){var a=i.m.get("CUSTOM_IMAGE_BASE_URL")+n;e.push({id:n,type:"image",thumbnailUrl:a,closeButton:!0,thumbnailType:"image",text:{},data:{name:n,url:a},added:t.added})})),Object(J.reverse)(Object(J.sortBy)(e,["added"]))})))},e.\u0275fac=function(t){return new(t||e)(o.gc(i.kb),o.gc(r.e),o.gc(i.B),o.gc(i.Nb),o.gc(b.a),o.gc(De.m),o.gc(xt.a))},e.\u0275cmp=o.ac({type:e,selectors:[["image-import-container"]],features:[o.Pb],decls:12,vars:6,consts:[[1,"image-import-container"],[1,"image-import-container-tiles"],[1,"btn-link","btn-medium","nu-ic-upload","fx-center",3,"click"],[1,"nu-icon","nu-icon-xsmall","fx-margin-right-5","upload-btn"],[0,"xlink","href","./assets/icons/symbol-defs.svg#nu-ic-upload"],["translate",""],[4,"ngIf"],[1,"col-menu-scrollbar"],[3,"item","dragstart","mouseenter","mouseleave","clicked","closed",4,"ngFor","ngForOf"],[3,"title","body","titleIcon"],[3,"item","dragstart","mouseenter","mouseleave","clicked","closed"],["tile",""]],template:function(t,e){if(1&t&&(o.mc(0,"div",0),o.mc(1,"div",1),o.mc(2,"button",2),o.uc("click",(function(){return e.openImportImageWindow()})),o.xc(),o.mc(3,"svg",3),o.hc(4,"use",4),o.lc(),o.wc(),o.mc(5,"span",5),o.gd(6,"FILE_IMPORTS.UPLOAD"),o.lc(),o.lc(),o.ed(7,Vo,2,3,"div",6),o.zc(8,"async"),o.mc(9,"perfect-scrollbar",7),o.ed(10,Uo,2,1,"library-tile",8),o.zc(11,"async"),o.lc(),o.lc(),o.lc()),2&t){var n;o.Sb(7),o.Dc("ngIf",0===(null==(n=o.Ac(8,2,e.items))?null:n.length)),o.Sb(3),o.Dc("ngForOf",o.Ac(11,4,e.items))}},directives:[r.a,k.t,$a.b,k.s,Ja.a,go.a],pipes:[k.b],styles:[".image-import-container[_ngcontent-%COMP%]{height:100%}library-tile[_ngcontent-%COMP%]{margin-right:.125rem;display:inline-block;background:#fff}.image-import-container-tiles[_ngcontent-%COMP%]{max-height:inherit;height:100%}.image-import-container-tiles[_ngcontent-%COMP%]  .lib-tile-container{padding:.125rem;margin-left:.5rem;margin-right:.5rem;border-radius:4px;height:86px;overflow:hidden;width:86px;position:relative}.image-import-container-tiles[_ngcontent-%COMP%]  .lib-tile-container  .thumb-img-image-container{height:auto;width:auto}.image-import-container-tiles[_ngcontent-%COMP%]  .lib-tile-container  .thumb-img-image-container img{max-width:60px!important;max-height:60px!important;width:auto;height:auto}.image-import-container-tiles[_ngcontent-%COMP%]  .lib-tile-container  .thumb-img-container{height:100%}.col-menu-scrollbar[_ngcontent-%COMP%]{height:200px}.nu-ic-upload[_ngcontent-%COMP%]{margin-bottom:.25rem;margin-top:1.25rem;display:flex}.nu-icon[_ngcontent-%COMP%]{color:#1381cd}.nu-icon[_ngcontent-%COMP%]:hover{color:#0c5e96}"],changeDetection:0}),e}(jo),Ko=function(){function t(){this.id="asset",this.hasSearch=!1,this.isPinned=!0}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=o.ac({type:t,selectors:[["asset-panel"]],hostAttrs:[1,"is-height-responsive"],decls:2,vars:0,consts:[[1,"floating-panel","quick-toolbar-panel"]],template:function(t,e){1&t&&(o.mc(0,"div",0),o.hc(1,"image-import-container"),o.lc())},directives:[Xo],styles:[".floating-panel[_ngcontent-%COMP%]{pointer-events:auto}.floating-panel[_ngcontent-%COMP%], [_nghost-%COMP%]{height:100%}.lib-padding[_ngcontent-%COMP%]{padding-left:.5rem;padding-right:.5rem}"],changeDetection:0}),t}();function Wo(t,e){if(1&t&&(o.xc(),o.mc(0,"svg",4),o.hc(1,"use"),o.lc()),2&t){var n=o.yc();o.Dc("ngClass","nu-icon-"+n.icon),o.Sb(1),o.Tb("href","./assets/icons/symbol-defs.svg#nu-ic-fab-close",null,"xlink")}}!function(t){t.normal="normal",t.large="large"}(zo||(zo={})),function(t){t.rotate="rotate",t.background="background"}(Yo||(Yo={}));var Zo,Qo=function(t,e){return[t,e]},Jo=function(){function t(){this.icon="",this.tooltipPlacement=S.v.top,this.size=zo.normal,this.active=!1,this.activeAnimation=Yo.background}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=o.ac({type:t,selectors:[["floating-action-button"]],inputs:{id:"id",icon:"icon",tooltipPlacement:"tooltipPlacement",size:"size",active:"active",activeAnimation:"activeAnimation",tooltip:"tooltip"},decls:6,vars:12,consts:[["class","fab-close-design nu-icon nu-icon-xlarge",3,"ngClass",4,"ngIf"],["tooltip","",1,"floating-action-button","fx-button","fx-round","fx-pointer-events-auto","btn-primary",3,"ngClass","deactivated","placement"],[1,"nu-icon",3,"ngClass"],["translate","",1,"tooltip-content"],[1,"fab-close-design","nu-icon","nu-icon-xlarge",3,"ngClass"]],template:function(t,e){1&t&&(o.ed(0,Wo,2,2,"svg",0),o.mc(1,"button",1),o.xc(),o.mc(2,"svg",2),o.hc(3,"use"),o.lc(),o.wc(),o.mc(4,"span",3),o.gd(5),o.lc(),o.lc()),2&t&&(o.Dc("ngIf",!e.active),o.Sb(1),o.Yb("active",e.active),o.Dc("ngClass",o.Jc(9,Qo,e.size,e.activeAnimation))("deactivated",!e.tooltip)("placement",e.tooltipPlacement),o.Sb(1),o.Dc("ngClass","nu-icon-"+e.icon),o.Sb(1),o.Tb("href","./assets/icons/symbol-defs.svg#nu-ic-"+e.icon,null,"xlink"),o.Sb(2),o.hd(e.tooltip))},directives:[k.t,ga.a,k.q,r.a],styles:[".fab-close-design[_ngcontent-%COMP%]{position:absolute;left:-7px;bottom:0;z-index:-1}.floating-action-button[_ngcontent-%COMP%]{pointer-events:all;margin:0;box-shadow:0 12px 32px rgba(0,0,0,.05),0 8px 10px rgba(0,0,0,.05),0 2px 2px rgba(0,0,0,.05)}.floating-action-button[_ngcontent-%COMP%]   .nu-icon[_ngcontent-%COMP%]{will-change:transform;transition:transform .25s linear}.floating-action-button.large[_ngcontent-%COMP%]{height:56px;width:56px}.floating-action-button.large[_ngcontent-%COMP%]   .nu-icon[_ngcontent-%COMP%]{width:24px;height:24px;stroke-width:1px;transition:transform .25s linear}.floating-action-button.rotate[_ngcontent-%COMP%]   .nu-icon[_ngcontent-%COMP%]{color:#fff}.floating-action-button.rotate.active[_ngcontent-%COMP%]   .nu-icon[_ngcontent-%COMP%]{transform:rotate(45deg)}.floating-action-button.background[_ngcontent-%COMP%]   .nu-icon[_ngcontent-%COMP%]{color:#04263d}.floating-action-button.background.active[_ngcontent-%COMP%]   .nu-icon[_ngcontent-%COMP%]{color:#fff}.floating-action-button.background[_ngcontent-%COMP%]:not(.active){background:#fff}"]}),t}();!function(t){t.Closed="closed",t.Opening="opening",t.Opened="opened",t.Closing="closing"}(Zo||(Zo={}));var $o=n("bV32"),tr=n("wkyi"),er=n("gedj"),nr=n("kZAw"),ir=n("Ownj"),ar=function(){function t(t,e){this.state=t,this.libraryList=e}return t.prototype.ngOnInit=function(){var t=this;this.state.changes("SelectedFloatingPanel").pipe(Object(E.a)((function(t){return"icons"===t})),Object(j.a)(3)).subscribe((function(){t.addStickers(),t.loadIconLibraries()}))},t.prototype.addStickers=function(){this.collapsibleMenu.add(tr.a,er.a,{id:"quick-tool-stickers",trackingInfo:{location:"FAB.Icons"}},!1,{isPremium:!1,collapsable:!1})},t.prototype.loadIconLibraries=function(){var t=this;this.libraryList.getAllIconLibraries().filter((function(e){return!t.collapsibleMenu.has(e.id)})).forEach((function(e){return t.collapsibleMenu.add(tr.a,nr.a,{id:e.id,isCollapsed:!1,trackingInfo:{location:"FAB.Icons"}},!1,{isPremium:!1})}))},t.\u0275fac=function(e){return new(e||t)(o.gc(i.Nb),o.gc(Si.a))},t.\u0275cmp=o.ac({type:t,selectors:[["icons-library-container"]],viewQuery:function(t,e){var n;(1&t&&o.Yc(i.t,!0),2&t)&&(o.Mc(n=o.vc())&&(e.collapsibleMenu=n.first))},decls:3,vars:0,consts:[[1,"lib-container"],[1,"col-menu-scrollbar"]],template:function(t,e){1&t&&(o.mc(0,"div",0),o.mc(1,"perfect-scrollbar",1),o.hc(2,"collapsible-menu"),o.lc(),o.lc())},directives:[$a.b,ir.a],styles:[".lib-container[_ngcontent-%COMP%], [_nghost-%COMP%]{max-height:inherit;height:100%}.lib-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%}.lib-container[_ngcontent-%COMP%]   perfect-scrollbar[_ngcontent-%COMP%]{max-height:inherit}.lib-container[_ngcontent-%COMP%]  .ps-content{margin-right:.625rem}.lib-message[_ngcontent-%COMP%]{display:none}"],changeDetection:0}),t}(),or=function(){function t(){this.id="icons",this.hasSearch=!0,this.isPinned=!0}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=o.ac({type:t,selectors:[["icons-panel"]],hostAttrs:[1,"is-height-responsive"],decls:2,vars:0,consts:[[1,"floating-panel","icons-panel"]],template:function(t,e){1&t&&(o.mc(0,"div",0),o.hc(1,"icons-library-container"),o.lc())},directives:[ar],styles:[".floating-panel[_ngcontent-%COMP%]{pointer-events:auto}.floating-panel[_ngcontent-%COMP%], [_nghost-%COMP%]{height:100%}"],changeDetection:0}),t}(),rr=function(){function t(t,e){this.state=t,this.libraryList=e}return t.prototype.ngOnInit=function(){var t=this;this.state.changes("SelectedFloatingPanel").pipe(Object(E.a)((function(t){return"frames"===t})),Object(j.a)(3)).subscribe((function(){t.loadIconLibraries()}))},t.prototype.loadIconLibraries=function(){var t=this;this.libraryList.getAllFramesLibraries().filter((function(e){return!t.collapsibleMenu.has(e.id)})).forEach((function(e){return t.collapsibleMenu.add(tr.a,nr.a,{id:e.id,trackingInfo:{location:"FAB.Frames"}},!1,{isPremium:!1,collapsable:!1})}))},t.\u0275fac=function(e){return new(e||t)(o.gc(i.Nb),o.gc(Si.a))},t.\u0275cmp=o.ac({type:t,selectors:[["frames-library-container"]],viewQuery:function(t,e){var n;(1&t&&o.Yc(i.t,!0),2&t)&&(o.Mc(n=o.vc())&&(e.collapsibleMenu=n.first))},decls:3,vars:0,consts:[[1,"lib-container"],["tooltip-tour-step","data-6",1,"col-menu-scrollbar"],[1,"lib-collapsible-menu"]],template:function(t,e){1&t&&(o.mc(0,"div",0),o.mc(1,"perfect-scrollbar",1),o.hc(2,"collapsible-menu",2),o.lc(),o.lc())},directives:[$a.b,$o.a,ir.a],styles:[".lib-container[_ngcontent-%COMP%], [_nghost-%COMP%]{max-height:inherit;height:inherit}.lib-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%;height:inherit}.lib-container[_ngcontent-%COMP%]   perfect-scrollbar[_ngcontent-%COMP%]{max-height:inherit}.lib-container[_ngcontent-%COMP%]  .ps-content{margin-right:10px}.lib-container[_ngcontent-%COMP%]  .col-menu-item-heading-title{padding-left:5px}.lib-message[_ngcontent-%COMP%]{display:none}"],changeDetection:0}),t}(),sr=function(){function t(){this.id="frames",this.hasSearch=!0,this.isPinned=!0}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=o.ac({type:t,selectors:[["frames-panel"]],hostAttrs:[1,"is-height-responsive"],decls:2,vars:0,consts:[["tooltip-tour-step","fab-1.3",1,"floating-panel","frames-panel"]],template:function(t,e){1&t&&(o.mc(0,"div",0),o.hc(1,"frames-library-container"),o.lc())},directives:[$o.a,rr],styles:[".floating-panel[_ngcontent-%COMP%]{pointer-events:auto}.floating-panel[_ngcontent-%COMP%], [_nghost-%COMP%]{height:100%}"],changeDetection:0}),t}(),cr=function(){function t(t,e){this.state=t,this.libraryList=e}return t.prototype.ngOnInit=function(){var t=this;this.state.changes("SelectedFloatingPanel").pipe(Object(E.a)((function(t){return"embeds"===t})),Object(j.a)(3)).subscribe((function(){t.loadIconLibraries()}))},t.prototype.loadIconLibraries=function(){var t=this;this.libraryList.getAllEmbedsLibraries().filter((function(e){return!t.collapsibleMenu.has(e.id)})).forEach((function(e){return t.collapsibleMenu.add(tr.a,nr.a,{id:e.id,trackingInfo:{location:"FAB.Embeds"}},!1,{isPremium:!1,collapsable:!1})}))},t.\u0275fac=function(e){return new(e||t)(o.gc(i.Nb),o.gc(Si.a))},t.\u0275cmp=o.ac({type:t,selectors:[["embeds-library-container"]],viewQuery:function(t,e){var n;(1&t&&o.Yc(i.t,!0),2&t)&&(o.Mc(n=o.vc())&&(e.collapsibleMenu=n.first))},decls:3,vars:0,consts:[[1,"lib-container"],["tooltip-tour-step","data-6",1,"col-menu-scrollbar"],[1,"lib-collapsible-menu"]],template:function(t,e){1&t&&(o.mc(0,"div",0),o.mc(1,"perfect-scrollbar",1),o.hc(2,"collapsible-menu",2),o.lc(),o.lc())},directives:[$a.b,$o.a,ir.a],styles:[".lib-container[_ngcontent-%COMP%], [_nghost-%COMP%]{max-height:inherit;height:inherit}.lib-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%;height:inherit}.lib-container[_ngcontent-%COMP%]   perfect-scrollbar[_ngcontent-%COMP%]{max-height:inherit}.lib-container[_ngcontent-%COMP%]  .ps-content{margin-right:10px}.lib-container[_ngcontent-%COMP%]  .col-menu-item-heading-title{padding-left:5px}.lib-message[_ngcontent-%COMP%]{display:none}"],changeDetection:0}),t}(),lr=function(){function t(){this.id="embeds",this.hasSearch=!0,this.isPinned=!0}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=o.ac({type:t,selectors:[["embeds-panel"]],hostAttrs:[1,"is-height-responsive"],decls:2,vars:0,consts:[["tooltip-tour-step","fab-1.3",1,"floating-panel","embeds-panel"]],template:function(t,e){1&t&&(o.mc(0,"div",0),o.hc(1,"embeds-library-container"),o.lc())},directives:[$o.a,cr],styles:[".floating-panel[_ngcontent-%COMP%]{pointer-events:auto}.floating-panel[_ngcontent-%COMP%], [_nghost-%COMP%]{height:100%}"],changeDetection:0}),t}(),ur=n("CrNP"),dr=function(){function t(t,e,n,i,a,o){this.translate=t,this.state=e,this.modalController=n,this.commandService=i,this.libraryList=a,this.recentShapeService=o,this.toolbarButtons=new O.a([]),this.defaultLibraryId="general",this.previousLibsCount=0,this.currLibPosition=0,this.currFocusLibs={},this.recentShapesPanelId="recent-shapes",this.triggerScrollUpdate=new le.a,this.subs=[],this.currentLibrariesState=this.state,this.currentLibraryGroupState=this.state}return Object.defineProperty(t.prototype,"activeToolbarButton",{get:function(){return this.state.get("CurrentLibraryGroup")},enumerable:!1,configurable:!0}),t.prototype.ngOnInit=function(){var t=this;this.subs.push(this.handleDispatchUpdateLibrariesCommand().subscribe(),this.listenToFloatingPanelChanges().subscribe(),this.listenToToolbarButtonChanges().subscribe(),this.onChildRemoved().subscribe(),this.onChildToggle().subscribe(),this.scrollWhenAllLoaded().subscribe(),this.triggerScrollUpdate.pipe(Object(E.a)((function(t){return!!t})),Object(M.a)((function(){return t.updateScrollPosition()}))).subscribe())},t.prototype.ngOnDestroy=function(){for(;this.subs.length>0;)this.subs.pop().unsubscribe()},t.prototype.updateScrollPosition=function(){var t=this.state.get("CurrentLibraryGroup");this.currFocusLibs[t]=this.directiveScroll.directiveRef.elementRef.nativeElement.scrollTop||1},t.prototype.openLibraryBrowser=function(){this.modalController.show(Ka.a)},t.prototype.listenToToolbarButtonChanges=function(){var t=this;return this.state.changes("CurrentLibraries").pipe(Object(E.a)((function(t){return t&&t.length>0})),Object(T.a)((function(e){return t.getLibraryGroups(e)})),Object(E.a)((function(t){return!!t})),Object(M.a)((function(e){var n=e.map((function(t){return{id:t,label:t}}));t.toolbarButtons.next(n)})))},t.prototype.getLibraryGroups=function(t){return Object($.a)(t).pipe(Object(I.a)((function(t){return t.map((function(t){return t.libGroup}))})),Object(I.a)((function(t){return Object(J.uniq)(t)})))},t.prototype.initLibrary=function(){var t=this;return Object(Ce.b)([this.currentLibrariesState.changes("CurrentLibraries"),this.currentLibraryGroupState.changes("CurrentLibraryGroup")]).pipe(Object(E.a)((function(t){var e=Object(W.h)(t,2),n=e[0],i=e[1];return!!n&&!!i})),Object(I.a)((function(e){var n=Object(W.h)(e,2),i=n[0],a=n[1];return t.currFocusLibs[a]=0,i.filter((function(t){return t.libGroup===a}))})),Object(j.a)(1),Object(M.a)((function(e){t.updateMenu(e),t.subs.push(t.listenToRecentShapeChanges().subscribe())})))},t.prototype.scrollWhenAllLoaded=function(){var t=this;return this.currentLibrariesState.changes("CurrentLibraries").pipe(Object(E.a)((function(t){return t.filter((function(t){return"loaded"===t.status})).length===t.length})),Object(w.a)(1),Object(M.a)((function(e){if(t.previousLibsCount<e.length){var n=t.state.get("CurrentLibraryGroup");t.currFocusLibs[n]?t.scrollToYPos(t.currFocusLibs[n]):t.scrollToLibrary(e.length-1),t.previousLibsCount=e.length}})))},t.prototype.scrollToLibrary=function(t){var e=this.directiveScroll.directiveRef.elementRef.nativeElement.getBoundingClientRect(),n=this.directiveScroll.directiveRef.geometry(),i=this.collapsibleMenu.children?this.collapsibleMenu.getChildBounds(t):void 0;i&&i.height>e.height?this.directiveScroll.directiveRef.scrollToY(n.h-i.height,100):this.directiveScroll.directiveRef.scrollToBottom(-75,100),this.updateScrollPosition()},t.prototype.scrollToYPos=function(t){this.directiveScroll.directiveRef.geometry().h>t?this.directiveScroll.directiveRef.scrollToY(t,100):this.directiveScroll.directiveRef.scrollToBottom(-75,100)},t.prototype.listenToFloatingPanelChanges=function(){var t=this;return this.state.changes("SelectedFloatingPanel").pipe(Object(E.a)((function(t){return"shapes"===t})),Object(j.a)(3),Object(M.a)((function(){return t.initLibrary().subscribe()})),Object(T.a)((function(){return t.listenToLibraryChanges()})))},t.prototype.handleDispatchUpdateLibrariesCommand=function(){var t=this;return this.currentLibrariesState.changes("CurrentLibraries").pipe(Object(E.a)((function(t){return!!t})),Object(w.a)(1),Object(et.a)((function(t,e){return Object(J.isEqual)(t.map((function(t){return t.id})).sort(),e.map((function(t){return t.id})).sort())})),Object(M.a)((function(e){t.dispatchUpdateLibrariesCommand(e)})))},t.prototype.listenToLibraryChanges=function(){var t=this;return Object(Ce.b)([this.currentLibrariesState.changes("CurrentLibraries"),this.currentLibraryGroupState.changes("CurrentLibraryGroup")]).pipe(Object(nt.a)(),Object(E.a)((function(t){var e=Object(W.h)(t,2),n=Object(W.h)(e[0],2),i=n[0],a=n[1],o=Object(W.h)(e[1],2),r=o[0],s=o[1];return!(!r||!s||i.length===r.length&&a===s)})),Object(I.a)((function(e){var n=Object(W.h)(e,2),i=Object(W.h)(n[0],2),a=(i[0],i[1],Object(W.h)(n[1],2)),o=a[0],r=a[1];return t.currLibPosition=o.length-1,o.filter((function(t){return t.libGroup===r}))})),Object(M.a)((function(e){t.updateMenu(e),t.previousLibsCount>e.length&&(t.previousLibsCount=e.length)})))},t.prototype.dispatchUpdateLibrariesCommand=function(t){this.commandService.dispatch(D.a.updateLibraries,{libraries:t})},t.prototype.onChildToggle=function(){var t=this;return this.collapsibleMenu.childToggled.pipe(Object(M.a)((function(e){var n=t.state.get("CurrentLibraries").map((function(t){return t.id===e&&(t.isCollapsed=!t.isCollapsed),t}));t.currLibPosition=n.findIndex((function(t){return t.id===e})),t.state.set("CurrentLibraries",n),t.dispatchUpdateLibrariesCommand(n)})))},t.prototype.onChildRemoved=function(){var t=this;return this.collapsibleMenu.childRemoved.pipe(Object(ut.a)(1),Object(M.a)((function(e){i.Pb.track("left.library.section.header.close",{value1Type:"libraryId",value1:e});var n=t.currentLibrariesState.get("CurrentLibraries"),a=t.currentLibraryGroupState.get("CurrentLibraryGroup"),o=n.filter((function(t){return t.id!==e}));if(t.libraryList.getMainGroupForLibrary(e).includes(a)&&!o.find((function(t){return t.libGroup===a}))){delete t.currFocusLibs[a];var r=o[o.length-1].libGroup;t.currentLibraryGroupState.set("CurrentLibraryGroup",r),t.currentLibrariesState.set("CurrentLibraries",o)}t.currentLibrariesState.set("CurrentLibraries",o)})))},t.prototype.updateMenu=function(t){this.addLibrariesToMenu(t),this.removeOtherLibrariesFromMenu(t);var e=this.state.get("CurrentLibraryGroup");0===this.directiveScroll.directiveRef.elementRef.nativeElement.scrollTop||this.directiveScroll.directiveRef.elementRef.nativeElement.scrollTop===this.currFocusLibs[e]?this.scrollToLibrary(this.currLibPosition):this.scrollToYPos(this.currFocusLibs[e])},t.prototype.addLibrariesToMenu=function(t){var e=this;if(!(t.length<=0)){var n=this.collapsibleMenu.panels.map((function(t){return t.id}));t.filter((function(t){return!n.includes(t.id)&&t.type===jn.c.Static})).sort((function(t,e){return t.order-e.order})).forEach((function(t){var i=e.libraryList.belongsToPremiumGroup(t.id);return t.id.includes("custom-database-")?e.collapsibleMenu.add(tr.a,er.a,{id:t.id,isCollapsed:t.isCollapsed,trackingInfo:{location:"FAB.Shapes"}},!1,{isPremium:i}).subscribe():e.collapsibleMenu.add(tr.a,nr.a,{id:t.id,isCollapsed:t.isCollapsed,trackingInfo:{location:"FAB.Shapes"}},!1,{isPremium:i},n.includes("recent-shapes")?1:0).subscribe()}))}},t.prototype.removeOtherLibrariesFromMenu=function(t){var e=this;this.collapsibleMenu.panels.forEach((function(n){n.id!==e.recentShapesPanelId&&(t.find((function(t){return t.id===n.id}))||e.collapsibleMenu.detachById(n.id).subscribe())}))},t.prototype.listenToRecentShapeChanges=function(){var t=this;return this.recentShapeService.getShapes().pipe(Object(M.a)((function(e){var n=t.state.get("CurrentLibraryGroup");!t.collapsibleMenu.has(t.recentShapesPanelId)||"Shapes"===n&&0!==e.length?!t.collapsibleMenu.has(t.recentShapesPanelId)&&"Shapes"===n&&e.length>0&&t.collapsibleMenu.add(tr.a,er.a,{id:t.recentShapesPanelId,isCollapsed:!1,trackingInfo:{location:"FAB.Shapes"}},!1,{isPremium:!1},0).subscribe():t.collapsibleMenu.detachById(t.recentShapesPanelId).subscribe()})))},t.\u0275fac=function(e){return new(e||t)(o.gc(r.e),o.gc(i.Nb),o.gc(i.kb),o.gc(i.B),o.gc(Si.a),o.gc(ur.a))},t.\u0275cmp=o.ac({type:t,selectors:[["shapes-library-container"]],viewQuery:function(t,e){var n;(1&t&&(o.Yc(i.t,!0),o.Yc($a.b,!0)),2&t)&&(o.Mc(n=o.vc())&&(e.collapsibleMenu=n.first),o.Mc(n=o.vc())&&(e.directiveScroll=n.first))},inputs:{triggerScrollUpdate:"triggerScrollUpdate"},decls:6,vars:0,consts:[["tooltip-tour-step","fab-1.4",1,"shape-lib-container"],[1,"lib-scroll-container"],[1,"col-menu-scrollbar"],[1,"lib-collapsible-menu"],["translate","",1,"lib-message","grey","body"]],template:function(t,e){1&t&&(o.mc(0,"div",0),o.mc(1,"div",1),o.mc(2,"perfect-scrollbar",2),o.hc(3,"collapsible-menu",3),o.lc(),o.lc(),o.mc(4,"p",4),o.gd(5,"LABELS.YOU_HAVE_NOT_ADDED_ANY_SHAPES"),o.lc(),o.lc())},directives:[$o.a,$a.b,ir.a,r.a],styles:[".shape-lib-container[_ngcontent-%COMP%], [_nghost-%COMP%]{max-height:inherit;height:100%}.shape-lib-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%;height:100%}.shape-lib-container[_ngcontent-%COMP%]   perfect-scrollbar[_ngcontent-%COMP%]{max-height:inherit}.lib-scroll-container[_ngcontent-%COMP%]{width:100%;height:inherit;max-height:inherit}.lib-scroll-container[_ngcontent-%COMP%]  .ps-content{margin-right:10px}.lib-message[_ngcontent-%COMP%]{display:none}.lib-toolbar[_ngcontent-%COMP%]{height:-webkit-fit-content;height:-moz-fit-content;height:fit-content;width:260px;bottom:68px;position:absolute}.close-btn[_ngcontent-%COMP%]{display:flex;flex-direction:row-reverse;height:25px}.nu-btn-icon[_ngcontent-%COMP%]{padding:0}.nu-icon-med[_ngcontent-%COMP%]{width:30px;height:30px;color:rgba(98,104,106,.6)}.nu-icon-med[_ngcontent-%COMP%]:hover{cursor:pointer;color:rgba(41,53,56,.7)}"],changeDetection:0}),t}(),pr=function(){function t(t,e){this.state=t,this.modalController=e,this.id="shapes",this.hasSearch=!0,this.isPinned=!0,this.hasOpenLibraries=new O.a(!1),this.subs=[]}return t.prototype.ngOnInit=function(){this.subs.push(this.listenToHasOpenLibrariesChanges().subscribe())},t.prototype.ngOnDestroy=function(){for(this.hasOpenLibraries.unsubscribe();this.subs.length;)this.subs.pop().unsubscribe()},t.prototype.handleMoreButtonClick=function(){this.openLibraryBrowser()},t.prototype.openLibraryBrowser=function(){this.modalController.show(Ka.a).subscribe()},t.prototype.listenToHasOpenLibrariesChanges=function(){var t=this;return this.state.changes("CurrentLibraries").pipe(Object(I.a)((function(t){return t&&t.length>0})),Object(et.a)(),Object(M.a)((function(e){return t.hasOpenLibraries.next(e)})))},t.\u0275fac=function(e){return new(e||t)(o.gc(i.Nb),o.gc(i.kb))},t.\u0275cmp=o.ac({type:t,selectors:[["shapes-panel"]],hostAttrs:[1,"is-height-responsive"],inputs:{triggerScrollUpdate:"triggerScrollUpdate"},decls:3,vars:5,consts:[[1,"floating-panel","shapes-panel"],[3,"triggerScrollUpdate"]],template:function(t,e){1&t&&(o.mc(0,"div",0),o.zc(1,"async"),o.hc(2,"shapes-library-container",1),o.lc()),2&t&&(o.Yb("no-libraries",!o.Ac(1,3,e.hasOpenLibraries)),o.Sb(2),o.Dc("triggerScrollUpdate",e.triggerScrollUpdate))},directives:[dr],pipes:[k.b],styles:[".floating-panel[_ngcontent-%COMP%]{pointer-events:auto}.floating-panel[_ngcontent-%COMP%], [_nghost-%COMP%]{height:100%}.shapes-panel.no-libraries[_ngcontent-%COMP%]  .lib-shapes{height:0}.shapes-panel.no-libraries[_ngcontent-%COMP%]  .lib-message{display:block;padding:10px 10px 0}"],changeDetection:0}),t}(),hr=n("Q0Yk"),gr=n("oqI+"),fr=n("yNxV"),br=n("bFGe"),mr=n("hxpg"),vr=n("td3m");function yr(t,e){1&t&&(o.xc(),o.mc(0,"svg",16),o.hc(1,"use",17),o.lc())}function Sr(t,e){1&t&&(o.xc(),o.mc(0,"svg",16),o.hc(1,"use",18),o.lc())}function Or(t,e){1&t&&(o.mc(0,"p",19),o.gd(1,"TOOLTIPS.SLIDE_PANEL.SLIDE_MODE_PAN"),o.lc())}function xr(t,e){1&t&&(o.mc(0,"p",20),o.gd(1,"TOOLTIPS.SLIDE_PANEL.SLIDE_MODE_PAN_DESCRIPTION"),o.lc())}function Cr(t,e){1&t&&(o.mc(0,"p",21),o.gd(1,"TOOLTIPS.SLIDE_PANEL.SLIDE_MODE_PAN_ACTION"),o.lc())}function Pr(t,e){1&t&&(o.mc(0,"p",19),o.gd(1,"TOOLTIPS.SLIDE_PANEL.SLIDE_MODE_FOCUSED"),o.lc())}function Tr(t,e){1&t&&(o.mc(0,"p",20),o.gd(1,"TOOLTIPS.SLIDE_PANEL.SLIDE_MODE_FOCUSED_DESCRIPTION"),o.lc())}function wr(t,e){1&t&&(o.mc(0,"p",21),o.gd(1,"TOOLTIPS.SLIDE_PANEL.SLIDE_MODE_FOCUSED_ACTION"),o.lc())}var jr=function(t){return["ActiveSlide",t,"active"]},Mr=function(){function t(t,e,n,i){this.commandService=t,this.state=e,this.pl=n,this.presentingService=i,this.isFocusedMode=new O.a(!1),this.isSelected=new O.a(!1),this.hasSelection=new O.a(!1),this.isFocusedMode.next(this.mode===vr.b.FOCUSED),this.subs=[]}return t.prototype.ngOnInit=function(){var t=this;this.isFocusedMode.next(this.mode===vr.b.FOCUSED),this.subs.push(this.state.changes("CurrentPresentation").pipe(Object(M.a)((function(e){e===t.id?t.isSelected.value?t.isSelected.next(!1):t.isSelected.next(!0):t.isSelected.next(!1)}))).subscribe(),this.selectionChanges().subscribe())},t.prototype.ngOnDestroy=function(){for(;this.subs.length;)this.subs.pop().unsubscribe()},t.prototype.loadSlide=function(){var t=this.presentingService.loadSlide(this.presentationId,parseInt(this.index,10)-1,!0).subscribe();this.subs.push(t)},t.prototype.togglePresentingMode=function(){var t=this;this.pl.getPresentation(this.presentationId).pipe(Object(j.a)(1),Object(M.a)((function(e){var n=e.slides[t.id];n.mode=n.mode===vr.b.FOCUSED?vr.b.WORKSPACE:vr.b.FOCUSED,t.commandService.dispatch(D.a.updatePresentation,{presentation:{$set:e},presentationId:e.id}),t.isFocusedMode.next(!t.isFocusedMode.value)}))).subscribe()},t.prototype.selectionChanges=function(){var t=this;return this.state.changes("Selected").pipe(Object(M.a)((function(e){e&&e.length>0?t.hasSelection.next(!0):t.hasSelection.next(!1)})))},t.\u0275fac=function(e){return new(e||t)(o.gc(i.B),o.gc(i.Nb),o.gc(br.a),o.gc(fr.a))},t.\u0275cmp=o.ac({type:t,selectors:[["slide-view"]],inputs:{title:"title",notes:"notes",index:"index",id:"id",presentationId:"presentationId",mode:"mode"},decls:32,vars:30,consts:[[1,"slide-view",3,"ifStateClass"],[1,"slide",3,"click"],[1,"slide-index-container"],[1,"slide-content-container"],[1,"slide-content-head"],[1,"slide-content-title"],[1,"slide-controls"],["tooltip","","placement","top",1,"tooltip-container"],[1,"btn-small","btn-toggle-mode",3,"click"],["class","nu-icon nu-icon-small",4,"ngIf"],[1,"tooltip-content"],["class","tooltip-header body","translate","",4,"ngIf"],["class","tooltip-body body","translate","",4,"ngIf"],["class","tooltip-footer","translate","",4,"ngIf"],[1,"slide-content-notes"],[1,"caption"],[1,"nu-icon","nu-icon-small"],[0,"xlink","href","./assets/icons/symbol-defs.svg#nu-ic-focus-mode"],[0,"xlink","href","./assets/icons/symbol-defs.svg#nu-ic-move"],["translate","",1,"tooltip-header","body"],["translate","",1,"tooltip-body","body"],["translate","",1,"tooltip-footer"]],template:function(t,e){1&t&&(o.mc(0,"div",0),o.mc(1,"button",1),o.uc("click",(function(){return e.loadSlide()})),o.mc(2,"div",2),o.mc(3,"span"),o.gd(4),o.lc(),o.lc(),o.mc(5,"div",3),o.mc(6,"div",4),o.mc(7,"span",5),o.gd(8),o.lc(),o.mc(9,"div",6),o.mc(10,"span",7),o.mc(11,"button",8),o.uc("click",(function(){return e.togglePresentingMode()})),o.ed(12,yr,2,0,"svg",9),o.zc(13,"async"),o.ed(14,Sr,2,0,"svg",9),o.zc(15,"async"),o.lc(),o.mc(16,"span",10),o.ed(17,Or,2,0,"p",11),o.zc(18,"async"),o.ed(19,xr,2,0,"p",12),o.zc(20,"async"),o.ed(21,Cr,2,0,"p",13),o.zc(22,"async"),o.ed(23,Pr,2,0,"p",11),o.zc(24,"async"),o.ed(25,Tr,2,0,"p",12),o.zc(26,"async"),o.ed(27,wr,2,0,"p",13),o.zc(28,"async"),o.lc(),o.lc(),o.lc(),o.lc(),o.mc(29,"div",14),o.mc(30,"span",15),o.gd(31),o.lc(),o.lc(),o.lc(),o.lc(),o.lc()),2&t&&(o.Dc("ifStateClass",o.Ic(28,jr,e.id)),o.Sb(4),o.hd(e.index),o.Sb(4),o.hd(e.title),o.Sb(4),o.Dc("ngIf",o.Ac(13,12,e.isFocusedMode)),o.Sb(2),o.Dc("ngIf",!o.Ac(15,14,e.isFocusedMode)),o.Sb(3),o.Dc("ngIf",!o.Ac(18,16,e.isFocusedMode)),o.Sb(2),o.Dc("ngIf",!o.Ac(20,18,e.isFocusedMode)),o.Sb(2),o.Dc("ngIf",!o.Ac(22,20,e.isFocusedMode)),o.Sb(2),o.Dc("ngIf",o.Ac(24,22,e.isFocusedMode)),o.Sb(2),o.Dc("ngIf",o.Ac(26,24,e.isFocusedMode)),o.Sb(2),o.Dc("ngIf",o.Ac(28,26,e.isFocusedMode)),o.Sb(4),o.hd(e.notes))},directives:[ba.a,ga.a,k.t,r.a],pipes:[k.b],styles:[".nu-beta-tag[_ngcontent-%COMP%]{padding:2px 3px;background-color:#ffc648;color:#04263d;border-radius:2px;font-size:11px;display:inline-block}.left-sidebar-panel[_ngcontent-%COMP%]{padding-bottom:.5rem;height:100vh;box-sizing:border-box}.left-sidebar-panel.expanded[_ngcontent-%COMP%], .left-sidebar-panel.fullscreen[_ngcontent-%COMP%]{width:100%;background-color:#fff;z-index:4}.left-sidebar-panel.closed[_ngcontent-%COMP%]{transform:translateX(-215px);width:0}.left-sidebar-panel-container[_ngcontent-%COMP%]{width:310px;padding-top:1.375rem;padding-bottom:1.375rem}.left-sidebar-add-btn[_ngcontent-%COMP%]{margin:1rem 0}.left-sidebar-heading[_ngcontent-%COMP%]{font-family:Inter,Arial,sans-serif,ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Noto Sans,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;font-size:1rem;font-weight:500;line-height:1.5rem;padding-bottom:.875rem;color:#04263d}.col-menu-scrollbar[_ngcontent-%COMP%]{height:calc(100vh - calc(calc(140px) + calc(22px + 24px + 14px)))}.presentation-slide[_ngcontent-%COMP%], .slide-view[_ngcontent-%COMP%]{pointer-events:auto}.presentation-slide[_ngcontent-%COMP%]   .btn-new-slide-below[_ngcontent-%COMP%], .slide-view[_ngcontent-%COMP%]   .btn-new-slide-below[_ngcontent-%COMP%]{background-color:transparent;width:calc(100% - 8px);font-size:small;text-align:center;display:flex;align-items:center;justify-content:center;opacity:0;transition:all .3s ease-in-out;height:16px;position:relative}.presentation-slide[_ngcontent-%COMP%]   .btn-new-slide-below[_ngcontent-%COMP%]   .nu-icon[_ngcontent-%COMP%], .slide-view[_ngcontent-%COMP%]   .btn-new-slide-below[_ngcontent-%COMP%]   .nu-icon[_ngcontent-%COMP%]{color:#caccce}.presentation-slide[_ngcontent-%COMP%]   .btn-new-slide-below[_ngcontent-%COMP%]   .add-slide-line[_ngcontent-%COMP%], .slide-view[_ngcontent-%COMP%]   .btn-new-slide-below[_ngcontent-%COMP%]   .add-slide-line[_ngcontent-%COMP%]{width:100%;height:4px;background-color:#f1f4fa;z-index:0;position:absolute;left:0;top:6px}.presentation-slide[_ngcontent-%COMP%]   .btn-new-slide-below[_ngcontent-%COMP%]   .add-slide-padding[_ngcontent-%COMP%], .slide-view[_ngcontent-%COMP%]   .btn-new-slide-below[_ngcontent-%COMP%]   .add-slide-padding[_ngcontent-%COMP%]{height:16px;background-color:#f1f4fa;display:flex;align-items:center;justify-content:center;z-index:1}.presentation-slide[_ngcontent-%COMP%]   .btn-new-slide-below[_ngcontent-%COMP%]:hover   .nu-icon[_ngcontent-%COMP%], .slide-view[_ngcontent-%COMP%]   .btn-new-slide-below[_ngcontent-%COMP%]:hover   .nu-icon[_ngcontent-%COMP%]{color:#1381cd}.presentation-slide[_ngcontent-%COMP%]   .btn-new-slide-below.display[_ngcontent-%COMP%], .slide-view[_ngcontent-%COMP%]   .btn-new-slide-below.display[_ngcontent-%COMP%]{padding-top:.5rem;padding-bottom:.5rem;height:16px;visibility:visible;opacity:1}.presentation-slide[_ngcontent-%COMP%]   .btn-new-slide-below.selection[_ngcontent-%COMP%], .presentation-slide[_ngcontent-%COMP%]   .btn-new-slide-below.selection[_ngcontent-%COMP%]   .nu-icon[_ngcontent-%COMP%], .slide-view[_ngcontent-%COMP%]   .btn-new-slide-below.selection[_ngcontent-%COMP%], .slide-view[_ngcontent-%COMP%]   .btn-new-slide-below.selection[_ngcontent-%COMP%]   .nu-icon[_ngcontent-%COMP%]{color:#0c5e96}.presentation-slide[_ngcontent-%COMP%]   .btn-new-slide-below.selection[_ngcontent-%COMP%]   .add-slide-line[_ngcontent-%COMP%], .presentation-slide[_ngcontent-%COMP%]   .btn-new-slide-below.selection[_ngcontent-%COMP%]   .add-slide-padding[_ngcontent-%COMP%], .slide-view[_ngcontent-%COMP%]   .btn-new-slide-below.selection[_ngcontent-%COMP%]   .add-slide-line[_ngcontent-%COMP%], .slide-view[_ngcontent-%COMP%]   .btn-new-slide-below.selection[_ngcontent-%COMP%]   .add-slide-padding[_ngcontent-%COMP%]{background-color:#e1f1fb}.presentation-slide[_ngcontent-%COMP%]   .slide-controls[_ngcontent-%COMP%], .slide-view[_ngcontent-%COMP%]   .slide-controls[_ngcontent-%COMP%]{display:flex;visibility:hidden;opacity:0;transition:all .3s ease-in}.presentation-slide[_ngcontent-%COMP%]   .btn-toggle-mode[_ngcontent-%COMP%], .slide-view[_ngcontent-%COMP%]   .btn-toggle-mode[_ngcontent-%COMP%]{padding:0;border:1px solid #06263d;background-color:#fff;width:25px;height:25px;margin:0 2px 0 0;transition:all .3s ease-in-out}.presentation-slide[_ngcontent-%COMP%]   .btn-toggle-mode[_ngcontent-%COMP%]:hover, .slide-view[_ngcontent-%COMP%]   .btn-toggle-mode[_ngcontent-%COMP%]:hover{opacity:.7}.presentation-slide[_ngcontent-%COMP%]   .btn-toggle-mode.commit-update[_ngcontent-%COMP%], .slide-view[_ngcontent-%COMP%]   .btn-toggle-mode.commit-update[_ngcontent-%COMP%]{color:#caccce;border-color:#caccce;background-color:transparent}.presentation-slide[_ngcontent-%COMP%]   .btn-toggle-mode.commit-update[_ngcontent-%COMP%]:hover, .slide-view[_ngcontent-%COMP%]   .btn-toggle-mode.commit-update[_ngcontent-%COMP%]:hover{background-color:#fff;color:#06263d;border-color:#06263d}.presentation-slide[_ngcontent-%COMP%]   .btn-toggle-mode.cancel-update[_ngcontent-%COMP%], .slide-view[_ngcontent-%COMP%]   .btn-toggle-mode.cancel-update[_ngcontent-%COMP%]{border:0;background-color:transparent}.presentation-slide[_ngcontent-%COMP%]   .btn-toggle-mode.cancel-update[_ngcontent-%COMP%]:hover, .slide-view[_ngcontent-%COMP%]   .btn-toggle-mode.cancel-update[_ngcontent-%COMP%]:hover{background-color:rgba(19,129,205,.07)}.presentation-slide[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%], .slide-view[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]{width:calc(100% - 8px);padding:.5rem 4px .5rem 12px;display:flex;flex-direction:row;align-items:flex-start;border-radius:5px;background-color:transparent;text-align:left;cursor:pointer}.presentation-slide[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]:hover, .slide-view[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]:hover{background-color:#eff6fd}.presentation-slide[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]:hover   .slide-controls[_ngcontent-%COMP%], .slide-view[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]:hover   .slide-controls[_ngcontent-%COMP%]{display:flex;align-items:flex-start;visibility:visible;opacity:1}.presentation-slide[_ngcontent-%COMP%]   .slide.active[_ngcontent-%COMP%], .slide-view[_ngcontent-%COMP%]   .slide.active[_ngcontent-%COMP%]{background:var(--color-primary-light,#e1f1fb);border-radius:5px}.presentation-slide[_ngcontent-%COMP%]   .slide.active[_ngcontent-%COMP%]   .slide-content-title[_ngcontent-%COMP%], .presentation-slide[_ngcontent-%COMP%]   .slide.active[_ngcontent-%COMP%]   .slide-index-container[_ngcontent-%COMP%], .slide-view[_ngcontent-%COMP%]   .slide.active[_ngcontent-%COMP%]   .slide-content-title[_ngcontent-%COMP%], .slide-view[_ngcontent-%COMP%]   .slide.active[_ngcontent-%COMP%]   .slide-index-container[_ngcontent-%COMP%]{color:#1381cd}.presentation-slide[_ngcontent-%COMP%]   .slide.active[_ngcontent-%COMP%]   .slide-controls[_ngcontent-%COMP%], .slide-view[_ngcontent-%COMP%]   .slide.active[_ngcontent-%COMP%]   .slide-controls[_ngcontent-%COMP%]{display:flex;align-items:flex-start;visibility:visible;opacity:1}.presentation-slide[_ngcontent-%COMP%]   .slide-index-container[_ngcontent-%COMP%], .slide-view[_ngcontent-%COMP%]   .slide-index-container[_ngcontent-%COMP%]{padding-right:5px;padding-top:3px;color:var(--color-brand-blue,#04263d);font-family:Inter;font-size:14px;font-style:normal;font-weight:400;line-height:21px}.presentation-slide[_ngcontent-%COMP%]   .slide-content-container[_ngcontent-%COMP%], .slide-view[_ngcontent-%COMP%]   .slide-content-container[_ngcontent-%COMP%]{flex:1;width:90%}.presentation-slide[_ngcontent-%COMP%]   .slide-content-container[_ngcontent-%COMP%]   .slide-content-head[_ngcontent-%COMP%], .slide-view[_ngcontent-%COMP%]   .slide-content-container[_ngcontent-%COMP%]   .slide-content-head[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between}.presentation-slide[_ngcontent-%COMP%]   .slide-content-container[_ngcontent-%COMP%]   .slide-content-head[_ngcontent-%COMP%]   .slide-content-title[_ngcontent-%COMP%], .slide-view[_ngcontent-%COMP%]   .slide-content-container[_ngcontent-%COMP%]   .slide-content-head[_ngcontent-%COMP%]   .slide-content-title[_ngcontent-%COMP%]{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;padding-top:3px;font-family:Inter;font-size:14px;font-style:normal;font-weight:400;line-height:21px}.presentation-slide[_ngcontent-%COMP%]   .slide-content-container[_ngcontent-%COMP%]   .slide-content-head[_ngcontent-%COMP%]   .editable-title[_ngcontent-%COMP%], .slide-view[_ngcontent-%COMP%]   .slide-content-container[_ngcontent-%COMP%]   .slide-content-head[_ngcontent-%COMP%]   .editable-title[_ngcontent-%COMP%]{width:100%}.presentation-slide[_ngcontent-%COMP%]   .slide-content-container[_ngcontent-%COMP%]   .slide-content-notes[_ngcontent-%COMP%], .slide-view[_ngcontent-%COMP%]   .slide-content-container[_ngcontent-%COMP%]   .slide-content-notes[_ngcontent-%COMP%]{padding-top:4px}.presentation-slide[_ngcontent-%COMP%]   .slide-content-container[_ngcontent-%COMP%]   .slide-content-notes[_ngcontent-%COMP%]  .caption, .presentation-slide[_ngcontent-%COMP%]   .slide-content-container[_ngcontent-%COMP%]   .slide-content-notes[_ngcontent-%COMP%]  .editable-label, .slide-view[_ngcontent-%COMP%]   .slide-content-container[_ngcontent-%COMP%]   .slide-content-notes[_ngcontent-%COMP%]  .caption, .slide-view[_ngcontent-%COMP%]   .slide-content-container[_ngcontent-%COMP%]   .slide-content-notes[_ngcontent-%COMP%]  .editable-label{color:var(--color-gray,#64767d);font-family:Inter;font-size:12px;font-style:normal;font-weight:400;line-height:16px}.presentation-slide[_ngcontent-%COMP%]   .thumbnail-dd-button[_ngcontent-%COMP%], .slide-view[_ngcontent-%COMP%]   .thumbnail-dd-button[_ngcontent-%COMP%]{margin:0;padding:0;background-color:transparent}.presentation-slide[_ngcontent-%COMP%]   .diagram-thumbnail-item-img[_ngcontent-%COMP%], .slide-view[_ngcontent-%COMP%]   .diagram-thumbnail-item-img[_ngcontent-%COMP%]{max-height:100%;max-width:100%}.presentation-slide[_ngcontent-%COMP%]   .diagram-thumbnail-item-img[_ngcontent-%COMP%]  svg, .slide-view[_ngcontent-%COMP%]   .diagram-thumbnail-item-img[_ngcontent-%COMP%]  svg{max-height:115px;max-width:152px}.presentation-slide[_ngcontent-%COMP%]   .thumbnail-dd[_ngcontent-%COMP%]:hover   .thumbnail-dd-item[_ngcontent-%COMP%], .slide-view[_ngcontent-%COMP%]   .thumbnail-dd[_ngcontent-%COMP%]:hover   .thumbnail-dd-item[_ngcontent-%COMP%]{display:none}.presentation-slide[_ngcontent-%COMP%]   .open-dd[_ngcontent-%COMP%]   .thumbnail-dd-item[_ngcontent-%COMP%], .presentation-slide[_ngcontent-%COMP%]   .thumbnail-dd.open-dd[_ngcontent-%COMP%]   .thumbnail-dd-item[_ngcontent-%COMP%], .slide-view[_ngcontent-%COMP%]   .open-dd[_ngcontent-%COMP%]   .thumbnail-dd-item[_ngcontent-%COMP%], .slide-view[_ngcontent-%COMP%]   .thumbnail-dd.open-dd[_ngcontent-%COMP%]   .thumbnail-dd-item[_ngcontent-%COMP%]{display:block}.slide-view[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]{padding-top:.5rem;padding-bottom:.5rem;width:calc(100%);margin-left:0;border-radius:5px}.slide-view.active[_ngcontent-%COMP%]{background:var(--color-primary-light,#e1f1fb);border-radius:5px}.slide-view.active[_ngcontent-%COMP%]   .slide-content-title[_ngcontent-%COMP%], .slide-view.active[_ngcontent-%COMP%]   .slide-index-container[_ngcontent-%COMP%]{color:#1381cd}.slide-view.active[_ngcontent-%COMP%]   .slide-controls[_ngcontent-%COMP%]{display:flex;align-items:flex-start;visibility:visible;opacity:1}.thumbnail-dd-button[_ngcontent-%COMP%]{background-color:#e1f1fb;width:25px;height:25px;border-radius:.375rem}.thumbnail-dd-button[_ngcontent-%COMP%]   .nu-icon[_ngcontent-%COMP%]{color:#0c5e96;width:24px;height:24px}.dropdown-wrapper[_ngcontent-%COMP%]{position:relative}.thumbnail-dd-item[_ngcontent-%COMP%]{padding:.625rem;box-shadow:0 4px 9px -2px rgba(39,41,50,.12);width:150px;background:#fff;border-radius:.25rem;display:none;position:absolute;z-index:1;right:0}.thumbnail-dd-item[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:block;font-size:.875rem}.menu-icon[_ngcontent-%COMP%]{margin-right:10px}"],changeDetection:0}),t}(),Ir=n("rwb9");function Er(t,e){1&t&&o.hc(0,"div",38)}function Dr(t,e){if(1&t&&(o.mc(0,"div"),o.mc(1,"slide-view",36),o.ed(2,Er,1,0,"div",37),o.lc(),o.lc()),2&t){var n=e.$implicit,i=e.index;o.Sb(1),o.Dc("title",n.title)("notes",n.notes)("id",n.id)("index",i+1)("presentationId",n.presentationId)("mode",n.mode)}}var _r=function(){return{value1:"pan"}},kr=function(t){return{event:"fab.button.quick.click",data:t}};function Ar(t,e){if(1&t){var n=o.nc();o.mc(0,"div",25),o.mc(1,"div",26),o.mc(2,"div",27),o.mc(3,"div",28),o.mc(4,"span",29),o.gd(5),o.lc(),o.mc(6,"button",30),o.uc("click",(function(){return o.Rc(n),o.yc(2).toggleSlidesPanel()})),o.xc(),o.mc(7,"svg",20),o.hc(8,"use",21),o.lc(),o.lc(),o.lc(),o.wc(),o.mc(9,"span",31),o.gd(10),o.lc(),o.lc(),o.lc(),o.mc(11,"div",32),o.uc("drop",(function(t){return o.Rc(n),o.yc(2).onDrop(t)})),o.mc(12,"perfect-scrollbar",33),o.mc(13,"cdk-drop-list",34),o.uc("cdkDropListDropped",(function(t){return o.Rc(n),o.yc(2).drop(t)})),o.ed(14,Dr,3,6,"div",35),o.zc(15,"async"),o.lc(),o.lc(),o.lc(),o.lc()}if(2&t){var i=o.yc(2);o.Sb(5),o.hd(i.presentationName.value),o.Sb(1),o.Dc("trackAction",o.Ic(8,kr,o.Hc(7,_r))),o.Sb(4),o.id("",i.totalSlides.value," Slides"),o.Sb(3),o.Dc("cdkDropListData",i.slides),o.Sb(1),o.Dc("ngForOf",o.Ac(15,5,i.slides))}}function Lr(t,e){if(1&t){var n=o.nc();o.mc(0,"div",22),o.mc(1,"button",6),o.uc("click",(function(){return o.Rc(n),o.yc().toggleSlidesPanel()})),o.hc(2,"img",23),o.lc(),o.ed(3,Ar,16,10,"div",24),o.zc(4,"async"),o.lc()}if(2&t){var i=o.yc();o.Sb(3),o.Dc("ngIf",o.Ac(4,1,i.showSlidesPanel))}}function Br(t,e){if(1&t&&o.hc(0,"user-image",44),2&t){var n=o.yc(2);o.Dc("hasImage",n.user.value.hasImage)("imagePath",n.user.value.image)("userColor",n.user.value.getColor())("userInitials",n.user.value.initial)("userRegistered",n.user.value.isRegistered)("userOnlineStatus",!0)}}var Rr=function(t){return{user:t}};function Nr(t,e){if(1&t){var n=o.nc();o.mc(0,"span",39),o.mc(1,"button",40),o.uc("click",(function(){return o.Rc(n),o.yc().gotoPresenter()})),o.ed(2,Br,1,6,"user-image",41),o.lc(),o.mc(3,"span",42),o.hc(4,"p",43),o.lc(),o.lc()}if(2&t){var i=o.yc();o.Sb(2),o.Dc("ngIf",i.user.value),o.Sb(2),o.Dc("translate","TOOLTIPS.SLIDE_PANEL.CLICK_TO_RETURN_TO")("translateParams",o.Ic(3,Rr,i.user.value.firstName))}}function Hr(t,e){1&t&&o.hc(0,"div",13)}function Fr(t,e){if(1&t){var n=o.nc();o.mc(0,"div"),o.mc(1,"button",45),o.uc("click",(function(){return o.Rc(n),o.yc().showShareModal()})),o.xc(),o.mc(2,"svg",46),o.hc(3,"use",47),o.lc(),o.wc(),o.mc(4,"span",11),o.gd(5,"SHARE.SHARE"),o.lc(),o.lc(),o.lc()}}function Gr(t,e){1&t&&o.hc(0,"div",13)}var qr=function(){return["MouseControlState","sticky-note","active"]},Vr=function(){return{value1:"sticky-note"}},Ur=function(){return["MouseControlState","highlighter","active"]},zr=function(t){return{value1:"highlighter",value2:t}},Yr=function(){function t(t,e,n,i,a,o){this.state=t,this.commandService=e,this.presentingService=n,this.pl=i,this.dialogBoxController=a,this.mdlCtrl=o,this.user=new O.a({}),this.subs=[],this.currentSlide=new O.a(1),this.totalSlides=new O.a(0),this.presenter=new O.a(!1),this.slides=new O.a([]),this.presentationName=new O.a(""),this.showSlidesPanel=new O.a(!1),this.projectId=new O.a("")}return Object.defineProperty(t.prototype,"currentSlideValue",{get:function(){return this.currentSlide.value},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"totalSlidesValue",{get:function(){return this.totalSlides.value},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"freeHandStatus",{get:function(){var t=[pt.b.Pen,pt.b.Highlighter];return i.Pb.track("toolbar.freehand.click"),t.includes(this.state.get("MouseControlState"))?"close":"open"},enumerable:!1,configurable:!0}),t.prototype.ngOnInit=function(){var t=this.state.get("PresentationStatus");this.presenter.next(null==t?void 0:t.presenting),t.presenting||this.user.next(this.presentingService.presenter.value);var e=this.initialize(t.presentationId).subscribe(),n=this.listenToSlideChange().subscribe();this.subs.push(e,n)},t.prototype.ngOnDestroy=function(){for(var t,e,n,i,a,o,r;this.subs.length;)this.subs.pop().unsubscribe();null===(t=this.currentSlide)||void 0===t||t.complete(),null===(e=this.totalSlides)||void 0===e||e.complete(),null===(n=this.presenter)||void 0===n||n.complete(),null===(i=this.user)||void 0===i||i.complete(),null===(a=this.showSlidesPanel)||void 0===a||a.complete(),null===(o=this.slides)||void 0===o||o.complete(),null===(r=this.presentationName)||void 0===r||r.complete(),this.currentSlide=null,this.totalSlides=null,this.presenter=null,this.user=null,this.showSlidesPanel=null,this.slides=null,this.presentationName=null},t.prototype.setMouseControlState=function(t){t!==this.state.get("MouseControlState")?this.commandService.dispatch(gt.a.changeMouseControlState,{state:t}):this.commandService.dispatch(gt.a.changeMouseControlState,{state:pt.b.Normal})},t.prototype.leavePresentation=function(){var t=this.state.get("PresentationStatus");t&&t.presentationId&&t.presenting?this.presentingService.togglePresenting(t.presentationId):this.presentingService.leavePresentation(t.presentationId)},t.prototype.nextSlide=function(){var t=this.state.get("PresentationStatus");if(t&&t.presentationId&&this.currentSlide.value+1<=this.totalSlides.value){var e=this.currentSlide.value+1;this.currentSlide.next(e),this.presentingService.loadSlide(t.presentationId,e-1,!!t.presenting).subscribe()}},t.prototype.previousSlide=function(){var t=this.state.get("PresentationStatus");if(t&&t.presentationId&&this.currentSlide.value-1>0){var e=this.currentSlide.value-1;this.currentSlide.next(e),this.presentingService.loadSlide(t.presentationId,e-1,!!t.presenting).subscribe()}},t.prototype.drop=function(t){var e=this,n=this.slides.value;Object(gr.h)(n,t.previousIndex,t.currentIndex),this.slides.next(n);var i=this.state.get("PresentationStatus");this.pl.getPresentation(i.presentationId).pipe(Object(j.a)(1),Object(M.a)((function(t){var i={};n.forEach((function(e){return i[e.id]=t.slides[e.id]})),t.slides=i,e.commandService.dispatch(gt.a.updatePresentation,{presentation:{$set:t},presentationId:t.id})}))).subscribe()},t.prototype.initialize=function(t){var e=this;return this.pl.getPresentation(t).pipe(Object(j.a)(1),Object(M.a)((function(t){e.presentation=t,e.projectId.next(t.projectId),e.presentationName.next(t.name),t.slides&&Object.keys(t.slides).forEach((function(n,i){var a=e.getSlideView(t.slides[n],i);e.slides.next(Object(W.j)(e.slides.value,[a])),e.totalSlides.next(e.slides.value.length)}))})))},t.prototype.gotoPresenter=function(){this.presentingService.goToPresenter().subscribe()},t.prototype.showShareModal=function(){var t=this;if(this.presentation&&this.presentation.hideWarning)return this.openShareWindow();var e={id:"CustomTypeDeleteCustomDatabaseDelete",heading:"SLIDES_PANEL.SHARE.HEADING",description:"SLIDES_PANEL.SHARE.DESCRIPTION",headingParams:{},descriptionParams:{},type:"warning",icon:"circle-warning",buttons:[{type:"cancel",text:"BUTTONS.CANCEL",clickHandler:function(){}},{type:"ok",text:"BUTTONS.INVITE",clickHandler:function(){return t.openShareWindow()}}]};this.dialogBoxController.showDialog(e),this.pl.getPresentation(this.presentation.id).pipe(Object(j.a)(1),Object(M.a)((function(e){e.hideWarning=!0,t.presentation=e,t.commandService.dispatch(gt.a.updatePresentation,{presentation:{$set:e},presentationId:e.id})}))).subscribe()},t.prototype.openShareWindow=function(t){void 0===t&&(t=this.projectId.value);var e=null!=t?t:this.state.get("FolderPanelSelectedProject");this.state.set("HighlightedProject",e),this.mdlCtrl.show(mr.a)},t.prototype.listenToSlideChange=function(){var t=this;return this.state.changes("ActiveSlide").pipe(Object(M.a)((function(e){if(t.slides.value.length>0){var n=t.slides.value.findIndex((function(t){return t.id===e}));t.currentSlide.next(n+1)}})))},t.prototype.toggleSlidesPanel=function(){this.showSlidesPanel.next(!this.showSlidesPanel.value)},t.prototype.getSlideView=function(t,e){return{id:t.id,index:e+1,title:t.title,presentationId:t.presentationId,notes:t.notes,mode:t.mode}},t.\u0275fac=function(e){return new(e||t)(o.gc(i.Nb),o.gc(i.B),o.gc(fr.a),o.gc(br.a),o.gc(S.g),o.gc(i.kb))},t.\u0275cmp=o.ac({type:t,selectors:[["floating-presentation-container"]],decls:48,vars:34,consts:[[1,"floating-menu-container",3,"beforeunload","unload"],["class","d-flex",4,"ngIf"],["class","tooltip-container","tooltip","","placement","top",4,"ngIf"],["class","fab-divider",4,"ngIf"],[1,"presentation-controls-container","fx-center-all"],["placement","top","tooltip",""],[1,"btn-medium","btn-icon","fx-center-all","fx-padding-8",3,"click"],[1,"nu-icon","nu-icon-med"],[0,"xlink","href","./assets/icons/symbol-defs.svg#nu-ic-chevron-left"],["translate","",1,"tooltip-content"],[1,"fx-padding-8"],["translate",""],[0,"xlink","href","./assets/icons/symbol-defs.svg#nu-ic-chevron-right"],[1,"fab-divider"],[1,"fx-justify-space-between","fx-center-all"],[1,"btn-medium","btn-icon","fx-center-all","fx-padding-8",3,"ifStateClass","trackAction","click"],["src","./assets/images/quick-tool/sticky.svg",1,"nu-icon","quick-tool-icon","nu-icon-med"],["src","./assets/images/quick-tool/freehand.svg",1,"nu-icon","quick-tool-icon","nu-ic-pen","nu-icon-med"],[4,"ngIf"],[1,"btn-medium","btn-icon","fx-center-all","fx-padding-8",3,"trackAction","click"],[1,"nu-icon","nu-icon-med","icon-closebtn"],[0,"xlink","href","./assets/icons/symbol-defs.svg#nu-ic-close"],[1,"d-flex"],["src","./assets/images/quick-tool/card.svg",1,"nu-icon","quick-tool-icon","nu-icon-med"],["class","fab-slides-panel",4,"ngIf"],[1,"fab-slides-panel"],[1,"fab-head"],[1,"d-flex","fab-header"],[1,"d-flex","fx-justify-space-between","title-container"],[1,"flex-1","presentation-title"],[1,"btn-small","btn-icon","fx-center-all","fx-padding-8",3,"trackAction","click"],[1,"slide-count"],[1,"slides-section",3,"drop"],[1,"scroll-bar"],["cdkDropList","",1,"dropbox",3,"cdkDropListData","cdkDropListDropped"],[4,"ngFor","ngForOf"],["cdkDrag","",1,"slide-item",3,"title","notes","id","index","presentationId","mode"],["class","example-custom-placeholder",4,"cdkDragPlaceholder"],[1,"example-custom-placeholder"],["tooltip","","placement","top",1,"tooltip-container"],[1,"btn-small",3,"click"],["imageSize","small",3,"hasImage","imagePath","userColor","userInitials","userRegistered","userOnlineStatus",4,"ngIf"],[1,"tooltip-content"],[1,"tooltip-header","body",3,"translate","translateParams"],["imageSize","small",3,"hasImage","imagePath","userColor","userInitials","userRegistered","userOnlineStatus"],[1,"btn-medium","btn-primary","header-share-button",3,"click"],[1,"nu-icon","nu-icon-med","white"],[0,"xlink","href","./assets/icons/symbol-defs.svg#nu-ic-users"]],template:function(t,e){1&t&&(o.mc(0,"div",0),o.uc("beforeunload",(function(){return e.leavePresentation()}),!1,o.Qc)("unload",(function(){return e.leavePresentation()}),!1,o.Qc),o.ed(1,Lr,5,3,"div",1),o.zc(2,"async"),o.ed(3,Nr,5,5,"span",2),o.zc(4,"async"),o.ed(5,Hr,1,0,"div",3),o.zc(6,"async"),o.mc(7,"div",4),o.mc(8,"div",5),o.mc(9,"button",6),o.uc("click",(function(){return e.previousSlide()})),o.xc(),o.mc(10,"svg",7),o.hc(11,"use",8),o.lc(),o.lc(),o.wc(),o.mc(12,"span",9),o.gd(13,"TOOLTIPS.PRESENTATION_FAB.PREVIOUS"),o.lc(),o.lc(),o.mc(14,"span",10),o.mc(15,"span",11),o.gd(16,"SLIDES_PANEL.SLIDE"),o.lc(),o.mc(17,"span"),o.gd(18),o.lc(),o.lc(),o.mc(19,"div",5),o.mc(20,"button",6),o.uc("click",(function(){return e.nextSlide()})),o.xc(),o.mc(21,"svg",7),o.hc(22,"use",12),o.lc(),o.lc(),o.wc(),o.mc(23,"span",9),o.gd(24,"TOOLTIPS.PRESENTATION_FAB.NEXT"),o.lc(),o.lc(),o.lc(),o.hc(25,"div",13),o.mc(26,"div",14),o.mc(27,"div",5),o.mc(28,"button",15),o.uc("click",(function(){return e.setMouseControlState("sticky-note")})),o.hc(29,"img",16),o.lc(),o.mc(30,"span",9),o.gd(31,"TOOLTIPS.ADD_STICKY_NOTE"),o.lc(),o.lc(),o.mc(32,"div",5),o.mc(33,"button",15),o.uc("click",(function(){return e.setMouseControlState("highlighter")})),o.hc(34,"img",17),o.lc(),o.mc(35,"span",9),o.gd(36,"TOOLTIPS.FREEHANDTOOL"),o.lc(),o.lc(),o.hc(37,"div",13),o.ed(38,Fr,6,0,"div",18),o.zc(39,"async"),o.ed(40,Gr,1,0,"div",3),o.zc(41,"async"),o.mc(42,"div",5),o.mc(43,"button",19),o.uc("click",(function(){return e.leavePresentation()})),o.xc(),o.mc(44,"svg",20),o.hc(45,"use",21),o.lc(),o.lc(),o.wc(),o.mc(46,"span",9),o.gd(47,"TOOLTIPS.PRESENTATION_FAB.LEAVE_PRESENTATION"),o.lc(),o.lc(),o.lc(),o.lc()),2&t&&(o.Sb(1),o.Dc("ngIf",o.Ac(2,12,e.presenter)),o.Sb(2),o.Dc("ngIf",!o.Ac(4,14,e.presenter)),o.Sb(2),o.Dc("ngIf",o.Ac(6,16,e.presenter)),o.Sb(13),o.jd(" ",e.currentSlideValue," / ",e.totalSlidesValue,""),o.Sb(10),o.Dc("ifStateClass",o.Hc(22,qr))("trackAction",o.Ic(24,kr,o.Hc(23,Vr))),o.Sb(5),o.Dc("ifStateClass",o.Hc(26,Ur))("trackAction",o.Ic(29,kr,o.Ic(27,zr,e.freeHandStatus))),o.Sb(5),o.Dc("ngIf",o.Ac(39,18,e.presenter)),o.Sb(2),o.Dc("ngIf",o.Ac(41,20,e.presenter)),o.Sb(3),o.Dc("trackAction",o.Ic(32,kr,o.Hc(31,_r))))},directives:[k.t,ga.a,r.a,ba.a,fa.a,$a.b,gr.e,k.s,Mr,gr.a,gr.c,Ir.a],pipes:[k.b],styles:["[_nghost-%COMP%]{display:flex;align-items:flex-end;-webkit-align-items:flex-end}.icon-closebtn[_ngcontent-%COMP%]{width:20px;height:20px}.floating-section[_ngcontent-%COMP%]{display:flex;flex-direction:column-reverse}.slides-section[_ngcontent-%COMP%]{padding:0 8px 8px;overflow-y:hidden}.floating-menu-container[_ngcontent-%COMP%]{box-shadow:0 2px 2px rgba(0,0,0,.15),0 1px 12px rgba(0,0,0,.15);padding:.25rem;flex-direction:row;align-items:center;position:relative;border-radius:8px;height:48px}.fab-slides-panel[_ngcontent-%COMP%], .floating-menu-container[_ngcontent-%COMP%]{display:flex;background:#fff;box-shadow:0 1px 12px 0 rgba(0,0,0,.15),0 2px 2px 0 rgba(0,0,0,.15)}.fab-slides-panel[_ngcontent-%COMP%]{width:314px;position:absolute;bottom:65px;left:0;padding:8px 0;flex-direction:column;border-radius:6px}.presentation-title[_ngcontent-%COMP%]{color:var(--color-brand-blue,#04263d);font-family:Inter;font-size:16px;font-style:normal;font-weight:500;line-height:150%}.scroll-bar[_ngcontent-%COMP%]{max-height:calc(100vh - 50px - 16px - 35px - 65px - 108px)}.fab-head[_ngcontent-%COMP%]{width:100%;padding-left:14px;padding-right:8px}.fab-header[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-start;justify-content:space-between;width:100%;padding-top:8px;padding-bottom:8px}.title-container[_ngcontent-%COMP%]{width:100%;align-items:center}.slide-count[_ngcontent-%COMP%]{margin-top:5px;color:var(--color-gray,#64767d);font-weight:400;line-height:21px}.presentation-controls-container[_ngcontent-%COMP%], .slide-count[_ngcontent-%COMP%]{font-family:Inter;font-size:14px;font-style:normal}.presentation-controls-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;align-items:center;margin-right:5px;color:var(--color-brand-blue,#04263d);text-align:center;font-weight:500;line-height:20px}.fab-divider[_ngcontent-%COMP%]{margin-left:10px;margin-right:10px;height:20px;border-left:1px solid #d8dbe1}.menu-button[_ngcontent-%COMP%]{margin-bottom:.625rem;display:block}.menu-container[_ngcontent-%COMP%]{position:absolute;bottom:0;opacity:0;transition:transform .1s ease-in-out,opacity .1s ease-in-out}.menu-container.active[_ngcontent-%COMP%]{transform:translateY(-55px);opacity:1}@supports (background:-webkit-canvas(squares)){.floating-panel-container[_ngcontent-%COMP%]{left:80px}}.presentation-controls-container[_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%]{pointer-events:all;align-items:center;padding:6px 0 16px;height:112px}.presentation-controls-container[_ngcontent-%COMP%]   .context-menu-item[_ngcontent-%COMP%]{padding:.5rem .25rem;color:#04263d;border-radius:.25rem;display:block}.presentation-controls-container[_ngcontent-%COMP%]   .context-menu-item[_ngcontent-%COMP%]:hover{color:#04263d;background:#e1f1fb}.panel-container[_ngcontent-%COMP%]{height:calc(100vh - 196px - 160px);padding-right:0;padding-left:.5rem;flex-grow:1}@media only screen and (max-width:1440px){.panel-container[_ngcontent-%COMP%]{height:calc(100vh - 196px - 200px)}}.floating-quick-tools[_ngcontent-%COMP%]{box-shadow:0 2px 2px rgba(0,0,0,.15),0 1px 12px rgba(0,0,0,.15);padding:.25rem .25rem .25rem 1.25rem;margin-left:-1rem;background:#fff;border-radius:4px 0 4px 4px;width:298px}.more-btns-section[_ngcontent-%COMP%]{padding:1rem;display:flex;flex-direction:row;position:relative}@media only screen and (max-width:1440px){.more-btns-section[_ngcontent-%COMP%]{flex-direction:column}}.more-btns-section[_ngcontent-%COMP%] > button[_ngcontent-%COMP%] + button[_ngcontent-%COMP%]{margin-left:1rem}@media only screen and (max-width:1440px){.more-btns-section[_ngcontent-%COMP%] > button[_ngcontent-%COMP%] + button[_ngcontent-%COMP%]{margin-left:0;margin-top:.5rem}}.slide-item[_ngcontent-%COMP%]{position:relative}.cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;display:flex;padding:4px;flex-direction:column;align-items:flex-start;gap:8px;flex:1 0 0;border-radius:8px;background-color:#e1f1fb;opacity:.6;cursor:-webkit-grabbing!important;cursor:grabbing!important}.example-custom-placeholder[_ngcontent-%COMP%]{background-color:#9dc4f8;height:2px;transition:transform .25s cubic-bezier(0,0,.2,1)}"]}),t}();function Xr(t,e){if(1&t&&(o.xc(),o.mc(0,"svg",4),o.hc(1,"use"),o.lc()),2&t){var n=o.yc();o.Dc("ngClass","nu-icon-"+n.icon),o.Sb(1),o.Tb("href","./assets/icons/symbol-defs.svg#nu-ic-"+n.icon,null,"xlink")}}function Kr(t,e){if(1&t&&o.hc(0,"img",5),2&t){var n=o.yc();o.Ec("src",n.icon,o.Uc)}}var Wr=function(){function t(){this.icon="",this.label="",this.active=!1,this.selected=!1,this.isImage=!1}return t.prototype.ngAfterViewInit=function(){this.isImage=this.icon&&this.icon.includes("/assets/images/")},t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=o.ac({type:t,selectors:[["panel-toolbar-button"]],inputs:{id:"id",icon:"icon",label:"label",active:"active",selected:"selected",tooltip:"tooltip"},decls:6,vars:9,consts:[["tooltip","",1,"panel-toolbar-button","btn-small","btn-secondary","body","fx-pointer-events-auto",3,"deactivated"],["class","nu-icon",3,"ngClass",4,"ngIf"],["class","nu-icon nu-icon-xsmall",3,"src",4,"ngIf"],["translate","",1,"tooltip-content"],[1,"nu-icon",3,"ngClass"],[1,"nu-icon","nu-icon-xsmall",3,"src"]],template:function(t,e){1&t&&(o.mc(0,"button",0),o.ed(1,Xr,2,2,"svg",1),o.ed(2,Kr,1,1,"img",2),o.mc(3,"span",3),o.gd(4),o.lc(),o.gd(5),o.lc()),2&t&&(o.Yb("has-icon-only",!!e.icon&&!e.label)("active",e.active),o.Dc("deactivated",!e.tooltip),o.Sb(1),o.Dc("ngIf",e.icon&&!e.isImage),o.Sb(1),o.Dc("ngIf",e.isImage),o.Sb(2),o.hd(e.tooltip),o.Sb(1),o.id(" ",e.label,"\n"))},directives:[ga.a,k.t,r.a,k.q],styles:[".panel-toolbar-button[_ngcontent-%COMP%]{padding:.375rem .5rem;background:#fff;border:1px solid #e9e9e9;border-radius:6px;color:#04263d;height:36px;white-space:nowrap;cursor:pointer;display:flex;align-items:center}.panel-toolbar-button.has-icon-only[_ngcontent-%COMP%]{width:32px}.panel-toolbar-button[_ngcontent-%COMP%]:not(.has-icon-only){padding:.5rem .75rem}.panel-toolbar-button.active[_ngcontent-%COMP%], .panel-toolbar-button[_ngcontent-%COMP%]:hover{background:#e1f1fb}.panel-toolbar-button[_ngcontent-%COMP%]   .nu-icon-pin[_ngcontent-%COMP%]{width:14px;height:14px}.panel-toolbar-button[_ngcontent-%COMP%]   .nu-icon[_ngcontent-%COMP%]{margin-right:8px}"]}),t}(),Zr=["panelTagContainer"],Qr=["slider"];function Jr(t,e){if(1&t){var n=o.nc();o.mc(0,"panel-toolbar-button",5),o.uc("click",(function(){o.Rc(n);var t=e.$implicit;return o.yc().onButtonClick(t.id)})),o.lc()}if(2&t){var i=e.$implicit,a=o.yc();o.Dc("icon",null==i?null:i.icon)("label",null==i?null:i.label)("active",a.activeButton==i.id)}}var $r=function(){function t(t){this.state=t,this._buttons=new O.a([]),this.orderedBtns=new O.a([]),this.buttonClick=new o.t,this.subs=[]}return Object.defineProperty(t.prototype,"buttons",{get:function(){return this._buttons.value},set:function(t){this._buttons.next(t)},enumerable:!1,configurable:!0}),t.prototype.ngOnInit=function(){this.subs.push(this.listenToButtonChanges().subscribe())},t.prototype.ngOnChanges=function(){var t,e=this;if(this.activeButton){var n=this.buttons.map((function(t){return t}));if((null===(t=this.buttons[0])||void 0===t?void 0:t.id)!==this.activeButton){var i=this.buttons.find((function(t){return t.id===e.activeButton}));i&&(n.splice(n.indexOf(i),1),n.unshift(i))}this.orderedBtns.next(n)}else this.orderedBtns.next(this.buttons)},t.prototype.ngOnDestroy=function(){for(;this.subs.length>0;)this.subs.pop().unsubscribe()},t.prototype.onButtonClick=function(t){["icons","shapes","asset","frames","embeds"].includes(t)?i.Pb.track("fab."+t+".click"):i.Pb.track("fab.click",{value1Type:"tagBarButton",value1:t}),this.buttonClick.emit(t)},t.prototype.listenToButtonChanges=function(){return this._buttons.pipe(Object(ut.a)(1),Object(M.a)((function(){})))},t.\u0275fac=function(e){return new(e||t)(o.gc(i.Nb))},t.\u0275cmp=o.ac({type:t,selectors:[["panel-tag-bar"]],viewQuery:function(t,e){var n;(1&t&&(o.ld(Zr,!0),o.ld(Qr,!0)),2&t)&&(o.Mc(n=o.vc())&&(e.panelTagContainer=n.first),o.Mc(n=o.vc())&&(e.slider=n.first))},inputs:{activeButton:"activeButton",buttons:"buttons"},outputs:{buttonClick:"buttonClick"},features:[o.Qb],decls:6,vars:3,consts:[[1,"panel-tag-bar"],[1,"fx-overflow-hidden"],["panelTagContainer",""],[1,"panel-tag-bar-buttons"],[3,"icon","label","active","click",4,"ngFor","ngForOf"],[3,"icon","label","active","click"]],template:function(t,e){1&t&&(o.mc(0,"div",0),o.mc(1,"div",1,2),o.mc(3,"div",3),o.ed(4,Jr,1,3,"panel-toolbar-button",4),o.zc(5,"async"),o.lc(),o.lc(),o.lc()),2&t&&(o.Sb(4),o.Dc("ngForOf",o.Ac(5,1,e.orderedBtns)))},directives:[k.s,Wr],pipes:[k.b],styles:[".panel-tag-bar[_ngcontent-%COMP%]{padding-left:.25rem;padding-bottom:.5rem;background:#fafafc;display:flex;left:0;flex-wrap:wrap;height:64px;overflow:hidden;box-shadow:inset 0 2px 4px -2px rgba(39,41,50,.04);position:absolute;z-index:3}.panel-tag-bar[_ngcontent-%COMP%]:hover{height:auto}.panel-tag-bar[_ngcontent-%COMP%]   panel-toolbar-button[_ngcontent-%COMP%]{margin-top:.5rem;margin-right:.5rem}@media only screen and (max-width:1440px){.panel-tag-bar[_ngcontent-%COMP%]{padding-left:.5rem}}.panel-tag-bar-buttons[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}"]}),t}(),ts=["plusFab"],es=["panelContainer"],ns=["multiSearch"],is=["panel"],as=function(){return{event:"fab.button.click"}};function os(t,e){if(1&t){var n=o.nc();o.mc(0,"div",19),o.mc(1,"floating-action-button",20,21),o.uc("click",(function(){return o.Rc(n),o.yc().toggleMenu()})),o.lc(),o.mc(3,"div",22),o.hc(4,"insert-buttons-container",23),o.lc(),o.lc()}if(2&t){var i=o.yc();o.Sb(1),o.Dc("trackAction",o.Hc(2,as))("tooltip",i.tooltipForFAB)}}function rs(t,e){1&t&&(o.mc(0,"div",24),o.hc(1,"floating-presentation-container"),o.lc())}function ss(t,e){if(1&t&&(o.xc(),o.wc(),o.mc(0,"simple-dropdown-item",31),o.uc("click",(function(){return e.$implicit.onClick()})),o.mc(1,"a",32),o.gd(2),o.lc(),o.lc()),2&t){var n=e.$implicit;o.Dc("item",n),o.Sb(2),o.hd(n.label)}}var cs=function(){return{closeOnItemClicked:!0,openOnHover:!1,closeOnBlur:!0,multiselectable:!1}};function ls(t,e){if(1&t&&(o.mc(0,"div",25),o.mc(1,"abs-dropdown",26),o.mc(2,"simple-dropdown-button",27),o.xc(),o.mc(3,"svg",28),o.hc(4,"use",29),o.lc(),o.lc(),o.ed(5,ss,3,2,"simple-dropdown-item",30),o.lc(),o.lc()),2&t){var n=o.yc();o.Sb(1),o.Dc("settings",o.Hc(3,cs)),o.Sb(1),o.Dc("items",n.contextMenuItems),o.Sb(3),o.Dc("ngForOf",n.contextMenuItems)}}function us(t,e){if(1&t){var n=o.nc();o.mc(0,"div"),o.mc(1,"panel-tag-bar",33),o.uc("buttonClick",(function(t){return o.Rc(n),o.yc().handleButtonClick(t)})),o.lc(),o.lc()}if(2&t){var i=e.ngIf,a=o.yc();o.Yb("fx-hidden",a.hasSearchResults()),o.Sb(1),o.Dc("buttons",i)("activeButton",a.activeToolbarButton)}}var ds=function(){return["fx-pointer-events-none","fx-hidden"]},ps=function(){return["fx-pointer-events-auto"]},hs=function(){return{event:"fab.moreshapes.click"}},gs=function(){return{event:"fab.templates.click"}},fs=function(){function t(t,e,n,i,a){this.translate=t,this.state=e,this.elementRef=n,this.modalController=i,this.userLocator=a,this.toolbarButtons=new O.a([]),this.hasOverlay=!1,this.triggerScrollUpdate=new le.a,this.subs=[],this.toolbarButtons=new O.a(this.toolbarBtns),this.menuViewState=Zo.Closed,this.floatingPanelViewState=Zo.Closed,this.isPinned=!0,this.inPresentation=new O.a(!1),this.hasSearch=!0}return Object.defineProperty(t.prototype,"tooltipForFAB",{get:function(){return this.menuViewState===Zo.Closed||this.menuViewState===Zo.Closing?this.translate.instant("TEMPLATE_PANEL.ADD_TO_WORKSPACE"):this.translate.instant("TOOLTIPS.CLOSE_PANEL")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selectedPanelId",{get:function(){return this.state.get("SelectedFloatingPanel")||"shapes"},set:function(t){this.panels&&(this._selectedPanel&&this._selectedPanel.id===t||(this._selectedPanel=this.panels.find((function(e){return e.id===t}))),this.state.get("SelectedFloatingPanel")!==t&&this.state.set("SelectedFloatingPanel",t))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activeToolbarButton",{get:function(){if(this.selectedPanelId)return"shapes"===this.selectedPanelId&&"Shapes"!==this.state.get("CurrentLibraryGroup")?this.state.get("CurrentLibraryGroup"):this.selectedPanelId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selectedPanel",{get:function(){return this._selectedPanel},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasActions",{get:function(){return this.hasSearch||this.hasContextMenu},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasContextMenu",{get:function(){var t,e,n;return!!(null===(n=null===(e=null===(t=this._selectedPanel)||void 0===t?void 0:t.contextMenuItems)||void 0===e?void 0:e.value)||void 0===n?void 0:n.length)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"contextMenuItems",{get:function(){var t,e,n;return(null===(n=null===(e=null===(t=this._selectedPanel)||void 0===t?void 0:t.contextMenuItems)||void 0===e?void 0:e.value)||void 0===n?void 0:n.filter((function(t){return t.available})))||[]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"toolbarBtns",{get:function(){var t=Object(J.uniqBy)(this.state.get("CurrentLibraries"),(function(t){return t.libGroup})).filter((function(t){return"Shapes"!==t.libGroup})).map((function(t){return{id:t.libGroup,label:t.libGroup}}));return Object(W.j)(this.defaultButtons,t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"defaultButtons",{get:function(){return[{id:"shapes",label:"Shapes",icon:"./assets/images/fab/fab-shapes.svg"},{id:"asset",label:"Imports",icon:"./assets/images/fab/fab-assets.svg"},{id:"icons",label:"Stickers",icon:"./assets/images/fab/fab-stickers.svg"},{id:"frames",label:"Frames",icon:"./assets/images/fab/fab-frames.svg"},{id:"embeds",label:"Embeds",icon:"./assets/images/fab/fab-frames.svg"}]},enumerable:!1,configurable:!0}),t.prototype.ngAfterViewInit=function(){this.subs.push(this.listenToToolbarButtonChanges().subscribe(),this.listenToPresentationState().subscribe(),this.listenFloatingPanelChanges().subscribe(),this.toggleOnLibStateChange().subscribe())},t.prototype.ngOnDestroy=function(){for(;this.subs.length;)this.subs.pop().unsubscribe();this.toolbarButtons.complete()},t.prototype.toggleOnLibStateChange=function(){var t=this;return this.state.changes("CurrentLibraries").pipe(Object(M.a)((function(){var e=t.state.get("SelectedFloatingPanel");if(e&&"shapes"!==e){if("none"===e)return t.toggleMenu(),void t.togglePanel("shapes");t.togglePanel("shapes")}})))},t.prototype.toggleMenu=function(){this.menuViewState===Zo.Opened?(i.Pb.track("fab.panel.close"),this.closeMenu(),this.toolbarButtons.next([])):(this.toolbarButtons.next(this.toolbarBtns),this.openMenu())},t.prototype.togglePanel=function(t,e){void 0===e&&(e=!1);var n=this.selectedPanelId===t;this.multiSearch&&"asset"!==t&&(this.multiSearch.clear(),this.multiSearch.focus()),this.selectedPanelId=t,"none"!==t?this.floatingPanelViewState===Zo.Opened?n&&!e?this.goToNextViewState(Zo.Closed):this.handleSelectedPanelOpen():(this.goToNextViewState(Zo.Opened),this.handleSelectedPanelOpen(),this.toolbarButtons.next(this.toolbarBtns)):this.goToNextViewState(Zo.Closed)},t.prototype.hasSearchResults=function(){var t,e;return!!(null===(e=null===(t=this.multiSearch)||void 0===t?void 0:t.showSearchResults)||void 0===e?void 0:e.value)},t.prototype.handleButtonClick=function(t){var e;this.triggerScrollUpdate.next(!0),(null===(e=this.toolbarButtons.value.find((function(e){return e.id===t})))||void 0===e?void 0:e.icon)?(this.state.set("SelectedFloatingPanel",t),"shapes"===t&&this.state.set("CurrentLibraryGroup","Shapes")):this.state.set("CurrentLibraryGroup",t)},t.prototype.handleMoreButtonClick=function(t){"more-shapes"===t?this.openLibraryBrowser():this.handleShowTemplates(),this.triggerScrollUpdate.next(!0)},t.prototype.openLibraryBrowser=function(){this.modalController.show(Ka.a)},t.prototype.handleShowTemplates=function(){return this.state.set("TemplateOriginLocation","floating-panel"),this.state.set("ToggleTemplatesModal",!0)},t.prototype.listenToToolbarButtonChanges=function(){var t=this;return this.state.changes("CurrentLibraries").pipe(Object(M.a)((function(){return t.toolbarButtons.next(t.toolbarBtns)})))},t.prototype.listenToPresentationState=function(){var t=this;return this.state.changes("PresentationStatus").pipe(Object(M.a)((function(e){e&&e.presentationId?(t.closeMenu(),t.inPresentation.next(!0)):t.inPresentation.next(!1)})))},t.prototype.getLibraryGroups=function(t){return Object($.a)(t).pipe(Object(I.a)((function(t){return t.map((function(t){return t.libGroup}))})),Object(I.a)((function(t){return Object(J.uniq)(t)})))},t.prototype.listenFloatingPanelChanges=function(){var t=this;return this.state.changes("SelectedFloatingPanel").pipe(Object(E.a)((function(t){return!!t})),Object(M.a)((function(e){t.menuViewState===Zo.Closed&&t.toggleMenu(),t.togglePanel(e,!0)})))},t.prototype.handleOutsideClick=function(){var t=this;return Object(P.a)(document,"mousedown").pipe(Object(E.a)((function(e){var n;return!t.elementRef.nativeElement.contains(e.target)&&!t.isPinned&&(null===(n=t.plusFab)||void 0===n?void 0:n.active)})),Object(M.a)((function(){return t.goToNextViewState(Zo.Closed)})))},t.prototype.openMenu=function(){this.plusFab.active=!0,this.menuViewState=Zo.Opened;var t="none"===this.selectedPanelId?"shapes":this.selectedPanelId;this.togglePanel(t,!0)},t.prototype.closeMenu=function(){this.plusFab.active=!1,this.menuViewState=Zo.Closed,this.floatingPanelViewState===Zo.Opened&&this.goToNextViewState(Zo.Closed)},t.prototype.handleSelectedPanelOpen=function(){var t,e;(null===(t=this.selectedPanel)||void 0===t?void 0:t.onOpen)&&this.selectedPanel.onOpen(),this.hasSearch=null===(e=this.selectedPanel)||void 0===e?void 0:e.hasSearch,this.plusFab.active=!0},t.prototype.handleSelectedPanelClose=function(){var t;(null===(t=this.selectedPanel)||void 0===t?void 0:t.onClose)&&this.selectedPanel.onClose()},t.prototype.goToNextViewState=function(t){var e=this;if(this.floatingPanelViewState!==t&&this.panelContainer){var n,i=this.floatingPanelViewState;switch(i){case Zo.Closed:t===Zo.Opened&&(n=Zo.Opening);break;case Zo.Opened:t===Zo.Closed&&(n=Zo.Closing)}n&&(this.floatingPanelViewState=n),this.transitionState(i,t).start().pipe(Object(M.a)({complete:function(){e.floatingPanelViewState=t,e.floatingPanelViewState===Zo.Closed&&e.handleSelectedPanelClose()}})).subscribe()}},t.prototype.transitionState=function(t,e){var n,a,o={opacity:0,transform:"translateY(75px)"},r={opacity:1,transform:"translateY(0)"};switch(t){case Zo.Closed:n=o;break;case Zo.Opened:n=r}switch(e){case Zo.Closed:a=o;break;case Zo.Opened:a=r}var s=new i.l({from:n,to:a,transitionProperty:"opacity, transform",duration:100,easing:"ease-in-out"});return s.element=this.panelContainer.nativeElement,s},t.\u0275fac=function(e){return new(e||t)(o.gc(r.e),o.gc(i.Nb),o.gc(o.r),o.gc(i.kb),o.gc(De.B))},t.\u0275cmp=o.ac({type:t,selectors:[["floating-panel-container"]],viewQuery:function(t,e){var n;(1&t&&(o.ld(ts,!0),o.ld(es,!0),o.ld(ns,!0),o.ld(is,!0)),2&t)&&(o.Mc(n=o.vc())&&(e.plusFab=n.first),o.Mc(n=o.vc())&&(e.panelContainer=n.first),o.Mc(n=o.vc())&&(e.multiSearch=n.first),o.Mc(n=o.vc())&&(e.panels=n))},decls:34,vars:36,consts:[[1,"floating-section"],["class","floating-menu-container",4,"ngIf"],["class","fx-pointer-events-auto",4,"ngIf"],[1,"floating-panel-container",3,"ngClass"],["panelContainer",""],["tooltip-tour-step","fab",1,"actions-container"],["tooltip-tour-step","fab-1.4.3"],["multiSearch",""],["class","context-menu-container",4,"ngIf"],[3,"fx-hidden",4,"ngIf"],[1,"panel-container"],["panel",""],[3,"triggerScrollUpdate"],[1,"more-btns-section"],["tooltip-tour-step","fab-1.4.1",1,"more-shapes-btn","btn-medium","btn-secondary","fx-span-width","fx-no-padding","fx-no-margin",3,"trackAction","click"],["src","./assets/images/fab/fab-all-shapes.svg",1,"fx-margin-right-8","nu-icon","nu-icon-xsmall"],[1,"more-shapes-btn","btn-medium","btn-primary","fx-span-width","fx-no-padding","fx-no-margin",3,"trackAction","click"],["src","./assets/images/quick-tool/templates-white.svg",1,"fx-margin-right-8","nu-icon","nu-icon-small"],["id","preview-popover"],[1,"floating-menu-container"],["tooltip-tour-step","new-fab-tooltip","icon","plus-large","size","large","activeAnimation","rotate",1,"plus-button",3,"trackAction","tooltip","click"],["plusFab",""],[1,"fx-pointer-events-auto","floating-quick-tools"],["tooltip-tour-step","fab-1.1"],[1,"fx-pointer-events-auto"],[1,"context-menu-container"],["direction","up",1,"context-menu",3,"settings"],["ddbutton","",3,"items"],[1,"nu-icon","nu-icon-more"],[0,"xlink","href","./assets/icons/symbol-defs.svg#nu-ic-more"],["dditem","",3,"item","click",4,"ngFor","ngForOf"],["dditem","",3,"item","click"],["translate","",1,"context-menu-item"],[3,"buttons","activeButton","buttonClick"]],template:function(t,e){1&t&&(o.mc(0,"div",0),o.ed(1,os,5,3,"div",1),o.zc(2,"async"),o.ed(3,rs,2,0,"div",2),o.zc(4,"async"),o.mc(5,"div",3,4),o.mc(7,"div",5),o.hc(8,"multi-search",6,7),o.ed(10,ls,6,4,"div",8),o.ed(11,us,2,4,"div",9),o.zc(12,"async"),o.lc(),o.mc(13,"div",10),o.hc(14,"icons-panel",null,11),o.hc(16,"frames-panel",null,11),o.hc(18,"embeds-panel",null,11),o.hc(20,"asset-panel",null,11),o.hc(22,"shapes-panel",12,11),o.lc(),o.mc(24,"div",13),o.mc(25,"button",14),o.uc("click",(function(){return e.handleMoreButtonClick("more-shapes")})),o.hc(26,"img",15),o.gd(27),o.zc(28,"async"),o.lc(),o.mc(29,"button",16),o.uc("click",(function(){return e.handleMoreButtonClick("templates")})),o.hc(30,"img",17),o.gd(31),o.zc(32,"async"),o.lc(),o.lc(),o.lc(),o.hc(33,"library-preview-popover",18),o.lc()),2&t&&(o.Sb(1),o.Dc("ngIf",0==o.Ac(2,22,e.inPresentation)),o.Sb(2),o.Dc("ngIf",o.Ac(4,24,e.inPresentation)),o.Sb(2),o.Yb("has-actions",e.hasActions),o.Dc("ngClass","closed"===e.floatingPanelViewState?o.Hc(32,ds):o.Hc(33,ps)),o.Sb(5),o.Dc("ngIf",e.hasContextMenu),o.Sb(1),o.Dc("ngIf",o.Ac(12,26,e.toolbarButtons)),o.Sb(3),o.Yb("fx-hidden","icons"!==e.selectedPanelId||e.hasSearchResults()),o.Sb(2),o.Yb("fx-hidden","frames"!==e.selectedPanelId||e.hasSearchResults()),o.Sb(2),o.Yb("fx-hidden","embeds"!==e.selectedPanelId||e.hasSearchResults()),o.Sb(2),o.Yb("fx-hidden","asset"!==e.selectedPanelId||e.hasSearchResults()),o.Sb(2),o.Yb("fx-hidden","shapes"!==e.selectedPanelId||e.hasSearchResults()),o.Dc("triggerScrollUpdate",e.triggerScrollUpdate),o.Sb(3),o.Dc("trackAction",o.Hc(34,hs)),o.Sb(2),o.id(" ",o.Ac(28,28,e.translate.get("SHAPES_PANEL.ALL_SHAPES"))," "),o.Sb(2),o.Dc("trackAction",o.Hc(35,gs)),o.Sb(2),o.id(" ",o.Ac(32,30,e.translate.get("SHAPES_PANEL.TEMPLATES"))," "))},directives:[k.t,k.q,$o.a,Fo,or,sr,lr,Ko,pr,fa.a,hr.a,Jo,ga.a,La,Yr,Na.a,Ha.a,k.s,Fa.a,r.a,$r],pipes:[k.b],styles:["[_nghost-%COMP%]{display:flex;align-items:flex-end;-webkit-align-items:flex-end}[_nghost-%COMP%]   .panel-container[_ngcontent-%COMP%]:has(.is-height-responsive:not(.fx-hidden)){min-height:100px;height:auto}[_nghost-%COMP%]   .panel-container[_ngcontent-%COMP%]:has(.is-height-responsive:not(.fx-hidden))  .floating-panel{max-height:calc(100vh - 196px - 210px)}.floating-section[_ngcontent-%COMP%]{display:flex;flex-direction:column-reverse}.plus-button[_ngcontent-%COMP%]{z-index:1}.floating-menu-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;position:relative}.menu-button[_ngcontent-%COMP%]{margin-bottom:.625rem;display:block}.menu-container[_ngcontent-%COMP%]{position:absolute;bottom:0;opacity:0;transition:transform .1s ease-in-out,opacity .1s ease-in-out}.menu-container.active[_ngcontent-%COMP%]{transform:translateY(-55px);opacity:1}@supports (background:-webkit-canvas(squares)){.floating-panel-container[_ngcontent-%COMP%]{left:80px}}.floating-panel-container[_ngcontent-%COMP%]{box-shadow:0 2px 2px rgba(0,0,0,.15),0 1px 12px rgba(0,0,0,.15);margin-bottom:1rem;margin-left:0;opacity:0;display:flex;flex-direction:column;flex-grow:1;background:#fff;border-radius:6px;width:228px}.floating-panel-container[_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%]{pointer-events:all;align-items:center;padding:6px 0 16px;height:112px}.floating-panel-container[_ngcontent-%COMP%]   .context-menu-item[_ngcontent-%COMP%]{padding:.5rem .25rem;color:#04263d;border-radius:.25rem;display:block}.floating-panel-container[_ngcontent-%COMP%]   .context-menu-item[_ngcontent-%COMP%]:hover{color:#04263d;background:#e1f1fb}.panel-container[_ngcontent-%COMP%]{height:calc(100vh - 196px - 210px);padding-right:.5rem;padding-left:.5rem;flex-grow:1}@media only screen and (max-width:1440px){.panel-container[_ngcontent-%COMP%]{height:calc(100vh - 196px - 210px)}}.floating-quick-tools[_ngcontent-%COMP%]{box-shadow:0 2px 2px rgba(0,0,0,.15),0 1px 12px rgba(0,0,0,.15);padding:.25rem .25rem .25rem 1.25rem;margin-left:-1rem;background:#fff;border-radius:4px 0 4px 4px;width:320px}.more-btns-section[_ngcontent-%COMP%]{padding:1rem;display:flex;flex-direction:column;gap:4px;position:relative}.more-shapes-btn[_ngcontent-%COMP%]{font-weight:500}"]}),t}(),bs=["sliderContainer"],ms=["slider"];function vs(t,e){if(1&t){var n=o.nc();o.mc(0,"button",10),o.uc("click",(function(){return o.Rc(n),o.yc().handlePreviousButtonClick()})),o.xc(),o.mc(1,"svg",11),o.hc(2,"use",12),o.lc(),o.lc()}}function ys(t,e){if(1&t){var n=o.nc();o.mc(0,"panel-toolbar-button",13),o.uc("click",(function(){o.Rc(n);var t=e.$implicit;return o.yc().buttonClick.next(t.id)})),o.lc()}if(2&t){var i=e.$implicit,a=o.yc();o.Dc("icon",null==i?null:i.icon)("label",null==i?null:i.label)("active",a.activeButton==i.id)}}function Ss(t,e){if(1&t){var n=o.nc();o.mc(0,"button",14),o.uc("click",(function(){return o.Rc(n),o.yc().handleNextButtonClick()})),o.xc(),o.mc(1,"svg",15),o.hc(2,"use",12),o.lc(),o.lc()}}var Os=function(t){return{left:t}},xs=function(){function t(t){this.state=t,this._buttons=new O.a([]),this.pinButtonClick=new o.t,this.buttonClick=new o.t,this.moreButtonClick=new o.t,this.sliderLeft=0,this.subs=[]}return Object.defineProperty(t.prototype,"buttons",{get:function(){return this._buttons.value},set:function(t){this._buttons.next(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sliderContainerWidth",{get:function(){return this.sliderContainer.nativeElement.offsetWidth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sliderWidth",{get:function(){return this.slider.nativeElement.scrollWidth},enumerable:!1,configurable:!0}),t.prototype.ngOnInit=function(){this.subs.push(this.listenToButtonChanges().subscribe())},t.prototype.handleNextButtonClick=function(){this.showPreviousButton||(this.showPreviousButton=!0);var e=this.sliderWidth-(this.sliderContainerWidth+-this.sliderLeft);e>0&&(e>t.SCROLL_STEP_SIZE?this.sliderLeft-=t.SCROLL_STEP_SIZE:this.sliderLeft-=e),-this.sliderLeft==this.sliderWidth-this.sliderContainerWidth&&(this.showNextButton=!1)},t.prototype.handlePreviousButtonClick=function(){this.showNextButton||(this.showNextButton=!0),this.sliderLeft<0&&(this.sliderLeft<-t.SCROLL_STEP_SIZE?this.sliderLeft+=t.SCROLL_STEP_SIZE:this.sliderLeft+=-this.sliderLeft),0===this.sliderLeft&&(this.showPreviousButton=!1)},t.prototype.listenToButtonChanges=function(){var t=this;return this._buttons.pipe(Object(ut.a)(1),Object(M.a)((function(){t.sliderWidth>t.sliderContainerWidth&&!t.showNextButton&&(t.showNextButton=!0)})))},t.SCROLL_STEP_SIZE=35,t.\u0275fac=function(e){return new(e||t)(o.gc(i.Nb))},t.\u0275cmp=o.ac({type:t,selectors:[["panel-toolbar"]],viewQuery:function(t,e){var n;(1&t&&(o.ld(bs,!0),o.ld(ms,!0)),2&t)&&(o.Mc(n=o.vc())&&(e.sliderContainer=n.first),o.Mc(n=o.vc())&&(e.slider=n.first))},inputs:{isPinned:"isPinned",activeButton:"activeButton",buttons:"buttons"},outputs:{pinButtonClick:"pinButtonClick",buttonClick:"buttonClick",moreButtonClick:"moreButtonClick"},decls:10,vars:7,consts:[[1,"panel-toolbar"],["class","panel-toolbar-slider-control-button previous",3,"click",4,"ngIf"],[1,"panel-toolbar-buttons-slider-container"],["sliderContainer",""],[1,"panel-toolbar-buttons-slider",3,"ngStyle"],["slider",""],["icon","pin",3,"active","click"],[3,"icon","label","active","click",4,"ngFor","ngForOf"],["icon","plus",3,"click"],["class","panel-toolbar-slider-control-button next",3,"click",4,"ngIf"],[1,"panel-toolbar-slider-control-button","previous",3,"click"],[1,"nu-icon","nu-ic-collapse-arrow-left"],[0,"xlink","href","./assets/icons/symbol-defs.svg#nu-ic-collapse-arrow"],[3,"icon","label","active","click"],[1,"panel-toolbar-slider-control-button","next",3,"click"],[1,"nu-icon","nu-ic-collapse-arrow-right"]],template:function(t,e){1&t&&(o.mc(0,"div",0),o.ed(1,vs,3,0,"button",1),o.mc(2,"div",2,3),o.mc(4,"div",4,5),o.mc(6,"panel-toolbar-button",6),o.uc("click",(function(){return e.pinButtonClick.next()})),o.lc(),o.ed(7,ys,1,3,"panel-toolbar-button",7),o.mc(8,"panel-toolbar-button",8),o.uc("click",(function(){return e.moreButtonClick.next()})),o.lc(),o.lc(),o.lc(),o.ed(9,Ss,3,0,"button",9),o.lc()),2&t&&(o.Sb(1),o.Dc("ngIf",e.showPreviousButton),o.Sb(3),o.Dc("ngStyle",o.Ic(5,Os,e.sliderLeft+"px")),o.Sb(2),o.Dc("active",e.isPinned),o.Sb(1),o.Dc("ngForOf",e.buttons),o.Sb(2),o.Dc("ngIf",e.showNextButton))},directives:[k.t,k.w,Wr,k.s],styles:[".panel-toolbar[_ngcontent-%COMP%]{display:flex;background:#fff;padding:10px 16px;position:relative}panel-toolbar-button[_ngcontent-%COMP%]:not(:last-child){margin-right:10px}.panel-toolbar-buttons-slider-container[_ngcontent-%COMP%]{overflow:hidden}.panel-toolbar-buttons-slider[_ngcontent-%COMP%]{display:flex;position:relative;transition:left .25s ease-in-out}.panel-toolbar-slider-control-button[_ngcontent-%COMP%]{width:16px;height:32px;background:transparent;display:flex;position:absolute;pointer-events:all;cursor:pointer}.panel-toolbar-slider-control-button.previous[_ngcontent-%COMP%]{left:0}.panel-toolbar-slider-control-button.next[_ngcontent-%COMP%]{right:0}.nu-ic-collapse-arrow-left[_ngcontent-%COMP%]{transform:rotate(180deg)}"]}),t}(),Cs=["quickToolCollapsibleMenu"],Ps=["quickToolScrollbar"],Ts=function(){function t(t,e,n){this.state=t,this.commandService=e,this.libraryList=n,this.subs=[]}return t.prototype.ngOnInit=function(){this.subs.push(this.listenToFloatingPanelChanges().subscribe(),this.listenToLibraryChanges().subscribe())},t.prototype.ngOnDestroy=function(){for(;this.subs.length>0;)this.subs.pop().unsubscribe()},t.prototype.initLibrary=function(){this.resetLibs(),this.updateMenu(this.getDefaultLibraries())},t.prototype.getDefaultLibraries=function(){var t,e=null===(t=this.state.get("CurrentLibraries"))||void 0===t?void 0:t.filter((function(t){return t.id.includes("custom-database-")})).length;return this.libraryList.getQuickToolLibraries().filter((function(t){return!!e||"quick-tool-database"!==t.id})).map((function(t){return{id:t.id,libGroup:t.libGroup,type:jn.c.Static,status:"loading"}}))},t.prototype.scrollToLibrary=function(t){var e=this.directiveScroll.directiveRef.elementRef.nativeElement.getBoundingClientRect(),n=this.directiveScroll.directiveRef.geometry(),i=this.collapsibleMenu.children?this.collapsibleMenu.getChildBounds(t):void 0;i&&i.height>e.height?this.directiveScroll.directiveRef.scrollToY(n.h-i.height,100):this.directiveScroll.directiveRef.scrollToBottom(0,100)},t.prototype.listenToFloatingPanelChanges=function(){var t=this;return this.state.changes("SelectedFloatingPanel").pipe(Object(E.a)((function(t){return"quick-toolbar"===t})),Object(M.a)((function(){return t.initLibrary()})))},t.prototype.resetLibs=function(){this.removeOtherLibrariesFromMenu([])},t.prototype.listenToLibraryChanges=function(){var t=this;return this.state.changes("SelectedFloatingPanel").pipe(Object(E.a)((function(t){return"quick-toolbar"===t})),Object(T.a)((function(){return t.state.changes("CurrentLibraries").pipe(Object(E.a)((function(t){return!!t})),Object(I.a)((function(t){return t.filter((function(t){return t.id.includes("custom-database-")})).map((function(t){return t.id}))})),Object(et.a)(),Object(M.a)((function(){var e=t.getDefaultLibraries();t.updateMenu(e)})))})))},t.prototype.updateMenu=function(t){this.addLibrariesToMenu(t),this.removeOtherLibrariesFromMenu(t)},t.prototype.addLibrariesToMenu=function(t){var e=this;t.length<=0||t.filter((function(t){return!e.collapsibleMenu.has(t.id)&&t.type===jn.c.Static})).forEach((function(t){t.type===jn.c.Static&&(t.id.includes("custom-database-")||t.id.includes("quick-tool-")?e.collapsibleMenu.add(i.u,er.a,{id:t.id,trackingInfo:{location:"FAB.QuickTool"}},!1,{collapsable:!1}):e.collapsibleMenu.add(i.u,nr.a,{id:t.id,trackingInfo:{location:"FAB.QuickTool"}},!1))}))},t.prototype.removeOtherLibrariesFromMenu=function(t){var e=this;this.collapsibleMenu.panels.forEach((function(n){t.find((function(t){return t.id===n.id}))||e.collapsibleMenu.detachById(n.id).subscribe()}))},t.\u0275fac=function(e){return new(e||t)(o.gc(i.Nb),o.gc(i.B),o.gc(Si.a))},t.\u0275cmp=o.ac({type:t,selectors:[["quick-toolbar-library-container"]],viewQuery:function(t,e){var n;(1&t&&(o.Yc(Cs,!0),o.Yc(Ps,!0)),2&t)&&(o.Mc(n=o.vc())&&(e.collapsibleMenu=n.first),o.Mc(n=o.vc())&&(e.directiveScroll=n.first))},decls:5,vars:0,consts:[[1,"lib-container"],["tooltip-tour-step","fab-1.1",1,"col-menu-scrollbar"],["quickToolScrollbar",""],[1,"lib-collapsible-menu"],["quickToolCollapsibleMenu",""]],template:function(t,e){1&t&&(o.mc(0,"div",0),o.mc(1,"perfect-scrollbar",1,2),o.hc(3,"collapsible-menu",3,4),o.lc(),o.lc())},directives:[$a.b,$o.a,ir.a],styles:[".lib-container[_ngcontent-%COMP%], [_nghost-%COMP%]{max-height:inherit;padding-left:8px;padding-right:4px}.lib-container[_ngcontent-%COMP%]   .lib-collapsible-menu[_ngcontent-%COMP%], [_nghost-%COMP%]   .lib-collapsible-menu[_ngcontent-%COMP%]{padding-right:4px}.lib-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%;height:inherit}.lib-container[_ngcontent-%COMP%]   perfect-scrollbar[_ngcontent-%COMP%]{max-height:inherit}.lib-container[_ngcontent-%COMP%]  .ps-content{margin-right:10px}.lib-container[_ngcontent-%COMP%]  .col-menu-item-heading-title{padding-left:5px}.lib-message[_ngcontent-%COMP%]{display:none}"],changeDetection:0}),t}(),ws=function(){function t(){this.id="quick-toolbar",this.hasSearch=!0,this.isPinned=!0}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=o.ac({type:t,selectors:[["quick-toolbar-panel"]],decls:4,vars:0,consts:[[1,"floating-panel","quick-toolbar-panel"],["tooltip-tour-step","fab"],[1,"lib-insert-btn-section","lib-padding"]],template:function(t,e){1&t&&(o.mc(0,"div",0),o.hc(1,"quick-toolbar-library-container",1),o.mc(2,"div",2),o.hc(3,"insert-buttons-container"),o.lc(),o.lc())},directives:[Ts,$o.a,La],styles:[".floating-panel[_ngcontent-%COMP%]{pointer-events:auto}.floating-panel[_ngcontent-%COMP%], [_nghost-%COMP%]{height:100%}.quick-toolbar-panel.no-libraries[_ngcontent-%COMP%]  .lib-shapes{height:0}.lib-padding[_ngcontent-%COMP%]{padding-left:8px;padding-right:8px}"],changeDetection:0}),t}(),js=n("HY3P"),Ms=n("bq/2"),Is=n("eaE7"),Es=n("BJDd"),Ds=n("XbJg"),_s=n("hb43"),ks=n("UfOR"),As=n("S8c2"),Ls=n("fdBj"),Bs=n("LX6Z"),Rs=n("6uE6"),Ns=n("Y4mt"),Hs=n("rPyh"),Fs=n("sIsI"),Gs=n("nmkj"),qs=n("OlX0"),Vs=n("uIWG"),Us=n("igS9"),zs=n("/kaM"),Ys=n("xejr"),Xs=n("0Ohc"),Ks=n("am3J"),Ws=n("ZFuN"),Zs=n("s01o"),Qs=n("HYfA"),Js=n("+ZK7"),$s=n("vd2+"),tc=n("HF29"),ec=n("QVgP"),nc=n("qtZD"),ic=n("bMav"),ac=n("UFl8"),oc=n("T4H+"),rc=n("thzy"),sc=n("NvYU"),cc=n("LSZy"),lc=n("S8Qb"),uc=n("uDTp"),dc=n("lQIu"),pc=n("D8VW"),hc=n("8uPo"),gc=n("GmW1"),fc=n("ys29"),bc=n("D+VW"),mc=n("8Tlt"),vc=n("rDL/"),yc=n("LiJA"),Sc=n("0Gjp"),Oc=n("eRmX"),xc=n("IG37"),Cc=n("XwbL"),Pc=n("uXwy"),Tc=n("g5Ym"),wc=n("QvAL"),jc=n("27m/"),Mc=n("iFwQ"),Ic=n("oysJ"),Ec=n("vEbn"),Dc=n("dDoe"),_c=n("tpYh"),kc=n("dfHf"),Ac=n("1ahL"),Lc=n("x7My"),Bc=n("TeX2"),Rc=n("PLkt"),Nc=n("4Kso"),Hc=n("/ege"),Fc=n("TT9f"),Gc=n("qvOF"),qc=n("x+xc"),Vc=function(){function t(){}return t.\u0275mod=o.ec({type:t}),t.\u0275inj=o.dc({factory:function(e){return new(e||t)},providers:[ta.a,ea.a,Tn.a,X.a,Ci.a,Si.a,da.a],imports:[[k.c,$i.m,S.p,ua.a,i.W,r.c,gr.g]]}),t}();o.Vc(Go.a,[k.q,k.r,k.s,k.t,k.A,k.w,k.x,k.y,k.z,k.u,k.v,$i.I,$i.x,$i.H,$i.d,$i.y,$i.B,$i.a,$i.E,$i.F,$i.A,$i.s,$i.t,$i.D,$i.o,$i.n,$i.z,$i.b,$i.e,$i.v,$i.w,$i.u,js.a,Ms.a,Is.a,Es.a,ga.a,Ds.a,_s.a,ks.a,As.a,Ls.a,Bs.a,Rs.a,ir.a,Ns.a,Hs.a,Fs.a,Gs.a,qs.a,Vs.a,Us.a,zs.b,Ys.a,Xs.a,Ks.a,Ws.a,A.a,Na.a,Zs.a,Qs.a,Js.a,Ir.a,Fa.a,Ha.a,$s.a,$a.b,$a.c,tc.a,ec.a,nc.a,ho.a,ic.a,ac.a,oc.a,rc.a,sc.a,Ja.a,cc.a,lc.a,uc.a,dc.b,pc.a,hc.a,gc.a,fc.a,bc.a,mc.a,hr.a,go.a,vc.a,yc.a,Sc.a,Oc.a,to.a,xc.a,Cc.a,Pc.a,Tc.a,tr.a,wc.a,jc.a,Mc.a,Ic.a,Ec.a,Dc.a,_c.a,kc.a,Ac.a,Lc.a,Bc.a,$o.a,Rc.a,Nc.a,ba.a,fa.a,Hc.a,Fc.a,r.a,Gc.a,gr.e,gr.f,gr.a,gr.b,gr.d,gr.c,Jo,fs,pr,ws,or,dr,Ts,ar,rr,cr,sr,lr,Ko,Xo,Go.a,La,Ra,xs,$r,Wr,Qa,lo,Ua,Fo,Lo,Yr,Mr],[k.b,k.G,k.p,k.k,k.E,k.g,k.C,k.F,k.d,k.f,k.i,k.j,k.l,qc.b,qc.a,r.d]),o.Vc(Qa,[k.q,k.r,k.s,k.t,k.A,k.w,k.x,k.y,k.z,k.u,k.v,$i.I,$i.x,$i.H,$i.d,$i.y,$i.B,$i.a,$i.E,$i.F,$i.A,$i.s,$i.t,$i.D,$i.o,$i.n,$i.z,$i.b,$i.e,$i.v,$i.w,$i.u,js.a,Ms.a,Is.a,Es.a,ga.a,Ds.a,_s.a,ks.a,As.a,Ls.a,Bs.a,Rs.a,ir.a,Ns.a,Hs.a,Fs.a,Gs.a,qs.a,Vs.a,Us.a,zs.b,Ys.a,Xs.a,Ks.a,Ws.a,A.a,Na.a,Zs.a,Qs.a,Js.a,Ir.a,Fa.a,Ha.a,$s.a,$a.b,$a.c,tc.a,ec.a,nc.a,ho.a,ic.a,ac.a,oc.a,rc.a,sc.a,Ja.a,cc.a,lc.a,uc.a,dc.b,pc.a,hc.a,gc.a,fc.a,bc.a,mc.a,hr.a,go.a,vc.a,yc.a,Sc.a,Oc.a,to.a,xc.a,Cc.a,Pc.a,Tc.a,tr.a,wc.a,jc.a,Mc.a,Ic.a,Ec.a,Dc.a,_c.a,kc.a,Ac.a,Lc.a,Bc.a,$o.a,Rc.a,Nc.a,ba.a,fa.a,Hc.a,Fc.a,r.a,Gc.a,gr.e,gr.f,gr.a,gr.b,gr.d,gr.c,Jo,fs,pr,ws,or,dr,Ts,ar,rr,cr,sr,lr,Ko,Xo,Go.a,La,Ra,xs,$r,Wr,Qa,lo,Ua,Fo,Lo,Yr,Mr],[k.b,k.G,k.p,k.k,k.E,k.g,k.C,k.F,k.d,k.f,k.i,k.j,k.l,qc.b,qc.a,r.d]);var Uc=n("Xpu5"),zc=n("Ax/4"),Yc=n("XRvk"),Xc=n("54H5"),Kc=n("CdCz"),Wc=n("f0nv"),Zc=n("CDoB"),Qc=n("mFH5"),Jc=n("R7+U"),$c=n("9jP7"),tl=n("ulve"),el=n("29Wa"),nl=n("Cd2c"),il=n("4h2T"),al=n("/YKq"),ol=n("gk5g"),rl=n("P0bA"),sl=n("0KF9"),cl=n("diDk"),ll=["viewContainer"],ul=function(t){function e(e,n,i,a,o,r,s,c){var l=t.call(this,e,n)||this;return l.componentFactoryResolver=e,l.injector=n,l.dtov=i,l.ll=a,l.ell=o,l.er=r,l.commandSvc=s,l.state=c,l.subs=[],l}return Object(W.e)(e,t),e.prototype.getDocuments=function(){return e.documents},e.prototype.ngAfterViewInit=function(){var t=this;this.subs.push(this.state.changes("CurrentDiagram").pipe(Object(T.a)((function(e){return t.state.changes("TiptapDocument").pipe(Object(rt.a)({diagramId:e}),Object(E.a)((function(t){return t.diagramId&&t.edataId&&t.entityId})),Object(T.a)((function(e){return t.manageDocument(e.edataId,e.diagramId,e.shapeId)})))}))).subscribe(),this.state.changes("CurrentDiagram").pipe(Object(T.a)((function(e){return t.manageShapeDeletes()}))).subscribe())},e.prototype.getEditor=function(t,e){var n=this,i=this.getDocuments()[t];return i?Object($.a)(i):this.createTiptap(t,e).pipe(Object(M.a)((function(e){return n.getDocuments()[t]=e})))},e.prototype.manageDocument=function(t,n,i){var a=this;return i?this.getEditor(t,n).pipe(Object(T.a)((function(o){o.instance.shapeIdSubject.next(i);var r=o.instance.editorSubject.value;return a.ll.forDiagram(n,!1).getDiagramOnce().pipe(Object(T.a)((function(e){return a.ell.getEDataModel(t).pipe(Object(I.a)((function(t){return{diagram:e,edata:t}})))})),Object(T.a)((function(o){var s=o.diagram,c=(o.edata,s.shapes[i]),l=c.entityId,u=document.querySelector('tiptap-editor-component[id="'+t+'"].notesEdata div[data-type="tiptap-child-editor-node"][entityid="'+l+'"]'),d=c.getDataItems(s);if(!u&&d.description&&d.description.value&&"string"==typeof d.description.value){var p=d.description.value,h=a.preparePrimaryTextNode(c,r).content;r.chain().focus().setTextSelection(r.state.doc.content.size).insertContent('<tiptap-child-editor-node entityid="'+l+'" >'+h+p+"</tiptap-child-editor-node>").blur().run(),a.cleanUpDocument(n);var g=e.getPrimaryTextNode(t,l).from;setTimeout((function(){void 0!==g&&r.chain().focus().setTextSelection(g+1).run()}),10)}else if(u&&!u.innerText.trim()){a.updatePrimaryTextNode(t,l,c);var f=e.getPrimaryTextNode(t,l).from;void 0!==f&&r.commands.setTextSelection(f+1)}else a.updatePrimaryTextNode(t,l,c);return setTimeout((function(){e.removeDuplicates(t,l)}),1e3),Object($.a)({})})))}))):Object($.a)({})},e.prototype.insertPrimaryTextNode=function(t,n,i){var a,o,r,s=e.getChildEditorNode(t,n),c=s.domNode,l=s.from,u=s.editor;if(c&&l&&u){var d=this.preparePrimaryTextNode(i,u).content;"primaryTextNode"!==(null===(r=null===(o=null===(a=c)||void 0===a?void 0:a.firstChild)||void 0===o?void 0:o.firstChild)||void 0===r?void 0:r.getAttribute("data-type"))&&u.chain().focus().setTextSelection(l).insertContent(d).blur().run()}},e.prototype.updatePrimaryTextNode=function(t,n,i){var a,o,r,s=e.getChildEditorNode(t,n),c=s.domNode,l=s.from,u=s.editor,d=i.primaryTextModel;if(d)if("primaryTextNode"===(null===(r=null===(o=null===(a=c)||void 0===a?void 0:a.firstChild)||void 0===o?void 0:o.firstChild)||void 0===r?void 0:r.getAttribute("data-type"))){var p=this.preparePrimaryTextNode(i,u),h=p.details,g=p.content;e.getPrimaryTextNode(t,n).domNode.querySelector("summary").innerHTML===d.plainText&&"<p></p>"===h||(u.chain().focus().setTextSelection(l+1).deleteNode("primaryTextNode").run(),u.chain().setTextSelection(l).insertContent(g).blur().run())}else this.insertPrimaryTextNode(t,n,i)},e.prototype.preparePrimaryTextNode=function(t,e){var n="",i="",a=!0,o=t.primaryTextModel,r=o.handlebarsReplacedText;r?(i=rl.a.convertCarotaToTiptapHtml(o.content,e.schema),a=!1,n=r):o&&"tiptapCanvas"===o.rendering?(rl.a.isUniformFormatWithNoLineBreaks(o.html)||(i=o.html,a=!1),n=(null==o?void 0:o.plainText)||""):((null==o?void 0:o.content.length)>1&&(n=o.plainText,i=rl.a.convertCarotaToTiptapHtml(o.content,e.schema),a=!1),n=(null==o?void 0:o.plainText)||""),i||(i="<p></p>");var s=document.createTextNode(n),c=document.createElement("div");c.innerHTML=i;var l=document.createElement("primary-text-node");l.setAttribute("showbutton",""+!a);var u=document.createElement("summary"),d=Object(sl.b)(n)||"ltr";return u.setAttribute("inactive",""+!a),u.setAttribute("dir",d),u.setAttribute("contenteditable",""+a),u.setAttribute("contenteditable",""+a),u.appendChild(s),l.appendChild(u),l.appendChild(c),{content:l.outerHTML,title:n,details:i,editable:a}},e.prototype.manageShapeDeletes=function(){var t=this;return this.ll.forCurrentObserver(!1).pipe(Object(T.a)((function(e){return Object(x.a)(e.getDiagramOnce().pipe(Object(M.a)((function(e){t.cleanUpTextNodes(e.id,Object.keys(e.shapes))}))),e.getDiagramChanges().pipe(Object(I.a)((function(e){"init"!==e.source&&e.split&&e.split.shapes&&Object.keys(e.split.shapes).map((function(n){!0===e.split.shapes[n].$unset&&t.removeShapeTextNodes(e.model.id,n)}))}))))})))},e.prototype.removeShapeTextNodes=function(t,e){(document.querySelectorAll('tiptap-editor-component[id="'+t+'"].notesEdata div[data-type="tiptap-child-editor-node"][entityid="'+e+'"]')||[]).forEach((function(t){return t.remove()}))},e.prototype.cleanUpTextNodes=function(t,e){(document.querySelectorAll('tiptap-editor-component[id="'+t+'"].notesEdata div[data-type="tiptap-child-editor-node"]')||[]).forEach((function(t){e.includes(t.getAttribute("shapeId"))||t.remove()}))},e.prototype.cleanUpDocument=function(t){(document.querySelectorAll('tiptap-editor-component[id="'+t+'"].notesEdata .prose > *')||[]).forEach((function(t){t.classList.contains("tiptap-child-editor")||t.remove()}))},e.removeDuplicates=function(t,e){(document.querySelectorAll('tiptap-editor-component[id="'+t+'"].notesEdata div[data-type="tiptap-child-editor-node"][entityid="'+e+'"]')||[]).forEach((function(t,e){e>0&&t.remove()})),(document.querySelectorAll('tiptap-editor-component[id="'+t+'"].notesEdata div[data-type="tiptap-child-editor-node"][entityid="'+e+'"] div[data-type="primaryTextNode"]')||[]).forEach((function(t,e){e>0&&t.remove()}))},e.prototype.ngOnDestroy=function(){for(;this.subs.length>0;)this.subs.pop().unsubscribe()},e.prototype.createTiptap=function(t,e){var n=this,i=this.makeComponent(al.a),a=i.instance;a.id="notesEdata",a.diagramId=e,a.edataId=t,a.transformPastedHTML=function(t){return n.transformPastedHTML(t)},this.insert(this.viewContainer,i),i.changeDetectorRef.detectChanges(),this.subs.push(this.escapeSub(a));var o=a.change.subscribe((function(t){n.onChildNodeviewChange(e,{shapeId:a.shapeIdSubject.value,html:t.html})}));return this.subs.push(o),i.instance.localSynced.pipe(Object(E.a)((function(t){return!!t})),Object(T.a)((function(){return i.instance.editorSubject})),Object(E.a)((function(t){return!!t})),Object(j.a)(1),Object(I.a)((function(){return i})))},e.prototype.escapeSub=function(t){return Object(P.a)(t.editorElement.nativeElement,"keydown").subscribe((function(e){e.keyCode===y.m.Escape&&t.change.next(t.getChildEditorHTML())}))},e.prototype.transformPastedHTML=function(t){var e=document.createElement("div");return e.innerHTML=t,e.querySelectorAll('div[data-type="detailsContent"]').forEach((function(t){t.removeAttribute("data-type"),t.querySelectorAll("*[style]").forEach((function(t){t.style.removeProperty("text-align")}))})),e.innerHTML},e.prototype.onChildNodeviewChange=function(t,e){var n,i=null==e?void 0:e.shapeId;i&&this.commandSvc.dispatch(D.a.changeShapeDataItems,t,((n={})[i]={description:{value:e.html}},n))},e.updateDocumentByModifier=function(t,n){var i=Object(we.L)(n);Object.keys(i.shapes||{}).forEach((function(n){if(Object.keys(i.shapes[n].$set||{}).includes("data.description.value")){var a=i.shapes[n].$set["data.description.value"];e.updateDocument(t,n,a)}}))},e.updateDocument=function(t,n,i){var a=e.getChildEditorNode(t,n),o=a.node,r=a.from,s=a.to,c=a.editor;c&&(i!==Object(ol.r)(o.content,c.schema)&&c.chain().focus().insertContentAt({from:r,to:s},i).blur().run())},e.getChildEditorNode=function(t,n){var i=e.documents[t].instance.editor,a=i.view.dom.querySelector('tiptap-editor-component[id="'+t+'"].notesEdata div[data-type="tiptap-child-editor-node"][entityid="'+n+'"]');if(a)for(var o=i.view.posAtDOM(a,0),r=i.view.state.doc.resolve(o),s=r.depth;s>0;s--){var c=r.node(s);if("tiptapChildEditor"===c.type.name)return{domNode:a,node:c,from:o,to:o+c.nodeSize-3,editor:i}}return{domNode:a}},e.getPrimaryTextNode=function(t,n){var i=e.documents[t].instance.editor,a=i.view.dom.querySelector('tiptap-editor-component[id="'+t+'"].notesEdata div[data-type="tiptap-child-editor-node"][entityid="'+n+'"] div[data-type="primaryTextNode"]');if(a)for(var o=i.view.posAtDOM(a,0),r=i.view.state.doc.resolve(o),s=r.depth;s>0;s--){var c=r.node(s);if("primaryTextNode"===c.type.name){var l=a.querySelector("summary").textContent,u="";return a.querySelector('div[data-type="detailsContent"]').textContent.trim()&&(u=a.querySelector('div[data-type="detailsContent"]').innerHTML),{domNode:a,node:c,from:o,to:o+c.nodeSize-3,editor:i,title:l,details:u}}}return{domNode:a}},e.documents={},e.\u0275fac=function(t){return new(t||e)(o.gc(o.m),o.gc(o.C),o.gc(f.a),o.gc(b.a),o.gc(cl.a),o.gc(o.r),o.gc(i.B),o.gc(i.Nb))},e.\u0275cmp=o.ac({type:e,selectors:[["tiptap-documents-manager-edata"]],viewQuery:function(t,e){var n;(1&t&&o.ld(ll,!0,o.hb),2&t)&&(o.Mc(n=o.vc())&&(e.viewContainer=n.first))},features:[o.Pb],decls:2,vars:0,consts:[["viewContainer",""]],template:function(t,e){1&t&&o.hc(0,"div",null,0)},styles:["[_nghost-%COMP%]{display:none}"],changeDetection:0}),e}(S.k),dl=[{matcher:function(t,e){var n;return"dashboard"===(null===(n=null==e?void 0:e.segments[0])||void 0===n?void 0:n.path)?{consumed:t}:null},resolve:[Qi],canDeactivate:[Qi],children:[{component:ha.a,path:""},{outlet:"dashboard-canvas-message",component:s,path:""}]},{path:"**",resolve:[Qi],canDeactivate:[Qi],children:[{component:ha.a,path:""},{outlet:"tiptap-docs",component:Zc.a,path:""},{outlet:"tiptap-docs-edata",component:ul,path:""},{outlet:"hyperlink-editor",component:Y.a,path:""},{outlet:"shapelink-editor",component:q,path:""},{outlet:"floating-panels",component:fs,path:""}]}],pl=function(){function t(t,e,n,i,a,o,r,s,c,l,u,d,p,h,f,b,m,v,y,S,O,x,C,P,T,w,j){this.mapper=t,this.defSumLocator=e,this.changeBindingSvc=n,this.textBoundsBinder=i,this.containerChangeBinder=a,this.containerRulesBinder=o,this.containerChildrenLayoutingBinder=r,this.shapeBoundsBinder=s,this.shapeAddedBinder=c,this.shapeAddedSanitizeBinder=l,this.connectorReconnectBinder=u,this.connectorReconnectBinderAutolayout=d,this.tableCellsResizeBinder=p,this.connectionChangeBinder=h,this.connectorLookupValueBinder=f,this.gluepointsBinder=b,this.textDataItemBinder=m,this.textParserinder=v,this.shapeCodeBinder=y,this.taskBinder=S,this.shapeEDataChangeBinder=O,this.searchService=x,this.defShapeSearchProvider=C,this.librarySearchProvider=P,this.state=T,this.dataDefCodeBinder=w,this.displayRuleBinder=j,this.state.set("ProjectDiagrams",{}),this.state.set("ProjectMap",{}),this.state.set("RecentDiagrams",[]),g.s.register(this.mapper),la.a.register(this.mapper),D.a.register(this.mapper),g.f.register(this.mapper),Uc.a.register(this.mapper),Ht.a.register(this.mapper),g.I.register(this.mapper),e.load().subscribe(),this.changeBindingSvc.register(m),this.changeBindingSvc.register(v),this.changeBindingSvc.register(i),this.changeBindingSvc.register(a),this.changeBindingSvc.register(o),this.changeBindingSvc.register(r),this.changeBindingSvc.register(s),this.changeBindingSvc.register(c),this.changeBindingSvc.register(l),this.changeBindingSvc.register(u),this.changeBindingSvc.register(d),this.changeBindingSvc.register(p),this.changeBindingSvc.register(h),this.changeBindingSvc.register(f),this.changeBindingSvc.register(b),this.changeBindingSvc.register(y),this.changeBindingSvc.register(S),this.changeBindingSvc.register(j),this.changeBindingSvc.register(w),this.changeBindingSvc.register(O),this.searchService.register(C),this.searchService.register(P)}return t.\u0275mod=o.ec({type:t}),t.\u0275inj=o.dc({factory:function(e){return new(e||t)(o.qc(i.z),o.qc(ea.a),o.qc(na.a),o.qc(K.a),o.qc(h.a),o.qc(Xc.a),o.qc(p.a),o.qc(V.a),o.qc(u.a),o.qc(d.a),o.qc(z.a),o.qc($c.a),o.qc(il.a),o.qc(c.a),o.qc(Kc.a),o.qc(U.a),o.qc(ia.a),o.qc(aa.a),o.qc(oa.a),o.qc(zc.a),o.qc(l.a),o.qc(ca.a),o.qc(ra.a),o.qc(sa.a),o.qc(i.Nb),o.qc(Yc.a),o.qc(Wc.a))},providers:[Qi,se,de,ce.b,Pi,ta.a,ea.a,Tn.a,X.a,Ci.a,z.a,$c.a,U.a,u.a,d.a,Si.a,da.a,ki],imports:[[Ji.h.forChild(dl),k.c,$i.m,S.p,pa.a,Vc,ua.a,i.W,Jc.b,Qc.l,r.c,tl.b,el.e,nl.c,$i.C]]}),t}()}}]);
//# sourceMappingURL=30.c001cdec050a588bf2d5.js.map