/**
 * Indicative.js - v1.0.1 - Build Date: 2020-12-07
 * https://www.indicative.com
 *
 * Copyright (c) 2020 Indicative
 * Indicative JavaScript library includes code from Google's json-sans-eval project
 * to decode a JSON string into a JavaScript object.
 * The json-sans-eval library is Copyright (c) 2008 Google Inc. and is available
 * at https://code.google.com/p/json-sans-eval/
 */

!function(a,b){"function"==typeof define&&define.amd?define(b):a.Indicative=b()}(window,function(){"use strict";function a(a){if(this.clearProperties(),void 0===a&&(a=!0),this._useCookie=a,a){var b=m.getCookie();b&&b.props&&(this.properties=b.props,l.info("Loaded in properties from cookie!",this.properties))}}function b(){this.initalized=!1,this._util=m}var c,d,e=!1,f=30,g=!1,h=!1,i=!1,j={cookiesOnMainDomain:"cookiesOnMainDomain",domainName:"domainName",recordSessions:"recordSessions",sessionsThreshold:"sessionsThreshold",forms:"forms",links:"links"},k={encode:function(a){if(JSON&&JSON.stringify)return JSON.stringify(a);var b=[],c="[object Array]"===Object.prototype.toString.apply(a);for(var d in a){var e=a[d];if("object"==typeof e)c?b.push(this.encode(e)):b.push('"'+d+'":'+this.encode(e));else{var f="",g=d.replace(/[\\"]/g,"\\$&");if(c||(f='"'+g+'":'),"number"==typeof e)f+=e;else if(!1===e)f+="false";else if(!0===e)f+="true";else{var h=e.replace(/[\\"]/g,"\\$&");f+='"'+h+'"'}b.push(f)}}var i=b.join(",");return c?"["+i+"]":"{"+i+"}"},decode:function(){function a(a,b,c){return b?d[b]:String.fromCharCode(parseInt(c,16))}var b=new RegExp('(?:false|true|null|[\\{\\}\\[\\]]|(?:-?\\b(?:0|[1-9][0-9]*)(?:\\.[0-9]+)?(?:[eE][+-]?[0-9]+)?\\b)|(?:"(?:[^\\0-\\x08\\x0a-\\x1f"\\\\]|\\\\(?:["/\\\\bfnrt]|u[0-9A-Fa-f]{4}))*"))',"g"),c=new RegExp("\\\\(?:([^u])|u(.{4}))","g"),d={'"':'"',"/":"/","\\":"\\",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"};Object,Array;return function(d){try{d=d.replace("\\'","'"),d=d.replace("\\’","’"),d=d.replace("\\‘","‘"),d=d.replace("\\’","’")}catch(a){log.error("Could not remove bad escape characters...")}if(JSON&&JSON.parse)return JSON.parse(d);var e,f=d.match(b),g=f[0];if("{"===g)e={};else{if("["!==g)throw new Error(g);e=[]}for(var h,i=[e],j=1,k=f.length;j<k;++j){g=f[j];var l;switch(g.charCodeAt(0)){default:l=i[0],l[h||l.length]=+g,h=void 0;break;case 34:if(g=g.substring(1,g.length-1),-1!==g.indexOf("\\")&&(g=g.replace(c,a)),l=i[0],!h){if(!(l instanceof Array)){h=g||"";break}h=l.length}l[h]=g,h=void 0;break;case 91:l=i[0],i.unshift(l[h||l.length]=[]),h=void 0;break;case 93:i.shift();break;case 102:l=i[0],l[h||l.length]=!1,h=void 0;break;case 110:l=i[0],l[h||l.length]=null,h=void 0;break;case 116:l=i[0],l[h||l.length]=!0,h=void 0;break;case 123:l=i[0],i.unshift(l[h||l.length]={}),h=void 0;break;case 125:i.shift()}}if(i.length)throw new Error;return e}}()},l=(window.console,{log:function(){},debug:function(){},info:function(){},error:function(){}}),m={isString:function(a){return"string"==typeof a},isNumber:function(a){return"number"==typeof a},isBoolean:function(a){return"boolean"==typeof a},isObject:function(a){return null!==a&&"object"==typeof a},objectSize:function(a){var b,c=0;for(b in a)a.hasOwnProperty(b)&&c++;return c},contains:function(a,b){return b.indexOf(a)>=0},clone:function(a){if(null==a||"object"!=typeof a)return a;var b=a.constructor();for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},trimString:function(a){return"function"==typeof String.prototype.trim?a.trim():a.replace(/^\s+|\s+$/g,"")},buildGetQuery:function(a){var b=[];for(var c in a)this.isString(c)&&this.isString(a[c])&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return"?"+b.join("&")},buildPropertyQueryParams:function(a){var b=[];for(var c in a)this.isString(c)&&this.isString(a[c])&&(b.push("propertyNames="+encodeURIComponent(c)),b.push("propertyValues="+encodeURIComponent(a[c])));return"&"+b.join("&")},extend:function(a,b){var c;if(null!=b)for(c in b)a[c]=b[c];return a},getCookie:function(){if(document.cookie)for(var a=document.cookie.split(";"),b=0;b<a.length;b++){var d=m.trimString(a[b]);if(d&&0===d.indexOf(c)){var e=k.decode(decodeURIComponent(d.substring(c.length+2,d.length-1)))||{};return e||{}}}return{}},_setCookie:function(a){document.cookie=a},setCookie:function(a){if(c){var b=new Date;b.setDate(b.getDate()+365),b=b.toUTCString();var d=[c,'="',encodeURIComponent(k.encode(a)),'";'," path=/;"," expires=",b];if(i){this.getDomainName().indexOf(".")>-1&&(d.push("; domain="),d.push([".",this.getDomainName()].join("")))}var e=d.join("");l.log("setting cookie to be : ",e),this._setCookie(e)}},generateUUID:function(){var a=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"==b?c:7&c|8).toString(16)})},_getFullHostName:function(){return window.location.host},getDomainName:function(){if(d)return d;var a=this._getFullHostName(),b=a.substring(a.lastIndexOf(".",a.lastIndexOf(".")-1)+1),c=b.split(":");if(c.length>1){var e=c[0],f="",g=c[1].split(".");g.length>1&&(f=[".",g[1]].join("")),b=[e,f].join("")}return b}};a.prototype._setPropertiesCookie=function(){if(this._useCookie){var a=m.getCookie();a.props=this.properties,m.setCookie(a),l.info("saved cookie!",a)}},a.prototype.getProperties=function(){return this.properties},a.prototype.addProperties=function(a){l.info("IndicativePropertyManager.addProperties()",this.properties),l.info("adding props",a);var b;if(a instanceof Array)for(var c=0;c<a.length;c++){var d=a[c];if(d instanceof Array&&2===d.length)this.addProperty(d[0],d[1],!1);else if(d instanceof Object)for(b in d)this.addProperty(b,d[b],!1)}if(a instanceof Object)for(b in a)this.addProperty(b,a[b],!1);this._setPropertiesCookie()},a.prototype.addProperty=function(a,b,c){if(c=void 0===c||!1,a&&void 0!==b){var d=m.isString(b),e=d||m.isNumber(b)||m.isBoolean(b);if(l.info("adding property in manager"),m.isString(a))if(e)l.info("we can set the property here"),d&&(b=b.replace(/(\r)/g," "),b=b.replace(/(\n)/g," ")),this.properties[a]=b,l.info(this.properties);else if(m.isObject(b))for(var f in b){var g=a+"_"+f;this.addProperty(g,b[f],c)}c&&(l.info("Adding cookie"),this._setPropertiesCookie())}},a.prototype.incrementProperty=function(a,b){if(!m.isString(a))return void l.warn("Cannot increment value for non string property key");b=m.isNumber(b)?b:1;var c=this.properties[a];if(m.isString(c))try{var d=parseInt(c);isNaN(d)||(c=d)}catch(a){}if(m.isNumber(c)){var e=c+b;this.addProperty(a,e)}else this.addProperty(a,b)},a.prototype.removeProperty=function(a){delete this.properties[a],this._setPropertiesCookie()},a.prototype.clearProperties=function(){this.properties={},this._setPropertiesCookie()},b.prototype._resetUniqueIDToDefault=function(a,b){a=a||m.getCookie(),a.defaultUniqueID&&!b||(l.info("Generating random uniqueness ID"),this._createDefaultUniqueID(a)),this.uniqueID=a.defaultUniqueID},b.prototype._setUniqueIDCookie=function(){var a=m.getCookie();this.uniqueID?a.uniqueID=this.uniqueID:delete a.uniqueID,m.setCookie(a)},b.prototype._createDefaultUniqueID=function(a){a=a||m.getCookie(),a.defaultUniqueID=m.generateUUID(),m.setCookie(a)},b.prototype._handleInitParams=function(a){if(a){i=!!a[j.cookiesOnMainDomain],d=a[j.domainName],e=!!a[j.recordSessions];var b=a[j.sessionsThreshold];b&&m.isNumber(b)&&b>=1&&(f=b),g=!!a[j.forms],h=!!a[j.links]}},b.prototype.initialize=function(b,d){if(!this.initalized){this.initalized=!0,c="Indicative_"+b,this._handleInitParams(d),this.apiKey=b,this.properties=new a;var e=m.getCookie();e&&e.uniqueID?(this.uniqueID=e.uniqueID,l.info("Loaded in uniqueID from cookie!",this.uniqueID)):e&&this._resetUniqueIDToDefault(e),l.info("What is uniqueID? ",this.uniqueID),g&&this._trackForms(),h&&this._trackLinks()}},b.prototype.setUniqueID=function(a,b,c){a?(this.uniqueID=a,this._setUniqueIDCookie(),b&&this.sendAlias(c)):this.clearUniqueID()},b.prototype.clearUniqueID=function(a){delete this.uniqueID,this._setUniqueIDCookie(),this._resetUniqueIDToDefault(null,a)},b.prototype.getDefaultUniqueID=function(){return m.getCookie().defaultUniqueID},b.prototype.getProperties=function(){if(this.properties)return this.properties.getProperties()},b.prototype.addProperty=function(a,b){this.properties.addProperty(a,b)},b.prototype.incrementProperty=function(a,b){this.properties.incrementProperty(a,b||1)},b.prototype.addProperties=function(a){this.properties.addProperties(a)},b.prototype.removeProperty=function(a){this.properties.removeProperty(a)},b.prototype.clearProperties=function(){this.properties.clearProperties()},b.prototype.sendAlias=function(a){var b=m.getCookie();if(b){var c=b.defaultUniqueID,d=b.uniqueID;if(c&&d){var e={apiKey:this.apiKey,previousId:c,newId:d};this._sendAlias(e,a)}}},b.prototype.buildEvent=function(b,c,d,e,f,g,h){function i(a){l.info("_eventPropsOrCallback this ",a),a&&("function"==typeof a?(l.info("It's a callback!"),k=a):"object"==typeof a&&(l.info("It's eventProperties!"),j=a))}if(l.info("Building event ",b,c,d,e),!this.apiKey)return l.info("missing something"),l.error("Cannot send an event without an api key"),!1;if(!b)return l.info("missing something name "),l.error("Cannot send an event without an event name"),!1;if(!this.uniqueID)return l.info("missing uniqueID"),l.error("Cannot send an event without a uniqueID"),!1;var j,k,n=this.uniqueID,o=m.clone(this.properties.getProperties());if(c&&(m.isString(c)?(n=c,i(d),i(e)):(i(c),i(d))),j){var p=new a(!1);p.addProperties(j),m.extend(o,p.getProperties())}g||m.extend(o,this._buildStaticProps());var q={apiKey:this.apiKey,eventName:b};if(n&&(q.eventUniqueId=n),o&&(q.properties=o),f)return l.info("returning event"),q;this._sendEvent(q,k,h)},b.prototype.linkClick=function(a,b){var c=a.target.getAttribute("href"),b=b||a.target.innerText||c,d={link_url:c,link_name:b,link_text:a.target.innerText};a.preventDefault(),this.buildEvent("Link Click",d,function(){c&&(window.location=c)})},b.prototype.formSubmit=function(a){if(!a.defaultPrevented){var b=this._buildFormProps(a.target);a.preventDefault(),this.buildEvent("Form Submit",b,function(a){a.target.submit()}.bind(this,a))}},b.prototype._trackLinks=function(){for(var a=document.getElementsByTagName("a"),b=0;b<a.length;b++)a[b].addEventListener("click",this.linkClick.bind(this))},b.prototype._trackForms=function(){for(var a=document.getElementsByTagName("form"),b=0;b<a.length;b++)a[b].addEventListener("submit",this.formSubmit.bind(this))},b.prototype._buildFormProps=function(a){var b={form:{inputs:{}}},c=["id","name"];for(var d in c){var e=c[d];a[e]&&(b.form[e]=a[e])}var f=["input","select"],g=[];for(var h in f)for(var i=f[h],j=a.getElementsByTagName(i),k=0;k<j.length;k++){var l=j[k];if("select"===i||"text"===l.type||"radio"===l.type||"checkbox"===l.type){var m=l.name,n=/pass|billing|creditcard|cardnum|^cc|ccnum|exp|seccode|securitycode|securitynum|cvc|cvv|ssn|socialsec|socsec|csc/i;m&&-1===m.search(n)&&g.push(l)}}var o=["name","id","value"];for(var p in g){var q=g[p],r={},s=p;"checkbox"===q.type||"radio"===q.type?(q.value?s=q.value:q.id&&(s=q.id),r.checked=q.checked):q.name?s=q.name:q.id&&(s=q.id),b.form.inputs[s]&&(s=s+"-"+p),q.type&&"INPUT"===q.nodeName.toUpperCase()&&(r.type=q.type);for(var t in o){var u=o[t];q[u]&&(r[u]=q[u])}b.form.inputs[s]=r}return b},b.prototype._updateSession=function(){if(e&&f>=1){var a=(new Date).getTime(),b=m.getCookie(),c=b.lastSessionTime;(!c||c+6e4*f<=a)&&this.buildEvent("Web Session (Automatic)",void 0,void 0,void 0,void 0,!1,!0),b.lastSessionTime=a,m.setCookie(b)}},b.prototype.buildAutomaticEvent=function(a){var b=this.buildEvent(a,void 0,void 0,void 0,!0);b.automatic=!0,this._sendEvent(b)},b.prototype._sendEvent=function(a,b,c){c||this._updateSession(),this._postObjToEndpoint(a,"/event",b)},b.prototype._sendAlias=function(a,b){this._postObjToEndpoint(a,"/alias",b)},b.prototype._postObjToEndpoint=function(a,b,c){l.info("Recording event ",a),l.info("Endpoint suffix ",b);var d="//api.indicative.com/service"+b,e=!1;if(window.XMLHttpRequest){var f=new XMLHttpRequest;if(void 0!==f.withCredentials){e=!0,f.onreadystatechange=function(){if(4==f.readyState)if(200===f.status)l.info("Successful stat post!"),l.info("What is callback? ",c),c&&c();else{var a="Error HTTP status: "+f.status+" "+f.statusText;if(l.error(a),422===f.status)return l.error("posting unprocessable object"),!1;c&&c()}},f.open("POST",d,!0),f.setRequestHeader("Content-Type","application/json"),f.setRequestHeader("Indicative-Client","javascript");try{f.send(k.encode(a))}catch(a){l.info("exception",a)}}}if(!e){var g;g=a.properties?[d,m.buildGetQuery(a),m.buildPropertyQueryParams(a.properties),"&breakcache="+Math.random()].join(""):[d,m.buildGetQuery(a),"&breakcache="+Math.random()].join(""),l.info("what is url?"),l.info(g),setTimeout(function(){var a=document.createElement("script");a.setAttribute("src",g),a.setAttribute("type","application/json"),a.setAttribute("async","true"),a.setAttribute("defer","true");var b=!1;a.onload=a.onreadystatechange=function(){l.info("loaded!!!!");var a=this.readyState;a&&"complete"!=a&&"loaded"!=a||!b&&c&&(b=!0,c())};var d=document.getElementsByTagName("script")[0];d.parentNode.insertBefore(a,d)},100)}};var n={browser:function(a){return window.opera?m.contains("Opera Mini",a)?"OperaMini":m.contains("Opera Mobi")?"OperaMobile":"Opera":m.contains("BlackBerry",a)?"BlackBerry":m.contains("Blazer",a)?"Blazer":m.contains("IEMobile",a)?"IEMobile":m.contains("MSIE",a)?"IE":m.contains("GoBrowser",a)?"GoBrowser":m.contains("Chrome",a)?"Chrome":m.contains("Apple",a)?m.contains("Mobile",a)?"SafariMobile":"Safari":m.contains("Firefox",a)?"Firefox":m.contains("Android",a)?"Android":m.contains("Gecko",a)?"Mozilla":null},os:function(a){return m.contains("Android",a)?"Android":m.contains("iPhone",a)||m.contains("iPad",a)||m.contains("iPod",a)?"iOS":m.contains("BlackBerry",a)?"BlackBerry":m.contains("Mac",a)?"MacOS":m.contains("Linux",a)?"Linux":m.contains("Windows",a)?"Windows":null},device:function(a){return m.contains("Android",a)||m.contains("webOS",a)||m.contains("iPhone",a)||m.contains("iPad",a)||m.contains("iPod",a)||m.contains("BlackBerry",a)||m.contains("Windows Phone",a)?"Mobile":"Web"}};return b.prototype._mapSearchParams=function(a){var b={};a=decodeURIComponent(a);for(var c=a.substring(1),d=c.split("&"),e=0;e<d.length;e++){var f=d[e].split("="),g=f[0],h=f[1];b[g]?b[g]=b[g]+","+h:b[g]=h}return b},b.prototype._utm_parse=function(a){return{source:a.utm_source,medium:a.utm_medium,term:a.utm_term,content:a.utm_content,campaign:a.utm_campaign}},b.prototype._parse_referral=function(a){var b={},c=a.split("://");if(c[0]&&(b.protocol=c[0]),c[1]){var d=c[1].split("/");if(d[0]&&(b.domain=d[0]),d[1]){d.shift();var e=d.join("/").split("?");e[0]&&(b.path=e[0]),e[1]&&(b.query=e[1])}}return b},b.prototype._buildStaticProps=function(){var a={},c=window.navigator.userAgent,d=window.document,e=n.browser(c);e&&(a.browser=e);var f=n.os(c);f&&(a.browser_os=f);var g=n.device(c);g&&(a.browser_device=g);var h=d.referrer;if(h){a.browser_referrer=h;var i=b.prototype._parse_referral(h);i.protocol&&(a.browser_referrer_protocol=i.protocol),i.domain&&(a.browser_referrer_domain=i.domain),i.path&&(a.browser_referrer_path=i.path),i.query&&(a.browser_referrer_query=i.query)}var j=window.navigator.userLanguage||window.navigator.language;j&&(a.browser_language=j);var k=d.title;k&&(a.page_title=k),a.page_url=location.href,a.page_url.length>255&&(a.page_url=a.page_url.substring(0,255));var l=b.prototype._mapSearchParams(d.location.search),m=b.prototype._utm_parse(l);return m.source&&(a.campaign_source=m.source,a.$indicative_utm_source=m.source),m.medium&&(a.campaign_medium=m.medium,a.$indicative_utm_medium=m.medium),m.term&&(a.campaign_term=m.term,a.$indicative_utm_term=m.term),m.content&&(a.campaign_content=m.content,a.$indicative_utm_content=m.content),m.campaign&&(a.campaign_name=m.campaign,a.$indicative_utm_campaign=m.campaign),a},b.prototype.getAPIKey=function(){return this.apiKey},b.prototype.getUniqueID=function(){return this.uniqueID},b.prototype.getJson=function(){return k},new b});